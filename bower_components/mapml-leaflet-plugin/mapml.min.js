/*! mapml-leaflet-client 17-02-2018 */
function URI(a){a||(a="");var b=/^(?:([^:\/?\#]+):)?(?:\/\/([^\/?\#]*))?([^?\#]*)(?:\?([^\#]*))?(?:\#(.*))?/,c=a.match(b);this.scheme=c[1]||null,this.authority=c[2]||null,this.path=c[3]||null,this.query=c[4]||null,this.fragment=c[5]||null}URI.prototype.toString=function(){var a="";return this.scheme&&(a+=this.scheme+":"),this.authority&&(a+="//"+this.authority),this.path&&(a+=this.path),this.query&&(a+="?"+this.query),this.fragment&&(a+="#"+this.fragment),a},function(){function a(a,b){var c=/^(.*)\//;return a.authority&&!a.path?"/"+b:a.path.match(c)[0]+b}function b(a){if(!a)return"";var b=a.replace(/\/\.\//g,"/");for(b=b.replace(/\/\.$/,"/");b.match(c);)b=b.replace(c,"/");for(b=b.replace(/\/([^\/]*)\/\.\.$/,"/");b.match(/\/\.\.\//);)b=b.replace(/\/\.\.\//,"/");return b}var c=/\/((?!\.\.\/)[^\/]*)\/\.\.\//;URI.prototype.resolve=function(c){var d=new URI;return this.scheme?(d.scheme=this.scheme,d.authority=this.authority,d.path=b(this.path),d.query=this.query):(this.authority?(d.authority=this.authority,d.path=b(this.path),d.query=this.query):(this.path?("/"===this.path.charAt(0)?d.path=b(this.path):(d.path=a(c,this.path),d.path=b(d.path)),d.query=this.query):(d.path=c.path,this.query?d.query=this.query:d.query=c.query),d.authority=c.authority),d.scheme=c.scheme),d.fragment=this.fragment,d}}(),function(a,b,c){var d={};a.M=d,function(){d.mime="text/mapml",d.CBMTILE=new L.Proj.CRS("EPSG:3978","+proj=lcc +lat_1=49 +lat_2=77 +lat_0=49 +lon_0=-95 +x_0=0 +y_0=0 +ellps=GRS80 +datum=NAD83 +units=m +no_defs",{resolutions:[38364.660062653464,22489.62831258996,13229.193125052918,7937.5158750317505,4630.2175937685215,2645.8386250105837,1587.5031750063501,926.0435187537042,529.1677250021168,317.50063500127004,185.20870375074085,111.12522225044451,66.1459656252646,38.36466006265346,22.48962831258996,13.229193125052918,7.9375158750317505,4.6302175937685215,2.6458386250105836,1.5875031750063502,.9260435187537043,.5291677250021167,.31750063500127,.18520870375074083,.11112522225044451,.06614596562526459],origin:[-34655800,3931e4]}),d.APSTILE=new L.Proj.CRS("EPSG:5936","+proj=stere +lat_0=90 +lat_ts=50 +lon_0=-150 +k=0.994 +x_0=2000000 +y_0=2000000 +datum=WGS84 +units=m +no_defs",{resolutions:[238810.813354,119405.406677,59702.7033384999,29851.3516692501,14925.675834625,7462.83791731252,3731.41895865639,1865.70947932806,932.854739664032,466.427369832148,233.213684916074,116.606842458037,58.3034212288862,29.1517106145754,14.5758553072877,7.28792765351156,3.64396382688807,1.82198191331174,.910990956788164,.45549547826179],origin:[-28567784.109255,32567784.109255]}),d.OSMTILE=L.CRS.EPSG3857,L.setOptions(d.OSMTILE,{origin:[-20037508.342787,20037508.342787],resolutions:[156543.0339,78271.51695,39135.758475,19567.8792375,9783.93961875,4891.969809375,2445.9849046875,1222.9924523438,611.49622617188,305.74811308594,152.87405654297,76.437028271484,38.218514135742,19.109257067871,9.5546285339355,4.7773142669678,2.3886571334839,1.1943285667419,.59716428337097,.29858214168549,.14929107084274,.074645535421371,.03732276771068573,.018661383855342866,.009330691927671433]})}(),d.Util={coordsToArray:function(a){for(var b=1,c=[],d=a.split(",");b<d.length;b+=2)c.push([parseInt(d[b-1]),parseInt(d[b])]);return c}},d.coordsToArray=d.Util.coordsToArray,d.MapMLLayer=L.Layer.extend({options:{maxNext:10,zIndex:0,maxZoom:25},initialize:function(a,b,c){a&&(this._href=a);var d=!!b.querySelector("image,feature,tile");d&&(this._content=b),this._container=L.DomUtil.create("div","leaflet-layer"),L.DomUtil.addClass(this._container,"mapml-layer"),this._imageContainer=L.DomUtil.create("div","leaflet-layer",this._container),L.DomUtil.addClass(this._imageContainer,"mapml-image-container"),this._mapmlTileContainer=L.DomUtil.create("div","mapml-tile-container"),this._initCount=0,this._initExtent(d?b:null),this.on("attached",this._validateExtent,this),L.setOptions(this,c)},setZIndex:function(a){return this.options.zIndex=a,this._updateZIndex(),this},_updateZIndex:function(){this._container&&this.options.zIndex!==c&&null!==this.options.zIndex&&(this._container.style.zIndex=this.options.zIndex)},_detectImagePath:function(a){var b=L.DomUtil.create("div","leaflet-default-icon-path",a),c=L.DomUtil.getStyle(b,"background-image")||L.DomUtil.getStyle(b,"backgroundImage");return Polymer.dom(a).removeChild(b),c=null===c||0!==c.indexOf("url")?"":c.replace(/^url\(["']?/,"").replace(/marker-icon\.png["']?\)$/,"")},onAdd:function(a){this._map=a,this._mapmlvectors||(this._mapmlvectors=d.mapMlFeatures(null,{renderer:L.svg(),pane:this._container,opacity:this.options.opacity,imagePath:this._detectImagePath(this._map.getContainer()),onEachFeature:function(a,b){var c;c=b instanceof L.Polygon?"Polygon":b instanceof L.Polyline?"LineString":b instanceof L.Marker?"Point":"Unknown";for(var d="<p>Type: "+c+"</p>",e=0;e<a.childNodes.length;e++)a.childNodes[e].nodeType===Node.ELEMENT_NODE&&(d+=a.childNodes[e].tagName+" = "+a.childNodes[e].textContent+"<br>");b.bindPopup(d,{autoPan:!1})}})),a.addLayer(this._mapmlvectors),this._imageLayer||(this._imageLayer=L.layerGroup()),a.addLayer(this._imageLayer),this._tileLayer||(this._tileLayer=d.mapMLTileLayer(this.href?this.href:this._href,{pane:this._container})),this._tileLayer._mapmlTileContainer=this._mapmlTileContainer,a.addLayer(this._tileLayer),this._tileLayer._container.appendChild(this._mapmlTileContainer),this._extent?(this._templateVars&&(this._templatedLayer=d.templatedLayer(this._templateVars,{pane:this._container}).addTo(a)),this._onMoveEnd()):(this.once("extentload",function(){this._templateVars&&(this._templatedLayer=d.templatedLayer(this._templateVars,{pane:this._container}).addTo(a))},this),this.once("extentload",this._onMoveEnd,this)),this.setZIndex(this.options.zIndex),Polymer.dom(this.getPane()).appendChild(this._container)},addTo:function(a){return a.addLayer(this),this},getEvents:function(){return{moveend:this._onMoveEnd,zoomanim:this._onZoomAnim}},_onZoomAnim:function(a){var b=a.zoom,c=this._extent.querySelector("input[type=zoom]"),d=parseInt(c.getAttribute("min")),e=parseInt(c.getAttribute("max")),f=b<d&&this._extent.zoomout||b>e&&this._extent.zoomin;this._extent.hasAttribute("action")||d<=b&&b<=e||(this._extent.zoomin&&b>e?(this._href=this._extent.zoomin,this.href=this._extent.zoomin):this._extent.zoomout&&b<d&&(this._href=this._extent.zoomout,this.href=this._extent.zoomout)),this._templatedLayer&&f&&this._initExtent()},onRemove:function(a){L.DomUtil.remove(this._container),this._mapmlvectors.clearLayers(),a.removeLayer(this._mapmlvectors),a.removeLayer(this._tileLayer),a.removeLayer(this._imageLayer),this._templatedLayer&&a.removeLayer(this._templatedLayer)},getZoomBounds:function(){if(this._extent){var a={},b=this._extent.querySelector("[type=zoom]").getAttribute("min"),c=this._extent.querySelector("[type=zoom]").getAttribute("max");return a.min=Math.min(b,c),a.max=Math.max(b,c),a}},getLayerExtentBounds:function(a){if(this._extent){var b,c,e,f,g,h,i,j,k=a.getZoom(),l=a.options.projection,m=this._extent.querySelector("[type=projection]")?this._extent.querySelector("[type=projection]").getAttribute("value"):this._extent.getAttribute("units"),n=l!==m;if(h=this._extent.querySelector("[type=xmin]").getAttribute("min"),i=this._extent.querySelector("[type=xmax]").getAttribute("min"),c=Math.min(h,i),h=this._extent.querySelector("[type=xmin]").getAttribute("max"),i=this._extent.querySelector("[type=xmax]").getAttribute("max"),f=Math.max(h,i),h=this._extent.querySelector("[type=ymin]").getAttribute("min"),i=this._extent.querySelector("[type=ymax]").getAttribute("min"),e=Math.min(h,i),h=this._extent.querySelector("[type=ymin]").getAttribute("max"),i=this._extent.querySelector("[type=ymax]").getAttribute("max"),g=Math.max(h,i),n){b=d[l];var o=[b.latLngToPoint(L.latLng([e,c]),k),b.latLngToPoint(L.latLng([g,f]),k),b.latLngToPoint(L.latLng([e,c]),k),b.latLngToPoint(L.latLng([e,f]),k)];return L.bounds(o)}return j=parseInt(this._extent.querySelector("[type=zoom]").getAttribute("value")),j!==k?(b=d[l],L.bounds(b.latLngToPoint(b.pointToLatLng(L.point(c,e),j),k),b.latLngToPoint(b.pointToLatLng(L.point(f,g),j),k))):L.bounds(L.point(c,e),L.point(f,g))}},getAttribution:function(){return this.options.attribution},_initExtent:function(a){function b(a,b){f.onreadystatechange=function(){this.readyState===this.DONE&&(400!==this.status&&404!==this.status&&500!==this.status&&406!==this.status||(e.error=!0,e.fire("extentload",e,!0),f.abort()))},f.onload=b,f.onerror=function(){e.error=!0,e.fire("extentload",e,!0)},f.open("GET",a),f.setRequestHeader("Accept",d.mime),f.overrideMimeType("text/xml"),f.send()}function c(a){var b=this.responseXML||a;if(b){var c=b.querySelector("extent");if(c){if(!c.hasAttribute("action")&&c.querySelector("template")&&c.hasAttribute("units")&&"WGS84"!==c.getAttribute("units")){e._templateVars=[];for(var d=c.querySelectorAll("template"),f=new RegExp("(?:{)(.*?)(?:})","g"),g=0;g<d.length;g++){for(var h,i=d[g],j=i.getAttribute("tref"),k=j.match(f),l=i.hasAttribute("type")&&"tile"!==i.getAttribute("type").toLowerCase()?i.getAttribute("type").toLowerCase():"tile",m=[];null!==(h=f.exec(j));){var n=h[1],o=c.querySelector("input[name="+n+"]");if(!o){console.log("input with name="+n+" not found for template variable of same name");break}m.push(o)}j&&k.length===m.length&&e._templateVars.push({template:j,type:l,values:m})}}}else c=e._synthesizeExtent(b),b.querySelector("feature,image,tile")&&(e._content=b);e._parseLicenseAndLegend(b,e),e._extent=c;var p=b.querySelector("link[rel=zoomin]"),q=b.querySelector("link[rel=zoomout]"),r=new URI(b.querySelector("base")?b.querySelector("base").getAttribute("href"):this.responseURL).resolve(new URI(this.responseURL));delete e._extent.zoomin,delete e._extent.zoomout,p&&(e._extent.zoomin=new URI(p.getAttribute("href")).resolve(r).toString()),q&&(e._extent.zoomout=new URI(q.getAttribute("href")).resolve(r).toString()),e._templatedLayer&&e._templatedLayer.reset(e._templateVars),b.querySelector("title")&&(e._title=b.querySelector("title").textContent),e._map&&(e._validateExtent(),e._map.hasLayer(e)&&e._map.attributionControl.addAttribution(e.getAttribution()))}else e.error=!0;e.fire("extentload",e,!1)}if(this._href||a){var e=this;if(this._href){var f=new XMLHttpRequest;b(this._href,c)}else a&&c(a)}},_getMapML:function(a){function c(a,b){i.onreadystatechange=function(){this.readyState===this.DONE&&(400!==this.status&&404!==this.status&&500!==this.status&&406!==this.status||(g.error=!0,g.fire("extentload",g,!0),i.abort()))},i.onload=b,i.onerror=function(){console.error(this.statusText),g.error=!0},i.open("GET",a),i.setRequestHeader("Accept",d.mime+";projection="+g.options.projection+";zoom="+g.zoom),i.overrideMimeType("text/xml"),i.send()}function e(a){var i,j=this.responseXML||a;if(j){if(0===h){var k=j.querySelector("extent");if(k){if(!k.hasAttribute("action")&&k.querySelector("template")&&k.hasAttribute("units")&&"WGS84"!==k.getAttribute("units")){g._templateVars=[];var l=k.querySelectorAll("template"),m=new RegExp("(?:{)(.*?)(?:})","g");for(i=0;i<l.length;i++){for(var n,o=l[i],p=o.getAttribute("tref"),q=p.match(m),r=o.hasAttribute("type")&&"tile"!==o.getAttribute("type").toLowerCase()?o.getAttribute("type").toLowerCase():"tile",s=[];null!==(n=m.exec(p));){var t=n[1],u=k.querySelector("input[name="+t+"]");if(!u){console.log("input with name="+t+" not found for template variable of same name");break}s.push(u)}p&&q.length===s.length&&g._templateVars.push({template:p,type:r,values:s})}}}else k=g._synthesizeExtent(j);g._extent=k,g._parseLicenseAndLegend(j,g);var v=j.querySelector("link[rel=zoomin]"),w=j.querySelector("link[rel=zoomout]"),x=new URI(j.querySelector("base")?j.querySelector("base").getAttribute("href"):this.responseURL).resolve(new URI(this.responseURL));delete g._extent.zoomin,delete g._extent.zoomout,v&&(g._extent.zoomin=new URI(v.getAttribute("href")).resolve(x).toString()),w&&(g._extent.zoomout=new URI(w.getAttribute("href")).resolve(x).toString())}if(j.querySelector("feature")&&g._mapmlvectors.addData(j),j.querySelector("tile")){var y=b.createElement("tiles"),z=j.querySelector("meta[name=zoom][content]")||j.querySelector("input[type=zoom][value]");y.setAttribute("zoom",z.getAttribute("content")||z.getAttribute("value"));var A=j.getElementsByTagName("tile");for(i=0;i<A.length;i++)Polymer.dom(y).appendChild(b.importNode(A[i],!0));g._mapmlTileContainer.appendChild(y)}if(j.querySelector("image")){var B=j.getElementsByTagName("image"),C=[],D=g._imageContainer;for(i=0;i<B.length;i++){var E=B[i],F=E.getAttribute("src"),G=g._map,H=G.getPixelBounds().min.subtract(G.getPixelOrigin()),I=G.getSize();C[i]=d.imageOverlay(F,H,I,0,D)}var J=g._imageLayer.getLayers(),K=C.length-1;for(i=0;i<C.length;i++)g._imageLayer.addLayer(C[i]),i===K&&C[i].on("load",function(a){for(var b=0;b<J.length;b++)g._imageLayer.removeLayer(J[b])})}var L=f("next",j);L&&h<g.options.maxNext?(h++,c(L,e)):(g._mapmlTileContainer.getElementsByTagName("tile").length>0&&g._tileLayer._onMapMLProcessed(),g.fire("extentload",g,!0))}}function f(a,b){var c=b.querySelector("base"),d=c?c.getAttribute("href"):null,e=new URI(d||b.baseURI),f=b.querySelector("link[rel="+a+"]");return f?new URI(f.getAttribute("href")).resolve(e):null}var g=this;if(a){var h=0,i=new XMLHttpRequest;this._map.once("movestart",function(){i.abort()}),c(a,e)}else this._content&&e(this._content)},_createExtent:function(){var a=b.createElement("extent"),c=b.createElement("input"),d=b.createElement("input"),e=b.createElement("input"),f=b.createElement("input"),g=b.createElement("input"),h=b.createElement("input");return g.setAttribute("type","zoom"),g.setAttribute("min","0"),g.setAttribute("max","0"),c.setAttribute("type","xmin"),c.setAttribute("min",""),c.setAttribute("max",""),d.setAttribute("type","ymin"),d.setAttribute("min",""),d.setAttribute("max",""),e.setAttribute("type","xmax"),e.setAttribute("min",""),e.setAttribute("max",""),f.setAttribute("type","ymax"),f.setAttribute("min",""),f.setAttribute("max",""),h.setAttribute("type","projection"),h.setAttribute("value","WGS84"),a.setAttribute("action","synthetic"),Polymer.dom(a).appendChild(c),Polymer.dom(a).appendChild(d),Polymer.dom(a).appendChild(e),Polymer.dom(a).appendChild(f),Polymer.dom(a).appendChild(g),Polymer.dom(a).appendChild(h),a},_validateExtent:function(){var a=this._extent;if(a&&a.querySelector&&this._map){if(a.querySelector('[type=xmin][min=""], [type=xmin][max=""], [type=xmax][min=""], [type=xmax][max=""], [type=ymin][min=""], [type=ymin][max=""]')){var b,c,d=a.querySelector("[type=xmin]"),e=a.querySelector("[type=ymin]"),f=a.querySelector("[type=xmax]"),g=a.querySelector("[type=ymax]"),h=a.querySelector("[type=projection][value]");h?(c=h.getAttribute("value"),c&&"WGS84"===c?(b=this._map.getBounds(),d.setAttribute("min",b.getWest()),d.setAttribute("max",b.getEast()),e.setAttribute("min",b.getSouth()),e.setAttribute("max",b.getNorth()),f.setAttribute("min",b.getWest()),f.setAttribute("max",b.getEast()),g.setAttribute("min",b.getSouth()),g.setAttribute("max",b.getNorth())):c&&(b=this._map.getPixelBounds(),d.setAttribute("min",b.getBottomLeft().x),d.setAttribute("max",b.getTopRight().x),e.setAttribute("min",b.getTopRight().y),e.setAttribute("max",b.getBottomLeft().y),f.setAttribute("min",b.getBottomLeft().x),f.setAttribute("max",b.getTopRight().x),g.setAttribute("min",b.getTopRight().y),g.setAttribute("max",b.getBottomLeft().y))):this.error=!0}if(a.querySelector('[type=zoom][min=""], [type=zoom][max=""]')){var i=a.querySelector("[type=zoom]");i.setAttribute("min",this._map.getMinZoom()),i.setAttribute("max",this._map.getMaxZoom())}}},_getMapMLExtent:function(a,b,d){var e=this._createExtent(),f=e.querySelector("input[type=zoom]"),g=e.querySelector("input[type=xmin]"),h=e.querySelector("input[type=ymin]"),i=e.querySelector("input[type=xmax]"),j=e.querySelector("input[type=ymax]"),k=e.querySelector("input[type=projection]"),l=b[0]!==c&&b[1]!==c?Math.min(b[0],b[1]):"",m=b[0]!==c&&b[1]!==c?Math.max(b[0],b[1]):"",n=a?a._southWest?a.getWest():a.getBottomLeft().x:"",o=a?a._southWest?a.getSouth():a.getTopRight().y:"",p=a?a._southWest?a.getEast():a.getTopRight().x:"",q=a?a._southWest?a.getNorth():a.getBottomLeft().y:"";return f.setAttribute("min","number"==typeof l&&isNaN(l)?"":l),f.setAttribute("max","number"==typeof m&&isNaN(m)?"":m),g.setAttribute("min",n),g.setAttribute("max",p),h.setAttribute("min",o),h.setAttribute("max",q),i.setAttribute("min",n),i.setAttribute("max",p),j.setAttribute("min",o),j.setAttribute("max",q),k.setAttribute("value",a&&a._southWest&&!d?"WGS84":d),e},_synthesizeExtent:function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n=a.querySelectorAll("meta[name=zoom]")[0],o=a.querySelector("meta[name=extent]"),p=a.querySelector("meta[name=projection]"),q=p?p.getAttribute("content"):"WGS84";if(n)for(c=n.getAttribute("content").split(","),b=0;b<c.length;b++)k=c[b].split("="),l=k[0],m=k[1],"min"===l&&(e=parseInt(m)),"max"===l&&(f=parseInt(m));if(o)for(c=o.getAttribute("content").split(","),b=0;b<c.length;b++)k=c[b].split("="),l=k[0],m=k[1],"xmin"===l&&(g=parseFloat(m)),"xmax"===l&&(i=parseFloat(m)),"ymin"===l&&(h=parseFloat(m)),"ymax"===l&&(j=parseFloat(m));if(g&&h&&i&&j&&"WGS84"===q){var r=L.latLng(h,g),s=L.latLng(j,i);d=L.latLngBounds(r,s)}else g&&h&&i&&j&&(d=L.bounds([[g,h],[i,j]]));return this._getMapMLExtent(d,[e,f],q)},getProjection:function(){if(!this._extent||!this._extent.querySelector("input[type=projection]"))return"WGS84";var a=this._extent.querySelector("input[type=projection]");return a.getAttribute("value")?a.getAttribute("value"):"WGS84"},_parseLicenseAndLegend:function(a,b){var c,d,e,f=a.querySelector("link[rel=license]");f&&(c=f.getAttribute("title"),d=f.getAttribute("href"),e='<a href="'+d+'" title="'+c+'">'+c+"</a>"),L.setOptions(b,{attribution:e});var g=a.querySelector("link[rel=legend]");g&&(b._legendUrl=g.getAttribute("href"))},_onMoveEnd:function(){var a=this._calculateUrl();a?(this.href=a,this.fire("loadstart"),this._mapmlvectors.clearLayers(),this._initEl(),this._getMapML(a)):this._content&&!this._mapmlvectors.getLayers().length&&this._getMapML(null)},_initEl:function(){if(this._mapmlTileContainer)for(var a=this._mapmlTileContainer;a.firstChild;)a.removeChild(a.firstChild)},_reset:function(){this._initEl(),this._mapmlvectors.clearLayers()},_getUnprojectedMapLatLngBounds:function(a){a=a||this._map;var b=a.getPixelOrigin(),c=a.getPixelBounds(),d=a.unproject(b),e=a.unproject(c.getBottomLeft()),f=a.unproject(c.getTopRight()),g=a.unproject(b.add(a.getSize()));return L.latLngBounds(e,f).extend(g).extend(d)},_calculateUrl:function(){if(!this._map)return null;if(!this._mapmlTileContainer&&!this._extent)return this._href;var a=this._extent;if(!a)return this._href;var b=a.getAttribute("action"),c=new URI(this._href),d=a.querySelectorAll("input[type=zoom]")[0];if(!d)return null;var e=parseInt(d.getAttribute("min")),f=parseInt(d.getAttribute("max")),g={},h=this._map.getZoom();if(e<=h&&h<=f)g.zoom=h;else{if(b)return null;if(a.zoomin&&h>f)return this._href=a.zoomin,this.href=a.zoomin,this.href;if(a.zoomout&&h<e)return this._href=a.zoomout,this.href=a.zoomout,this.href}if(!b||"synthetic"===b)return null;var i,j=a.querySelectorAll("input[type=projection]")[0],k=j.getAttribute("value");i="WGS84"===k?this._getUnprojectedMapLatLngBounds():this._map.getPixelBounds();var l=a.querySelectorAll("input[type=xmin]")[0],m=a.querySelectorAll("input[type=ymin]")[0],n=a.querySelectorAll("input[type=xmax]")[0],o=a.querySelectorAll("input[type=ymax]")[0];if(!(l&&m&&n&&o))return null;var p=l.getAttribute("name")?l.getAttribute("name").trim():"xmin",q=m.getAttribute("name")?m.getAttribute("name").trim():"ymin",r=n.getAttribute("name")?n.getAttribute("name").trim():"xmax",s=o.getAttribute("name")?o.getAttribute("name").trim():"ymax",t="";if(t+=p+"={"+p+"}&",t+=q+"={"+q+"}&",t+=r+"={"+r+"}&",t+=s+"={"+s+"}",!j)return null;var u=d.getAttribute("name")?d.getAttribute("name").trim():"zoom",v=u+"={"+u+"}";g.xmin=i.min?i.min.x:i.getWest(),g.ymin=i.min?i.min.y:i.getSouth(),g.xmax=i.max?i.max.x:i.getEast(),g.ymax=i.max?i.max.y:i.getNorth(),g.projection=k;var w=j.getAttribute("name")?j.getAttribute("name").trim():"projection",x=w+"={"+w+"}",y=t+"&"+v+"&"+x;b+=(-1===b.search(/\?/g)?"?":"&")+y;var z=new URI(b).resolve(c).toString();return L.Util.template(z,g)},_projectionMatches:function(a){a=a||this._map;var b=this.getProjection();return!(!a.options.projection||"WGS84"!==b&&a.options.projection!==b)}}),d.mapMLLayer=function(a,c,e){return new d.MapMLLayer(a,c||b.createElement("div"),e)},d.ImageOverlay=L.ImageOverlay.extend({initialize:function(a,b,c,d,e,f){this._container=e,this._url=a,this._location=b,this._size=L.point(c),this._angle=d,L.setOptions(this,f)},getEvents:function(){var a={viewreset:this._reset};return this._zoomAnimated&&(a.zoomanim=this._animateZoom),a},onAdd:function(){this.on({load:this._onImageLoad}),this._image||this._initImage(),this.options.interactive&&(L.DomUtil.addClass(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),Polymer.dom(this._container).appendChild(this._image),this._reset()},onRemove:function(){L.DomUtil.remove(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},_onImageLoad:function(){this._image&&(this._image.loaded=+new Date,this._updateOpacity())},_animateZoom:function(a){var b=this._map.getZoomScale(a.zoom),c=this._map.getPixelOrigin().add(this._location).multiplyBy(b).subtract(this._map._getNewPixelOrigin(a.center,a.zoom)).round();L.Browser.any3d?L.DomUtil.setTransform(this._image,c,b):L.DomUtil.setPosition(this._image,c)},_reset:function(){var a=this._image,b=this._location,c=this._size;L.DomUtil.setPosition(a,b),a.style.width=c.x+"px",a.style.height=c.y+"px"},_updateOpacity:function(){if(this._map){var a=+new Date,b=!1,c=this._image,d=Math.min(1,(a-c.loaded)/200);L.DomUtil.setOpacity(c,d),d<1&&(b=!0),b&&(L.Util.cancelAnimFrame(this._fadeFrame),this._fadeFrame=L.Util.requestAnimFrame(this._updateOpacity,this)),L.DomUtil.addClass(c,"leaflet-image-loaded")}}}),d.imageOverlay=function(a,b,c,e,f,g){return new d.ImageOverlay(a,b,c,e,f,g)},d.TemplatedImageLayer=L.Layer.extend({initialize:function(a,b){this._template=a,this._container=L.DomUtil.create("div","leaflet-layer",b.pane),L.DomUtil.addClass(this._container,"mapml-image-container"),L.setOptions(this,L.extend(b,this._setUpExtentTemplateVars(a)))},getEvents:function(){return{moveend:this._onMoveEnd}},onAdd:function(){this.setZIndex(this.options.zIndex),this._onMoveEnd()},_onMoveEnd:function(){var a=this._map,b=a.getPixelBounds().min.subtract(a.getPixelOrigin()),c=a.getSize(),e=this.getImageUrl(),f=this._imageOverlay;this._imageOverlay=d.imageOverlay(e,b,c,0,this._container),f&&this._imageOverlay.on("load",function(){a.removeLayer(f)}),this._imageOverlay.addTo(a)},setZIndex:function(a){return this.options.zIndex=a,this._updateZIndex(),this},_updateZIndex:function(){this._container&&this.options.zIndex!==c&&null!==this.options.zIndex&&(this._container.style.zIndex=this.options.zIndex)},onRemove:function(){},getImageUrl:function(){var a={};return a[this.options.extent.width]=this._map.getSize().x,a[this.options.extent.height]=this._map.getSize().y,a[this.options.extent.bottom]=this._TCRSToPCRS(this._map.getPixelBounds().max,this._map.getZoom()).y,a[this.options.extent.left]=this._TCRSToPCRS(this._map.getPixelBounds().min,this._map.getZoom()).x,a[this.options.extent.top]=this._TCRSToPCRS(this._map.getPixelBounds().min,this._map.getZoom()).y,a[this.options.extent.right]=this._TCRSToPCRS(this._map.getPixelBounds().max,this._map.getZoom()).x,L.Util.template(this._template.template,a)},_TCRSToPCRS:function(a,b){var c=this._map,d=c.options.crs;return d.transformation.untransform(a,d.scale(b))},_setUpExtentTemplateVars:function(a){for(var b={extent:{}},c=a.values,d=0;d<a.values.length;d++){var e=c[d].getAttribute("type"),f=c[d].getAttribute("units"),g=c[d].getAttribute("axis"),h=c[d].getAttribute("name"),i=c[d].getAttribute("position"),j=c[d].getAttribute("value");if("width"===e)b.extent.width=h;else if("height"===e)b.extent.height=h;else if("location"===e&&"pcrs"===f)switch(g){case"easting":i&&(i.match(/.*?-left/i)?b.extent.left=h:i.match(/.*?-right/i)&&(b.extent.right=h));break;case"northing":i&&(i.match(/top-.*?/i)?b.extent.top=h:i.match(/bottom-.*?/i)&&(b.extent.bottom=h))}else"hidden"===e&&(b.extent[h]=j)}return b}}),d.templatedImageLayer=function(a,b){return new d.TemplatedImageLayer(a,b)},d.TemplatedLayer=L.Layer.extend({initialize:function(a,b){this._templates=a,L.setOptions(this,b),this._container=L.DomUtil.create("div","leaflet-layer",b.pane),L.DomUtil.addClass(this._container,"mapml-templatedlayer-container");for(var c=0;c<a.length;c++)"tile"===a[c].type?this._templates[c].layer=d.templatedTileLayer(a[c],L.Util.extend(b,{errorTileUrl:"data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",zIndex:c,pane:this._container})):"image"===a[c].type?this._templates[c].layer=d.templatedImageLayer(a[c],L.Util.extend(b,{zIndex:c,pane:this._container})):"query"===a[c].type&&(this._queries||(this._queries=[]),this._queries.push(L.extend(a[c],this._setupQueryVars(a[c]))))},getEvents:function(){return{zoomstart:this._onZoomStart}},_onZoomStart:function(){this.closePopup()},_setupQueryVars:function(a){for(var b={query:{}},c=a.values,d=0;d<a.values.length;d++){var e=c[d].getAttribute("type"),f=c[d].getAttribute("units"),g=c[d].getAttribute("axis"),h=c[d].getAttribute("name"),i=c[d].getAttribute("position"),j=c[d].getAttribute("value");if("width"===e)b.query.width=h;else if("height"===e)b.query.height=h;else if("location"===e&&"pcrs"===f)switch(g){case"easting":i?i.match(/.*?-left/i)?b.query.left=h:i.match(/.*?-right/i)&&(b.query.right=h):b.query.easting=h;break;case"northing":i?i.match(/top-.*?/i)?b.query.top=h:i.match(/bottom-.*?/i)&&(b.query.bottom=h):b.query.northing=h}else"location"===e&&"map"===f?"i"===g?b.query.i=h:"j"===g&&(b.query.j=h):"location"===e&&"tcrs"===f?"x"===g?b.query.x=h:"y"===g&&(b.query.y=h):"zoom"===e?b.query.zoom=h:"hidden"===e&&(b.query[h]=j)}return b},reset:function(a){if(a){var b=this._map&&this._map.hasLayer(this),c=this._templates;delete this._queries,this._map.off("click",null,this),this._templates=a;for(var e=0;e<a.length;e++)"tile"===a[e].type?this._templates[e].layer=d.templatedTileLayer(a[e],L.Util.extend(this.options,{errorTileUrl:"data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",zIndex:e,pane:this._container})):"image"===a[e].type?this._templates[e].layer=d.templatedImageLayer(a[e],L.Util.extend(this.options,{zIndex:e,pane:this._container})):"query"===a[e].type&&(this._queries||(this._queries=[]),this._queries.push(L.extend(a[e],this._setupQueryVars(a[e])))),b&&this.onAdd(this._map);for(e=0;e<c.length;e++)this._map.hasLayer(c[e].layer)&&this._map.removeLayer(c[e].layer)}},onAdd:function(a){function b(a){d.setContent(" ");var b={},c=this._queries[0],e=a.target.getPixelBounds(),f=a.target.getZoom(),g=a.target,h=g.options.crs,i=function(a){return h.transformation.untransform(a,h.scale(f))};b[c.query.i]=a.containerPoint.x.toFixed(),b[c.query.j]=a.containerPoint.y.toFixed(),b[c.query.x]=g.getPixelOrigin().add(a.layerPoint).x.toFixed(),b[c.query.y]=g.getPixelOrigin().add(a.layerPoint).y.toFixed(),b[c.query.easting]=i(g.getPixelOrigin().add(a.layerPoint)).x,b[c.query.northing]=i(g.getPixelOrigin().add(a.layerPoint)).y,b[c.query.zoom]=f,b[c.query.width]=g.getSize().x,b[c.query.height]=g.getSize().y,b[c.query.width]=g.getSize().x,b[c.query.height]=g.getSize().y,b[c.query.bottom]=i(e.max).y,b[c.query.left]=i(e.min).x,b[c.query.top]=i(e.min).y,b[c.query.right]=i(e.max).x,fetch(L.Util.template(c.template,b),{redirect:"follow"}).then(function(a){return 200!==a.status&&console.log("Looks like there was a problem. Status Code: "+a.status),a.text()}).then(function(a){d.setContent(a)}).catch(function(a){console.log("Fetch Error :-S",a)}),d.setLatLng(a.latlng).openOn(g)}for(var c=0;c<this._templates.length;c++)"query"!==this._templates[c].type&&a.addLayer(this._templates[c].layer);this._queries&&a.on("click",b,this);var d=L.popup({autoPan:!1,maxHeight:a.getSize().y-20,className:"mapml-popup-overflow"});this.bindPopup(d)},onRemove:function(a){L.DomUtil.remove(this._container);for(var b=0;b<this._templates.length;b++)"query"!==this._templates[b].type&&a.removeLayer(this._templates[b].layer);a.off("click",null,this)}}),d.templatedLayer=function(a,b){return new d.TemplatedLayer(a,b)},d.TemplatedTileLayer=L.TileLayer.extend({initialize:function(a,b){L.setOptions(this,L.extend(b,this._setUpTileTemplateVars(a))),this._initContainer(),L.TileLayer.prototype.initialize.call(this,a.template,L.extend(b,{pane:this._container}))},getPane:function(){return this.options.pane},_initContainer:function(){this._container||(this._container=L.DomUtil.create("div","leaflet-layer",this.options.pane),L.DomUtil.addClass(this._container,"mapml-templated-tile-container"),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity())},getTileUrl:function(a){var b={};b[this.options.tile.col]=a.x,b[this.options.tile.row]=a.y,b[this.options.tile.zoom]=this._getZoomForUrl(),b[this.options.tile.left]=this._tileMatrixToPCRSPosition(a,"top-left").x,b[this.options.tile.right]=this._tileMatrixToPCRSPosition(a,"top-right").x,b[this.options.tile.top]=this._tileMatrixToPCRSPosition(a,"top-left").y,b[this.options.tile.bottom]=this._tileMatrixToPCRSPosition(a,"bottom-left").y;for(var c in this.options.tile)"row"!==c&&"col"!==c&&"zoom"!==c&&"left"!==c&&"right"!==c&&"top"!==c&&"bottom"!==c&&(b[c]=this.options.tile[c]);return b.r=this.options.detectRetina&&L.Browser.retina&&this.options.maxZoom>0?"@2x":"",b.s=this._getSubdomain(a),L.Util.template(this._url,b)},_tileMatrixToPCRSPosition:function(a,b){var c=this._map,d=c.options.crs,e=this.getTileSize(),f=a.scaleBy(e),g=f.add(e),h=f.add(Math.floor(e/2)),i=d.transformation.untransform(f,d.scale(a.z)),j=d.transformation.untransform(g,d.scale(a.z)),k=d.transformation.untransform(h,d.scale(a.z)),l=null;switch(b){case"top-left":l=i;break;case"bottom-left":l=new L.Point(i.x,j.y);break;case"center-left":l=new L.Point(i.x,k.y);break;case"top-right":l=new L.Point(j.x,i.y);break;case"bottom-right":l=j;break;case"center-right":l=new L.Point(j.x,k.y);break;case"top-center":l=new L.Point(k.x,i.y);break;case"bottom-center":l=new L.Point(k.x,j.y);break;case"center":l=k}return l},_setUpTileTemplateVars:function(a){for(var b={tile:{}},c=a.values,d=0;d<a.values.length;d++){var e=c[d].getAttribute("type"),f=c[d].getAttribute("units"),g=c[d].getAttribute("axis"),h=c[d].getAttribute("name"),i=c[d].getAttribute("position"),j=c[d].getAttribute("value");if("location"===e&&"tilematrix"===f)switch(g){case"column":b.tile.col=h;break;case"row":b.tile.row=h;break;case"easting":i&&(i.match(/.*?-left/i)?b.tile.left=h:i.match(/.*?-right/i)&&(b.tile.right=h));break;case"northing":i&&(i.match(/top-.*?/i)?b.tile.top=h:i.match(/bottom-.*?/i)&&(b.tile.bottom=h))}else"zoom"===e?b.tile.zoom=h:"hidden"===e&&(b.tile[h]=j)}return b}}),d.templatedTileLayer=function(a,b){return new d.TemplatedTileLayer(a,b)},d.MapMLTileLayer=L.TileLayer.extend({initialize:function(a,b){L.setOptions(this,b),L.TileLayer.prototype.initialize.call(this,a,b)},_initContainer:function(){this._container||(this._container=L.DomUtil.create("div","leaflet-layer",this.getPane()),L.DomUtil.addClass(this._container,"mapml-tilelayer-container"),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity())},getEvents:function(){var a={};return this._zoomAnimated&&(a.zoomanim=this._animateZoom),a},getPane:function(){return this.options.pane},_onMapMLProcessed:function(){this._map&&(L.DomUtil.hasClass(this._map.getPane("mapPane"),"leaflet-zoom-anim")||this._update())},_update:function(a,b){var d=this._map;if(d&&!L.DomUtil.hasClass(d.getPane("mapPane"),"leaflet-zoom-anim")){a===c&&(a=d.getCenter()),b===c&&(b=d.getZoom());var e=Math.round(b);if(!(e>this.options.maxZoom||e<this.options.minZoom)){var f=this._getTiledPixelBounds(a,b,e),g=this._pxBoundsToTileRange(f),h=this._groupTiles(this._mapmlTileContainer.getElementsByTagName("tile"));for(var i in this._tiles)this._tiles[i].current=!1;for(var j=g.min.y;j<=g.max.y;j++)for(var k=g.min.x;k<=g.max.x;k++){var l=new L.Point(k,j);if(l.z=e,this._isValidTile(l)){var m=this._tiles[this._tileCoordsToKey(l)];if(m){m.current=!0;for(var n=0;n<h.length;n++)h[n][0].row!==m.coords.y||h[n][0].col!==m.coords.x||h.splice(n,1)}}}h.length&&(this.once("load",this._pruneTiles),this._addTiles(h))}}},_groupTiles:function(a){function b(a,b){var c={};return a.forEach(function(a){var d=JSON.stringify(b(a));c[d]=c[d]||[],c[d].push(a)}),Object.keys(c).map(function(a){return c[a]})}for(var c=[],d=0;d<a.length;d++){var e={};e.row=parseInt(a[d].getAttribute("row")),e.col=parseInt(a[d].getAttribute("col")),e.src=a[d].getAttribute("src"),c.push(e)}return b(c,function(a){return[a.row,a.col]})},_addTiles:function(a){for(var c=[],d={},e=0;e<a.length;e++)d.col=a[e][0].col,d.row=a[e][0].row,this._isValidTile(new L.Point(d.col,d.row))&&c.push(a[e]);var f=c.length;if(0!==f){var g=b.createDocumentFragment();for(this._loading||(this._loading=!0,this.fire("loading")),e=0;e<f;e++)this._addTile(c[e],g);Polymer.dom(this._level.el).appendChild(g)}},_addTile:function(a,c){var d=new L.Point(a[0].col,a[0].row);d.z=this._map.getZoom();for(var e,f=this._tileCoordsToKey(d),g=0;g<a.length;g++)e=this.createTile(a[g].src,L.bind(this._tileReady,this,d)),this._initTile(e),a[g].img=e;var h;if(this._tiles[f])h=this._tiles[f].el;else for(h=b.createElement("div"),L.DomUtil.addClass(h,"leaflet-tile"),g=0;g<a.length;g++)Polymer.dom(h).appendChild(a[g].img);L.DomUtil.setPosition(h,this._getTilePos(d)),this._tiles[f]={el:h,coords:d,current:!0},Polymer.dom(c).appendChild(h),this.fire("tileloadstart",{tile:e,coords:d})},_initTile:function(a){var b=this.getTileSize();a.style.width=b.x+"px",a.style.height=b.y+"px",a.onselectstart=L.Util.falseFn,a.onmousemove=L.Util.falseFn,L.Browser.ielt9&&this.options.opacity<1&&L.DomUtil.setOpacity(a,this.options.opacity),L.Browser.android&&!L.Browser.android23&&(a.style.WebkitBackfaceVisibility="hidden")},_noTilesToLoad:function(){for(var a in this._tiles)if(!L.DomUtil.hasClass(this._tiles[a].el,"leaflet-tile-loaded"))return!1;return!0},createTile:function(a,c){var d=b.createElement("img");return d.onload=L.bind(this._tileOnLoad,this,c,d),d.onerror=L.bind(this._tileOnError,this,c,d),this.options.crossOrigin&&(d.crossOrigin=""),d.alt="",d.src=a,d},_tileLoad:function(a){if(a){for(var b=a.querySelectorAll("img"),c=!0,d=0;d<b.length;d++)b[d].loaded||(c=!1);c&&L.DomUtil.addClass(a,"leaflet-tile-loaded")}},_abortLoading:function(){var a,b;for(a in this._tiles){var c=this._tiles[a].el,d=c.getElementsByTagName("img");for(a=0;a<d.length;a++)b=d[a],b.onload=L.Util.falseFn,b.onerror=L.Util.falseFn,b.complete||(b.src=L.Util.emptyImageUrl,L.DomUtil.remove(b))}}}),d.mapMLTileLayer=function(a,b){return new d.MapMLTileLayer(a,b)},d.MapMLTileLayer.addInitHook(function(){this.on("tileload",function(a){var b=a.tile;this._tileLoad(b)},this)}),d.MapMLFeatures=L.FeatureGroup.extend({initialize:function(a,b){L.setOptions(this,b),this._container=L.DomUtil.create("div","leaflet-layer",this.options.pane),L.DomUtil.addClass(this._container,"leaflet-pane mapml-vector-container"),L.setOptions(this.options.renderer,{pane:this._container}),this._layers={},a&&this.addData(a)},addData:function(a){var c,e,f,g=a.nodeType===Node.DOCUMENT_NODE||"LAYER-"===a.nodeName?a.getElementsByTagName("feature"):null,h=a.nodeType===Node.DOCUMENT_NODE?a.querySelector("link[rel=stylesheet]"):null;if(h){var i=a.querySelector("base"),j=new URI(i?i.getAttribute("href"):a.baseURI);h=new URI(h.getAttribute("href")).resolve(j).toString()}if(h&&!b.head.querySelector("link[href='"+h+"']")){var k=b.createElementNS("http://www.w3.org/1999/xhtml","link");k.setAttribute("href",h),k.setAttribute("type","text/css"),k.setAttribute("rel","stylesheet"),b.head.appendChild(k)}if(g){for(c=0,e=g.length;c<e;c++){f=g[c];f.getElementsByTagName("geometry").length&&f.getElementsByTagName("coordinates").length&&this.addData(f)}return this}var l=this.options;if(!l.filter||l.filter(a)){var m=d.MapMLFeatures.geometryToLayer(a,l.pointToLayer,l.coordsToLatLng,l);return m.properties=a.getElementsByTagName("properties")[0],m.options.className=a.getAttribute("class")?a.getAttribute("class"):null,m.defaultOptions=m.options,this.resetStyle(m),l.onEachFeature&&l.onEachFeature(m.properties,m),this.addLayer(m)}},resetStyle:function(a){var b=this.options.style;b&&(L.Util.extend(a.options,a.defaultOptions),this._setLayerStyle(a,b))},setStyle:function(a){this.eachLayer(function(b){this._setLayerStyle(b,a)},this)},_setLayerStyle:function(a,b){"function"==typeof b&&(b=b(a.feature)),a.setStyle&&a.setStyle(b)}}),L.extend(d.MapMLFeatures,{geometryToLayer:function(a,b,c,d){function e(a,b,c){var d=[];a.split(/\s+/gi).forEach(f,d),this.push(d)}function f(a,b,c){this.push(parseFloat(a))}var g,h,i,j,k="FEATURE"===a.tagName.toUpperCase()?a.getElementsByTagName("geometry")[0]:a,l=k.getElementsByTagName("coordinates");switch(c=c||this.coordsToLatLng,k.firstElementChild.tagName.toUpperCase()){case"POINT":j=[],l[0].textContent.split(/\s+/gi).forEach(f,j),g=c(j);var m=d.opacity?d.opacity:null;return b?b(a,g):new L.Marker(g,{opacity:m,icon:L.icon({iconUrl:d.imagePath+"marker-icon.png",iconRetinaUrl:d.imagePath+"marker-icon-2x.png",shadowUrl:d.imagePath+"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]})});case"MULTIPOINT":throw new Error("Not implemented yet");case"LINESTRING":return j=[],l[0].textContent.match(/(\S+ \S+)/gi).forEach(e,j),h=this.coordsToLatLngs(j,0,c),new L.Polyline(h,d);case"POLYGON":for(j=new Array(l.length),i=0;i<l.length;i++)j[i]=[],l[i].textContent.match(/(\S+ \S+)/gi).forEach(e,j[i]);return h=this.coordsToLatLngs(j,1,c),new L.Polygon(h,d);case"MULTILINESTRING":case"MULTIPOLYGON":case"GEOMETRYCOLLECTION":throw new Error("Not implemented yet");default:throw new Error("Invalid GeoJSON object.")}},coordsToLatLng:function(a){return new L.LatLng(a[1],a[0],a[2])},coordsToLatLngs:function(a,b,c){var d,e,f,g=[];for(e=0,f=a.length;e<f;e++)d=b?this.coordsToLatLngs(a[e],b-1,c):(c||this.coordsToLatLng)(a[e]),g.push(d);return g},latLngToCoords:function(a){var b=[a.lng,a.lat];return a.alt!==c&&b.push(a.alt),b},latLngsToCoords:function(a){for(var b=[],c=0,d=a.length;c<d;c++)b.push(L.MapML.latLngToCoords(a[c]));return b}}),d.mapMlFeatures=function(a,b){return new d.MapMLFeatures(a,b)},d.MapMLLayerControl=L.Control.Layers.extend({options:{autoZIndex:!1},initialize:function(a,b){L.setOptions(this,b),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1;for(var c in a)this._addLayer(a[c],c,!0)},onAdd:function(){return this._initLayout(),this._map.on("moveend",this._validateExtents,this),this._update(),this._validateExtents(),this._container},onRemove:function(a){a.off("moveend",this._validateExtents,this);for(var b=0;b<this._layers.length;b++)this._layers[b].layer.off("add remove",this._onLayerChange,this),this._layers[b].layer.off("extentload",this._validateExtents,this)},addOrUpdateOverlay:function(a,b){for(var c=!1,d=0;d<this._layers.length;d++)if(this._layers[d].layer===a){c=!0,this._layers[d].name=b;break}return c||this._addLayer(a,b,!0),this._map?this._update():this},_validateExtents:function(a){for(var b,c,d,e,f=this._map.getZoom(),g=this._map.getPixelBounds(),h=0;h<this._layers.length;h++)c=this._layers[h],(c.layer._extent||c.layer.error)&&(b=c.layer.getZoomBounds(),e=c.layer._projectionMatches(this._map),d=e&&this._withinZoomBounds(f,b)&&g.intersects(c.layer.getLayerExtentBounds(this._map)),d?(c.input.disabled=!1,c.input.style=null,c.input.nextElementSibling.style.fontStyle=""):(c.input.disabled=!0,e||(this._map.removeLayer(c.layer),c.input.disabled=!0,c.input.checked=!1),c.input.nextElementSibling.style.fontStyle="italic"),this._setLegendLink(c,c.input.nextElementSibling))},_withinZoomBounds:function(a,b){return b.min<=a&&a<=b.max},_setLegendLink:function(a,c){if(a.layer._legendUrl){var d=b.createElement("a");d.text=" "+a.name,d.href=a.layer._legendUrl,d.target="_blank",c.innerHTML="",c.appendChild(d)}else c.innerHTML=" "+a.name},_addItem:function(a){var c,d=b.createElement("label"),e=this._map.hasLayer(a.layer);c=b.createElement("input"),c.type="checkbox",c.className="leaflet-control-layers-selector",c.defaultChecked=e,a.input=c,this._layerControlInputs.push(c),c.layerId=L.stamp(a.layer),L.DomEvent.on(c,"click",this._onInputClick,this);var f=b.createElement("span");this._setLegendLink(a,f);var g=b.createElement("div");Polymer.dom(d).appendChild(g),Polymer.dom(g).appendChild(c),Polymer.dom(g).appendChild(f);var h=this._overlaysList;return Polymer.dom(h).appendChild(d),a.layer.on("extentload",this._validateExtents,this),d}}),d.mapMlLayerControl=function(a,b){return new d.MapMLLayerControl(a,b)}}(window,document);
