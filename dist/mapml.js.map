{"version":3,"file":"mapml.js","sources":["mapml.js"],"sourcesContent":["(function () {\n  'use strict';\n\n  var StaticTileLayer = L.GridLayer.extend({\n    initialize: function (options) {\n      L.setOptions(this, options);\n      this.zoomBounds = this._getZoomBounds(\n        options.tileContainer,\n        options.maxZoomBound\n      );\n      L.extend(this.options, this.zoomBounds);\n      this._groups = this._groupTiles(\n        this.options.tileContainer.getElementsByTagName('map-tile')\n      );\n      this._bounds = this._getLayerBounds(this._groups, this.options.projection); //stores meter values of bounds\n      this.layerBounds = this._bounds[Object.keys(this._bounds)[0]];\n      for (let key of Object.keys(this._bounds)) {\n        this.layerBounds.extend(this._bounds[key].min);\n        this.layerBounds.extend(this._bounds[key].max);\n      }\n    },\n\n    onAdd: function (map) {\n      this._map = map;\n      L.GridLayer.prototype.onAdd.call(this, this._map);\n      this._handleMoveEnd();\n    },\n\n    getEvents: function () {\n      let events = L.GridLayer.prototype.getEvents.call(this, this._map);\n      this._parentOnMoveEnd = events.moveend;\n      events.moveend = this._handleMoveEnd;\n      events.move = () => {}; //needed to prevent moveend from running\n      return events;\n    },\n\n    isVisible: function () {\n      let mapZoom = this._map.getZoom();\n      let zoomLevel = mapZoom;\n      zoomLevel =\n        zoomLevel > this.options.maxNativeZoom\n          ? this.options.maxNativeZoom\n          : zoomLevel;\n      zoomLevel =\n        zoomLevel < this.options.minNativeZoom\n          ? this.options.minNativeZoom\n          : zoomLevel;\n      return (\n        mapZoom <= this.zoomBounds.maxZoom &&\n        mapZoom >= this.zoomBounds.minZoom &&\n        this._bounds[zoomLevel] &&\n        this._bounds[zoomLevel].overlaps(\n          M.pixelToPCRSBounds(\n            this._map.getPixelBounds(),\n            this._map.getZoom(),\n            this._map.options.projection\n          )\n        )\n      );\n    },\n\n    //sets the bounds flag of the layer and calls default moveEnd if within bounds\n    //its the zoom level is between the nativeZoom and zoom then it uses the nativeZoom value to get the bound its checking\n    _handleMoveEnd: function (e) {\n      if (!this.isVisible()) return; //onMoveEnd still gets fired even when layer is out of bounds??, most likely need to overrride _onMoveEnd\n      this._parentOnMoveEnd();\n    },\n\n    _isValidTile(coords) {\n      return this._groups[this._tileCoordsToKey(coords)];\n    },\n\n    createTile: function (coords) {\n      let tileGroup = this._groups[this._tileCoordsToKey(coords)] || [],\n        tileElem = document.createElement('map-tile'),\n        tileSize = this.getTileSize();\n      tileElem.setAttribute('col', coords.x);\n      tileElem.setAttribute('row', coords.y);\n      tileElem.setAttribute('zoom', coords.z);\n\n      for (let i = 0; i < tileGroup.length; i++) {\n        let tile = document.createElement('img');\n        tile.width = tileSize.x;\n        tile.height = tileSize.y;\n        tile.alt = '';\n        tile.setAttribute('role', 'presentation');\n        tile.src = tileGroup[i].src;\n        tileElem.appendChild(tile);\n      }\n      return tileElem;\n    },\n\n    _getLayerBounds: function (tileGroups, projection) {\n      let layerBounds = {},\n        tileSize = M[projection].options.crs.tile.bounds.max.x;\n      for (let tile in tileGroups) {\n        let sCoords = tile.split(':'),\n          pixelCoords = {};\n        pixelCoords.x = +sCoords[0] * tileSize;\n        pixelCoords.y = +sCoords[1] * tileSize;\n        pixelCoords.z = +sCoords[2]; //+String same as parseInt(String)\n        if (sCoords[2] in layerBounds) {\n          layerBounds[sCoords[2]].extend(L.point(pixelCoords.x, pixelCoords.y));\n          layerBounds[sCoords[2]].extend(\n            L.point(pixelCoords.x + tileSize, pixelCoords.y + tileSize)\n          );\n        } else {\n          layerBounds[sCoords[2]] = L.bounds(\n            L.point(pixelCoords.x, pixelCoords.y),\n            L.point(pixelCoords.x + tileSize, pixelCoords.y + tileSize)\n          );\n        }\n      }\n      // TODO: optimize by removing 2nd loop, add util function to convert point in pixels to point in pcrs, use that instead then this loop\n      // won't be needed\n      for (let pixelBounds in layerBounds) {\n        let zoom = +pixelBounds;\n        layerBounds[pixelBounds] = M.pixelToPCRSBounds(\n          layerBounds[pixelBounds],\n          zoom,\n          projection\n        );\n      }\n      return layerBounds;\n    },\n\n    _getZoomBounds: function (container, maxZoomBound) {\n      if (!container) return null;\n      // should read zoom information from map-meta (of layer-) instead of the zoom attribute value of map-tile\n      let meta = M._metaContentToObject(\n          this.options._leafletLayer._layerEl\n            .querySelector('map-meta[name=zoom]')\n            .getAttribute('content')\n        ),\n        zoom = {},\n        tiles = container.getElementsByTagName('map-tile');\n      zoom.nativeZoom = +meta.value || 0;\n      zoom.maxNativeZoom = 0;\n      zoom.minNativeZoom = maxZoomBound;\n      for (let i = 0; i < tiles.length; i++) {\n        let lZoom = +tiles[i].getAttribute('zoom');\n        if (!tiles[i].getAttribute('zoom')) lZoom = zoom.nativeZoom;\n        zoom.minNativeZoom = Math.min(zoom.minNativeZoom, lZoom);\n        zoom.maxNativeZoom = Math.max(zoom.maxNativeZoom, lZoom);\n      }\n\n      // currently the min and max zoom bounds of staticTileLayer is set based on map-meta\n      // can be hard coded to only natively zoom out 2 levels, any more and too many tiles are going to be loaded in at one time\n      // it will avoid lagging the users computer, but it will also cause the bug that the initial zoom level of map is inproperly set\n      zoom.minZoom = +meta.min || 0;\n      zoom.maxZoom = +meta.max || maxZoomBound;\n      return zoom;\n    },\n\n    _groupTiles: function (tiles) {\n      let tileMap = {};\n      for (let i = 0; i < tiles.length; i++) {\n        let tile = {};\n        tile.row = +tiles[i].getAttribute('row');\n        tile.col = +tiles[i].getAttribute('col');\n        tile.zoom = +tiles[i].getAttribute('zoom') || this.options.nativeZoom;\n        tile.src = tiles[i].getAttribute('src');\n        let tileCode = tile.col + ':' + tile.row + ':' + tile.zoom;\n        if (tileCode in tileMap) {\n          tileMap[tileCode].push(tile);\n        } else {\n          tileMap[tileCode] = [tile];\n        }\n      }\n      return tileMap;\n    }\n  });\n\n  var staticTileLayer = function (options) {\n    return new StaticTileLayer(options);\n  };\n\n  var LayerControl = L.Control.Layers.extend({\n    /* removes 'base' layers as a concept */\n    options: {\n      autoZIndex: false,\n      sortLayers: true,\n      sortFunction: function (layerA, layerB) {\n        return layerA.options.zIndex < layerB.options.zIndex\n          ? -1\n          : layerA.options.zIndex > layerB.options.zIndex\n          ? 1\n          : 0;\n      }\n    },\n    initialize: function (overlays, options) {\n      L.setOptions(this, options);\n\n      // the _layers array contains objects like {layer: layer, name: \"name\", overlay: true}\n      // the array index is the id of the layer returned by L.stamp(layer) which I guess is a unique hash\n      this._layerControlInputs = [];\n      this._layers = [];\n      this._lastZIndex = 0;\n      this._handlingClick = false;\n\n      for (var i in overlays) {\n        this._addLayer(overlays[i], i, true);\n      }\n    },\n    onAdd: function () {\n      this._initLayout();\n      // Adding event on layer control button\n      L.DomEvent.on(\n        this._container.getElementsByTagName('a')[0],\n        'keydown',\n        this._focusFirstLayer,\n        this._container\n      );\n      L.DomEvent.on(\n        this._container,\n        'contextmenu',\n        this._preventDefaultContextMenu,\n        this\n      );\n      this._update();\n      if (this._layers.length < 1 && !this._map._showControls) {\n        this._container.setAttribute('hidden', '');\n      } else {\n        this._map._showControls = true;\n      }\n      return this._container;\n    },\n    onRemove: function (map) {\n      L.DomEvent.off(\n        this._container.getElementsByTagName('a')[0],\n        'keydown',\n        this._focusFirstLayer,\n        this._container\n      );\n    },\n    addOrUpdateOverlay: function (layer, name) {\n      var alreadyThere = false;\n      for (var i = 0; i < this._layers.length; i++) {\n        if (this._layers[i].layer === layer) {\n          alreadyThere = true;\n          this._layers[i].name = name;\n          // replace the controls with updated controls if necessary.\n          break;\n        }\n      }\n      if (!alreadyThere) {\n        this.addOverlay(layer, name);\n      }\n      if (this._layers.length > 0) {\n        this._container.removeAttribute('hidden');\n        this._map._showControls = true;\n      }\n      return this._map ? this._update() : this;\n    },\n    removeLayer: function (layer) {\n      L.Control.Layers.prototype.removeLayer.call(this, layer);\n      if (this._layers.length === 0) {\n        this._container.setAttribute('hidden', '');\n      }\n    },\n\n    _checkDisabledLayers: function () {},\n\n    // focus the first layer in the layer control when enter is pressed\n    _focusFirstLayer: function (e) {\n      if (\n        e.key === 'Enter' &&\n        this.className ===\n          'leaflet-control-layers leaflet-control leaflet-control-layers-expanded'\n      ) {\n        var elem =\n          this.children[1].children[2].children[0].children[0].children[0]\n            .children[0];\n        if (elem) setTimeout(() => elem.focus(), 0);\n      }\n    },\n\n    // imported from leaflet with slight modifications\n    // for layerControl ordering based on zIndex\n    _update: function () {\n      if (!this._container) {\n        return this;\n      }\n\n      L.DomUtil.empty(this._baseLayersList);\n      L.DomUtil.empty(this._overlaysList);\n\n      this._layerControlInputs = [];\n      var baseLayersPresent,\n        overlaysPresent,\n        i,\n        obj,\n        baseLayersCount = 0;\n\n      // <----------- MODIFICATION from the default _update method\n      // sort the layercontrol layers object based on the zIndex\n      // provided by MapMLLayer\n      if (this.options.sortLayers) {\n        this._layers.sort((a, b) =>\n          this.options.sortFunction(a.layer, b.layer, a.name, b.name)\n        );\n      }\n      // -------------------------------------------------->\n      for (i = 0; i < this._layers.length; i++) {\n        obj = this._layers[i];\n        this._addItem(obj);\n        overlaysPresent = overlaysPresent || obj.overlay;\n        baseLayersPresent = baseLayersPresent || !obj.overlay;\n        baseLayersCount += !obj.overlay ? 1 : 0;\n      }\n\n      // Hide base layers section if there's only one layer.\n      if (this.options.hideSingleBase) {\n        baseLayersPresent = baseLayersPresent && baseLayersCount > 1;\n        this._baseLayersList.style.display = baseLayersPresent ? '' : 'none';\n      }\n\n      this._separator.style.display =\n        overlaysPresent && baseLayersPresent ? '' : 'none';\n\n      return this;\n    },\n\n    _addItem: function (obj) {\n      var layercontrols = obj.layer._layerEl._layerControlHTML;\n      // the input is required by Leaflet...\n      obj.input = layercontrols.querySelector(\n        'input.leaflet-control-layers-selector'\n      );\n\n      this._layerControlInputs.push(obj.input);\n      obj.input.layerId = L.stamp(obj.layer);\n\n      this._overlaysList.appendChild(layercontrols);\n      return layercontrols;\n    },\n\n    //overrides collapse and conditionally collapses the panel\n    collapse: function (e) {\n      // if layer control is not expanded, return\n      if (!this._container.className.includes('expanded')) {\n        return;\n      }\n      // return if layer contextmenu is still open\n      if (\n        !this._map.contextMenu._extentLayerMenu.hidden ||\n        !this._map.contextMenu._layerMenu.hidden\n      ) {\n        return;\n      }\n      if (\n        e.target.tagName === 'SELECT' ||\n        (e.relatedTarget &&\n          e.relatedTarget.parentElement &&\n          (e.relatedTarget.className === 'mapml-contextmenu mapml-layer-menu' ||\n            e.relatedTarget.parentElement.className ===\n              'mapml-contextmenu mapml-layer-menu')) ||\n        (this._map && this._map.contextMenu._layerMenu.style.display === 'block')\n      )\n        return this;\n\n      L.DomUtil.removeClass(this._container, 'leaflet-control-layers-expanded');\n      if (e.originalEvent?.pointerType === 'touch') {\n        this._container._isExpanded = false;\n      }\n      return this;\n    },\n    _preventDefaultContextMenu: function (e) {\n      let latlng = this._map.mouseEventToLatLng(e);\n      let containerPoint = this._map.mouseEventToContainerPoint(e);\n      e.preventDefault();\n      // for touch devices, when the layer control is not expanded,\n      // the layer context menu should not show on map\n      if (!this._container._isExpanded && e.pointerType === 'touch') {\n        this._container._isExpanded = true;\n        return;\n      }\n      this._map.fire('contextmenu', {\n        originalEvent: e,\n        containerPoint: containerPoint,\n        latlng: latlng\n      });\n    }\n  });\n  var layerControl = function (layers, options) {\n    return new LayerControl(layers, options);\n  };\n\n  var FeatureLayer = L.FeatureGroup.extend({\n    /*\n     * M.MapML turns any MapML feature data into a Leaflet layer. Based on L.GeoJSON.\n     *\n     * Used by MapMLLayer to create _mapmlvectors property, used to render features\n     */\n    initialize: function (mapml, options) {\n      /*\n          mapml:\n          1. for query: an array of map-feature elements that it fetches\n          2. for static templated feature: null\n          3. for non-templated feature: layer- (with no src) or mapml file (with src)\n        */\n      // options.extent: when you use a FeatureLayer, you can either get it to calculate the\n      // .layerBounds dynamically (the default), based on adds/removes of features from the layer/\n      // or you can construct it with a bounds (via options.extent),\n      // which will then remain static for the lifetime of the layer\n\n      L.FeatureGroup.prototype.initialize.call(this, null, options);\n      // this.options.static is false ONLY for tiled vector features\n      // this._staticFeature is ONLY true when not used by TemplatedFeaturesLayer\n      // this.options.query true when created by QueryHandler.js\n\n      if (!this.options.tiles) {\n        // not a tiled vector layer\n        this._container = null;\n        if (this.options.query) {\n          this._container = L.DomUtil.create(\n            'div',\n            'leaflet-layer',\n            this.options.pane\n          );\n          // must have leaflet-pane class because of new/changed rule in leaflet.css\n          // info: https://github.com/Leaflet/Leaflet/pull/4597\n          L.DomUtil.addClass(\n            this._container,\n            'leaflet-pane mapml-vector-container'\n          );\n        } else if (this.options._leafletLayer) {\n          this._container = L.DomUtil.create(\n            'div',\n            'leaflet-layer',\n            this.options.pane\n          );\n          L.DomUtil.addClass(\n            this._container,\n            'leaflet-pane mapml-vector-container'\n          );\n          // static mapmlvector should always at the top\n          //        this._container.style.zIndex = 1000;\n        } else {\n          // if the current featureLayer is a sublayer of templatedFeatureLayer,\n          // append <svg> directly to the templated feature container (passed in as options.pane)\n          this._container = this.options.pane;\n          L.DomUtil.addClass(\n            this._container,\n            'leaflet-pane mapml-vector-container'\n          );\n        }\n        L.setOptions(this.options.renderer, { pane: this._container });\n      }\n      if (this.options.query) {\n        this._queryFeatures = mapml.features ? mapml.features : mapml;\n      } else if (!mapml) {\n        // use this.options._leafletLayer to distinguish the featureLayer constructed for initialization and for templated features / tiles\n        if (this.options._leafletLayer) {\n          // this._staticFeature should be set to true to make sure the _getEvents works properly\n          this._features = {};\n          this._staticFeature = true;\n        }\n      }\n    },\n\n    isVisible: function () {\n      let map = this.options.mapEl._map;\n      // if query, isVisible is unconditionally true\n      if (this.options.query) return true;\n      // if the featureLayer is for static features, i.e. it is the mapmlvector layer,\n      // if it is empty, isVisible = false\n      // this._staticFeature: flag to determine if the featureLayer is used by static features only\n      // this._features: check if the current static featureLayer is empty\n      // (Object.keys(this._features).length === 0 => this._features is an empty object)\n      else if (this._staticFeature && Object.keys(this._features).length === 0) {\n        return false;\n      } else {\n        let mapZoom = map.getZoom(),\n          zoomBounds = this.zoomBounds || this.options.zoomBounds,\n          layerBounds = this.layerBounds || this.options.layerBounds,\n          withinZoom = zoomBounds\n            ? mapZoom <= zoomBounds.maxZoom && mapZoom >= zoomBounds.minZoom\n            : false;\n        return (\n          withinZoom &&\n          this._layers &&\n          layerBounds &&\n          layerBounds.overlaps(\n            M.pixelToPCRSBounds(\n              map.getPixelBounds(),\n              mapZoom,\n              map.options.projection\n            )\n          )\n        );\n      }\n    },\n\n    onAdd: function (map) {\n      this._map = map;\n      L.FeatureGroup.prototype.onAdd.call(this, map);\n      if (this._staticFeature) {\n        this._validateRendering();\n      }\n      if (this._queryFeatures)\n        map.on('featurepagination', this.showPaginationFeature, this);\n    },\n    addLayer: function (layerToAdd) {\n      L.FeatureGroup.prototype.addLayer.call(this, layerToAdd);\n      // static FeatureLayer (e.g. MapMLLayer._mapmlvectors) NEVER has a\n      // .layerBounds property, so if there is this.options.layerBounds, don't\n      // go copying it to this.layerBounds.  Same for zoomBounds.\n      // bug alert: it's necessary to create a new bounds object to initialize\n      // this.layerBounds, to avoid changing the layerBounds of the first geometry\n      // added to this layer\n      if (!this.options.layerBounds) {\n        this.layerBounds = this.layerBounds\n          ? this.layerBounds.extend(layerToAdd.layerBounds)\n          : L.bounds(layerToAdd.layerBounds.min, layerToAdd.layerBounds.max);\n\n        if (this.zoomBounds) {\n          if (layerToAdd.zoomBounds.minZoom < this.zoomBounds.minZoom)\n            this.zoomBounds.minZoom = layerToAdd.zoomBounds.minZoom;\n          if (layerToAdd.zoomBounds.maxZoom > this.zoomBounds.maxZoom)\n            this.zoomBounds.maxZoom = layerToAdd.zoomBounds.maxZoom;\n          if (layerToAdd.zoomBounds.minNativeZoom < this.zoomBounds.minNativeZoom)\n            this.zoomBounds.minNativeZoom = layerToAdd.zoomBounds.minNativeZoom;\n          if (layerToAdd.zoomBounds.maxNativeZoom > this.zoomBounds.maxNativeZoom)\n            this.zoomBounds.maxNativeZoom = layerToAdd.zoomBounds.maxNativeZoom;\n        } else {\n          this.zoomBounds = layerToAdd.zoomBounds;\n        }\n      }\n      if (this._staticFeature) {\n        // TODO: validate the use the feature.zoom which is new (was in createGeometry)\n        let featureZoom = layerToAdd.options.mapmlFeature.zoom;\n        if (featureZoom in this._features) {\n          this._features[featureZoom].push(layerToAdd);\n        } else {\n          this._features[featureZoom] = [layerToAdd];\n        }\n        // hide/display features based on the their zoom limits\n        this._validateRendering();\n      }\n      return this;\n    },\n    addRendering: function (featureToAdd) {\n      L.FeatureGroup.prototype.addLayer.call(this, featureToAdd);\n    },\n    onRemove: function (map) {\n      if (this._queryFeatures) {\n        map.off('featurepagination', this.showPaginationFeature, this);\n        delete this._queryFeatures;\n        L.DomUtil.remove(this._container);\n      }\n      L.FeatureGroup.prototype.onRemove.call(this, map);\n      this._map.featureIndex.cleanIndex();\n    },\n\n    removeLayer: function (featureToRemove) {\n      L.FeatureGroup.prototype.removeLayer.call(this, featureToRemove);\n      if (!this.options.layerBounds) {\n        delete this.layerBounds;\n        // this ensures that the <layer->.extent gets recalculated if needed\n        delete this.options._leafletLayer.bounds;\n        delete this.zoomBounds;\n        // this ensures that the <layer->.extent gets recalculated if needed\n        delete this.options._leafletLayer.zoomBounds;\n        delete this._layers[featureToRemove._leaflet_id];\n        this._removeFromFeaturesList(featureToRemove);\n        // iterate through all remaining layers\n        let layerBounds, zoomBounds;\n        let layerIds = Object.keys(this._layers);\n        // re-calculate the layerBounds and zoomBounds for the whole layer when\n        // a feature is permanently removed from the overall layer\n        // bug alert: it's necessary to create a new bounds object to initialize\n        // this.layerBounds, to avoid changing the layerBounds of the first geometry\n        // added to this layer\n        for (let id of layerIds) {\n          let layer = this._layers[id];\n          if (layerBounds) {\n            layerBounds.extend(layer.layerBounds);\n          } else {\n            layerBounds = L.bounds(layer.layerBounds.min, layer.layerBounds.max);\n          }\n          if (zoomBounds) {\n            if (layer.zoomBounds.minZoom < zoomBounds.minZoom)\n              zoomBounds.minZoom = layer.zoomBounds.minZoom;\n            if (layer.zoomBounds.maxZoom > zoomBounds.maxZoom)\n              zoomBounds.maxZoom = layer.zoomBounds.maxZoom;\n            if (layer.zoomBounds.minNativeZoom < zoomBounds.minNativeZoom)\n              zoomBounds.minNativeZoom = layer.zoomBounds.minNativeZoom;\n            if (layer.zoomBounds.maxNativeZoom > zoomBounds.maxNativeZoom)\n              zoomBounds.maxNativeZoom = layer.zoomBounds.maxNativeZoom;\n          } else {\n            zoomBounds = {};\n            zoomBounds.minZoom = layer.zoomBounds.minZoom;\n            zoomBounds.maxZoom = layer.zoomBounds.maxZoom;\n            zoomBounds.minNativeZoom = layer.zoomBounds.minNativeZoom;\n            zoomBounds.maxNativeZoom = layer.zoomBounds.maxNativeZoom;\n          }\n        }\n        // If the last feature is removed, we should remove the .layerBounds and\n        // .zoomBounds properties, so that the FeatureLayer may be ignored\n        if (layerBounds) {\n          this.layerBounds = layerBounds;\n        } else {\n          delete this.layerBounds;\n        }\n        if (zoomBounds) {\n          this.zoomBounds = zoomBounds;\n        } else {\n          delete this.zoomBounds;\n          delete this.options.zoomBounds;\n        }\n      }\n      return this;\n    },\n    /**\n     * Remove the geomtry rendering (an svg g/ M.Geomtry) from the L.FeatureGroup\n     * _layers array, so that it's not visible on the map, but still contributes\n     * to the bounds and zoom limits of the M.FeatureLayer.\n     *\n     * @param {type} featureToRemove\n     * @returns {undefined}\n     */\n    removeRendering: function (featureToRemove) {\n      L.FeatureGroup.prototype.removeLayer.call(this, featureToRemove);\n    },\n    _removeFromFeaturesList: function (feature) {\n      for (let zoom in this._features)\n        for (let i = 0; i < this._features[zoom].length; ++i) {\n          let feature = this._features[zoom][i];\n          if (feature._leaflet_id === feature._leaflet_id) {\n            this._features[zoom].splice(i, 1);\n            break;\n          }\n        }\n    },\n    getEvents: function () {\n      if (this._staticFeature) {\n        return {\n          moveend: this._handleMoveEnd,\n          zoomend: this._handleZoomEnd\n        };\n      }\n      return {};\n    },\n\n    // for query\n    showPaginationFeature: function (e) {\n      if (this.options.query && this._queryFeatures[e.i]) {\n        let feature = this._queryFeatures[e.i];\n        if (e.type === 'featurepagination') {\n          // remove map-feature only (keep meta's) when paginating\n          feature._linkEl.shadowRoot.querySelector('map-feature')?.remove();\n        } else {\n          // empty the map-extent shadowRoot\n          // remove the prev / next one <map-feature> and <map-meta>'s from shadow if there is any\n          feature._linkEl.shadowRoot.replaceChildren();\n        }\n        this.clearLayers();\n        // append all map-meta from mapml document\n        if (e.meta) {\n          for (let i = 0; i < e.meta.length; i++) {\n            feature._linkEl.shadowRoot.appendChild(e.meta[i]);\n          }\n        }\n        feature._linkEl.shadowRoot.appendChild(feature);\n        feature.addFeature(this);\n        e.popup._navigationBar.querySelector('p').innerText =\n          e.i + 1 + '/' + this.options._leafletLayer._totalFeatureCount;\n        e.popup._content\n          .querySelector('iframe')\n          .setAttribute('sandbox', 'allow-same-origin allow-forms');\n        e.popup._content.querySelector('iframe').srcdoc =\n          feature.querySelector('map-properties').innerHTML;\n        // \"zoom to here\" link need to be re-set for every pagination\n        this._map.fire('attachZoomLink', { i: e.i, currFeature: feature });\n        this._map.once(\n          'popupclose',\n          function (e) {\n            this.shadowRoot.innerHTML = '';\n          },\n          feature._linkEl\n        );\n      }\n    },\n\n    _handleMoveEnd: function () {\n      this._removeCSS();\n    },\n\n    _handleZoomEnd: function (e) {\n      // handle zoom end gets called twice for every zoom, this condition makes it go through once only.\n      if (this.zoomBounds) {\n        this._validateRendering();\n      }\n    },\n    /*\n     * _validateRendering prunes the features currently in the _features hashmap (created\n     * by us).  _features categorizes features by zoom, and is used to remove or add\n     * features from the map based on the map-feature min/max getters.  It also\n     * maintains the _map.featureIndex property, which is used to control the tab\n     * order for interactive (static) features currently rendered on the map.\n     * @private\n     *  */\n    _validateRendering: function () {\n      // since features are removed and re-added by zoom level, need to clean the feature index before re-adding\n      if (this._map) this._map.featureIndex.cleanIndex();\n      let map = this._map || this.options._leafletLayer._map;\n      // it's important that we not try to validate rendering if the FeatureLayer\n      // isn't actually  being rendered (i.e. on the map.  the _map property can't\n      // be used because once it's assigned  (by onAdd, above) it's never unassigned.\n      if (!map.hasLayer(this)) return;\n      if (this._features) {\n        for (let zoom in this._features) {\n          for (let k = 0; k < this._features[zoom].length; k++) {\n            let geometry = this._features[zoom][k],\n              renderable = geometry._checkRender(\n                map.getZoom(),\n                this.zoomBounds.minZoom,\n                this.zoomBounds.maxZoom\n              );\n            if (!renderable) {\n              // insert a placeholder in the dom rendering for the geometry\n              // so that it retains its layering order when it is next rendered\n              let placeholder = document.createElement('span');\n              placeholder.id = geometry._leaflet_id;\n              // geometry.defaultOptions.group is the rendered svg g element in sd\n              geometry.defaultOptions.group.insertAdjacentElement(\n                'beforebegin',\n                placeholder\n              );\n              // removing the rendering without removing the feature from the feature list\n              this.removeRendering(geometry);\n            } else if (\n              // checking for _map so we do not enter this code block during the connectedCallBack of the map-feature\n              !map.hasLayer(geometry) &&\n              !geometry._map\n            ) {\n              this.addRendering(geometry);\n              // update the layerbounds\n              let placeholder =\n                geometry.defaultOptions.group.parentNode.querySelector(\n                  `span[id=\"${geometry._leaflet_id}\"]`\n                );\n              placeholder.replaceWith(geometry.defaultOptions.group);\n            }\n          }\n        }\n      }\n    },\n\n    _setZoomTransform: function (center, clampZoom) {\n      var scale = this._map.getZoomScale(this._map.getZoom(), clampZoom),\n        translate = center\n          .multiplyBy(scale)\n          .subtract(this._map._getNewPixelOrigin(center, this._map.getZoom()))\n          .round();\n\n      if (any3d) {\n        L.setTransform(this._layers[clampZoom], translate, scale);\n      } else {\n        L.setPosition(this._layers[clampZoom], translate);\n      }\n    },\n\n    /**\n     * Render a <map-feature> as a Leaflet layer that can be added to a map or\n     * LayerGroup as required.  Kind of a \"factory\" method.\n     *\n     * Uses this.options, so if you need to, you can construct an M.featureLayer\n     * with options set as required\n     *\n     * @param feature - a <map-feature> element\n     * @param {String} fallbackCS - \"gcrs\" | \"pcrs\"\n     * @param {String} tileZoom - the zoom of the map at which the coordinates will exist\n     *\n     * @returns M.Geometry, which is an L.FeatureGroup\n     * @public\n     */\n    createGeometry: function (feature, fallbackCS, tileZoom) {\n      // was let options = this.options, but that was causing unwanted side-effects\n      // because we were adding .layerBounds and .zoomBounds to it before passing\n      // to _createGeometry, which meant that FeatureLayer was sprouting\n      // options.layerBounds and .zoomBounds when it should not have those props\n      let options = Object.assign({}, this.options);\n\n      if (options.filter && !options.filter(feature)) {\n        return;\n      }\n\n      if (feature.classList.length) {\n        options.className = feature.classList.value;\n      }\n      // tileZoom is only used when the map-feature is discarded i.e. for rendering\n      // vector tiles' feature geometries in bulk (in this case only the geomtry\n      // is rendered on a tile-shaped FeatureLayer\n      let zoom = feature.zoom ?? tileZoom,\n        title = feature.querySelector('map-featurecaption');\n      title = title ? title.innerHTML : 'Feature';\n\n      if (feature.querySelector('map-properties')) {\n        options.properties = document.createElement('div');\n        options.properties.classList.add('mapml-popup-content');\n        options.properties.insertAdjacentHTML(\n          'afterbegin',\n          feature.querySelector('map-properties').innerHTML\n        );\n      }\n      let cs =\n        feature.getElementsByTagName('map-geometry')[0]?.getAttribute('cs') ||\n        fallbackCS;\n      // options.layerBounds and options.zoomBounds are set by TemplatedTileLayer._createFeatures\n      // each geometry needs bounds so that it can be a good community member of this._layers\n      if (this._staticFeature || this.options.query) {\n        options.layerBounds = M.extentToBounds(feature.extent, 'PCRS');\n        options.zoomBounds = feature.extent.zoom;\n      }\n      let geometry = this._geometryToLayer(feature, options, cs, +zoom, title);\n      if (geometry && Object.keys(geometry._layers).length !== 0) {\n        // if the layer is being used as a query handler output, it will have\n        // a color option set.  Otherwise, copy classes from the feature\n        if (!geometry.options.color && feature.hasAttribute('class')) {\n          geometry.options.className = feature.getAttribute('class');\n        }\n        geometry.defaultOptions = geometry.options;\n        this.resetStyle(geometry);\n\n        if (options.onEachFeature) {\n          geometry.bindTooltip(title, { interactive: true, sticky: true });\n        }\n        if (feature.tagName.toUpperCase() === 'MAP-FEATURE') {\n          feature._groupEl = geometry.options.group;\n        }\n        return geometry;\n      }\n    },\n\n    resetStyle: function (layer) {\n      var style = this.options.style;\n      if (style) {\n        // reset any custom styles\n        L.Util.extend(layer.options, layer.defaultOptions);\n        this._setLayerStyle(layer, style);\n      }\n    },\n\n    setStyle: function (style) {\n      this.eachLayer(function (layer) {\n        this._setLayerStyle(layer, style);\n      }, this);\n    },\n\n    _setLayerStyle: function (layer, style) {\n      if (typeof style === 'function') {\n        style = style(layer.feature);\n      }\n      if (layer.setStyle) {\n        layer.setStyle(style);\n      }\n    },\n    _removeCSS: function () {\n      let toDelete = this._container.querySelectorAll(\n        'link[rel=stylesheet],style'\n      );\n      for (let i = 0; i < toDelete.length; i++) {\n        this._container.removeChild(toDelete[i]);\n      }\n    },\n    _geometryToLayer: function (feature, vectorOptions, cs, zoom, title) {\n      let geometry = feature.getElementsByTagName('map-geometry')[0],\n        group = [],\n        svgGroup = L.SVG.create('g'),\n        copyOptions = Object.assign({}, vectorOptions);\n      svgGroup._featureEl = feature; // rendered <g> has a reference to map-feature\n      if (geometry) {\n        for (let geo of geometry.querySelectorAll(\n          'map-polygon, map-linestring, map-multilinestring, map-point, map-multipoint'\n        )) {\n          group.push(\n            M.path(\n              geo,\n              Object.assign(copyOptions, {\n                nativeCS: cs,\n                nativeZoom: zoom,\n                projection: this.options.projection,\n                featureID: feature.id,\n                group: svgGroup,\n                wrappers: this._getGeometryParents(geo.parentElement),\n                featureLayer: this,\n                _leafletLayer: this.options._leafletLayer\n              })\n            )\n          );\n        }\n        let groupOptions = {\n            group: svgGroup,\n            mapmlFeature: feature,\n            featureID: feature.id,\n            accessibleTitle: title,\n            onEachFeature: vectorOptions.onEachFeature,\n            properties: vectorOptions.properties,\n            _leafletLayer: this.options._leafletLayer,\n            layerBounds: vectorOptions.layerBounds,\n            zoomBounds: vectorOptions.zoomBounds\n          },\n          collections =\n            geometry.querySelector('map-multipolygon') ||\n            geometry.querySelector('map-geometrycollection');\n        if (collections)\n          groupOptions.wrappers = this._getGeometryParents(\n            collections.parentElement\n          );\n        return M.geometry(group, groupOptions);\n      }\n    },\n\n    _getGeometryParents: function (subType, elems = []) {\n      if (subType && subType.tagName.toUpperCase() !== 'MAP-GEOMETRY') {\n        if (\n          subType.tagName.toUpperCase() === 'MAP-MULTIPOLYGON' ||\n          subType.tagName.toUpperCase() === 'MAP-GEOMETRYCOLLECTION'\n        )\n          return this._getGeometryParents(subType.parentElement, elems);\n        return this._getGeometryParents(\n          subType.parentElement,\n          elems.concat([subType])\n        );\n      } else {\n        return elems;\n      }\n    }\n  });\n  var featureLayer = function (mapml, options) {\n    return new FeatureLayer(mapml, options);\n  };\n\n  var TemplatedTileLayer = L.TileLayer.extend({\n    // a TemplateTileLayer is similar to a L.TileLayer except its templates are\n    // defined by the <map-extent><template/></map-extent>\n    // content found in the MapML document.  As such, the client map does not\n    // 'revisit' the server for more MapML content, it simply fills the map extent\n    // with tiles for which it generates requests on demand (as the user pans/zooms/resizes\n    // the map)\n    initialize: function (template, options) {\n      // _setUpTileTemplateVars needs options.crs, not available unless we set\n      // options first...\n      options.tms = template.tms;\n      // it's critical to have this.options.minZoom, minNativeZoom, maxZoom, maxNativeZoom\n      // because they are used by Leaflet Map and GridLayer, but we\n      // don't need two copies of that info on our options object, so set the\n      // .zoomBounds property (which is used externally), then delete the option\n      // before unpacking the zoomBound object's properties onto this.options.minZ... etc.\n      this.zoomBounds = Object.assign({}, options.zoomBounds);\n      // unpack object to this.options.minZ... etc where minZ... are the props\n      // of the this.zoomBounds object:\n      L.extend(options, this.zoomBounds);\n      L.setOptions(this, options);\n      // _setup call here relies on this.options.minZ.. etc\n      this._setUpTileTemplateVars(template);\n      this._linkEl = options.linkEl;\n      this.extentBounds = this.options.extentBounds;\n      // get rid of duplicate information as it is confusing\n      delete this.options.zoomBounds;\n      delete this.options.extentBounds;\n\n      this._template = template;\n      this._initContainer();\n      // call the parent constructor with the template tref value, per the\n      // Leaflet tutorial: http://leafletjs.com/examples/extending/extending-1-classes.html#methods-of-the-parent-class\n      L.TileLayer.prototype.initialize.call(\n        this,\n        template.template,\n        L.extend(options, { pane: this.options.pane })\n      );\n    },\n    onAdd: function (map) {\n      this.options.pane.appendChild(this._container);\n      L.TileLayer.prototype.onAdd.call(this, map);\n      this._handleMoveEnd();\n    },\n\n    onRemove: function () {\n      L.DomUtil.remove(this._container);\n      // should clean up the container\n      for (let child of this._container.children) {\n        L.DomUtil.remove(child);\n      }\n    },\n\n    getEvents: function () {\n      let events = L.TileLayer.prototype.getEvents.call(this, this._map);\n      this._parentOnMoveEnd = events.moveend;\n      events.moveend = this._handleMoveEnd;\n      return events;\n    },\n\n    isVisible: function () {\n      let map = this._linkEl.getMapEl()._map;\n      let mapZoom = map.getZoom();\n      let mapBounds = M.pixelToPCRSBounds(\n        map.getPixelBounds(),\n        mapZoom,\n        map.options.projection\n      );\n      return (\n        mapZoom <= this.zoomBounds.maxZoom &&\n        mapZoom >= this.zoomBounds.minZoom &&\n        this.extentBounds.overlaps(mapBounds)\n      );\n    },\n\n    _initContainer: function () {\n      if (this._container) {\n        return;\n      }\n\n      this._container = L.DomUtil.create(\n        'div',\n        'leaflet-layer',\n        this.options.pane\n      );\n      L.DomUtil.addClass(this._container, 'mapml-templated-tile-container');\n      this._updateZIndex();\n    },\n\n    _handleMoveEnd: function (e) {\n      if (!this.isVisible()) return;\n      this._parentOnMoveEnd();\n    },\n    createTile: function (coords) {\n      let tileGroup = document.createElement('DIV'),\n        tileSize = this.getTileSize();\n      L.DomUtil.addClass(tileGroup, 'mapml-tile-group');\n      L.DomUtil.addClass(tileGroup, 'leaflet-tile');\n\n      this._template.linkEl.dispatchEvent(\n        new CustomEvent('tileloadstart', {\n          detail: {\n            x: coords.x,\n            y: coords.y,\n            zoom: coords.z,\n            appendTile: (elem) => {\n              tileGroup.appendChild(elem);\n            }\n          }\n        })\n      );\n\n      if (this._template.type.startsWith('image/')) {\n        let tile = L.TileLayer.prototype.createTile.call(\n          this,\n          coords,\n          function () {}\n        );\n        tile.width = tileSize.x;\n        tile.height = tileSize.y;\n        tileGroup.appendChild(tile);\n      } else if (!this._url.includes(M.BLANK_TT_TREF)) {\n        // tiles of type=\"text/mapml\" will have to fetch content while creating\n        // the tile here, unless there can be a callback associated to the element\n        // that will render the content in the alread-placed tile\n        // var tile = L.DomUtil.create('canvas', 'leaflet-tile');\n        this._fetchTile(coords, tileGroup);\n      }\n      return tileGroup;\n    },\n    _mapmlTileReady: function (tile) {\n      L.DomUtil.addClass(tile, 'leaflet-tile-loaded');\n    },\n    // instead of being child of a pane, the TemplatedTileLayers are 'owned' by the group,\n    // and so are DOM children of the group, not the pane element (the MapMLLayer is\n    // a child of the overlay pane and always has a set of sub-layers)\n    getPane: function () {\n      return this.options.pane;\n    },\n    _fetchTile: function (coords, tile) {\n      let url = this.getTileUrl(coords);\n      if (url) {\n        fetch(url, { redirect: 'follow' })\n          .then(function (response) {\n            if (response.status >= 200 && response.status < 300) {\n              return Promise.resolve(response);\n            } else {\n              console.log(\n                'Looks like there was a problem. Status Code: ' + response.status\n              );\n              return Promise.reject(response);\n            }\n          })\n          .then(function (response) {\n            return response.text();\n          })\n          .then((text) => {\n            var parser = new DOMParser();\n            return parser.parseFromString(text, 'application/xml');\n          })\n          .then((mapml) => {\n            this._createFeatures(mapml, coords, tile);\n            this._mapmlTileReady(tile);\n          })\n          .catch((err) => {\n            console.log('Error Creating Tile');\n          });\n      }\n    },\n\n    // TO DO: get rid of this function altogether; see TO DO below re: map-link\n    // shadow root\n    // _parseStylesheetAsHTML parses map-link and map-style from mapml and inserts them to the container as HTML\n    _parseStylesheetAsHTML: function (mapml, base, container) {\n      if (\n        !(container instanceof Element) ||\n        !mapml ||\n        !mapml.querySelector('map-link[rel=stylesheet],map-style')\n      )\n        return;\n\n      if (base instanceof Element) {\n        base = base.getAttribute('href')\n          ? base.getAttribute('href')\n          : document.URL;\n      } else if (!base || base === '' || base instanceof Object) {\n        return;\n      }\n\n      var ss = [];\n      var stylesheets = mapml.querySelectorAll(\n        'map-link[rel=stylesheet],map-style'\n      );\n      for (var i = 0; i < stylesheets.length; i++) {\n        if (stylesheets[i].nodeName.toUpperCase() === 'MAP-LINK') {\n          var href = stylesheets[i].hasAttribute('href')\n            ? new URL(stylesheets[i].getAttribute('href'), base).href\n            : null;\n          if (href) {\n            if (!container.querySelector(\"link[href='\" + href + \"']\")) {\n              var linkElm = document.createElement('link');\n              copyAttributes(stylesheets[i], linkElm);\n              linkElm.setAttribute('href', href);\n              ss.push(linkElm);\n            }\n          }\n        } else {\n          // <map-style>\n          var styleElm = document.createElement('style');\n          copyAttributes(stylesheets[i], styleElm);\n          styleElm.textContent = stylesheets[i].textContent;\n          ss.push(styleElm);\n        }\n      }\n      // insert <link> or <style> elements after the begining  of the container\n      // element, in document order as copied from original mapml document\n      // note the code below assumes hrefs have been resolved and elements\n      // re-parsed from xml and serialized as html elements ready for insertion\n      for (var s = ss.length - 1; s >= 0; s--) {\n        container.insertAdjacentElement('afterbegin', ss[s]);\n      }\n      function copyAttributes(source, target) {\n        return Array.from(source.attributes).forEach((attribute) => {\n          if (attribute.nodeName !== 'href')\n            target.setAttribute(attribute.nodeName, attribute.nodeValue);\n        });\n      }\n    },\n\n    _createFeatures: function (markup, coords, tile) {\n      // TO DO: create a shadow root for the <map-link> that hosts this layer,\n      // populate it with map-tile, map-link and map-style elements that are\n      // fetched.\n      let stylesheets = markup.querySelector(\n        'map-link[rel=stylesheet],map-style'\n      );\n      if (stylesheets) {\n        let base =\n          markup.querySelector('map-base') &&\n          markup.querySelector('map-base').hasAttribute('href')\n            ? new URL(markup.querySelector('map-base').getAttribute('href')).href\n            : markup.URL;\n        this._parseStylesheetAsHTML(markup, base, tile);\n      }\n\n      let svg = L.SVG.create('svg'),\n        g = L.SVG.create('g'),\n        tileSize = this._map.options.crs.options.crs.tile.bounds.max.x,\n        xOffset = coords.x * tileSize,\n        yOffset = coords.y * tileSize;\n\n      let tileFeatures = M.featureLayer(null, {\n        projection: this._map.options.projection,\n        tiles: true,\n        layerBounds: this.extentBounds,\n        zoomBounds: this.zoomBounds,\n        interactive: false,\n        mapEl: this._linkEl.getMapEl()\n      });\n      let fallback = M.getNativeVariables(markup);\n      let features = markup.querySelectorAll('map-feature:has(> map-geometry)');\n      for (let i = 0; i < features.length; i++) {\n        let feature = tileFeatures.createGeometry(\n          features[i],\n          fallback.cs,\n          coords.z\n        );\n        for (let featureID in feature._layers) {\n          let layer = feature._layers[featureID];\n          M.FeatureRenderer.prototype._initPath(layer, false);\n          layer._project(this._map, L.point([xOffset, yOffset]), coords.z);\n          M.FeatureRenderer.prototype._addPath(layer, g, false);\n          M.FeatureRenderer.prototype._updateFeature(layer);\n        }\n      }\n      svg.setAttribute('width', tileSize.toString());\n      svg.setAttribute('height', tileSize.toString());\n      svg.appendChild(g);\n      tile.appendChild(svg);\n    },\n\n    getTileUrl: function (coords) {\n      if (\n        coords.z >= this._template.tilematrix.bounds.length ||\n        !this._template.tilematrix.bounds[coords.z].contains(coords)\n      ) {\n        return '';\n      }\n      var obj = {},\n        linkEl = this._template.linkEl,\n        zoomInput = linkEl.zoomInput;\n      obj[this._template.tilematrix.col.name] = coords.x;\n      obj[this._template.tilematrix.row.name] = coords.y;\n      if (\n        zoomInput &&\n        linkEl.hasAttribute('tref') &&\n        linkEl\n          .getAttribute('tref')\n          .includes(`{${zoomInput.getAttribute('name')}}`)\n      ) {\n        obj[this._template.zoom.name] = this._getZoomForUrl();\n      }\n      obj[this._template.pcrs.easting.left] = this._tileMatrixToPCRSPosition(\n        coords,\n        'top-left'\n      ).x;\n      obj[this._template.pcrs.easting.right] = this._tileMatrixToPCRSPosition(\n        coords,\n        'top-right'\n      ).x;\n      obj[this._template.pcrs.northing.top] = this._tileMatrixToPCRSPosition(\n        coords,\n        'top-left'\n      ).y;\n      obj[this._template.pcrs.northing.bottom] = this._tileMatrixToPCRSPosition(\n        coords,\n        'bottom-left'\n      ).y;\n      for (var v in this._template.tile) {\n        if (\n          ['row', 'col', 'zoom', 'left', 'right', 'top', 'bottom'].indexOf(v) < 0\n        ) {\n          obj[v] = this._template.tile[v];\n        }\n      }\n      if (this._map && !this._map.options.crs.infinite) {\n        let invertedY = this._globalTileRange.max.y - coords.y;\n        if (this.options.tms) {\n          obj[this._template.tilematrix.row.name] = invertedY;\n        }\n        //obj[`-${this._template.tilematrix.row.name}`] = invertedY; //leaflet has this but I dont see a use in storing row and -row as it doesnt follow that pattern\n      }\n      obj.r =\n        this.options.detectRetina && L.Browser.retina && this.options.maxZoom > 0\n          ? '@2x'\n          : '';\n      return L.Util.template(this._url, obj);\n    },\n    _tileMatrixToPCRSPosition: function (coords, pos) {\n      // this is a tile:\n      //\n      //   top-left         top-center           top-right\n      //      +------------------+------------------+\n      //      |                  |                  |\n      //      |                  |                  |\n      //      |                  |                  |\n      //      |                  |                  |\n      //      |                  |                  |\n      //      |                  |                  |\n      //      + center-left    center               + center-right\n      //      |                  |                  |\n      //      |                  |                  |\n      //      |                  |                  |\n      //      |                  |                  |\n      //      |                  |                  |\n      //      |                  |                  |\n      //      |                  |                  |\n      //      +------------------+------------------+\n      //   bottom-left     bottom-center      bottom-right\n\n      var map = this._map,\n        crs = map.options.crs,\n        tileSize = this.getTileSize(),\n        nwPoint = coords.scaleBy(tileSize),\n        sePoint = nwPoint.add(tileSize),\n        centrePoint = nwPoint.add(Math.floor(tileSize / 2)),\n        nw = crs.transformation.untransform(nwPoint, crs.scale(coords.z)),\n        se = crs.transformation.untransform(sePoint, crs.scale(coords.z)),\n        cen = crs.transformation.untransform(centrePoint, crs.scale(coords.z)),\n        result = null;\n\n      switch (pos) {\n        case 'top-left':\n          result = nw;\n          break;\n        case 'bottom-left':\n          result = new L.Point(nw.x, se.y);\n          break;\n        case 'center-left':\n          result = new L.Point(nw.x, cen.y);\n          break;\n        case 'top-right':\n          result = new L.Point(se.x, nw.y);\n          break;\n        case 'bottom-right':\n          result = se;\n          break;\n        case 'center-right':\n          result = new L.Point(se.x, cen.y);\n          break;\n        case 'top-center':\n          result = new L.Point(cen.x, nw.y);\n          break;\n        case 'bottom-center':\n          result = new L.Point(cen.x, se.y);\n          break;\n        case 'center':\n          result = cen;\n          break;\n      }\n      return result;\n    },\n    _setUpTileTemplateVars: function (template) {\n      // process the inputs associated to template and create an object named\n      // tile with member properties as follows:\n      // {row: 'rowvarname',\n      //  col: 'colvarname',\n      //  left: 'leftvarname',\n      //  right: 'rightvarname',\n      //  top: 'topvarname',\n      //  bottom: 'bottomvarname'}\n      template.tile = {};\n      var inputs = template.values,\n        crs = this.options.crs.options,\n        east,\n        north,\n        row,\n        col;\n\n      for (var i = 0; i < template.values.length; i++) {\n        var type = inputs[i].getAttribute('type'),\n          units = inputs[i].getAttribute('units'),\n          axis = inputs[i].getAttribute('axis'),\n          name = inputs[i].getAttribute('name'),\n          position = inputs[i].getAttribute('position'),\n          select = inputs[i].tagName.toLowerCase() === 'map-select',\n          value = inputs[i].getAttribute('value'),\n          min = inputs[i].getAttribute('min'),\n          max = inputs[i].getAttribute('max');\n        if (type === 'location' && units === 'tilematrix') {\n          switch (axis) {\n            case 'column':\n              col = {\n                name: name,\n                min: crs.crs.tilematrix.horizontal.min,\n                max: crs.crs.tilematrix.horizontal.max(crs.resolutions.length - 1)\n              };\n              if (!isNaN(Number.parseFloat(min))) {\n                col.min = Number.parseFloat(min);\n              }\n              if (!isNaN(Number.parseFloat(max))) {\n                col.max = Number.parseFloat(max);\n              }\n              break;\n            case 'row':\n              row = {\n                name: name,\n                min: crs.crs.tilematrix.vertical.min,\n                max: crs.crs.tilematrix.vertical.max(crs.resolutions.length - 1)\n              };\n              if (!isNaN(Number.parseFloat(min))) {\n                row.min = Number.parseFloat(min);\n              }\n              if (!isNaN(Number.parseFloat(max))) {\n                row.max = Number.parseFloat(max);\n              }\n              break;\n            case 'longitude':\n            case 'easting':\n              if (!east) {\n                east = {\n                  min: crs.crs.pcrs.horizontal.min,\n                  max: crs.crs.pcrs.horizontal.max\n                };\n              }\n              if (!isNaN(Number.parseFloat(min))) {\n                east.min = Number.parseFloat(min);\n              }\n              if (!isNaN(Number.parseFloat(max))) {\n                east.max = Number.parseFloat(max);\n              }\n              if (position) {\n                if (position.match(/.*?-left/i)) {\n                  east.left = name;\n                } else if (position.match(/.*?-right/i)) {\n                  east.right = name;\n                }\n              }\n              break;\n            case 'latitude':\n            case 'northing':\n              if (!north) {\n                north = {\n                  min: crs.crs.pcrs.vertical.min,\n                  max: crs.crs.pcrs.vertical.max\n                };\n              }\n              if (!isNaN(Number.parseFloat(min))) {\n                north.min = Number.parseFloat(min);\n              }\n              if (!isNaN(Number.parseFloat(max))) {\n                north.max = Number.parseFloat(max);\n              }\n              if (position) {\n                if (position.match(/top-.*?/i)) {\n                  north.top = name;\n                } else if (position.match(/bottom-.*?/i)) {\n                  north.bottom = name;\n                }\n              }\n              break;\n            // unsuportted axis value\n          }\n        } else if (select) {\n          /*jshint -W104 */\n          const parsedselect = inputs[i].htmlselect;\n          template.tile[name] = function () {\n            return parsedselect.value;\n          };\n        } else if (type === 'hidden') {\n          // needs to be a const otherwise it gets overwritten\n          /*jshint -W104 */\n          const input = inputs[i];\n          template.tile[name] = function () {\n            return input.getAttribute('value');\n          };\n        }\n      }\n      var transformation = this.options.crs.transformation,\n        tileSize = this.options.crs.options.crs.tile.bounds.max.x,\n        scale = L.bind(this.options.crs.scale, this.options.crs),\n        pcrs2tilematrix = function (c, zoom) {\n          return transformation\n            .transform(c, scale(zoom))\n            .divideBy(tileSize)\n            .floor();\n        };\n      if (east && north) {\n        template.pcrs = {};\n        template.pcrs.bounds = L.bounds(\n          [east.min, north.min],\n          [east.max, north.max]\n        );\n        template.pcrs.easting = east;\n        template.pcrs.northing = north;\n      } else if (col && row && !isNaN(template.zoom.initialValue)) {\n        // convert the tile bounds at this zoom to a pcrs bounds, then\n        // go through the zoom min/max and create a tile-based bounds\n        // at each zoom that applies to the col/row values that constrain what tiles\n        // will be requested so that we don't generate too many 404s\n        if (!template.pcrs) {\n          template.pcrs = {};\n          template.pcrs.easting = '';\n          template.pcrs.northing = '';\n        }\n\n        template.pcrs.bounds = M.boundsToPCRSBounds(\n          L.bounds(L.point([col.min, row.min]), L.point([col.max, row.max])),\n          template.zoom.initialValue,\n          this.options.crs,\n          M.axisToCS('column')\n        );\n\n        template.tilematrix = {};\n        template.tilematrix.col = col;\n        template.tilematrix.row = row;\n      }\n\n      if (!template.tilematrix) {\n        template.tilematrix = {};\n        template.tilematrix.col = {};\n        template.tilematrix.row = {};\n      }\n      template.tilematrix.bounds = [];\n      var pcrsBounds = template.pcrs.bounds;\n      // the template should _always_ have a zoom, because we force it to\n      // by first processing the extent to determine the zoom and if none, adding\n      // one and second by copying that zoom into the set of template variable inputs\n      // even if it is not referenced by one of the template's variable references\n      var zmin = this.options.minNativeZoom,\n        zmax = this.options.maxNativeZoom;\n      for (var z = 0; z <= zmax; z++) {\n        template.tilematrix.bounds[z] =\n          z >= zmin\n            ? L.bounds(\n                pcrs2tilematrix(pcrsBounds.min, z),\n                pcrs2tilematrix(pcrsBounds.max, z)\n              )\n            : L.bounds(L.point([-1, -1]), L.point([-1, -1]));\n      }\n    },\n    _clampZoom: function (zoom) {\n      let clamp = L.GridLayer.prototype._clampZoom.call(this, zoom);\n      if (this._template.step > this.options.maxNativeZoom)\n        this._template.step = this.options.maxNativeZoom;\n\n      if (zoom !== clamp) {\n        zoom = clamp;\n      } else {\n        if (zoom % this._template.step !== 0) {\n          zoom = Math.floor(zoom / this._template.step) * this._template.step;\n        }\n      }\n      return zoom;\n    }\n  });\n  var templatedTileLayer = function (template, options) {\n    return new TemplatedTileLayer(template, options);\n  };\n\n  var ExtentLayer = L.LayerGroup.extend({\n    initialize: function (options) {\n      // TODO: should invoke prototype.initialize to trigger the leaflet initialization for proper setup\n      //       otherwise the initialize we provide will override the init that leaflet provides\n      //       but we still need to create the container and the pane by ourselves\n      L.LayerGroup.prototype.initialize.call(this, null, options);\n      this._container = L.DomUtil.create('div', 'leaflet-layer');\n      this._extentEl = this.options.extentEl;\n      this.changeOpacity(this.options.opacity);\n      // TODO: need renaming ex. mapml-extentLayer-container\n      L.DomUtil.addClass(this._container, 'mapml-extentlayer-container');\n    },\n    getEvents: function () {\n      return {\n        zoomstart: this._onZoomStart\n      };\n    },\n    _onZoomStart: function () {\n      this.closePopup();\n    },\n    getContainer: function () {\n      return this._container;\n    },\n    onAdd: function (map) {\n      L.LayerGroup.prototype.onAdd.call(this, map);\n      let pane = this.options.extentEl.parentLayer._layer._container;\n      pane.appendChild(this._container);\n    },\n    redraw: function () {\n      this.eachLayer(function (layer) {\n        layer.redraw();\n      });\n    },\n    //addTo: function(map) {\n    //for(let i = 0; i < this._templates.length; i++){\n    //    this._templates[0].layer.addTo(map);\n    //}\n    //},\n    setZIndex: function (zIndex) {\n      this.options.zIndex = zIndex;\n      this._updateZIndex();\n\n      return this;\n    },\n    _updateZIndex: function () {\n      if (\n        this._container &&\n        this.options.zIndex !== undefined &&\n        this.options.zIndex !== null\n      ) {\n        this._container.style.zIndex = this.options.zIndex;\n      }\n    },\n    onRemove: function () {\n      L.LayerGroup.prototype.onRemove.call(this, this._map);\n      L.DomUtil.remove(this._container);\n    },\n\n    _previousFeature: function (e) {\n      if (this._count + -1 >= 0) {\n        this._count--;\n        this._map.fire('featurepagination', { i: this._count, popup: this });\n      }\n    },\n\n    _nextFeature: function (e) {\n      if (this._count + 1 < this._source._totalFeatureCount) {\n        this._count++;\n        this._map.fire('featurepagination', { i: this._count, popup: this });\n      }\n    },\n\n    changeOpacity: function (opacity) {\n      this._container.style.opacity = opacity;\n      this._extentEl._opacity = opacity;\n      if (this._extentEl._opacitySlider)\n        this._extentEl._opacitySlider.value = opacity;\n    },\n    appendStyleLink: function (mapLink) {\n      if (!mapLink.link) return;\n      let positionAndNode = this._getStylePositionAndNode();\n      positionAndNode.node.insertAdjacentElement(\n        positionAndNode.position,\n        mapLink.link\n      );\n    },\n    _getStylePositionAndNode: function () {\n      return this._container.lastChild &&\n        (this._container.lastChild.nodeName.toUpperCase() === 'SVG' ||\n          this._container.lastChild.classList.contains('mapml-vector-container'))\n        ? { position: 'beforebegin', node: this._container.lastChild }\n        : this._container.lastChild\n        ? { position: 'afterend', node: this._container.lastChild }\n        : { position: 'afterbegin', node: this._container };\n    },\n    appendStyleElement: function (mapStyle) {\n      if (!mapStyle.styleElement) return;\n      let positionAndNode = this._getStylePositionAndNode();\n      positionAndNode.node.insertAdjacentElement(\n        positionAndNode.position,\n        mapStyle.styleElement\n      );\n    }\n  });\n  var extentLayer = function (options) {\n    return new ExtentLayer(options);\n  };\n\n  var TemplatedFeaturesLayer = L.Layer.extend({\n    // this and M.ImageLayer could be merged or inherit from a common parent\n    initialize: function (template, options) {\n      this._template = template;\n      this._container = L.DomUtil.create('div', 'leaflet-layer');\n      L.DomUtil.addClass(this._container, 'mapml-features-container');\n      this.zoomBounds = options.zoomBounds;\n      this.extentBounds = options.extentBounds;\n      // get rid of duplicate info, it can be confusing\n      delete options.zoomBounds;\n      delete options.extentBounds;\n      this._linkEl = options.linkEl;\n      L.setOptions(\n        this,\n        L.extend(options, this._setUpFeaturesTemplateVars(template))\n      );\n    },\n\n    isVisible: function () {\n      let map = this._linkEl.getMapEl()._map;\n      let mapZoom = map.getZoom();\n      let mapBounds = M.pixelToPCRSBounds(\n        map.getPixelBounds(),\n        mapZoom,\n        map.options.projection\n      );\n      return (\n        mapZoom <= this.zoomBounds.maxZoom &&\n        mapZoom >= this.zoomBounds.minZoom &&\n        this.extentBounds.overlaps(mapBounds)\n      );\n    },\n\n    getEvents: function () {\n      var events = {\n        moveend: this._onMoveEnd\n      };\n      return events;\n    },\n    onAdd: function (map) {\n      this._map = map;\n      // this causes the layer (this._features) to actually render...\n      this.options.pane.appendChild(this._container);\n      var opacity = this.options.opacity || 1,\n        container = this._container;\n      if (!this._features) {\n        this._features = M.featureLayer(null, {\n          // pass the vector layer a renderer of its own, otherwise leaflet\n          // puts everything into the overlayPane\n          renderer: M.featureRenderer(),\n          // pass the vector layer the container for the parent into which\n          // it will append its own container for rendering into\n          pane: container,\n          // the bounds will be static, fixed, constant for the lifetime of the layer\n          layerBounds: this.extentBounds,\n          zoomBounds: this.zoomBounds,\n          opacity: opacity,\n          projection: map.options.projection,\n          mapEl: this._linkEl.getMapEl(),\n          onEachFeature: function (properties, geometry) {\n            // need to parse as HTML to preserve semantics and styles\n            var c = document.createElement('div');\n            c.classList.add('mapml-popup-content');\n            c.insertAdjacentHTML('afterbegin', properties.innerHTML);\n            geometry.bindPopup(c, { autoClose: false, minWidth: 108 });\n          }\n        });\n      } else {\n        this._features.eachLayer((layer) => layer.addTo(map));\n      }\n      this._onMoveEnd();\n    },\n    onRemove: function () {\n      if (this._features) this._features.eachLayer((layer) => layer.remove());\n      L.DomUtil.remove(this._container);\n    },\n    appendStyleLink: function (mapLink) {\n      if (!mapLink.link) return;\n      let positionAndNode = this._getStylePositionAndNode();\n      positionAndNode.node.insertAdjacentElement(\n        positionAndNode.position,\n        mapLink.link\n      );\n    },\n    _getStylePositionAndNode: function () {\n      return this._container.lastChild &&\n        (this._container.lastChild.nodeName.toUpperCase() === 'SVG' ||\n          this._container.lastChild.classList.contains('mapml-vector-container'))\n        ? { position: 'beforebegin', node: this._container.lastChild }\n        : this._container.lastChild\n        ? { position: 'afterend', node: this._container.lastChild }\n        : { position: 'afterbegin', node: this._container };\n    },\n    appendStyleElement: function (mapStyle) {\n      if (!mapStyle.styleElement) return;\n      let positionAndNode = this._getStylePositionAndNode();\n      positionAndNode.node.insertAdjacentElement(\n        positionAndNode.position,\n        mapStyle.styleElement\n      );\n    },\n    redraw: function () {\n      this._onMoveEnd();\n    },\n\n    _removeCSS: function () {\n      let toDelete = this._container.querySelectorAll(\n        'link[rel=stylesheet],style'\n      );\n      for (let i = 0; i < toDelete.length; i++) {\n        let parent = toDelete[i].parentNode;\n        parent.removeChild(toDelete[i]);\n      }\n    },\n\n    _onMoveEnd: function () {\n      let history = this._map.options.mapEl._history;\n      let current = history[history.length - 1];\n      let previous = history[history.length - 2] ?? current;\n      let step = this._template.step;\n      let mapZoom = this._map.getZoom();\n      let steppedZoom = mapZoom;\n      //If zooming out from one step interval into a lower one or panning, set the stepped zoom\n      if (\n        (step !== '1' &&\n          (mapZoom + 1) % step === 0 &&\n          current.zoom === previous.zoom - 1) ||\n        current.zoom === previous.zoom ||\n        Math.floor(mapZoom / step) * step !==\n          Math.floor(previous.zoom / step) * step\n      ) {\n        steppedZoom = Math.floor(mapZoom / step) * step;\n      }\n      //No request needed if in a step interval (unless panning)\n      else if (mapZoom % this._template.step !== 0) return;\n\n      let scaleBounds = this._map.getPixelBounds(\n        this._map.getCenter(),\n        steppedZoom\n      );\n\n      // should set this.isVisible properly BEFORE return, otherwise will cause layer-.validateDisabled not work properly\n      let url = this._getfeaturesUrl(steppedZoom, scaleBounds);\n      // No request needed if the current template url is the same as the url to request\n      if (url === this._url) return;\n\n      // do cleaning up for new request\n      this._features.clearLayers();\n      // shadow may has not yet attached to <map-extent> for the first-time rendering\n      if (this._linkEl.shadowRoot) {\n        this._linkEl.shadowRoot.innerHTML = '';\n      }\n      this._removeCSS();\n      //Leave the layers cleared if the layer is not visible\n      if (!this.isVisible() && steppedZoom === mapZoom) {\n        this._url = '';\n        return;\n      }\n\n      // TODO add preference with a bit less weight than that for text/mapml; 0.8 for application/geo+json; 0.6\n      var mapml,\n        headers = new Headers({\n          Accept: 'text/mapml;q=0.9,application/geo+json;q=0.8'\n        }),\n        parser = new DOMParser(),\n        featureLayer = this._features,\n        linkEl = this._linkEl,\n        map = this._map,\n        context = this,\n        MAX_PAGES = 10,\n        // TODO: Fetching logic should migrate to map-link\n        _pullFeatureFeed = function (url, limit) {\n          return fetch(url, { redirect: 'follow', headers: headers })\n            .then(function (response) {\n              return response.text();\n            })\n            .then(function (text) {\n              //TODO wrap this puppy in a try/catch/finally to parse application/geo+json if necessary\n              mapml = parser.parseFromString(text, 'application/xml');\n              var base = new URL(\n                mapml.querySelector('map-base')\n                  ? mapml.querySelector('map-base').getAttribute('href')\n                  : url\n              ).href;\n              url = mapml.querySelector('map-link[rel=next]')\n                ? mapml.querySelector('map-link[rel=next]').getAttribute('href')\n                : null;\n              url = url ? new URL(url, base).href : null;\n              let frag = document.createDocumentFragment();\n              let elements = mapml.querySelectorAll('map-head > *, map-body > *');\n              for (let i = 0; i < elements.length; i++) {\n                frag.appendChild(elements[i]);\n              }\n              linkEl.shadowRoot.appendChild(frag);\n              let features = linkEl.shadowRoot.querySelectorAll('map-feature');\n              let featuresReady = [];\n              for (let i = 0; i < features.length; i++) {\n                featuresReady.push(features[i].whenReady());\n              }\n              Promise.allSettled(featuresReady).then(() => {\n                for (let i = 0; i < features.length; i++) {\n                  features[i].addFeature(featureLayer);\n                }\n              });\n              if (url && --limit) {\n                return _pullFeatureFeed(url, limit);\n              }\n            });\n        };\n      this._url = url;\n      _pullFeatureFeed(url, MAX_PAGES)\n        .then(function () {\n          map.addLayer(featureLayer);\n          //Fires event for feature index overlay\n          map.fire('templatedfeatureslayeradd');\n          M.TemplatedFeaturesLayer.prototype._updateTabIndex(context);\n        })\n        .catch(function (error) {\n          console.log(error);\n        });\n    },\n    setZIndex: function (zIndex) {\n      this.options.zIndex = zIndex;\n      this._updateZIndex();\n      return this;\n    },\n    _updateTabIndex: function (context) {\n      let c = context || this;\n      for (let layerNum in c._features._layers) {\n        let layer = c._features._layers[layerNum];\n        if (layer._path) {\n          if (layer._path.getAttribute('d') !== 'M0 0') {\n            layer._path.setAttribute('tabindex', 0);\n          } else {\n            layer._path.removeAttribute('tabindex');\n          }\n          if (layer._path.childElementCount === 0) {\n            let title = document.createElement('title');\n            title.innerText = 'Feature';\n            layer._path.appendChild(title);\n          }\n        }\n      }\n    },\n    _updateZIndex: function () {\n      if (\n        this._container &&\n        this.options.zIndex !== undefined &&\n        this.options.zIndex !== null\n      ) {\n        this._container.style.zIndex = this.options.zIndex;\n      }\n    },\n    _getfeaturesUrl: function (zoom, bounds) {\n      if (zoom === undefined) zoom = this._map.getZoom();\n      if (bounds === undefined) bounds = this._map.getPixelBounds();\n      var obj = {};\n      if (this.options.feature.zoom) {\n        obj[this.options.feature.zoom] = zoom;\n      }\n      if (this.options.feature.width) {\n        obj[this.options.feature.width] = this._map.getSize().x;\n      }\n      if (this.options.feature.height) {\n        obj[this.options.feature.height] = this._map.getSize().y;\n      }\n      if (this.options.feature.bottom) {\n        obj[this.options.feature.bottom] = this._TCRSToPCRS(bounds.max, zoom).y;\n      }\n      if (this.options.feature.left) {\n        obj[this.options.feature.left] = this._TCRSToPCRS(bounds.min, zoom).x;\n      }\n      if (this.options.feature.top) {\n        obj[this.options.feature.top] = this._TCRSToPCRS(bounds.min, zoom).y;\n      }\n      if (this.options.feature.right) {\n        obj[this.options.feature.right] = this._TCRSToPCRS(bounds.max, zoom).x;\n      }\n      // hidden and other variables that may be associated\n      for (var v in this.options.feature) {\n        if (\n          ['width', 'height', 'left', 'right', 'top', 'bottom', 'zoom'].indexOf(\n            v\n          ) < 0\n        ) {\n          obj[v] = this.options.feature[v];\n        }\n      }\n      return L.Util.template(this._template.template, obj);\n    },\n    _TCRSToPCRS: function (coords, zoom) {\n      // TCRS pixel point to Projected CRS point (in meters, presumably)\n      var map = this._map,\n        crs = map.options.crs,\n        loc = crs.transformation.untransform(coords, crs.scale(zoom));\n      return loc;\n    },\n    _setUpFeaturesTemplateVars: function (template) {\n      // process the inputs and create an object named \"extent\"\n      // with member properties as follows:\n      // {width: {name: 'widthvarname'}, // value supplied by map if necessary\n      //  height: {name: 'heightvarname'}, // value supplied by map if necessary\n      //  left: {name: 'leftvarname', axis: 'leftaxisname'}, // axis name drives (coordinate system of) the value supplied by the map\n      //  right: {name: 'rightvarname', axis: 'rightaxisname'}, // axis name (coordinate system of) drives the value supplied by the map\n      //  top: {name: 'topvarname', axis: 'topaxisname'}, // axis name drives (coordinate system of) the value supplied by the map\n      //  bottom: {name: 'bottomvarname', axis: 'bottomaxisname'} // axis name drives (coordinate system of) the value supplied by the map\n      //  zoom: {name: 'zoomvarname'}\n      //  hidden: [{name: name, value: value}]}\n\n      var featuresVarNames = { feature: {} },\n        inputs = template.values;\n      featuresVarNames.feature.hidden = [];\n      for (var i = 0; i < inputs.length; i++) {\n        // this can be removed when the spec removes the deprecated inputs...\n        var type = inputs[i].getAttribute('type'),\n          units = inputs[i].getAttribute('units'),\n          axis = inputs[i].getAttribute('axis'),\n          name = inputs[i].getAttribute('name'),\n          position = inputs[i].getAttribute('position'),\n          value = inputs[i].getAttribute('value'),\n          select = inputs[i].tagName.toLowerCase() === 'map-select';\n        if (type === 'width') {\n          featuresVarNames.feature.width = name;\n        } else if (type === 'height') {\n          featuresVarNames.feature.height = name;\n        } else if (type === 'zoom') {\n          featuresVarNames.feature.zoom = name;\n        } else if (\n          type === 'location' &&\n          (units === 'pcrs' || units === 'gcrs')\n        ) {\n          //<input name=\"...\" units=\"pcrs\" type=\"location\" position=\"top|bottom-left|right\" axis=\"northing|easting\">\n          switch (axis) {\n            case 'x':\n            case 'longitude':\n            case 'easting':\n              if (position) {\n                if (position.match(/.*?-left/i)) {\n                  featuresVarNames.feature.left = name;\n                } else if (position.match(/.*?-right/i)) {\n                  featuresVarNames.feature.right = name;\n                }\n              }\n              break;\n            case 'y':\n            case 'latitude':\n            case 'northing':\n              if (position) {\n                if (position.match(/top-.*?/i)) {\n                  featuresVarNames.feature.top = name;\n                } else if (position.match(/bottom-.*?/i)) {\n                  featuresVarNames.feature.bottom = name;\n                }\n              }\n              break;\n          }\n        } else if (select) {\n          /*jshint -W104 */\n          const parsedselect = inputs[i].htmlselect;\n          featuresVarNames.feature[name] = function () {\n            return parsedselect.value;\n          };\n          // projection is deprecated, make it hidden\n        } else {\n          /*jshint -W104 */\n          const input = inputs[i];\n          featuresVarNames.feature[name] = function () {\n            return input.getAttribute('value');\n          };\n        }\n      }\n      return featuresVarNames;\n    }\n  });\n  var templatedFeaturesLayer = function (template, options) {\n    return new TemplatedFeaturesLayer(template, options);\n  };\n\n  var TemplatedImageLayer = L.Layer.extend({\n    initialize: function (template, options) {\n      this._template = template;\n      this._container = L.DomUtil.create('div', 'leaflet-layer');\n      L.DomUtil.addClass(this._container, 'mapml-image-container');\n      this._linkEl = options.linkEl;\n      this.zoomBounds = options.zoomBounds;\n      this.extentBounds = options.extentBounds;\n      // get rid of unused duplicate information that can be confusing\n      delete options.zoomBounds;\n      delete options.extentBounds;\n      L.setOptions(\n        this,\n        L.extend(options, this._setUpExtentTemplateVars(template))\n      );\n    },\n    getEvents: function () {\n      var events = {\n        moveend: this._onMoveEnd,\n        zoomstart: this._clearLayer\n      };\n      return events;\n    },\n    onAdd: function (map) {\n      this._map = map;\n      // TODO: set this._map by ourselves\n      this.options.pane.appendChild(this._container);\n      this.setZIndex(this.options.zIndex);\n      this._onAdd();\n    },\n    redraw: function () {\n      this._onMoveEnd();\n    },\n    isVisible: function () {\n      let map = this._linkEl.getMapEl()._map;\n      let mapZoom = map.getZoom();\n      let mapBounds = M.pixelToPCRSBounds(\n        map.getPixelBounds(),\n        mapZoom,\n        map.options.projection\n      );\n      return (\n        mapZoom <= this.zoomBounds.maxZoom &&\n        mapZoom >= this.zoomBounds.minZoom &&\n        this.extentBounds.overlaps(mapBounds)\n      );\n    },\n    _clearLayer: function () {\n      let containerImages = this._container.querySelectorAll('img');\n      for (let i = 0; i < containerImages.length; i++) {\n        this._container.removeChild(containerImages[i]);\n      }\n    },\n\n    _addImage: function (bounds, zoom, loc) {\n      let map = this._map;\n      let overlayToRemove = this._imageOverlay;\n      let src = this.getImageUrl(bounds, zoom);\n      let size = map.getSize();\n      this._imageOverlay = M.imageLayer(src, loc, size, 0, this._container);\n      this._imageOverlay._step = this._template.step;\n      this._imageOverlay.addTo(map);\n      if (overlayToRemove) {\n        this._imageOverlay._overlayToRemove = overlayToRemove._url;\n        this._imageOverlay.on('load error', function () {\n          map.removeLayer(overlayToRemove);\n        });\n      }\n    },\n\n    _scaleImage: function (bounds, zoom) {\n      let obj = this;\n      setTimeout(function () {\n        if (!obj._map) return;\n        let step = obj._template.step;\n        let steppedZoom = Math.floor(zoom / step) * step;\n        let scale = obj._map.getZoomScale(zoom, steppedZoom);\n        let translate = bounds.min\n          .multiplyBy(scale)\n          .subtract(obj._map._getNewPixelOrigin(obj._map.getCenter(), zoom))\n          .round();\n        L.DomUtil.setTransform(obj._imageOverlay._image, translate, scale);\n      });\n    },\n\n    _onAdd: function () {\n      let zoom = this._map.getZoom();\n      let steppedZoom = zoom;\n      let step = this._template.step;\n\n      if (zoom % step !== 0) steppedZoom = Math.floor(zoom / step) * step;\n      let bounds = this._map.getPixelBounds(this._map.getCenter(), steppedZoom);\n      this._pixelOrigins = {};\n      this._pixelOrigins[steppedZoom] = bounds.min;\n      // if the map is panned before the new image layer is added,\n      // the location that the layer should be added to is no longer (0,0) but need to be calculated\n      let loc = this._map\n        .getPixelBounds()\n        .min.subtract(this._map.getPixelOrigin());\n      this._addImage(bounds, steppedZoom, loc);\n      if (zoom !== steppedZoom) {\n        this._scaleImage(bounds, zoom);\n      }\n    },\n\n    _onMoveEnd: function (e) {\n      let mapZoom = this._map.getZoom();\n      let history = this._map.options.mapEl._history;\n      let current = history[history.length - 1];\n      let previous = history[history.length - 2];\n      if (!previous) previous = current;\n      let step = this._template.step;\n      let steppedZoom = Math.floor(mapZoom / step) * step;\n      let bounds = this._map.getPixelBounds(this._map.getCenter(), steppedZoom);\n      //Zooming from one step increment into a lower one\n      if (\n        step !== '1' &&\n        (mapZoom + 1) % step === 0 &&\n        current.zoom === previous.zoom - 1\n      ) {\n        this._addImage(bounds, steppedZoom, L.point(0, 0));\n        this._scaleImage(bounds, mapZoom);\n        //Zooming or panning within a step increment\n      } else if (e && mapZoom % step !== 0) {\n        this._imageOverlay._overlayToRemove = this._imageOverlay._url;\n        if (current.zoom !== previous.zoom) {\n          //Zoomed from within one step increment into another\n          this._addImage(bounds, steppedZoom, L.point(0, 0));\n          this._pixelOrigins[steppedZoom] = bounds.min;\n          this._scaleImage(bounds, mapZoom);\n        } else {\n          // Panning within a step increment\n          let pixelOrigin = this._pixelOrigins[steppedZoom];\n          let loc = bounds.min.subtract(pixelOrigin);\n          if (this.getImageUrl(bounds, steppedZoom) === this._imageOverlay._url)\n            return;\n          this._addImage(bounds, steppedZoom, loc);\n          this._scaleImage(bounds, mapZoom);\n        }\n        // Zooming from one step decrement into a higher one\n        // OR panning when mapZoom % step === 0\n      } else {\n        if (!this.isVisible) {\n          this._clearLayer();\n          return;\n        }\n        var map = this._map,\n          loc = map.getPixelBounds().min.subtract(map.getPixelOrigin());\n        this._addImage(map.getPixelBounds(), mapZoom, loc);\n        this._pixelOrigins[mapZoom] = map.getPixelOrigin();\n      }\n    },\n    setZIndex: function (zIndex) {\n      this.options.zIndex = zIndex;\n      this._updateZIndex();\n\n      return this;\n    },\n    _updateZIndex: function () {\n      if (\n        this._container &&\n        this.options.zIndex !== undefined &&\n        this.options.zIndex !== null\n      ) {\n        this._container.style.zIndex = this.options.zIndex;\n      }\n    },\n    onRemove: function (map) {\n      L.DomUtil.remove(this._container);\n      this._clearLayer();\n    },\n    getImageUrl: function (pixelBounds, zoom) {\n      var obj = {};\n      obj[this.options.extent.width] = this._map.getSize().x;\n      obj[this.options.extent.height] = this._map.getSize().y;\n      obj[this.options.extent.bottom] = this._TCRSToPCRS(pixelBounds.max, zoom).y;\n      obj[this.options.extent.left] = this._TCRSToPCRS(pixelBounds.min, zoom).x;\n      obj[this.options.extent.top] = this._TCRSToPCRS(pixelBounds.min, zoom).y;\n      obj[this.options.extent.right] = this._TCRSToPCRS(pixelBounds.max, zoom).x;\n      // hidden and other variables that may be associated\n      for (var v in this.options.extent) {\n        if (\n          ['width', 'height', 'left', 'right', 'top', 'bottom'].indexOf(v) < 0\n        ) {\n          obj[v] = this.options.extent[v];\n        }\n      }\n      return L.Util.template(this._template.template, obj);\n    },\n    _TCRSToPCRS: function (coords, zoom) {\n      // TCRS pixel point to Projected CRS point (in meters, presumably)\n      var map = this._map,\n        crs = map.options.crs,\n        loc = crs.transformation.untransform(coords, crs.scale(zoom));\n      return loc;\n    },\n    _setUpExtentTemplateVars: function (template) {\n      // process the inputs associated to template and create an object named\n      // extent with member properties as follows:\n      // {width: 'widthvarname',\n      //  height: 'heightvarname',\n      //  left: 'leftvarname',\n      //  right: 'rightvarname',\n      //  top: 'topvarname',\n      //  bottom: 'bottomvarname'}\n\n      var extentVarNames = { extent: {} },\n        inputs = template.values;\n\n      for (var i = 0; i < template.values.length; i++) {\n        var type = inputs[i].getAttribute('type'),\n          units = inputs[i].getAttribute('units'),\n          axis = inputs[i].getAttribute('axis'),\n          name = inputs[i].getAttribute('name'),\n          position = inputs[i].getAttribute('position'),\n          select = inputs[i].tagName.toLowerCase() === 'map-select';\n        if (type === 'width') {\n          extentVarNames.extent.width = name;\n        } else if (type === 'height') {\n          extentVarNames.extent.height = name;\n        } else if (\n          type === 'location' &&\n          (units === 'pcrs' || units === 'gcrs')\n        ) {\n          //<input name=\"...\" units=\"pcrs\" type=\"location\" position=\"top|bottom-left|right\" axis=\"northing|easting|latitude|longitude\">\n          switch (axis) {\n            case 'longitude':\n            case 'easting':\n              if (position) {\n                if (position.match(/.*?-left/i)) {\n                  extentVarNames.extent.left = name;\n                } else if (position.match(/.*?-right/i)) {\n                  extentVarNames.extent.right = name;\n                }\n              }\n              break;\n            case 'latitude':\n            case 'northing':\n              if (position) {\n                if (position.match(/top-.*?/i)) {\n                  extentVarNames.extent.top = name;\n                } else if (position.match(/bottom-.*?/i)) {\n                  extentVarNames.extent.bottom = name;\n                }\n              }\n              break;\n          }\n        } else if (select) {\n          /*jshint -W104 */\n          const parsedselect = inputs[i].htmlselect;\n          extentVarNames.extent[name] = function () {\n            return parsedselect.value;\n          };\n        } else {\n          /*jshint -W104 */\n          const input = inputs[i];\n          extentVarNames.extent[name] = function () {\n            return input.getAttribute('value');\n          };\n        }\n      }\n      return extentVarNames;\n    }\n  });\n  var templatedImageLayer = function (template, options) {\n    return new TemplatedImageLayer(template, options);\n  };\n\n  var ImageLayer = L.ImageOverlay.extend({\n    initialize: function (url, location, size, angle, container, options) {\n      // (String, Point, Point, Number, Element, Object)\n      this._container = container;\n      this._url = url;\n      // instead of calculating where the image goes, put it at 0,0\n      //this._location = L.point(location);\n      // the location for WMS requests will be the upper left hand\n      // corner of the map.  When the map is initialized, that is 0,0,\n      // but as the user pans, of course the\n      this._location = location;\n      this._size = L.point(size);\n      this._angle = angle;\n\n      L.setOptions(this, options);\n    },\n    getEvents: function () {\n      var events = {\n        viewreset: this._reset\n      };\n\n      if (this._zoomAnimated && this._step <= 1) {\n        events.zoomanim = this._animateZoom;\n      }\n\n      return events;\n    },\n    onAdd: function (map) {\n      this.on({\n        load: this._onImageLoad\n      });\n\n      if (!this._image) {\n        this._initImage();\n      }\n\n      if (this.options.interactive) {\n        L.DomUtil.addClass(this._image, 'leaflet-interactive');\n        this.addInteractiveTarget(this._image);\n      }\n\n      this._container.appendChild(this._image);\n      this._reset();\n    },\n    onRemove: function () {\n      L.DomUtil.remove(this._image);\n      if (this.options.interactive) {\n        this.removeInteractiveTarget(this._image);\n      }\n    },\n    _onImageLoad: function () {\n      if (!this._image) {\n        return;\n      }\n      this._image.loaded = +new Date();\n      this._updateOpacity();\n    },\n    _animateZoom: function (e) {\n      var scale = this._map.getZoomScale(e.zoom),\n        translate = this._map\n          .getPixelOrigin()\n          .add(this._location)\n          .multiplyBy(scale)\n          .subtract(this._map._getNewPixelOrigin(e.center, e.zoom))\n          .round();\n\n      if (L.Browser.any3d) {\n        L.DomUtil.setTransform(this._image, translate, scale);\n      } else {\n        L.DomUtil.setPosition(this._image, translate);\n      }\n    },\n    _reset: function (e) {\n      var image = this._image,\n        location = this._location,\n        size = this._size;\n      // TBD use the angle to establish the image rotation in CSS\n\n      if (\n        e &&\n        this._step > 1 &&\n        (this._overlayToRemove === undefined ||\n          this._url === this._overlayToRemove)\n      ) {\n        return;\n      }\n      L.DomUtil.setPosition(image, location);\n\n      image.style.width = size.x + 'px';\n      image.style.height = size.y + 'px';\n    },\n    _updateOpacity: function () {\n      if (!this._map) {\n        return;\n      }\n\n      //L.DomUtil.setOpacity(this._image, this.options.opacity);\n\n      var now = +new Date(),\n        nextFrame = false;\n\n      var image = this._image;\n\n      var fade = Math.min(1, (now - image.loaded) / 200);\n\n      L.DomUtil.setOpacity(image, fade);\n      if (fade < 1) {\n        nextFrame = true;\n      }\n      if (nextFrame) {\n        L.Util.cancelAnimFrame(this._fadeFrame);\n        this._fadeFrame = L.Util.requestAnimFrame(this._updateOpacity, this);\n      }\n      L.DomUtil.addClass(image, 'leaflet-image-loaded');\n    }\n  });\n  var imageLayer = function (\n    url,\n    location,\n    size,\n    angle,\n    container,\n    options\n  ) {\n    return new ImageLayer(url, location, size, angle, container, options);\n  };\n\n  var MapMLLayer = L.LayerGroup.extend({\n    options: {\n      zIndex: 0,\n      opacity: '1.0'\n    },\n    // initialize is executed before the layer is added to a map\n    initialize: function (href, layerEl, options) {\n      // in the custom element, the attribute is actually 'src'\n      // the _href version is the URL received from layer-@src\n      L.LayerGroup.prototype.initialize.call(this, null, options);\n      if (href) {\n        this._href = href;\n      }\n      this._layerEl = layerEl;\n      this._content = layerEl.src ? layerEl.shadowRoot : layerEl;\n      L.setOptions(this, options);\n      this._container = L.DomUtil.create('div', 'leaflet-layer');\n      this.changeOpacity(this.options.opacity);\n      L.DomUtil.addClass(this._container, 'mapml-layer');\n\n      // this layer 'owns' a mapmlTileLayer, which is a subclass of L.GridLayer\n      // it 'passes' what tiles to load via the content of this._mapmlTileContainer\n      this._mapmlTileContainer = L.DomUtil.create(\n        'div',\n        'mapml-tile-container',\n        this._container\n      );\n      // hit the service to determine what its extent might be\n      // OR use the extent of the content provided\n\n      this._initialize(this._content);\n    },\n    setZIndex: function (zIndex) {\n      this.options.zIndex = zIndex;\n      this._updateZIndex();\n\n      return this;\n    },\n    getHref: function () {\n      return this._href ?? '';\n    },\n    _updateZIndex: function () {\n      if (\n        this._container &&\n        this.options.zIndex !== undefined &&\n        this.options.zIndex !== null\n      ) {\n        this._container.style.zIndex = this.options.zIndex;\n      }\n    },\n    changeOpacity: function (opacity) {\n      this._container.style.opacity = opacity;\n      this._layerEl._opacity = opacity;\n      if (this._layerEl._opacitySlider)\n        this._layerEl._opacitySlider.value = opacity;\n    },\n    titleIsReadOnly() {\n      return !!this._titleIsReadOnly;\n    },\n    setName(newName) {\n      // a layer's accessible name is set by the <map-title>, if present\n      // if it's not available the <layer- label=\"accessible-name\"> attribute\n      // can be used\n      if (!this.titleIsReadOnly()) {\n        this._title = newName;\n        this._layerEl._layerControlHTML.querySelector(\n          '.mapml-layer-item-name'\n        ).innerHTML = newName;\n      }\n    },\n    getName() {\n      return this._title;\n    },\n\n    onAdd: function (map) {\n      L.LayerGroup.prototype.onAdd.call(this, map);\n      this.getPane().appendChild(this._container);\n\n      //only add the layer if there are tiles to be rendered\n      if (this._staticTileLayer) {\n        this.addLayer(this._staticTileLayer);\n      }\n      this.setZIndex(this.options.zIndex);\n      map.on('popupopen', this._attachSkipButtons, this);\n    },\n\n    _calculateBounds: function () {\n      delete this.bounds;\n      delete this.zoomBounds;\n      let bounds, zoomBounds;\n      let layerTypes = ['_staticTileLayer', '_mapmlvectors', '_extentLayer'];\n      bounds =\n        this._layerEl.src &&\n        this._layerEl.shadowRoot.querySelector(\n          ':host > map-meta[name=extent][content]'\n        )\n          ? M.getBoundsFromMeta(this._layerEl.shadowRoot)\n          : this._layerEl.querySelector(':scope > map-meta[name=extent][content]')\n          ? M.getBoundsFromMeta(this._layerEl)\n          : undefined;\n      zoomBounds =\n        this._layerEl.src &&\n        this._layerEl.shadowRoot.querySelector(\n          ':host > map-meta[name=zoom][content]'\n        )\n          ? M.getZoomBoundsFromMeta(this._layerEl.shadowRoot)\n          : this._layerEl.querySelector(':scope > map-meta[name=zoom][content]')\n          ? M.getZoomBoundsFromMeta(this._layerEl)\n          : undefined;\n      const mapExtents = this._layerEl.src\n        ? this._layerEl.shadowRoot.querySelectorAll('map-extent')\n        : this._layerEl.querySelectorAll('map-extent');\n      layerTypes.forEach((type) => {\n        let zoomMax, zoomMin, minNativeZoom, maxNativeZoom;\n        if (zoomBounds) {\n          zoomMax = zoomBounds.maxZoom;\n          zoomMin = zoomBounds.minZoom;\n          maxNativeZoom = zoomBounds.maxNativeZoom\n            ? zoomBounds.maxNativeZoom\n            : -Infinity;\n          minNativeZoom = zoomBounds.minNativeZoom\n            ? zoomBounds.minNativeZoom\n            : Infinity;\n        }\n        if (type === '_extentLayer' && mapExtents.length) {\n          for (let i = 0; i < mapExtents.length; i++) {\n            if (mapExtents[i]._extentLayer.bounds) {\n              let mapExtentLayer = mapExtents[i]._extentLayer;\n              if (!bounds) {\n                bounds = L.bounds(\n                  mapExtentLayer.bounds.min,\n                  mapExtentLayer.bounds.max\n                );\n              } else {\n                bounds.extend(mapExtentLayer.bounds);\n              }\n              if (mapExtentLayer.zoomBounds) {\n                if (!zoomBounds) {\n                  zoomBounds = mapExtentLayer.zoomBounds;\n                } else {\n                  // Extend layer zoombounds\n                  zoomMax = Math.max(zoomMax, mapExtentLayer.zoomBounds.maxZoom);\n                  zoomMin = Math.min(zoomMin, mapExtentLayer.zoomBounds.minZoom);\n                  maxNativeZoom = Math.max(\n                    maxNativeZoom,\n                    mapExtentLayer.zoomBounds.maxNativeZoom\n                  );\n                  minNativeZoom = Math.min(\n                    minNativeZoom,\n                    mapExtentLayer.zoomBounds.minNativeZoom\n                  );\n                  zoomBounds.minZoom = zoomMin;\n                  zoomBounds.maxZoom = zoomMax;\n                  zoomBounds.minNativeZoom = minNativeZoom;\n                  zoomBounds.maxNativeZoom = maxNativeZoom;\n                }\n              }\n            }\n          }\n        } else if (\n          type === '_mapmlvectors' ||\n          (type === '_staticTileLayer' && this._staticTileLayer)\n        ) {\n          if (this[type].layerBounds) {\n            if (!bounds) {\n              bounds = this[type].layerBounds;\n            } else {\n              bounds.extend(this[type].layerBounds);\n            }\n          }\n          if (this[type].zoomBounds) {\n            if (!zoomBounds) {\n              zoomBounds = this[type].zoomBounds;\n            } else {\n              // Extend layer zoombounds\n              zoomMax = Math.max(zoomMax, this[type].zoomBounds.maxZoom);\n              zoomMin = Math.min(zoomMin, this[type].zoomBounds.minZoom);\n              maxNativeZoom = Math.max(\n                maxNativeZoom,\n                this[type].zoomBounds.maxNativeZoom\n              );\n              minNativeZoom = Math.min(\n                minNativeZoom,\n                this[type].zoomBounds.minNativeZoom\n              );\n              zoomBounds.minZoom = zoomMin;\n              zoomBounds.maxZoom = zoomMax;\n              zoomBounds.minNativeZoom = minNativeZoom;\n              zoomBounds.maxNativeZoom = maxNativeZoom;\n            }\n          }\n        }\n      });\n      if (bounds) {\n        this.bounds = bounds;\n      } else {\n        let projectionBounds = M[this.options.projection].options.bounds;\n        this.bounds = L.bounds(projectionBounds.min, projectionBounds.max);\n      }\n      // we could get here and zoomBounds might still not be defined (empty layer)\n      if (!zoomBounds) zoomBounds = {};\n      if (!zoomBounds.minZoom) {\n        zoomBounds.minZoom = 0;\n      }\n      if (!zoomBounds.maxZoom) {\n        zoomBounds.maxZoom =\n          M[this.options.projection].options.resolutions.length - 1;\n      }\n      if (zoomBounds.minNativeZoom === Infinity) {\n        zoomBounds.minNativeZoom = zoomBounds.minZoom;\n      }\n      if (zoomBounds.maxNativeZoom === -Infinity) {\n        zoomBounds.maxNativeZoom = zoomBounds.maxZoom;\n      }\n      this.zoomBounds = zoomBounds;\n    },\n\n    onRemove: function (map) {\n      L.LayerGroup.prototype.onRemove.call(this, map);\n      L.DomUtil.remove(this._container);\n      map.off('popupopen', this._attachSkipButtons);\n    },\n    getAttribution: function () {\n      return this.options.attribution;\n    },\n    getBase: function () {\n      return new URL(\n        this._content.querySelector('map-base')\n          ? this._content.querySelector('map-base').getAttribute('href')\n          : this._content.nodeName === 'LAYER-'\n          ? this._content.baseURI\n          : this._href,\n        this._href\n      ).href;\n    },\n    appendStyleLink: function (mapLink) {\n      if (!mapLink.link) return;\n      let positionAndNode = this._getStylePositionAndNode();\n      positionAndNode.node.insertAdjacentElement(\n        positionAndNode.position,\n        mapLink.link\n      );\n    },\n    _getStylePositionAndNode: function () {\n      return this._container.lastChild &&\n        (this._container.lastChild.nodeName.toUpperCase() === 'SVG' ||\n          this._container.lastChild.classList.contains('mapml-vector-container'))\n        ? { position: 'beforebegin', node: this._container.lastChild }\n        : this._container.lastChild\n        ? { position: 'afterend', node: this._container.lastChild }\n        : { position: 'afterbegin', node: this._container };\n    },\n    appendStyleElement: function (mapStyle) {\n      if (!mapStyle.styleElement) return;\n      let positionAndNode = this._getStylePositionAndNode();\n      positionAndNode.node.insertAdjacentElement(\n        positionAndNode.position,\n        mapStyle.styleElement\n      );\n    },\n    _initialize: function () {\n      var layer = this;\n      var base = layer.getBase(),\n        mapml = this._content;\n      parseLicenseAndLegend();\n      setLayerTitle();\n      // crs is only set if the layer has the same projection as the map\n      if (M[layer.options.projection]) processTiles();\n      processFeatures();\n      // update controls if needed based on mapml-viewer controls/controlslist attribute\n      if (layer._layerEl.parentElement) {\n        // if layer does not have a parent Element, do not need to set Controls\n        layer._layerEl.parentElement._toggleControls();\n      }\n      // local functions\n      // determine if, where there's no match of the current layer's projection\n      // and that of the map, if there is a linked alternate text/mapml\n      // resource that matches the map's projection\n      function processFeatures() {\n        let native = M.getNativeVariables(layer._content);\n        layer._mapmlvectors = M.featureLayer(null, {\n          // pass the vector layer a renderer of its own, otherwise leaflet\n          // puts everything into the overlayPane\n          renderer: M.featureRenderer(),\n          // pass the vector layer the container for the parent into which\n          // it will append its own container for rendering into\n          pane: layer._container,\n          opacity: layer.options.opacity,\n          projection: layer.options.projection,\n          // by NOT passing options.extent, we are asking the FeatureLayer\n          // to dynamically update its .layerBounds property as features are\n          // added or removed from it\n          native: native,\n          // each owned child layer gets a reference to the root layer\n          _leafletLayer: layer,\n          mapEl: layer._layerEl.parentElement,\n          onEachFeature: function (properties, geometry) {\n            // need to parse as HTML to preserve semantics and styles\n            if (properties) {\n              var c = document.createElement('div');\n              c.classList.add('mapml-popup-content');\n              c.insertAdjacentHTML('afterbegin', properties.innerHTML);\n              geometry.bindPopup(c, { autoClose: false, minWidth: 165 });\n            }\n          }\n        }).addTo(layer);\n      }\n      function processTiles() {\n        if (mapml.querySelector('map-tile')) {\n          var tiles = document.createElement('map-tiles'),\n            zoom =\n              mapml.querySelector('map-meta[name=zoom][content]') ||\n              mapml.querySelector('map-input[type=zoom][value]');\n          tiles.setAttribute(\n            'zoom',\n            (zoom && zoom.getAttribute('content')) ||\n              (zoom && zoom.getAttribute('value')) ||\n              '0'\n          );\n          var newTiles = mapml.getElementsByTagName('map-tile');\n          for (var nt = 0; nt < newTiles.length; nt++) {\n            tiles.appendChild(document.importNode(newTiles[nt], true));\n          }\n          layer._mapmlTileContainer.appendChild(tiles);\n          layer._staticTileLayer = M.staticTileLayer({\n            pane: layer._container,\n            _leafletLayer: layer,\n            projection: layer.options.projection,\n            className: 'mapml-static-tile-layer',\n            tileContainer: layer._mapmlTileContainer,\n            maxZoomBound:\n              M[layer.options.projection].options.resolutions.length - 1,\n            tileSize: M[layer.options.projection].options.crs.tile.bounds.max.x\n          });\n        }\n      }\n      function setLayerTitle() {\n        if (mapml.querySelector('map-title')) {\n          layer._title = mapml.querySelector('map-title').textContent.trim();\n          layer._titleIsReadOnly = true;\n        } else if (mapml instanceof Element && mapml.hasAttribute('label')) {\n          layer._title = mapml.getAttribute('label').trim();\n        }\n      }\n      function parseLicenseAndLegend() {\n        var licenseLink = mapml.querySelector('map-link[rel=license]'),\n          licenseTitle,\n          licenseUrl,\n          attText;\n        if (licenseLink) {\n          licenseTitle = licenseLink.getAttribute('title');\n          licenseUrl = licenseLink.getAttribute('href');\n          attText =\n            '<a href=\"' +\n            licenseUrl +\n            '\" title=\"' +\n            licenseTitle +\n            '\">' +\n            licenseTitle +\n            '</a>';\n        }\n        L.setOptions(layer, { attribution: attText });\n        var legendLink = mapml.querySelector('map-link[rel=legend]');\n        if (legendLink) {\n          layer._legendUrl = legendLink.getAttribute('href');\n        }\n        if (layer._map) {\n          // if the layer is checked in the layer control, force the addition\n          // of the attribution just received\n          if (layer._map.hasLayer(layer)) {\n            layer._map.attributionControl.addAttribution(layer.getAttribution());\n          }\n        }\n      }\n    },\n    getQueryTemplates: function (location, zoom) {\n      const queryLinks = this._layerEl.querySelectorAll(\n        'map-extent[checked] map-link[rel=query]'\n      ).length\n        ? this._layerEl.querySelectorAll(\n            'map-extent[checked] map-link[rel=query]'\n          )\n        : this._layerEl.shadowRoot.querySelectorAll(\n            'map-extent[checked] map-link[rel=query]'\n          ).length\n        ? this._layerEl.shadowRoot.querySelectorAll(\n            'map-extent[checked] map-link[rel=query]'\n          )\n        : null;\n      if (queryLinks) {\n        var templates = [];\n        for (let i = 0; i < queryLinks.length; i++) {\n          const minZoom = queryLinks[i].extent.zoom.minZoom,\n            maxZoom = queryLinks[i].extent.zoom.maxZoom,\n            withinZoomBounds = (z) => {\n              return minZoom <= z && z <= maxZoom;\n            },\n            bounds = queryLinks[i].getBounds();\n\n          if (bounds.contains(location) && withinZoomBounds(zoom)) {\n            templates.push(queryLinks[i]._templateVars);\n          }\n        }\n        return templates;\n      }\n    },\n    _attachSkipButtons: function (e) {\n      let popup = e.popup,\n        map = e.target,\n        layer,\n        group,\n        content = popup._container.getElementsByClassName(\n          'mapml-popup-content'\n        )[0];\n\n      popup._container.setAttribute('role', 'dialog');\n      content.setAttribute('tabindex', '-1');\n      // https://github.com/Maps4HTML/Web-Map-Custom-Element/pull/467#issuecomment-844307818\n      content.setAttribute('role', 'document');\n      popup._count = 0; // used for feature pagination\n\n      if (popup._source._eventParents) {\n        // check if the popup is for a feature or query\n        layer =\n          popup._source._eventParents[\n            Object.keys(popup._source._eventParents)[0]\n          ]; // get first parent of feature, there should only be one\n        group = popup._source.group;\n        // if the popup is for a static / templated feature, the \"zoom to here\" link can be attached once the popup opens\n        attachZoomLink.call(popup);\n      } else {\n        // getting access to the first map-extent to get access to _extentLayer to use it's (possibly) generic _previousFeature + _nextFeature methods.\n        const mapExtent =\n          popup._source._layerEl.querySelector('map-extent') ||\n          popup._source._layerEl.shadowRoot.querySelector('map-extent');\n        layer = mapExtent._extentLayer;\n        // if the popup is for a query, the \"zoom to here\" link should be re-attached every time new pagination features are displayed\n        map.on('attachZoomLink', attachZoomLink, popup);\n      }\n\n      if (popup._container.querySelector('nav[class=\"mapml-focus-buttons\"]')) {\n        L.DomUtil.remove(\n          popup._container.querySelector('nav[class=\"mapml-focus-buttons\"]')\n        );\n        L.DomUtil.remove(popup._container.querySelector('hr'));\n      }\n      //add when popopen event happens instead\n      let div = L.DomUtil.create('nav', 'mapml-focus-buttons');\n\n      // creates |< button, focuses map\n      let mapFocusButton = L.DomUtil.create('button', 'mapml-popup-button', div);\n      mapFocusButton.type = 'button';\n      mapFocusButton.title = 'Focus Map';\n      mapFocusButton.innerHTML = \"<span aria-hidden='true'>|&#10094;</span>\";\n      L.DomEvent.on(\n        mapFocusButton,\n        'click',\n        (e) => {\n          L.DomEvent.stop(e);\n          map.featureIndex._sortIndex();\n          map.closePopup();\n          map._container.focus();\n        },\n        popup\n      );\n\n      // creates < button, focuses previous feature, if none exists focuses the current feature\n      let previousButton = L.DomUtil.create('button', 'mapml-popup-button', div);\n      previousButton.type = 'button';\n      previousButton.title = 'Previous Feature';\n      previousButton.innerHTML = \"<span aria-hidden='true'>&#10094;</span>\";\n      L.DomEvent.on(previousButton, 'click', layer._previousFeature, popup);\n\n      // static feature counter that 1/1\n      let featureCount = L.DomUtil.create('p', 'mapml-feature-count', div),\n        totalFeatures = this._totalFeatureCount ? this._totalFeatureCount : 1;\n      featureCount.innerText = popup._count + 1 + '/' + totalFeatures;\n\n      // creates > button, focuses next feature, if none exists focuses the current feature\n      let nextButton = L.DomUtil.create('button', 'mapml-popup-button', div);\n      nextButton.type = 'button';\n      nextButton.title = 'Next Feature';\n      nextButton.innerHTML = \"<span aria-hidden='true'>&#10095;</span>\";\n      L.DomEvent.on(nextButton, 'click', layer._nextFeature, popup);\n\n      // creates >| button, focuses map controls\n      let controlFocusButton = L.DomUtil.create(\n        'button',\n        'mapml-popup-button',\n        div\n      );\n      controlFocusButton.type = 'button';\n      controlFocusButton.title = 'Focus Controls';\n      controlFocusButton.innerHTML = \"<span aria-hidden='true'>&#10095;|</span>\";\n      L.DomEvent.on(\n        controlFocusButton,\n        'click',\n        (e) => {\n          map.featureIndex._sortIndex();\n          map.featureIndex.currentIndex =\n            map.featureIndex.inBoundFeatures.length - 1;\n          map.featureIndex.inBoundFeatures[0]?.path.setAttribute('tabindex', -1);\n          map.featureIndex.inBoundFeatures[\n            map.featureIndex.currentIndex\n          ]?.path.setAttribute('tabindex', 0);\n          L.DomEvent.stop(e);\n          map.closePopup();\n          map._controlContainer.querySelector('A:not([hidden])').focus();\n        },\n        popup\n      );\n\n      let divider = L.DomUtil.create('hr', 'mapml-popup-divider');\n\n      popup._navigationBar = div;\n      popup._content.appendChild(divider);\n      popup._content.appendChild(div);\n\n      content.focus();\n\n      if (group && !M.options.featureIndexOverlayOption) {\n        // e.target = this._map\n        // Looks for keydown, more specifically tab and shift tab\n        group.setAttribute('aria-expanded', 'true');\n        map.on('keydown', focusFeature);\n      } else {\n        map.on('keydown', focusMap);\n      }\n      // When popup is open, what gets focused with tab needs to be done using JS as the DOM order is not in an accessibility friendly manner\n      function focusFeature(focusEvent) {\n        let path =\n          focusEvent.originalEvent.path ||\n          focusEvent.originalEvent.composedPath();\n        let isTab = focusEvent.originalEvent.keyCode === 9,\n          shiftPressed = focusEvent.originalEvent.shiftKey;\n        if (\n          (path[0].classList.contains('leaflet-popup-close-button') &&\n            isTab &&\n            !shiftPressed) ||\n          focusEvent.originalEvent.keyCode === 27 ||\n          (path[0].classList.contains('leaflet-popup-close-button') &&\n            focusEvent.originalEvent.keyCode === 13)\n        ) {\n          setTimeout(() => {\n            map.closePopup(popup);\n            group.focus();\n            L.DomEvent.stop(focusEvent);\n          }, 0);\n        } else if (\n          path[0].classList.contains('mapml-popup-content') &&\n          isTab &&\n          shiftPressed\n        ) {\n          setTimeout(() => {\n            //timeout needed so focus of the feature is done even after the keypressup event occurs\n            map.closePopup(popup);\n            group.focus();\n            L.DomEvent.stop(focusEvent);\n          }, 0);\n        } else if (\n          path[0] === popup._content.querySelector('a') &&\n          isTab &&\n          shiftPressed\n        ) {\n          setTimeout(() => {\n            map.closePopup(popup);\n            group.focus();\n            L.DomEvent.stop(focusEvent);\n          }, 0);\n        }\n      }\n\n      function focusMap(focusEvent) {\n        let path =\n          focusEvent.originalEvent.path ||\n          focusEvent.originalEvent.composedPath();\n        let isTab = focusEvent.originalEvent.keyCode === 9,\n          shiftPressed = focusEvent.originalEvent.shiftKey;\n\n        if (\n          (focusEvent.originalEvent.keyCode === 13 &&\n            path[0].classList.contains('leaflet-popup-close-button')) ||\n          focusEvent.originalEvent.keyCode === 27\n        ) {\n          L.DomEvent.stopPropagation(focusEvent);\n          map.closePopup(popup);\n          map._container.focus();\n          if (focusEvent.originalEvent.keyCode !== 27) map._popupClosed = true;\n        } else if (\n          isTab &&\n          path[0].classList.contains('leaflet-popup-close-button')\n        ) {\n          map.closePopup(popup);\n        } else if (\n          path[0].classList.contains('mapml-popup-content') &&\n          isTab &&\n          shiftPressed\n        ) {\n          map.closePopup(popup);\n          setTimeout(() => {\n            //timeout needed so focus of the feature is done even after the keypressup event occurs\n            L.DomEvent.stop(focusEvent);\n            map._container.focus();\n          }, 0);\n        } else if (\n          path[0] === popup._content.querySelector('a') &&\n          isTab &&\n          shiftPressed\n        ) {\n          map.closePopup(popup);\n          setTimeout(() => {\n            L.DomEvent.stop(focusEvent);\n            map.getContainer.focus();\n          }, 0);\n        }\n      }\n\n      function attachZoomLink(e) {\n        // this === popup\n        let content = this._content,\n          featureEl = e ? e.currFeature : this._source._groupLayer._featureEl;\n        if (content.querySelector('a.mapml-zoom-link')) {\n          content.querySelector('a.mapml-zoom-link').remove();\n        }\n        if (!featureEl.querySelector('map-geometry')) return;\n        let tL = featureEl.extent.topLeft.gcrs,\n          bR = featureEl.extent.bottomRight.gcrs,\n          center = L.latLngBounds(\n            L.latLng(tL.horizontal, tL.vertical),\n            L.latLng(bR.horizontal, bR.vertical)\n          ).getCenter(true);\n        let zoomLink = document.createElement('a');\n        zoomLink.href = `#${featureEl.getZoomToZoom()},${center.lng},${\n        center.lat\n      }`;\n        zoomLink.innerHTML = `${M.options.locale.popupZoom}`;\n        zoomLink.className = 'mapml-zoom-link';\n        zoomLink.onclick = zoomLink.onkeydown = function (e) {\n          if (!(e instanceof MouseEvent) && e.keyCode !== 13) return;\n          e.preventDefault();\n          featureEl.zoomTo();\n          map.closePopup();\n          map.getContainer().focus();\n        };\n        // we found that the popupopen event is fired as many times as there\n        // are layers on the map (<layer-> elements / MapMLLayers that is).\n        // In each case the target layer is always this layer, so we can't\n        // detect and conditionally add the zoomLink if the target is not this.\n        // so, like Ahmad, we are taking a 'delete everyting each time'\n        // approach (see _attachSkipButtons for this approach taken with\n        // feature navigation buttons); obviously he dealt with this leaflet bug\n        // this way some time ago, and we can't figure out how to get around it\n        // apart from this slightly non-optimal method. Revisit sometime!\n        let link = content.querySelector('.mapml-zoom-link');\n        if (link) link.remove();\n        content.insertBefore(\n          zoomLink,\n          content.querySelector('hr.mapml-popup-divider')\n        );\n      }\n\n      // if popup closes then the focusFeature handler can be removed\n      map.on('popupclose', removeHandlers);\n      function removeHandlers(removeEvent) {\n        if (removeEvent.popup === popup) {\n          map.off('keydown', focusFeature);\n          map.off('keydown', focusMap);\n          map.off('popupopen', attachZoomLink);\n          map.off('popupclose', removeHandlers);\n          if (group) group.setAttribute('aria-expanded', 'false');\n        }\n      }\n    }\n  });\n  var mapMLLayer = function (url, node, options) {\n    if (!url && !node) return null;\n    return new MapMLLayer(url, node, options);\n  };\n\n  var DebugOverlay = L.Layer.extend({\n    onAdd: function (map) {\n      let mapSize = map.getSize();\n\n      //conditionally show container for debug panel/banner only when the map has enough space for it\n      if (mapSize.x > 400 || mapSize.y > 300) {\n        this._container = L.DomUtil.create(\n          'table',\n          'mapml-debug',\n          map._container\n        );\n\n        this._panel = debugPanel({\n          className: 'mapml-debug-panel',\n          pane: this._container\n        });\n        map.addLayer(this._panel);\n      }\n\n      this._grid = debugGrid({\n        className: 'mapml-debug-grid',\n        pane: map._panes.mapPane,\n        zIndex: 400,\n        tileSize: map.options.crs.options.crs.tile.bounds.max.x\n      });\n      map.addLayer(this._grid);\n\n      this._vectors = debugVectors({\n        className: 'mapml-debug-vectors',\n        pane: map._panes.mapPane,\n        toolPane: this._container\n      });\n      map.addLayer(this._vectors);\n    },\n\n    onRemove: function (map) {\n      map.removeLayer(this._grid);\n      map.removeLayer(this._vectors);\n      if (this._panel) {\n        //conditionally remove the panel, as it's not always added\n        map.removeLayer(this._panel);\n        L.DomUtil.remove(this._container);\n      }\n    }\n  });\n\n  var debugOverlay = function () {\n    return new DebugOverlay();\n  };\n\n  var DebugPanel = L.Layer.extend({\n    initialize: function (options) {\n      L.setOptions(this, options);\n    },\n\n    onAdd: function (map) {\n      this._title = L.DomUtil.create(\n        'caption',\n        'mapml-debug-banner',\n        this.options.pane\n      );\n      this._title.innerHTML = 'Debug mode';\n\n      map.debug = {};\n      map.debug._infoContainer = this._debugContainer = L.DomUtil.create(\n        'tbody',\n        'mapml-debug-panel',\n        this.options.pane\n      );\n\n      let infoContainer = map.debug._infoContainer;\n\n      map.debug._tileCoord = L.DomUtil.create(\n        'tr',\n        'mapml-debug-coordinates',\n        infoContainer\n      );\n      map.debug._tileMatrixCoord = L.DomUtil.create(\n        'tr',\n        'mapml-debug-coordinates',\n        infoContainer\n      );\n      map.debug._mapCoord = L.DomUtil.create(\n        'tr',\n        'mapml-debug-coordinates',\n        infoContainer\n      );\n      map.debug._tcrsCoord = L.DomUtil.create(\n        'tr',\n        'mapml-debug-coordinates',\n        infoContainer\n      );\n      map.debug._pcrsCoord = L.DomUtil.create(\n        'tr',\n        'mapml-debug-coordinates',\n        infoContainer\n      );\n      map.debug._gcrsCoord = L.DomUtil.create(\n        'tr',\n        'mapml-debug-coordinates',\n        infoContainer\n      );\n\n      this._map.on('mousemove', this._updateCoords);\n    },\n    onRemove: function () {\n      L.DomUtil.remove(this._title);\n      if (this._debugContainer) {\n        L.DomUtil.remove(this._debugContainer);\n        this._map.off('mousemove', this._updateCoords);\n      }\n    },\n    _updateCoords: function (e) {\n      if (this.contextMenu._visible) return;\n      let mapEl = this.options.mapEl,\n        point = mapEl._map.project(e.latlng),\n        scale = mapEl._map.options.crs.scale(+mapEl.zoom),\n        pcrs = mapEl._map.options.crs.transformation.untransform(point, scale),\n        tileSize = mapEl._map.options.crs.options.crs.tile.bounds.max.x,\n        pointI = point.x % tileSize,\n        pointJ = point.y % tileSize;\n\n      if (pointI < 0) pointI += tileSize;\n      if (pointJ < 0) pointJ += tileSize;\n\n      this.debug._tileCoord.innerHTML = `\n      <th scope=\"row\">tile: </th>\n      <td>i: ${Math.trunc(pointI)}, </td>\n      <td>j: ${Math.trunc(pointJ)}</td>\n      `;\n      this.debug._mapCoord.innerHTML = `\n      <th scope=\"row\">map: </th>\n      <td>i: ${Math.trunc(e.containerPoint.x)}, </td>\n      <td>j: ${Math.trunc(e.containerPoint.y)}</td>\n      `;\n      this.debug._gcrsCoord.innerHTML = `\n      <th scope=\"row\">gcrs: </th>\n      <td>lon: ${e.latlng.lng.toFixed(6)}, </td>\n      <td>lat: ${e.latlng.lat.toFixed(6)}</td>\n      `;\n      this.debug._tcrsCoord.innerHTML = `\n      <th scope=\"row\">tcrs: </th>\n      <td>x: ${Math.trunc(point.x)}, </td>\n      <td>y: ${Math.trunc(point.y)}</td>\n      `;\n      this.debug._tileMatrixCoord.innerHTML = `\n      <th scope=\"row\">tilematrix: </th>\n      <td>column: ${Math.trunc(point.x / tileSize)}, </td>\n      <td>row: ${Math.trunc(point.y / tileSize)}</td>\n      `;\n      this.debug._pcrsCoord.innerHTML = `\n      <th scope=\"row\">pcrs: </th>\n      <td>easting: ${pcrs.x.toFixed(2)}, </td>\n      <td>northing: ${pcrs.y.toFixed(2)}</td>\n      `;\n    }\n  });\n\n  var debugPanel = function (options) {\n    return new DebugPanel(options);\n  };\n\n  var DebugGrid = L.GridLayer.extend({\n    initialize: function (options) {\n      L.setOptions(this, options);\n      L.GridLayer.prototype.initialize.call(this, this._map);\n    },\n\n    createTile: function (coords) {\n      let tile = L.DomUtil.create('div', 'mapml-debug-tile');\n      tile.setAttribute('col', coords.x);\n      tile.setAttribute('row', coords.y);\n      tile.setAttribute('zoom', coords.z);\n      tile.innerHTML = [\n        `col: ${coords.x}`,\n        `row: ${coords.y}`,\n        `zoom: ${coords.z}`\n      ].join(', ');\n\n      tile.style.outline = '1px dashed red';\n      return tile;\n    }\n  });\n\n  var debugGrid = function (options) {\n    return new DebugGrid(options);\n  };\n\n  var DebugVectors = L.LayerGroup.extend({\n    initialize: function (options) {\n      L.setOptions(this, options);\n      L.LayerGroup.prototype.initialize.call(this, this._map, options);\n    },\n    onAdd: function (map) {\n      map.on('overlayremove', this._mapLayerUpdate, this);\n      map.on('overlayadd', this._mapLayerUpdate, this);\n      let center = map.options.crs.transformation.transform(\n        L.point(0, 0),\n        map.options.crs.scale(0)\n      );\n      this._centerVector = L.circle(map.options.crs.pointToLatLng(center, 0), {\n        radius: 250,\n        className: 'mapml-debug-vectors projection-centre'\n      });\n      this._centerVector.bindTooltip('Projection Center');\n\n      this._addBounds(map);\n    },\n    onRemove: function (map) {\n      this.clearLayers();\n    },\n\n    _addBounds: function (map) {\n      // to delay the addBounds to wait for the layer.extentbounds / layer.layerbounds to be ready when the layer- checked attribute is changed\n      setTimeout(() => {\n        let id = Object.keys(map._layers),\n          layers = map._layers,\n          colors = ['#FF5733', '#8DFF33', '#3397FF', '#E433FF', '#F3FF33'],\n          j = 0;\n\n        this.addLayer(this._centerVector);\n\n        for (let i of id) {\n          if (layers[i].layerBounds || layers[i].extentBounds) {\n            let boundsArray;\n            if (layers[i].layerBounds) {\n              boundsArray = [\n                layers[i].layerBounds.min,\n                L.point(layers[i].layerBounds.max.x, layers[i].layerBounds.min.y),\n                layers[i].layerBounds.max,\n                L.point(layers[i].layerBounds.min.x, layers[i].layerBounds.max.y)\n              ];\n            } else {\n              boundsArray = [\n                layers[i].extentBounds.min,\n                L.point(\n                  layers[i].extentBounds.max.x,\n                  layers[i].extentBounds.min.y\n                ),\n                layers[i].extentBounds.max,\n                L.point(\n                  layers[i].extentBounds.min.x,\n                  layers[i].extentBounds.max.y\n                )\n              ];\n            }\n\n            // boundsTestTag adds the value of from the <layer-@data-testid> element\n            // if it exists. this simplifies debugging because the svg path will be\n            // tagged with the layer it came from\n            let boundsTestTag =\n              layers[i].extentBounds &&\n              layers[i].options.linkEl.getLayerEl().hasAttribute('data-testid')\n                ? layers[i].options.linkEl\n                    .getLayerEl()\n                    .getAttribute('data-testid')\n                : layers[i].layerBounds &&\n                  layers[i].options?._leafletLayer?._layerEl.hasAttribute(\n                    'data-testid'\n                  )\n                ? layers[i].options._leafletLayer._layerEl.getAttribute(\n                    'data-testid'\n                  )\n                : '';\n            let boundsRect = projectedExtent(boundsArray, {\n              className: this.options.className.concat(' ', boundsTestTag),\n              color: colors[j % colors.length],\n              weight: 2,\n              opacity: 1,\n              fillOpacity: 0.01,\n              fill: true\n            });\n            if (layers[i].options._leafletLayer)\n              boundsRect.bindTooltip(layers[i].options._leafletLayer._title, {\n                sticky: true\n              });\n            this.addLayer(boundsRect);\n            j++;\n          }\n        }\n\n        if (map.totalLayerBounds) {\n          let totalBoundsArray = [\n            map.totalLayerBounds.min,\n            L.point(map.totalLayerBounds.max.x, map.totalLayerBounds.min.y),\n            map.totalLayerBounds.max,\n            L.point(map.totalLayerBounds.min.x, map.totalLayerBounds.max.y)\n          ];\n\n          let totalBounds = projectedExtent(totalBoundsArray, {\n            className: 'mapml-debug-vectors mapml-total-bounds',\n            color: '#808080',\n            weight: 5,\n            opacity: 0.5,\n            fill: false\n          });\n          this.addLayer(totalBounds);\n        }\n      }, 0);\n    },\n\n    _mapLayerUpdate: function (e) {\n      this.clearLayers();\n      this._addBounds(e.target);\n    }\n  });\n\n  var debugVectors = function (options) {\n    return new DebugVectors(options);\n  };\n\n  var ProjectedExtent = L.Path.extend({\n    getCenter: function (round) {\n      let crs = this._map.options.crs;\n      return crs.unproject(L.bounds(this._locations).getCenter());\n    },\n\n    options: {\n      className: 'mapml-debug-extent'\n    },\n    initialize: function (locations, options) {\n      //locations passed in as pcrs coordinates\n      this._locations = locations;\n      L.setOptions(this, options);\n    },\n\n    _project: function () {\n      this._rings = [];\n      let scale = this._map.options.crs.scale(this._map.getZoom()),\n        map = this._map;\n      for (let i = 0; i < this._locations.length; i++) {\n        let point = map.options.crs.transformation.transform(\n          this._locations[i],\n          scale\n        );\n        //substract the pixel origin from the pixel coordinates to get the location relative to map viewport\n        this._rings.push(\n          L.point(point.x, point.y)._subtract(map.getPixelOrigin())\n        );\n      }\n      //leaflet SVG renderer looks for and array of arrays to build polygons,\n      //in this case it only deals with a rectangle so one closed array or points\n      this._parts = [this._rings];\n    },\n\n    _update: function () {\n      if (!this._map) return;\n      this._renderer._updatePoly(this, true); //passing true creates a closed path i.e. a rectangle\n    }\n  });\n\n  var projectedExtent = function (locations, options) {\n    return new ProjectedExtent(locations, options);\n  };\n\n  var QueryHandler = L.Handler.extend({\n    addHooks: function () {\n      // get a reference to the actual <map> element, so we can\n      // use its layers property to iterate the layers from top down\n      // evaluating if they are 'on the map' (enabled)\n      L.setOptions(this, { mapEl: this._map.options.mapEl });\n      L.DomEvent.on(this._map, 'click', this._queryTopLayer, this);\n      L.DomEvent.on(this._map, 'keypress', this._queryTopLayerAtMapCenter, this);\n    },\n    removeHooks: function () {\n      L.DomEvent.off(this._map, 'click', this._queryTopLayer, this);\n      L.DomEvent.on(this._map, 'keypress', this._queryTopLayerAtMapCenter, this);\n    },\n    _getTopQueryableLayer: function () {\n      var layers = this.options.mapEl.layers;\n      // work backwards in document order (top down)\n      for (var l = layers.length - 1; l >= 0; l--) {\n        if (layers[l].queryable()) {\n          return layers[l]._layer;\n        }\n      }\n    },\n    _queryTopLayerAtMapCenter: function (event) {\n      setTimeout(() => {\n        if (\n          this._map.isFocused &&\n          !this._map._popupClosed &&\n          (event.originalEvent.key === ' ' || +event.originalEvent.keyCode === 13)\n        ) {\n          this._map.fire('click', {\n            latlng: this._map.getCenter(),\n            layerPoint: this._map.latLngToLayerPoint(this._map.getCenter()),\n            containerPoint: this._map.latLngToContainerPoint(\n              this._map.getCenter()\n            )\n          });\n        } else {\n          delete this._map._popupClosed;\n        }\n      }, 0);\n    },\n    _queryTopLayer: function (event) {\n      var layer = this._getTopQueryableLayer();\n      if (layer) {\n        if (layer._mapmlFeatures) delete layer._mapmlFeatures;\n        this._query(event, layer);\n      }\n    },\n    _query(e, layer) {\n      var zoom = e.target.getZoom(),\n        map = this._map,\n        crs = M[layer.options.projection], // the crs for each extent would be the same\n        tileSize = map.options.crs.options.crs.tile.bounds.max.x,\n        container = layer._container,\n        popupOptions = {\n          autoClose: false,\n          autoPan: true,\n          maxHeight: map.getSize().y * 0.5 - 50\n        },\n        tcrs2pcrs = function (c) {\n          return crs.transformation.untransform(c, crs.scale(zoom));\n        },\n        tcrs2gcrs = function (c) {\n          return crs.unproject(\n            crs.transformation.untransform(c, crs.scale(zoom)),\n            zoom\n          );\n        };\n      var tcrsClickLoc = crs.latLngToPoint(e.latlng, zoom),\n        tileMatrixClickLoc = tcrsClickLoc.divideBy(tileSize).floor(),\n        tileBounds = new L.Bounds(\n          tcrsClickLoc.divideBy(tileSize).floor().multiplyBy(tileSize),\n          tcrsClickLoc.divideBy(tileSize).ceil().multiplyBy(tileSize)\n        );\n\n      let point = this._map.project(e.latlng),\n        scale = this._map.options.crs.scale(this._map.getZoom()),\n        pcrsClick = this._map.options.crs.transformation.untransform(\n          point,\n          scale\n        );\n      let templates = layer.getQueryTemplates(pcrsClick, zoom);\n\n      let fetches = [];\n\n      var fetchFeatures = function (template, obj) {\n        const parser = new DOMParser();\n        return fetch(L.Util.template(template.template, obj), {\n          redirect: 'follow'\n        })\n          .then((response) => {\n            if (response.status >= 200 && response.status < 300) {\n              return response.text().then((text) => {\n                return {\n                  contenttype: response.headers.get('Content-Type'),\n                  text: text\n                };\n              });\n            } else {\n              throw new Error(response.status);\n            }\n          })\n          .then((response) => {\n            let features = [];\n            let geom =\n              \"<map-geometry cs='gcrs'><map-point><map-coordinates>\" +\n              e.latlng.lng +\n              ' ' +\n              e.latlng.lat +\n              '</map-coordinates></map-point></map-geometry>';\n            if (response.contenttype.startsWith('text/mapml')) {\n              // the mapmldoc could have <map-meta> elements that are important, perhaps\n              // also, the mapmldoc can have many features\n              let mapmldoc = parser.parseFromString(\n                response.text,\n                'application/xml'\n              );\n              let geometrylessFeatures = mapmldoc.querySelectorAll(\n                'map-feature:not(:has(map-geometry))'\n              );\n              if (geometrylessFeatures.length) {\n                let g = parser.parseFromString(geom, 'application/xml');\n                for (let i = 0; i < geometrylessFeatures.length; i++) {\n                  let f = geometrylessFeatures[i];\n                  f.appendChild(g.firstElementChild.cloneNode(true));\n                }\n              }\n              features = Array.prototype.slice.call(\n                mapmldoc.querySelectorAll('map-feature')\n              );\n              // <map-meta> elements for this query\n              layer.queryMetas = Array.prototype.slice.call(\n                mapmldoc.querySelectorAll(\n                  'map-meta[name=cs], map-meta[name=zoom], map-meta[name=projection]'\n                )\n              );\n            } else {\n              try {\n                let featureDocument = parser.parseFromString(\n                  response.text,\n                  'application/xml'\n                );\n                let featureCollection =\n                  featureDocument.querySelectorAll('map-feature');\n                if (\n                  featureDocument.querySelector('parsererror') ||\n                  featureCollection.length === 0\n                ) {\n                  throw new Error('parsererror');\n                }\n                let g = parser.parseFromString(geom, 'application/xml');\n                for (let feature of featureCollection) {\n                  if (!feature.querySelector('map-geometry')) {\n                    feature.appendChild(g.firstElementChild.cloneNode(true));\n                  }\n                  features.push(feature);\n                }\n              } catch (err) {\n                // try the html parser; script elements are marked as non-functional\n                // by that api, which hopefully works!\n                let html = parser.parseFromString(response.text, 'text/html');\n\n                // synthesize a single feature from text or html content\n                let featureDoc = parser.parseFromString(\n                  '<map-feature><map-properties>' +\n                    '</map-properties>' +\n                    geom +\n                    '</map-feature>',\n                  'text/html'\n                );\n                if (html.body) {\n                  featureDoc\n                    .querySelector('map-properties')\n                    .appendChild(html.querySelector('html'));\n                } else {\n                  featureDoc\n                    .querySelector('map-properties')\n                    .append(response.text);\n                }\n                features.push(featureDoc.querySelector('map-feature'));\n              }\n            }\n            return { features: features, template: template };\n          })\n          .catch((err) => {\n            console.log('Looks like there was a problem. Status: ' + err.message);\n          });\n      };\n\n      for (let i = 0; i < templates.length; i++) {\n        var obj = {},\n          template = templates[i];\n\n        // all of the following are locations that might be used in a query, I think.\n        obj[template.query.tilei] =\n          tcrsClickLoc.x.toFixed() - tileMatrixClickLoc.x * tileSize;\n        obj[template.query.tilej] =\n          tcrsClickLoc.y.toFixed() - tileMatrixClickLoc.y * tileSize;\n\n        // this forces the click to the centre of the map extent in the layer crs\n        obj[template.query.mapi] = map.getSize().divideBy(2).x.toFixed();\n        obj[template.query.mapj] = map.getSize().divideBy(2).y.toFixed();\n\n        obj[template.query.pixelleft] = crs.pointToLatLng(tcrsClickLoc, zoom).lng;\n        obj[template.query.pixeltop] = crs.pointToLatLng(tcrsClickLoc, zoom).lat;\n        obj[template.query.pixelright] = crs.pointToLatLng(\n          tcrsClickLoc.add([1, 1]),\n          zoom\n        ).lng;\n        obj[template.query.pixelbottom] = crs.pointToLatLng(\n          tcrsClickLoc.add([1, 1]),\n          zoom\n        ).lat;\n\n        obj[template.query.column] = tileMatrixClickLoc.x;\n        obj[template.query.row] = tileMatrixClickLoc.y;\n        obj[template.query.x] = tcrsClickLoc.x.toFixed();\n        obj[template.query.y] = tcrsClickLoc.y.toFixed();\n\n        // whereas the layerPoint is calculated relative to the origin plus / minus any\n        // pan movements so is equal to containerPoint at first before any pans, but\n        // changes as the map pans.\n        obj[template.query.easting] = tcrs2pcrs(tcrsClickLoc).x;\n        obj[template.query.northing] = tcrs2pcrs(tcrsClickLoc).y;\n        obj[template.query.longitude] = tcrs2gcrs(tcrsClickLoc).lng;\n        obj[template.query.latitude] = tcrs2gcrs(tcrsClickLoc).lat;\n        obj[template.query.zoom] = zoom;\n        obj[template.query.width] = map.getSize().x;\n        obj[template.query.height] = map.getSize().y;\n        // assumes the click is at the centre of the map, per template.query.mapi, mapj above\n        obj[template.query.mapbottom] = tcrs2pcrs(\n          tcrsClickLoc.add(map.getSize().divideBy(2))\n        ).y;\n        obj[template.query.mapleft] = tcrs2pcrs(\n          tcrsClickLoc.subtract(map.getSize().divideBy(2))\n        ).x;\n        obj[template.query.maptop] = tcrs2pcrs(\n          tcrsClickLoc.subtract(map.getSize().divideBy(2))\n        ).y;\n        obj[template.query.mapright] = tcrs2pcrs(\n          tcrsClickLoc.add(map.getSize().divideBy(2))\n        ).x;\n\n        obj[template.query.tilebottom] = tcrs2pcrs(tileBounds.max).y;\n        obj[template.query.tileleft] = tcrs2pcrs(tileBounds.min).x;\n        obj[template.query.tiletop] = tcrs2pcrs(tileBounds.min).y;\n        obj[template.query.tileright] = tcrs2pcrs(tileBounds.max).x;\n        // add hidden or other variables that may be present into the values to\n        // be processed by L.Util.template below.\n        for (var v in template.query) {\n          if (\n            [\n              'mapi',\n              'mapj',\n              'tilei',\n              'tilej',\n              'row',\n              'col',\n              'x',\n              'y',\n              'easting',\n              'northing',\n              'longitude',\n              'latitude',\n              'width',\n              'height',\n              'zoom',\n              'mapleft',\n              'mapright',\n              ',maptop',\n              'mapbottom',\n              'tileleft',\n              'tileright',\n              'tiletop',\n              'tilebottom',\n              'pixeltop',\n              'pixelbottom',\n              'pixelleft',\n              'pixelright'\n            ].indexOf(v) < 0\n          ) {\n            obj[v] = template.query[v];\n          }\n        }\n        fetches.push(fetchFeatures(template, obj));\n      }\n      Promise.allSettled(fetches).then((results) => {\n        layer._mapmlFeatures = [];\n        // f is an array of {features[], template}\n\n        for (let f of results) {\n          if (f.status === 'fulfilled') {\n            // create connection between queried <map-feature> and its parent <map-link>\n            for (let feature of f.value.features) {\n              feature._linkEl = f.value.template.linkEl;\n            }\n            layer._mapmlFeatures = layer._mapmlFeatures.concat(f.value.features);\n          }\n        }\n        if (layer._mapmlFeatures.length > 0)\n          displayFeaturesPopup(layer._mapmlFeatures, e.latlng);\n      });\n\n      function displayFeaturesPopup(features, loc) {\n        if (features.length === 0) return;\n        let f = M.featureLayer(features, {\n          // pass the vector layer a renderer of its own, otherwise leaflet\n          // puts everything into the overlayPane\n          renderer: M.featureRenderer(),\n          // pass the vector layer the container for the parent into which\n          // it will append its own container for rendering into\n          pane: container,\n          //color: 'yellow',\n          // instead of unprojecting and then projecting and scaling,\n          // a much smarter approach would be to scale at the current\n          // zoom\n          projection: map.options.projection,\n          _leafletLayer: layer,\n          query: true,\n          mapEl: layer.options.mapEl\n        });\n\n        f.addTo(layer);\n\n        let div = L.DomUtil.create('div', 'mapml-popup-content'),\n          c = L.DomUtil.create('iframe');\n        c.style = 'border: none';\n        c.srcdoc = features[0].querySelector(\n          'map-feature map-properties'\n        ).innerHTML;\n        c.setAttribute('sandbox', 'allow-same-origin allow-forms');\n        div.appendChild(c);\n        // passing a latlng to the popup is necessary for when there is no\n        // geometry / null geometry\n        layer._totalFeatureCount = features.length;\n        layer.bindPopup(div, popupOptions).openPopup(loc);\n        layer.on('popupclose', function () {\n          layer.removeLayer(f);\n        });\n        f.showPaginationFeature({\n          i: 0,\n          popup: layer._popup,\n          meta: layer.queryMetas\n        });\n      }\n    }\n  });\n\n  /*\n  MIT License related to portions of M.ContextMenu \n  Copyright (c) 2017 adam.ratcliffe@gmail.com\n  Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the Software), \n  to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, \n  and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:\n  The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.\n  */\n  /* global M, KeyboardEvent */\n\n  var ContextMenu = L.Handler.extend({\n    _touchstart: L.Browser.msPointer\n      ? 'MSPointerDown'\n      : L.Browser.pointer\n      ? 'pointerdown'\n      : 'touchstart',\n\n    initialize: function (map) {\n      L.Handler.prototype.initialize.call(this, map);\n      this.activeIndex = 0; //current fous index on menu\n      this.excludedIndices = [4, 7]; //menu indexes that are --------\n      this.isRunned = false; //variable for tracking edge case\n      //setting the items in the context menu and their callback functions\n      this._menuItems = {};\n\n      const CTXBACK = 0,\n        CTXFWD = 1,\n        CTXRELOAD = 2,\n        CTXFULLSCR = 3,\n        CTXSPACER1 = 4,\n        CTXCOPY = 5,\n        CTXPASTE = 6,\n        CTXSPACER2 = 7,\n        CTXCNTRLS = 8,\n        CTXDEBUG = 9,\n        CTXVWSRC = 10;\n      this._menuItems.CTXBACK = CTXBACK;\n      this._menuItems.CTXFWD = CTXFWD;\n      this._menuItems.CTXRELOAD = CTXRELOAD;\n      this._menuItems.CTXFULLSCR = CTXFULLSCR;\n      this._menuItems.CTXSPACER1 = CTXSPACER1;\n      this._menuItems.CTXCOPY = CTXCOPY;\n      this._menuItems.CTXPASTE = CTXPASTE;\n      this._menuItems.CTXSPACER2 = CTXSPACER2;\n      this._menuItems.CTXCNTRLS = CTXCNTRLS;\n      this._menuItems.CTXDEBUG = CTXDEBUG;\n      this._menuItems.CTXVWSRC = CTXVWSRC;\n\n      this._items = [\n        {\n          // 0\n          text: M.options.locale.cmBack + ' (<kbd>Alt+Left Arrow</kbd>)',\n          callback: this._goBack\n        },\n        {\n          // 1\n          text: M.options.locale.cmForward + ' (<kbd>Alt+Right Arrow</kbd>)',\n          callback: this._goForward\n        },\n        {\n          // 2\n          text: M.options.locale.cmReload + ' (<kbd>Ctrl+R</kbd>)',\n          callback: this._reload\n        },\n        {\n          // 3\n          text: M.options.locale.btnFullScreen + ' (<kbd>F</kbd>)',\n          callback: this._toggleFullScreen\n        },\n        {\n          // 4\n          spacer: '-'\n        },\n        {\n          // 5\n          text: M.options.locale.cmCopyCoords + ' (<kbd>C</kbd>)<span></span>',\n          callback: this._copyCoords,\n          hideOnSelect: false,\n          popup: true,\n          submenu: [\n            {\n              // 5.0\n              text: M.options.locale.cmCopyMapML,\n              callback: this._copyMapML\n            },\n            {\n              // 5.1\n              text: M.options.locale.cmCopyExtent,\n              callback: this._copyExtent\n            },\n            {\n              // 5.2\n              text: M.options.locale.cmCopyLocation,\n              callback: this._copyLocation\n            }\n          ]\n        },\n        {\n          // 6\n          text: M.options.locale.cmPasteLayer + ' (<kbd>P</kbd>)',\n          callback: this._paste\n        },\n        {\n          // 7\n          spacer: '-'\n        },\n        {\n          // 8\n          text: M.options.locale.cmToggleControls + ' (<kbd>T</kbd>)',\n          callback: this._toggleControls\n        },\n        {\n          // 9\n          text: M.options.locale.cmToggleDebug + ' (<kbd>D</kbd>)',\n          callback: this._toggleDebug\n        },\n        {\n          // 10\n          text: M.options.locale.cmViewSource + ' (<kbd>V</kbd>)',\n          callback: this._viewSource\n        }\n      ];\n\n      // setting the default cs for copying location and extent\n      // should be public as they are used in tests\n      this.defExtCS = M.options.defaultExtCoor;\n      this.defLocCS = M.options.defaultLocCoor;\n\n      // Used for layer and map-extent contextmenu\n      const LYRZOOMTO = 0,\n        LYRCOPY = 1;\n      this._menuItems.LYRZOOMTO = LYRZOOMTO;\n      this._menuItems.LYRCOPY = LYRCOPY;\n\n      this._layerItems = [\n        {\n          // 0\n          text: M.options.locale.lmZoomToLayer + ' (<kbd>Z</kbd>)',\n          callback: this._zoomToLayer\n        },\n        {\n          // 1\n          text: M.options.locale.lmCopyLayer + ' (<kbd>L</kbd>)',\n          callback: this._copyLayer\n        }\n      ];\n\n      this._extentLayerItems = [\n        {\n          // 0\n          text: M.options.locale.lmZoomToExtent + ' (<kbd>Z</kbd>)',\n          callback: this._zoomToMapExtent\n        },\n        {\n          // 1\n          text: M.options.locale.lmCopyExtent + ' (<kbd>L</kbd>)',\n          callback: this._copyMapExtent\n        }\n      ];\n      this._mapMenuVisible = false;\n      this._keyboardEvent = false;\n\n      this._container = L.DomUtil.create(\n        'div',\n        'mapml-contextmenu',\n        map.getContainer()\n      );\n      this._container.setAttribute('hidden', '');\n\n      this._items[CTXBACK].el = this._createItem(\n        this._container,\n        this._items[CTXBACK]\n      );\n      this._items[CTXFWD].el = this._createItem(\n        this._container,\n        this._items[CTXFWD]\n      );\n      this._items[CTXRELOAD].el = this._createItem(\n        this._container,\n        this._items[CTXRELOAD]\n      );\n      this._items[CTXFULLSCR].el = this._createItem(\n        this._container,\n        this._items[CTXFULLSCR]\n      );\n      this._items[CTXSPACER1].el = this._createItem(\n        this._container,\n        this._items[CTXSPACER1]\n      );\n      this._items[CTXCOPY].el = this._createItem(\n        this._container,\n        this._items[CTXCOPY]\n      );\n\n      this._copySubMenu = L.DomUtil.create(\n        'div',\n        'mapml-contextmenu mapml-submenu',\n        this._container\n      );\n      this._copySubMenu.id = 'mapml-copy-submenu';\n      this._copySubMenu.setAttribute('hidden', '');\n\n      this._clickEvent = null;\n\n      const CPYMENUMAP = 0,\n        CPYMENUEXTENT = 1,\n        CPYMENULOC = 2;\n      this._menuItems.CPYMENUMAP = CPYMENUMAP;\n      this._menuItems.CPYMENUEXTENT = CPYMENUEXTENT;\n      this._menuItems.CPYMENULOC = CPYMENULOC;\n      this._createItem(\n        this._copySubMenu,\n        this._items[CTXCOPY].submenu[CPYMENUMAP],\n        CPYMENUMAP\n      );\n      this._createItem(\n        this._copySubMenu,\n        this._items[CTXCOPY].submenu[CPYMENUEXTENT],\n        CPYMENUEXTENT\n      );\n      this._createItem(\n        this._copySubMenu,\n        this._items[CTXCOPY].submenu[CPYMENULOC],\n        CPYMENULOC\n      );\n\n      this._items[CTXPASTE].el = this._createItem(\n        this._container,\n        this._items[CTXPASTE]\n      );\n      this._items[CTXSPACER2].el = this._createItem(\n        this._container,\n        this._items[CTXSPACER2]\n      );\n      this._items[CTXCNTRLS].el = this._createItem(\n        this._container,\n        this._items[CTXCNTRLS]\n      );\n      this._items[CTXDEBUG].el = this._createItem(\n        this._container,\n        this._items[CTXDEBUG]\n      );\n      this._items[CTXVWSRC].el = this._createItem(\n        this._container,\n        this._items[CTXVWSRC]\n      );\n\n      this._layerMenu = L.DomUtil.create(\n        'div',\n        'mapml-contextmenu mapml-layer-menu',\n        map.getContainer()\n      );\n      this._layerMenu.setAttribute('hidden', '');\n      this._createItem(this._layerMenu, this._layerItems[LYRZOOMTO]);\n      this._createItem(this._layerMenu, this._layerItems[LYRCOPY]);\n\n      this._extentLayerMenu = L.DomUtil.create(\n        'div',\n        'mapml-contextmenu mapml-extent-menu',\n        map.getContainer()\n      );\n      this._extentLayerMenu.setAttribute('hidden', '');\n      this._createItem(this._extentLayerMenu, this._extentLayerItems[LYRZOOMTO]);\n      this._createItem(this._extentLayerMenu, this._extentLayerItems[LYRCOPY]);\n\n      L.DomEvent.on(this._container, 'click', L.DomEvent.stop)\n        .on(this._container, 'mousedown', L.DomEvent.stop)\n        .on(this._container, 'dblclick', L.DomEvent.stop)\n        .on(this._container, 'contextmenu', L.DomEvent.stop)\n        .on(this._layerMenu, 'click', L.DomEvent.stop)\n        .on(this._layerMenu, 'mousedown', L.DomEvent.stop)\n        .on(this._layerMenu, 'dblclick', L.DomEvent.stop)\n        .on(this._layerMenu, 'contextmenu', L.DomEvent.stop)\n        .on(this._extentLayerMenu, 'click', L.DomEvent.stop)\n        .on(this._extentLayerMenu, 'mousedown', L.DomEvent.stop)\n        .on(this._extentLayerMenu, 'dblclick', L.DomEvent.stop)\n        .on(this._extentLayerMenu, 'contextmenu', L.DomEvent.stop);\n\n      this.t = document.createElement('template');\n      this.t.innerHTML = `<map-feature zoom=\"\">\n        <map-featurecaption></map-featurecaption>\n        <map-properties>\n            <h2></h2>\n            <div style=\"text-align:center\"></div>\n        </map-properties>\n        <map-geometry cs=\"\">\n          <map-point>\n            <map-coordinates></map-coordinates>\n          </map-point>\n        </map-geometry>\n      </map-feature>`;\n    },\n\n    addHooks: function () {\n      var container = this._map.getContainer();\n\n      L.DomEvent.on(container, 'mouseleave', this._hide, this).on(\n        document,\n        'keydown',\n        this._onKeyDown,\n        this\n      );\n\n      if (L.Browser.touch) {\n        L.DomEvent.on(document, this._touchstart, this._hide, this);\n      }\n\n      this._map.on(\n        {\n          contextmenu: this._show,\n          mousedown: this._hide,\n          zoomstart: this._hide\n        },\n        this\n      );\n    },\n\n    removeHooks: function () {\n      var container = this._map.getContainer();\n\n      L.DomEvent.off(container, 'mouseleave', this._hide, this).off(\n        document,\n        'keydown',\n        this._onKeyDown,\n        this\n      );\n\n      if (L.Browser.touch) {\n        L.DomEvent.off(document, this._touchstart, this._hide, this);\n      }\n\n      this._map.off(\n        {\n          contextmenu: this._show,\n          mousedown: this._hide,\n          zoomstart: this._hide\n        },\n        this\n      );\n    },\n\n    _updateCS: function () {\n      if (\n        this.defExtCS !== M.options.defaultExtCoor ||\n        this.defLocCS !== M.options.defaultLocCoor\n      ) {\n        this.defExtCS = M.options.defaultExtCoor;\n        this.defLocCS = M.options.defaultLocCoor;\n      }\n    },\n\n    _copyExtent: function (e) {\n      let context =\n          e instanceof KeyboardEvent ? this._map.contextMenu : this.contextMenu,\n        coord = context.defExtCS ? context.defExtCS.toLowerCase() : 'pcrs',\n        tL =\n          e instanceof KeyboardEvent\n            ? this.extent.topLeft[coord]\n            : this.options.mapEl.extent.topLeft[coord],\n        bR =\n          e instanceof KeyboardEvent\n            ? this.extent.bottomRight[coord]\n            : this.options.mapEl.extent.bottomRight[coord],\n        data = '';\n      switch (coord) {\n        case 'MapML':\n        default:\n          if (coord === 'pcrs') {\n            data = `<map-meta name=\"extent\" content=\"top-left-easting=${Math.round(\n            tL.horizontal\n          )}, top-left-northing=${Math.round(\n            tL.vertical\n          )}, bottom-right-easting=${Math.round(\n            bR.horizontal\n          )}, bottom-right-northing=${Math.round(bR.vertical)}\"></map-meta>`;\n          } else if (coord === 'gcrs') {\n            data = `<map-meta name=\"extent\" content=\"top-left-longitude=${tL.horizontal}, top-left-latitude=${tL.vertical}, bottom-right-longitude=${bR.horizontal}, bottom-right-latitude=${bR.vertical}\"></map-meta>`;\n          } else if (coord === 'tcrs') {\n            data = `<map-meta name=\"extent\" content=\"top-left-x=${\n            tL[0].horizontal\n          }, top-left-y=${tL[0].vertical}, bottom-right-x=${\n            bR[bR.length - 1].horizontal\n          }, bottom-right-y=${bR[bR.length - 1].vertical}\"></map-meta>`;\n          } else if (coord === 'tilematrix') {\n            data = `<map-meta name=\"extent\" content=\"top-left-column=${\n            tL[0].horizontal\n          }, top-left-row=${tL[0].vertical}, bottom-right-column=${\n            bR[bR.length - 1].horizontal\n          }, bottom-right-row=${bR[bR.length - 1].vertical}\"></map-meta>`;\n          } else {\n            console.log('not support');\n          }\n          break;\n      }\n      context._copyData(data);\n    },\n\n    _zoomToLayer: function (e) {\n      let context =\n        e instanceof KeyboardEvent ? this._map.contextMenu : this.contextMenu;\n      context._layerClicked.layer._layerEl.zoomTo();\n    },\n\n    _copyLayer: function (e) {\n      let context =\n          e instanceof KeyboardEvent ? this._map.contextMenu : this.contextMenu,\n        layerElem = context._layerClicked.layer._layerEl;\n      context._copyData(layerElem.getOuterHTML());\n    },\n\n    _zoomToMapExtent: function (e) {\n      let context =\n        e instanceof KeyboardEvent ? this._map.contextMenu : this.contextMenu;\n      context._layerClicked.extent.zoomTo();\n    },\n\n    _copyMapExtent: function (e) {\n      let context =\n          e instanceof KeyboardEvent ? this._map.contextMenu : this.contextMenu,\n        extentElem = context._layerClicked.extent;\n      context._copyData(extentElem.getOuterHTML());\n    },\n\n    _goForward: function (e) {\n      let mapEl =\n        e instanceof KeyboardEvent ? this._map.options.mapEl : this.options.mapEl;\n      mapEl.forward();\n    },\n\n    _goBack: function (e) {\n      let mapEl =\n        e instanceof KeyboardEvent ? this._map.options.mapEl : this.options.mapEl;\n      mapEl.back();\n    },\n\n    _reload: function (e) {\n      let mapEl =\n        e instanceof KeyboardEvent ? this._map.options.mapEl : this.options.mapEl;\n      mapEl.reload();\n    },\n\n    _toggleFullScreen: function (e) {\n      let mapEl =\n        e instanceof KeyboardEvent ? this._map.options.mapEl : this.options.mapEl;\n      mapEl._toggleFullScreen();\n    },\n\n    _toggleControls: function (e) {\n      let mapEl =\n        e instanceof KeyboardEvent ? this._map.options.mapEl : this.options.mapEl;\n      if (mapEl.controls) {\n        mapEl.controls = false;\n      } else {\n        mapEl.controls = true;\n      }\n    },\n\n    _copyMapML: function (e) {\n      let context =\n          e instanceof KeyboardEvent ? this._map.contextMenu : this.contextMenu,\n        mapEl =\n          e instanceof KeyboardEvent\n            ? this._map.options.mapEl\n            : this.options.mapEl;\n      context._copyData(\n        mapEl.outerHTML.replace(\n          /<div class=\"mapml-web-map\">.*?<\\/div>|<style>\\[is=\"web-map\"].*?<\\/style>|<style>mapml-viewer.*?<\\/style>/gm,\n          ''\n        )\n      );\n    },\n\n    // Add support for pasting GeoJSON in the future\n    _paste: function (e) {\n      let context =\n          e instanceof KeyboardEvent ? this._map.contextMenu : this.contextMenu,\n        mapEl =\n          e instanceof KeyboardEvent\n            ? this._map.options.mapEl\n            : this.options.mapEl;\n      navigator.clipboard.readText().then((layer) => {\n        M._pasteLayer(mapEl, layer);\n      });\n    },\n\n    _viewSource: function (e) {\n      let mapEl =\n        e instanceof KeyboardEvent ? this._map.options.mapEl : this.options.mapEl;\n      mapEl.viewSource();\n    },\n\n    _toggleDebug: function (e) {\n      let mapEl =\n        e instanceof KeyboardEvent ? this._map.options.mapEl : this.options.mapEl;\n      mapEl.toggleDebug();\n    },\n\n    _copyCoords: function (e) {\n      let directory = this.contextMenu ? this.contextMenu : this;\n      directory._showCopySubMenu(e);\n    },\n\n    _copyData: function (data) {\n      const el = document.createElement('textarea');\n      el.value = data;\n      document.body.appendChild(el);\n      el.select();\n      document.execCommand('copy');\n      document.body.removeChild(el);\n    },\n\n    _copyLocation: function (e) {\n      const menu = this.contextMenu;\n      switch (menu.defLocCS.toLowerCase()) {\n        case 'tile':\n          menu._copyTile.call(this, e);\n          break;\n        case 'tilematrix':\n          menu._copyTileMatrix.call(this, e);\n          break;\n        case 'map':\n          menu._copyMap.call(this, e);\n          break;\n        case 'tcrs':\n          menu._copyTCRS.call(this, e);\n          break;\n        case 'pcrs':\n          menu._copyPCRS.call(this, e);\n          break;\n        case 'gcrs':\n        default:\n          menu._copyGCRS.call(this, e);\n          break;\n      }\n    },\n\n    _copyGCRS: function (e) {\n      let mapEl = this.options.mapEl,\n        click = this.contextMenu._clickEvent,\n        projection = mapEl.projection,\n        feature = this.contextMenu.t.content.firstElementChild.cloneNode(true),\n        caption = feature.querySelector('map-featurecaption'),\n        h2 = feature.querySelector('h2'),\n        div = feature.querySelector('div'),\n        geom = feature.querySelector('map-geometry'),\n        coords = feature.querySelector('map-coordinates');\n\n      feature.setAttribute('zoom', mapEl.zoom);\n      geom.setAttribute('cs', 'gcrs');\n      caption.textContent = `Copied ${projection} gcrs location`;\n      h2.textContent = `Copied ${projection} gcrs location`;\n      div.textContent = `${click.latlng.lng.toFixed(\n      6\n    )} ${click.latlng.lat.toFixed(6)}`;\n      coords.textContent = `${click.latlng.lng.toFixed(\n      6\n    )} ${click.latlng.lat.toFixed(6)}`;\n      this.contextMenu._copyData(feature.outerHTML);\n    },\n\n    _copyTCRS: function (e) {\n      let mapEl = this.options.mapEl,\n        click = this.contextMenu._clickEvent,\n        point = mapEl._map.project(click.latlng),\n        pt = { x: point.x.toFixed(), y: point.y.toFixed() },\n        projection = mapEl.projection,\n        feature = this.contextMenu.t.content.firstElementChild.cloneNode(true),\n        caption = feature.querySelector('map-featurecaption'),\n        h2 = feature.querySelector('h2'),\n        div = feature.querySelector('div'),\n        geom = feature.querySelector('map-geometry'),\n        coords = feature.querySelector('map-coordinates');\n\n      feature.setAttribute('zoom', mapEl.zoom);\n      geom.setAttribute('cs', 'tcrs');\n      caption.textContent = `Copied ${projection} tcrs location`;\n      h2.textContent = `Copied ${projection} tcrs location`;\n      div.textContent = `${pt.x} ${pt.y}`;\n      coords.textContent = `${pt.x} ${pt.y}`;\n      this.contextMenu._copyData(feature.outerHTML);\n    },\n\n    _copyTileMatrix: function (e) {\n      let mapEl = this.options.mapEl,\n        click = this.contextMenu._clickEvent,\n        point = mapEl._map.project(click.latlng),\n        tileSize = mapEl._map.options.crs.options.crs.tile.bounds.max.x,\n        projection = mapEl.projection,\n        feature = this.contextMenu.t.content.firstElementChild.cloneNode(true),\n        caption = feature.querySelector('map-featurecaption'),\n        h2 = feature.querySelector('h2'),\n        div = feature.querySelector('div'),\n        geom = feature.querySelector('map-geometry'),\n        coords = feature.querySelector('map-coordinates');\n\n      feature.setAttribute('zoom', mapEl.zoom);\n      geom.setAttribute('cs', 'gcrs');\n      caption.textContent = `Copied ${projection} tilematrix location (not implemented yet)`;\n      h2.textContent = `Copied ${projection} tilematrix location (not implemented yet)`;\n      div.textContent = `${Math.trunc(point.x / tileSize)} ${Math.trunc(\n      point.y / tileSize\n    )}`;\n      coords.textContent = `${click.latlng.lng.toFixed(\n      6\n    )} ${click.latlng.lat.toFixed(6)}`;\n      this.contextMenu._copyData(feature.outerHTML);\n    },\n\n    _copyPCRS: function (e) {\n      let mapEl = this.options.mapEl,\n        click = this.contextMenu._clickEvent,\n        point = mapEl._map.project(click.latlng),\n        scale = mapEl._map.options.crs.scale(+mapEl.zoom),\n        pcrs = mapEl._map.options.crs.transformation\n          .untransform(point, scale)\n          .round(),\n        projection = mapEl.projection,\n        feature = this.contextMenu.t.content.firstElementChild.cloneNode(true),\n        caption = feature.querySelector('map-featurecaption'),\n        h2 = feature.querySelector('h2'),\n        div = feature.querySelector('div'),\n        geom = feature.querySelector('map-geometry'),\n        coords = feature.querySelector('map-coordinates');\n\n      feature.setAttribute('zoom', mapEl.zoom);\n      geom.setAttribute('cs', 'pcrs');\n      caption.textContent = `Copied ${projection} pcrs location`;\n      h2.textContent = `Copied ${projection} pcrs location`;\n      div.textContent = `${pcrs.x} ${pcrs.y}`;\n      coords.textContent = `${pcrs.x} ${pcrs.y}`;\n      this.contextMenu._copyData(feature.outerHTML);\n    },\n\n    _copyTile: function (e) {\n      let mapEl = this.options.mapEl,\n        click = this.contextMenu._clickEvent,\n        // the _map.project method returns pixels, while the _map.crs.project\n        // method returns meters, confusingly:\n        // https://leafletjs.com/reference.html#map-project\n        // https://leafletjs.com/reference.html#crs-project\n        point = mapEl._map.project(click.latlng),\n        tileSize = mapEl._map.options.crs.options.crs.tile.bounds.max.x,\n        pointX = point.x % tileSize,\n        pointY = point.y % tileSize,\n        pt = L.point(pointX, pointY).trunc(),\n        projection = mapEl.projection,\n        feature = this.contextMenu.t.content.firstElementChild.cloneNode(true),\n        caption = feature.querySelector('map-featurecaption'),\n        h2 = feature.querySelector('h2'),\n        div = feature.querySelector('div'),\n        geom = feature.querySelector('map-geometry'),\n        coords = feature.querySelector('map-coordinates');\n\n      if (pt.x < 0) pt.x += tileSize;\n      if (pt.y < 0) pt.y += tileSize;\n\n      feature.setAttribute('zoom', mapEl.zoom);\n      geom.setAttribute('cs', 'gcrs');\n      caption.textContent = `Copied ${projection} tile location (not implemented yet)`;\n      h2.textContent = `Copied ${projection} tile location (not implemented yet)`;\n      div.textContent = `${pt.x} ${pt.y}`;\n      coords.textContent = `${click.latlng.lng.toFixed(\n      6\n    )} ${click.latlng.lat.toFixed(6)}`;\n      this.contextMenu._copyData(feature.outerHTML);\n    },\n\n    _copyMap: function (e) {\n      let mapEl = this.options.mapEl,\n        click = this.contextMenu._clickEvent,\n        mapPt = click.containerPoint.trunc(),\n        projection = mapEl.projection,\n        feature = this.contextMenu.t.content.firstElementChild.cloneNode(true),\n        caption = feature.querySelector('map-featurecaption'),\n        h2 = feature.querySelector('h2'),\n        div = feature.querySelector('div'),\n        geom = feature.querySelector('map-geometry'),\n        coords = feature.querySelector('map-coordinates');\n\n      feature.setAttribute('zoom', mapEl.zoom);\n      geom.setAttribute('cs', 'gcrs');\n      caption.textContent = `Copied ${projection} map location (not implemented yet)`;\n      h2.textContent = `Copied ${projection} map location (not implemented yet)`;\n      div.textContent = `${mapPt.x} ${mapPt.y}`;\n      coords.textContent = `${click.latlng.lng.toFixed(\n      6\n    )} ${click.latlng.lat.toFixed(6)}`;\n      this.contextMenu._copyData(feature.outerHTML);\n    },\n\n    _copyAllCoords: function (e) {\n      let mapEl = this.options.mapEl,\n        click = this.contextMenu._clickEvent,\n        point = mapEl._map.project(click.latlng),\n        tileSize = mapEl._map.options.crs.options.crs.tile.bounds.max.x,\n        pointX = point.x % tileSize,\n        pointY = point.y % tileSize,\n        scale = mapEl._map.options.crs.scale(+mapEl.zoom),\n        pcrs = mapEl._map.options.crs.transformation.untransform(point, scale);\n      let allData = `z:${mapEl.zoom}\\n`;\n      allData += `tile: i:${Math.trunc(pointX)}, j:${Math.trunc(pointY)}\\n`;\n      allData += `tilematrix: column:${Math.trunc(\n      point.x / tileSize\n    )}, row:${Math.trunc(point.y / tileSize)}\\n`;\n      allData += `map: i:${Math.trunc(click.containerPoint.x)}, j:${Math.trunc(\n      click.containerPoint.y\n    )}\\n`;\n      allData += `tcrs: x:${Math.trunc(point.x)}, y:${Math.trunc(point.y)}\\n`;\n      allData += `pcrs: easting:${pcrs.x.toFixed(2)}, northing:${pcrs.y.toFixed(\n      2\n    )}\\n`;\n      allData += `gcrs: lon :${click.latlng.lng.toFixed(\n      6\n    )}, lat:${click.latlng.lat.toFixed(6)}`;\n      this.contextMenu._copyData(allData);\n    },\n\n    _createItem: function (container, options, index) {\n      if (options.spacer) {\n        return this._createSeparator(container, index);\n      }\n\n      var itemCls = 'mapml-contextmenu-item',\n        el = this._insertElementAt('button', itemCls, container, index),\n        callback = this._createEventHandler(\n          el,\n          options.callback,\n          options.context,\n          options.hideOnSelect\n        ),\n        html = '';\n\n      el.innerHTML = html + options.text;\n      el.setAttribute('type', 'button');\n      el.classList.add('mapml-button');\n      if (options.popup) {\n        el.setAttribute('aria-haspopup', 'true');\n        el.setAttribute('aria-expanded', 'false');\n        el.setAttribute('aria-controls', 'mapml-copy-submenu');\n      }\n\n      L.DomEvent.on(el, 'mouseover', this._onItemMouseOver, this)\n        .on(el, 'mouseout', this._onItemMouseOut, this)\n        .on(el, 'mousedown', L.DomEvent.stopPropagation)\n        .on(el, 'click', callback);\n\n      if (L.Browser.touch) {\n        L.DomEvent.on(el, this._touchstart, L.DomEvent.stopPropagation);\n      }\n\n      // Devices without a mouse fire \"mouseover\" on tap, but never mouseout\"\n      if (!L.Browser.pointer) {\n        L.DomEvent.on(el, 'click', this._onItemMouseOut, this);\n      }\n\n      return {\n        id: L.Util.stamp(el),\n        el: el,\n        callback: callback\n      };\n    },\n\n    _createSeparator: function (container, index) {\n      let el = this._insertElementAt(\n        'div',\n        'mapml-contextmenu-separator',\n        container,\n        index\n      );\n\n      return {\n        id: L.Util.stamp(el),\n        el: el\n      };\n    },\n\n    _createEventHandler: function (el, func, context, hideOnSelect) {\n      let parent = this;\n\n      hideOnSelect = hideOnSelect !== undefined ? hideOnSelect : true;\n\n      return function (e) {\n        let map = parent._map,\n          containerPoint = parent._showLocation.containerPoint,\n          layerPoint = map.containerPointToLayerPoint(containerPoint),\n          latlng = map.layerPointToLatLng(layerPoint),\n          relatedTarget = parent._showLocation.relatedTarget,\n          data = {\n            containerPoint: containerPoint,\n            layerPoint: layerPoint,\n            latlng: latlng,\n            relatedTarget: relatedTarget\n          };\n\n        if (hideOnSelect) {\n          parent._hide();\n        }\n\n        if (func) {\n          func.call(context || map, data);\n        }\n\n        parent._map.fire('contextmenu.select', {\n          contextmenu: parent,\n          el: el\n        });\n      };\n    },\n\n    _insertElementAt: function (tagName, className, container, index) {\n      let refEl,\n        el = document.createElement(tagName);\n\n      el.className = className;\n\n      if (index !== undefined) {\n        refEl = container.children[index];\n      }\n\n      if (refEl) {\n        container.insertBefore(el, refEl);\n      } else {\n        container.appendChild(el);\n      }\n\n      return el;\n    },\n\n    _show: function (e) {\n      // don't show a context menu for features\n      if (e.originalEvent.target.closest('.mapml-vector-container')) return;\n      if (this._mapMenuVisible) this._hide();\n      this._clickEvent = e;\n      let elem = e.originalEvent.target;\n      // Opening contextmenu for layercontrol\n      if (elem.closest('fieldset')) {\n        elem = elem.closest('fieldset');\n        // layer layercontrol\n        if (elem.className === 'mapml-layer-item') {\n          elem = elem.querySelector('span');\n          this._layerMenu.removeAttribute('hidden');\n          this._showAtPoint(e.containerPoint, e, this._layerMenu);\n          // map-extent layercontrol\n        } else if (elem.className === 'mapml-layer-extent') {\n          elem = elem.querySelector('span');\n          this._extentLayerMenu.removeAttribute('hidden');\n          this._showAtPoint(e.containerPoint, e, this._extentLayerMenu);\n        }\n        this._layerClicked = elem;\n      } else if (\n        // map contextmenu\n        elem.classList.contains('leaflet-container') ||\n        elem.classList.contains('mapml-debug-extent') ||\n        elem.tagName === 'path'\n      ) {\n        let layerList = this._map.options.mapEl.layers;\n        this._layerClicked = Array.from(layerList).find((el) => el.checked);\n        // the 'hidden' attribute must be removed before any attempt to get the size of container\n        let pt = e.containerPoint;\n        // this is for firefox, which reports the e.containerPoint as x=0 when you\n        // use a keyboard Shift+F10 to display the context menu; this appears\n        // to be because blink returns a PointerEvent of type==='contextmenu',\n        // while gecko returns an object (for e.originalEvent).\n        if (L.Browser.gecko) {\n          const getCenter = function (el) {\n            let w = el.getBoundingClientRect().width;\n            let h = el.getBoundingClientRect().height;\n            return { x: Number.parseInt(w / 2), y: Number.parseInt(h / 2) };\n          };\n          pt = getCenter(this._map.getContainer());\n        }\n        this._container.removeAttribute('hidden');\n        this._showAtPoint(pt, e, this._container);\n        this._updateCS();\n      }\n      // Once contextmenu is opened, focus the first item\n      if (e.originalEvent.button === 0 || e.originalEvent.button === -1) {\n        this._keyboardEvent = true;\n        if (this._layerClicked.className.includes('mapml-layer-item')) {\n          let activeEl = document.activeElement;\n          this._elementInFocus = activeEl.shadowRoot.activeElement;\n          this._layerMenuTabs = 1;\n          this._layerMenu.firstChild.focus();\n          //\n        } else if (this._layerClicked.className.includes('mapml-extent-item')) {\n          let activeEl = document.activeElement;\n          this._elementInFocus = activeEl.shadowRoot.activeElement;\n          this._extentLayerMenuTabs = 1;\n          this._extentLayerMenu.firstChild.focus();\n        } else {\n          this._container.querySelectorAll('button:not([disabled])')[0].focus();\n        }\n      }\n    },\n\n    _showAtPoint: function (pt, data, container) {\n      if (this._items.length) {\n        let event = L.extend(data || {}, { contextmenu: this });\n\n        this._showLocation = {\n          containerPoint: pt\n        };\n\n        if (data && data.relatedTarget) {\n          this._showLocation.relatedTarget = data.relatedTarget;\n        }\n\n        this._setPosition(pt, container);\n\n        if (!this._mapMenuVisible) {\n          container.removeAttribute('hidden');\n          this._mapMenuVisible = true;\n        }\n\n        this._map.fire('contextmenu.show', event);\n      }\n    },\n\n    _hide: function () {\n      if (this._mapMenuVisible) {\n        this._mapMenuVisible = false;\n        this._container.setAttribute('hidden', '');\n        this._copySubMenu.setAttribute('hidden', '');\n        this._layerMenu.setAttribute('hidden', '');\n        this._extentLayerMenu.setAttribute('hidden', '');\n        this._map.fire('contextmenu.hide', { contextmenu: this });\n        setTimeout(() => this._map._container.focus(), 0);\n        this.activeIndex = 0;\n        this.isRunned = false;\n      }\n    },\n\n    _setPosition: function (pt, container) {\n      let mapSize = this._map.getSize(),\n        containerSize = this._getElementSize(container),\n        anchor;\n\n      if (this._map.options.contextmenuAnchor) {\n        anchor = L.point(this._map.options.contextmenuAnchor);\n        pt = pt.add(anchor);\n      }\n\n      container._leaflet_pos = pt;\n\n      if (pt.x + containerSize.x > mapSize.x) {\n        container.style.left = 'auto';\n        container.style.right =\n          Math.min(\n            Math.max(mapSize.x - pt.x, 0),\n            mapSize.x - containerSize.x - 1\n          ) + 'px';\n      } else {\n        container.style.left = Math.max(pt.x, 0) + 'px';\n        container.style.right = 'auto';\n      }\n\n      if (pt.y + containerSize.y > mapSize.y) {\n        container.style.top = 'auto';\n        container.style.bottom =\n          Math.min(\n            Math.max(mapSize.y - pt.y, 0),\n            mapSize.y - containerSize.y - 1\n          ) + 'px';\n      } else {\n        container.style.top = Math.max(pt.y, 0) + 'px';\n        container.style.bottom = 'auto';\n      }\n    },\n\n    _getElementSize: function (el) {\n      let size = this._size;\n\n      if (!size || this._sizeChanged) {\n        size = {};\n\n        el.style.left = '-999999px';\n        el.style.right = 'auto';\n\n        size.x = el.offsetWidth;\n        size.y = el.offsetHeight;\n\n        el.style.left = 'auto';\n\n        this._sizeChanged = false;\n      }\n\n      return size;\n    },\n\n    // once Esc is clicked on the layer/extent contextMenu, change the focus back to the layer control\n    _focusOnLayerControl: function () {\n      this._mapMenuVisible = false;\n      delete this._layerMenuTabs;\n      delete this._extentLayerMenuTabs;\n      this._layerMenu.setAttribute('hidden', '');\n      this._extentLayerMenu.setAttribute('hidden', '');\n      if (this._elementInFocus) {\n        this._elementInFocus.focus();\n      } else {\n        this._layerClicked.parentElement.firstChild.focus();\n      }\n      delete this._elementInFocus;\n    },\n\n    _setActiveItem: function (index) {\n      if (\n        document.activeElement.shadowRoot === null &&\n        this.noActiveEl === true\n      ) {\n        //bug fix when theres no active element\n        this.noActiveEl = false;\n        //setting this._items[9] is just for preventing some diabled index, it will be override by later code.\n        this._items[9].el.el.focus();\n      }\n      if (\n        document.activeElement.shadowRoot.activeElement.innerHTML ===\n        this._items[index].el.el.innerHTML\n      ) {\n        //edge case where pressing shift f10 focuses the first element on contextmenu (if already focused, have to press arrow twice to go down)\n        let next = index + 1;\n        while (this._items[next].el.el.disabled) {\n          next++;\n          if (next >= this._items.length) {\n            next = 0;\n          }\n        }\n        this._setActiveItem(next);\n      } else {\n        if (this.excludedIndices.includes(index)) {\n          // find the next or previous non-excluded item\n          let nextIndex = index + 1;\n          let prevIndex = index - 1;\n          while (\n            this.excludedIndices.includes(nextIndex) ||\n            this._items[nextIndex].el.el.disabled\n          ) {\n            nextIndex++;\n            if (nextIndex >= this._items.length) {\n              nextIndex = 0;\n            }\n          }\n          while (\n            this.excludedIndices.includes(prevIndex) ||\n            this._items[prevIndex].el.el.disabled\n          ) {\n            prevIndex--;\n            if (prevIndex < 0) {\n              prevIndex = this._items.length - 1;\n            }\n          }\n          // set the active item to the next or previous non-excluded item\n          if (this.activeIndex < index) {\n            this._setActiveItem(nextIndex);\n          } else {\n            this._setActiveItem(prevIndex);\n          }\n        } else {\n          // set the focus item\n          this._items[index].el.el.focus();\n          this.activeIndex = index;\n        }\n      }\n    },\n\n    _onKeyDown: function (e) {\n      if (!this._mapMenuVisible || e.key === 'Shift') return;\n\n      if (e.code === 'Enter' || e.code === 'Tab' || e.code.startsWith('Arrow'))\n        e.preventDefault();\n\n      if (e.code === 'ArrowUp' || (e.shiftKey && e.code === 'Tab')) {\n        if (\n          !this._copySubMenu.hasAttribute('hidden') &&\n          (document.activeElement.shadowRoot === null || //null happens when the focus is on submenu and when mouse hovers on main menu, submenu disappears\n            document.activeElement.shadowRoot.activeElement.innerHTML ===\n              this._copySubMenu.children[this._menuItems.CPYMENUMAP].innerHTML)\n        ) {\n          //\"map\" on submenu\n          this._copySubMenu.children[this._menuItems.CPYMENULOC].focus();\n        } else if (\n          !this._copySubMenu.hasAttribute('hidden') &&\n          document.activeElement.shadowRoot.activeElement.innerHTML ===\n            this._copySubMenu.children[this._menuItems.CPYMENUEXTENT].innerHTML\n        ) {\n          //\"extent\" on submenu\n          this._copySubMenu.children[this._menuItems.CPYMENUMAP].focus();\n        } else if (\n          !this._copySubMenu.hasAttribute('hidden') &&\n          document.activeElement.shadowRoot.activeElement.innerHTML ===\n            this._copySubMenu.children[this._menuItems.CPYMENULOC].innerHTML\n        ) {\n          //\"Location\" on submenu\n          this._copySubMenu.children[this._menuItems.CPYMENUEXTENT].focus();\n        } else if (\n          !this._layerMenu.hasAttribute('hidden') &&\n          document.activeElement.shadowRoot.activeElement.innerHTML ===\n            this._layerMenu.children[this._menuItems.LYRZOOMTO].innerHTML\n        ) {\n          //\"zoom to layer\" on layermenu\n          this._layerMenu.children[this._menuItems.LYRCOPY].focus();\n        } else if (!this._layerMenu.hasAttribute('hidden')) {\n          this._layerMenu.children[this._menuItems.LYRZOOMTO].focus();\n        } else if (\n          !this._extentLayerMenu.hasAttribute('hidden') &&\n          document.activeElement.shadowRoot.activeElement.innerHTML ===\n            this._extentLayerMenu.children[this._menuItems.LYRZOOMTO].innerHTML\n        ) {\n          //\"zoom to extent\" on layermenu\n          this._extentLayerMenu.children[this._menuItems.LYRCOPY].focus();\n        } else if (!this._extentLayerMenu.hasAttribute('hidden')) {\n          this._extentLayerMenu.children[this._menuItems.LYRZOOMTO].focus();\n        } else {\n          if (this.activeIndex > 0) {\n            let prevIndex = this.activeIndex - 1;\n            while (this._items[prevIndex].el.el.disabled) {\n              prevIndex--;\n              if (prevIndex < 0) {\n                prevIndex = this._items.length - 1;\n              }\n            }\n            this._setActiveItem(prevIndex);\n          } else {\n            this._setActiveItem(this._items.length - 1);\n          }\n        }\n      } else if (e.code === 'ArrowDown' || e.code === 'Tab') {\n        if (\n          !this._copySubMenu.hasAttribute('hidden') &&\n          (document.activeElement.shadowRoot === null ||\n            document.activeElement.shadowRoot.activeElement.innerHTML ===\n              this._copySubMenu.children[this._menuItems.CPYMENULOC].innerHTML)\n        ) {\n          this._copySubMenu.children[this._menuItems.CPYMENUMAP].focus();\n        } else if (\n          !this._copySubMenu.hasAttribute('hidden') &&\n          document.activeElement.shadowRoot.activeElement.innerHTML ===\n            this._copySubMenu.children[this._menuItems.CPYMENUEXTENT].innerHTML\n        ) {\n          this._copySubMenu.children[this._menuItems.CPYMENULOC].focus();\n        } else if (\n          !this._copySubMenu.hasAttribute('hidden') &&\n          document.activeElement.shadowRoot.activeElement.innerHTML ===\n            this._copySubMenu.children[this._menuItems.CPYMENUMAP].innerHTML\n        ) {\n          this._copySubMenu.children[this._menuItems.CPYMENUEXTENT].focus();\n        } else if (\n          !this._layerMenu.hasAttribute('hidden') &&\n          document.activeElement.shadowRoot.activeElement.innerHTML ===\n            this._layerMenu.children[this._menuItems.LYRZOOMTO].innerHTML\n        ) {\n          this._layerMenu.children[this._menuItems.LYRCOPY].focus();\n        } else if (!this._layerMenu.hasAttribute('hidden')) {\n          this._layerMenu.children[this._menuItems.LYRZOOMTO].focus();\n        } else if (\n          !this._extentLayerMenu.hasAttribute('hidden') &&\n          document.activeElement.shadowRoot.activeElement.innerHTML ===\n            this._extentLayerMenu.children[this._menuItems.LYRZOOMTO].innerHTML\n        ) {\n          this._extentLayerMenu.children[this._menuItems.LYRCOPY].focus();\n        } else if (!this._extentLayerMenu.hasAttribute('hidden')) {\n          this._extentLayerMenu.children[this._menuItems.LYRZOOMTO].focus();\n        } else {\n          if (this.activeIndex < this._items.length - 1) {\n            //edge case at index 0\n            if (\n              !this.isRunned &&\n              this.activeIndex === 0 &&\n              !this._items[this.activeIndex].el.el.disabled\n            ) {\n              this._setActiveItem(0);\n              this.isRunned = true;\n            } else {\n              //edge case over\n              let nextIndex = this.activeIndex + 1;\n              while (this._items[nextIndex].el.el.disabled) {\n                nextIndex++;\n                if (nextIndex >= this._items.length) {\n                  nextIndex = 0;\n                }\n              }\n              this._setActiveItem(nextIndex);\n            }\n          } else {\n            let nextIndex = 0;\n            while (this._items[nextIndex].el.el.disabled) {\n              nextIndex++;\n              if (nextIndex >= this._items.length) {\n                nextIndex = 0;\n              }\n            }\n            this._setActiveItem(nextIndex);\n          }\n        }\n      } else if (e.code === 'ArrowRight') {\n        if (\n          document.activeElement.shadowRoot !== null &&\n          document.activeElement.shadowRoot.activeElement.innerHTML ===\n            this._items[this._menuItems.CTXCOPY].el.el.innerHTML && //'copy'\n          this._copySubMenu.hasAttribute('hidden')\n        ) {\n          this._showCopySubMenu();\n          this._copySubMenu.children[0].focus();\n        } else if (\n          document.activeElement.shadowRoot.activeElement.innerHTML ===\n            this._items[this._menuItems.CTXCOPY].el.el.innerHTML &&\n          !this._copySubMenu.hasAttribute('hidden')\n        ) {\n          this._copySubMenu.children[0].focus();\n        }\n      } else if (e.code === 'ArrowLeft') {\n        if (\n          !this._copySubMenu.hasAttribute('hidden') &&\n          document.activeElement.shadowRoot !== null\n        ) {\n          if (\n            document.activeElement.shadowRoot.activeElement.innerHTML ===\n              this._copySubMenu.children[this._menuItems.CPYMENUMAP].innerHTML ||\n            document.activeElement.shadowRoot.activeElement.innerHTML ===\n              this._copySubMenu.children[this._menuItems.CPYMENUEXTENT]\n                .innerHTML ||\n            document.activeElement.shadowRoot.activeElement.innerHTML ===\n              this._copySubMenu.children[this._menuItems.CPYMENULOC].innerHTML\n          ) {\n            this._copySubMenu.setAttribute('hidden', '');\n            this._setActiveItem(this._menuItems.CTXCOPY);\n          }\n        }\n      } else if (e.code === 'Escape') {\n        if (this._layerMenuTabs || this._extentLayerMenuTabs) {\n          L.DomEvent.stop(e);\n          this._focusOnLayerControl();\n          return;\n        }\n        if (document.activeElement.shadowRoot === null) {\n          this._hide();\n        } else {\n          if (!this._copySubMenu.hasAttribute('hidden')) {\n            if (\n              document.activeElement.shadowRoot.activeElement.innerHTML ===\n                this._copySubMenu.children[this._menuItems.CPYMENUMAP]\n                  .innerHTML ||\n              document.activeElement.shadowRoot.activeElement.innerHTML ===\n                this._copySubMenu.children[this._menuItems.CPYMENUEXTENT]\n                  .innerHTML ||\n              document.activeElement.shadowRoot.activeElement.innerHTML ===\n                this._copySubMenu.children[this._menuItems.CPYMENULOC].innerHTML\n            ) {\n              this._copySubMenu.setAttribute('hidden', '');\n              this._setActiveItem(this._menuItems.CTXCOPY);\n            }\n          } else {\n            this._hide();\n          }\n        }\n      } else if (\n        e.code !== 'KeyC' &&\n        document.activeElement.shadowRoot.activeElement.innerHTML !==\n          this._items[this._menuItems.CTXCOPY].el.el.innerHTML\n      ) {\n        this._hide();\n      }\n      // using KeyboardEvent.code for its mnemonics and case-independence\n      switch (e.code) {\n        case 'Enter':\n          if (\n            document.activeElement.shadowRoot.activeElement.innerHTML ===\n            this._items[this._menuItems.CTXCOPY].el.el.innerHTML\n          ) {\n            this._copyCoords({\n              latlng: this._map.getCenter()\n            });\n            this._copySubMenu.firstChild.focus();\n          } else {\n            if (\n              this._map._container.parentNode.activeElement.parentNode.classList.contains(\n                'mapml-contextmenu'\n              )\n            )\n              this._map._container.parentNode.activeElement.click();\n          }\n          break;\n        case 'Space':\n          if (\n            this._map._container.parentNode.activeElement.parentNode.classList.contains(\n              'mapml-contextmenu'\n            )\n          )\n            this._map._container.parentNode.activeElement.click();\n          break;\n        case 'KeyC':\n          this._copyCoords({\n            latlng: this._map.getCenter()\n          });\n          this._copySubMenu.firstChild.focus();\n          break;\n        case 'KeyD':\n          this._toggleDebug(e);\n          break;\n        case 'KeyM':\n          this._copyMapML(e);\n          break;\n        case 'KeyL':\n          if (this._layerClicked.className.includes('mapml-layer-item')) {\n            this._copyLayer(e);\n          } else if (this._layerClicked.className.includes('mapml-extent-item')) {\n            this._copyMapExtent(e);\n          }\n          break;\n        case 'KeyF':\n          this._toggleFullScreen(e);\n          break;\n        case 'KeyP':\n          this._paste(e);\n          break;\n        case 'KeyT':\n          this._toggleControls(e);\n          break;\n        case 'KeyV':\n          this._viewSource(e);\n          break;\n        case 'KeyZ':\n          if (this._layerClicked.className.includes('mapml-layer-item')) {\n            this._zoomToLayer(e);\n          } else if (this._layerClicked.className.includes('mapml-extent-item')) {\n            this._zoomToMapExtent(e);\n          }\n          break;\n      }\n    },\n\n    _showCopySubMenu: function (e) {\n      let mapSize = this._map.getSize(),\n        click = this._clickEvent,\n        menu = this._copySubMenu,\n        copyEl = this._items[5].el.el;\n\n      copyEl.setAttribute('aria-expanded', 'true');\n      menu.removeAttribute('hidden');\n\n      const menuWidth = this._container.offsetWidth,\n        menuHeight = this._container.offsetHeight,\n        submenuWidth = menu.offsetWidth;\n      if (click.containerPoint.x + menuWidth + submenuWidth > mapSize.x) {\n        menu.style.left = 'auto';\n        menu.style.right = menuWidth + 'px';\n      } else {\n        menu.style.left = menuWidth + 'px';\n        menu.style.right = 'auto';\n      }\n\n      menu.style.top = 100 - 22 + 'px';\n      menu.style.bottom = 'auto';\n    },\n\n    _hideCopySubMenu: function (e) {\n      if (\n        !e.relatedTarget ||\n        !e.relatedTarget.parentElement ||\n        e.relatedTarget.parentElement.classList.contains('mapml-submenu') ||\n        e.relatedTarget.classList.contains('mapml-submenu')\n      )\n        return;\n      let menu = this._copySubMenu,\n        copyEl = this._items[4].el.el;\n      copyEl.setAttribute('aria-expanded', 'false');\n      menu.setAttribute('hidden', '');\n      this.noActiveEl = true; //variable to keep track of no focus element on contextmenu, bug fix for arrow key navigation\n    },\n\n    _onItemMouseOver: function (e) {\n      L.DomUtil.addClass(e.target || e.srcElement, 'over');\n      if (e.srcElement.innerText === M.options.locale.cmCopyCoords + ' (C)')\n        this._showCopySubMenu(e);\n    },\n\n    _onItemMouseOut: function (e) {\n      L.DomUtil.removeClass(e.target || e.srcElement, 'over');\n      this._hideCopySubMenu(e);\n    },\n\n    toggleContextMenuItem: function (options, state) {\n      options = options.toUpperCase();\n      if (state === 'disabled') {\n        if (options === 'CONTROLS') {\n          this._items[8].el.el.disabled = true;\n        } else if (options === 'BACK') {\n          this._items[0].el.el.disabled = true;\n        } else if (options === 'FORWARD') {\n          this._items[1].el.el.disabled = true;\n        } else if (options === 'RELOAD') {\n          this._items[2].el.el.disabled = true;\n        }\n      } else if (state === 'enabled') {\n        if (options === 'CONTROLS') {\n          this._items[8].el.el.disabled = false;\n        } else if (options === 'BACK') {\n          this._items[0].el.el.disabled = false;\n        } else if (options === 'FORWARD') {\n          this._items[1].el.el.disabled = false;\n        } else if (options === 'RELOAD') {\n          this._items[2].el.el.disabled = false;\n        }\n      }\n    },\n\n    setViewFullScreenInnerHTML: function (options) {\n      if (options === 'view') {\n        this._map.contextMenu._items[3].el.el.innerHTML =\n          M.options.locale.btnFullScreen + ' (<kbd>F</kbd>)';\n      } else if (options === 'exit') {\n        this._map.contextMenu._items[3].el.el.innerHTML =\n          M.options.locale.btnExitFullScreen + ' (<kbd>F</kbd>)';\n      }\n    }\n  });\n\n  var Util = {\n    // _convertAndFormatPCRS returns the converted CRS and formatted pcrsBounds in gcrs, pcrs, tcrs, and tilematrix. Used for setting extent for the map and layer (map.extent, layer.extent).\n    // _convertAndFormatPCRS: L.Bounds, _map, projection -> {...}\n    _convertAndFormatPCRS: function (pcrsBounds, crs, projection) {\n      if (!pcrsBounds || !crs) return {};\n\n      let tcrsTopLeft = [],\n        tcrsBottomRight = [],\n        tileMatrixTopLeft = [],\n        tileMatrixBottomRight = [],\n        tileSize = crs.options.crs.tile.bounds.max.y;\n\n      for (let i = 0; i < crs.options.resolutions.length; i++) {\n        let scale = crs.scale(i),\n          minConverted = crs.transformation.transform(pcrsBounds.min, scale),\n          maxConverted = crs.transformation.transform(pcrsBounds.max, scale);\n\n        tcrsTopLeft.push({\n          horizontal: minConverted.x,\n          vertical: maxConverted.y\n        });\n        tcrsBottomRight.push({\n          horizontal: maxConverted.x,\n          vertical: minConverted.y\n        });\n\n        //converts the tcrs values from earlier to tilematrix\n        tileMatrixTopLeft.push({\n          horizontal: tcrsTopLeft[i].horizontal / tileSize,\n          vertical: tcrsTopLeft[i].vertical / tileSize\n        });\n        tileMatrixBottomRight.push({\n          horizontal: tcrsBottomRight[i].horizontal / tileSize,\n          vertical: tcrsBottomRight[i].vertical / tileSize\n        });\n      }\n\n      //converts the gcrs, I believe it can take any number values from -inf to +inf\n      let unprojectedMin = crs.unproject(pcrsBounds.min),\n        unprojectedMax = crs.unproject(pcrsBounds.max);\n\n      let gcrs = {\n        topLeft: {\n          horizontal: unprojectedMin.lng,\n          vertical: unprojectedMax.lat\n        },\n        bottomRight: {\n          horizontal: unprojectedMax.lng,\n          vertical: unprojectedMin.lat\n        }\n      };\n\n      //formats known pcrs bounds to correct format\n      let pcrs = {\n        topLeft: {\n          horizontal: pcrsBounds.min.x,\n          vertical: pcrsBounds.max.y\n        },\n        bottomRight: {\n          horizontal: pcrsBounds.max.x,\n          vertical: pcrsBounds.min.y\n        }\n      };\n\n      //formats all extent data\n      let extent = {\n        topLeft: {\n          tcrs: tcrsTopLeft,\n          tilematrix: tileMatrixTopLeft,\n          gcrs: gcrs.topLeft,\n          pcrs: pcrs.topLeft\n        },\n        bottomRight: {\n          tcrs: tcrsBottomRight,\n          tilematrix: tileMatrixBottomRight,\n          gcrs: gcrs.bottomRight,\n          pcrs: pcrs.bottomRight\n        }\n      };\n      if (projection) {\n        extent.projection = projection;\n      }\n      return extent;\n    },\n    // extentToBounds: returns bounds in gcrs, pcrs. Used for setting bounds for the map (map.totalLayerBounds).\n    // extentToBounds: {...}, crs -> L.Bounds / L.LatlngBounds\n    extentToBounds(extent, crs) {\n      switch (crs.toUpperCase()) {\n        case 'PCRS':\n          return L.bounds(\n            L.point(extent.topLeft.pcrs.horizontal, extent.topLeft.pcrs.vertical),\n            L.point(\n              extent.bottomRight.pcrs.horizontal,\n              extent.bottomRight.pcrs.vertical\n            )\n          );\n        case 'GCRS':\n          return L.latLngBounds(\n            L.latLng(\n              extent.topLeft.gcrs.vertical,\n              extent.topLeft.gcrs.horizontal\n            ),\n            L.latLng(\n              extent.bottomRight.gcrs.vertical,\n              extent.bottomRight.gcrs.horizontal\n            )\n          );\n      }\n    },\n\n    // axisToCS returns the CRS when given the axis:\n    // https://maps4html.org/web-map-doc/docs/elements/input/#axis\n    // axisToCS: (Axis String) -> (CRS String)\n    axisToCS: function (axis) {\n      try {\n        switch (axis.toLowerCase()) {\n          case 'row':\n          case 'column':\n            return 'TILEMATRIX';\n          case 'i':\n          case 'j':\n            return ['MAP', 'TILE'];\n          case 'x':\n          case 'y':\n            return 'TCRS';\n          case 'latitude':\n          case 'longitude':\n            return 'GCRS';\n          case 'northing':\n          case 'easting':\n            return 'PCRS';\n          default:\n            return M.FALLBACK_CS;\n        }\n      } catch (e) {\n        return undefined;\n      }\n    },\n\n    // csToAxes takes a given cs and retuns the axes, first horizontal then vertical\n    // https://maps4html.org/web-map-doc/docs/elements/input/#axis\n    // csToAxes: (CRS String) -> [(horizontal axis String), (Vertical axis String)]\n    csToAxes: function (cs) {\n      try {\n        switch (cs.toLowerCase()) {\n          case 'tilematrix':\n            return ['column', 'row'];\n          case 'map':\n          case 'tile':\n            return ['i', 'j'];\n          case 'tcrs':\n            return ['x', 'y'];\n          case 'gcrs':\n            return ['longitude', 'latitude'];\n          case 'pcrs':\n            return ['easting', 'northing'];\n        }\n      } catch (e) {\n        return undefined;\n      }\n    },\n\n    // axisToXY takes horizontal axis and returns 'x', or takes vertical axis and returns 'y'\n    // https://maps4html.org/web-map-doc/docs/elements/input/#axis\n    // axisToXY: (Axis String) -> 'x' or 'y'\n    axisToXY: function (axis) {\n      try {\n        switch (axis.toLowerCase()) {\n          case 'i':\n          case 'column':\n          case 'longitude':\n          case 'x':\n          case 'easting':\n            return 'x';\n          case 'row':\n          case 'j':\n          case 'latitude':\n          case 'y':\n          case 'northing':\n            return 'y';\n\n          default:\n            return undefined;\n        }\n      } catch (e) {\n        return undefined;\n      }\n    },\n\n    // convertPCRSBounds converts pcrsBounds to the given cs Bounds.\n    // convertPCRSBounds: L.Bounds, Int, L.CRS, Str('PCRS'|'TCRS'|'TILEMATRIX'|'GCRS') -> L.Bounds\n    convertPCRSBounds: function (pcrsBounds, zoom, projection, cs) {\n      if (\n        !pcrsBounds ||\n        (!zoom && zoom !== 0) ||\n        !Number.isFinite(+zoom) ||\n        !projection ||\n        !cs\n      )\n        return undefined;\n      projection = typeof projection === 'string' ? M[projection] : projection;\n      switch (cs.toUpperCase()) {\n        case 'PCRS':\n          return pcrsBounds;\n        case 'TCRS':\n        case 'TILEMATRIX':\n          let minPixel = projection.transformation.transform(\n              pcrsBounds.min,\n              projection.scale(+zoom)\n            ),\n            maxPixel = projection.transformation.transform(\n              pcrsBounds.max,\n              projection.scale(+zoom)\n            );\n          if (cs.toUpperCase() === 'TCRS') return L.bounds(minPixel, maxPixel);\n          let tileSize = projection.options.crs.tile.bounds.max.x;\n          return L.bounds(\n            L.point(minPixel.x / tileSize, minPixel.y / tileSize),\n            L.point(maxPixel.x / tileSize, maxPixel.y / tileSize)\n          );\n        case 'GCRS':\n          let minGCRS = projection.unproject(pcrsBounds.min),\n            maxGCRS = projection.unproject(pcrsBounds.max);\n          return L.bounds(\n            L.point(minGCRS.lng, minGCRS.lat),\n            L.point(maxGCRS.lng, maxGCRS.lat)\n          );\n        default:\n          return undefined;\n      }\n    },\n\n    // pointToPCRSPoint takes a point, with a projection and cs and converts it to a pcrs L.point/L.latLng\n    //pointToPCRSPoint: L.Point, Int, L.CRS, Str('PCRS'|'TCRS'|'TILEMATRIX'|'GCRS') -> L.point|L.latLng\n    pointToPCRSPoint: function (point, zoom, projection, cs) {\n      if (\n        !point ||\n        (zoom !== undefined && !Number.isFinite(+zoom)) ||\n        (zoom === undefined &&\n          (cs === 'TILEMATRIX' || cs === 'TCRS' || cs === 'TILE')) ||\n        !cs ||\n        !projection\n      )\n        return undefined;\n      projection = typeof projection === 'string' ? M[projection] : projection;\n      let tileSize = projection.options.crs.tile.bounds.max.x;\n      switch (cs.toUpperCase()) {\n        case 'TILEMATRIX':\n          return M.pixelToPCRSPoint(\n            L.point(point.x * tileSize, point.y * tileSize),\n            zoom,\n            projection\n          );\n        case 'PCRS':\n          return point;\n        case 'TCRS' :\n          return M.pixelToPCRSPoint(point, zoom, projection);\n        case 'GCRS':\n          return projection.project(L.latLng(point.y, point.x));\n        default:\n          return undefined;\n      }\n    },\n\n    // pixelToPCRSPoint takes a pixel L.point, the zoom and projection and returns a L.point in pcrs\n    // pixelToPCRSPoint: L.Point, Int, L.CRS|Str -> L.point\n    pixelToPCRSPoint: function (point, zoom, projection) {\n      if (\n        !point ||\n        (!zoom && zoom !== 0) ||\n        !Number.isFinite(+zoom) ||\n        !projection\n      )\n        return undefined;\n      projection = typeof projection === 'string' ? M[projection] : projection;\n      return projection.transformation.untransform(point, projection.scale(zoom));\n    },\n\n    // boundsToPCRSBounds converts bounds with projection and cs to PCRS bounds\n    // boundsToPCRSBounds: L.bounds, Int, L.CRS|Str, Str('PCRS'|'TCRS'|'TILEMATRIX'|'GCRS') -> L.bounds\n    boundsToPCRSBounds: function (bounds, zoom, projection, cs) {\n      if (\n        !bounds ||\n        !bounds.max ||\n        !bounds.min ||\n        (zoom !== undefined && !Number.isFinite(+zoom)) ||\n        (zoom === undefined &&\n          (cs === 'TILEMATRIX' || cs === 'TCRS' || cs === 'TILE')) ||\n        !projection ||\n        !cs\n      )\n        return undefined;\n      projection = typeof projection === 'string' ? M[projection] : projection;\n      return L.bounds(\n        M.pointToPCRSPoint(bounds.min, zoom, projection, cs),\n        M.pointToPCRSPoint(bounds.max, zoom, projection, cs)\n      );\n    },\n\n    //L.bounds have fixed point positions, where min is always topleft, max is always bottom right, and the values are always sorted by leaflet\n    //important to consider when working with pcrs where the origin is not topleft but rather bottomleft, could lead to confusion\n    pixelToPCRSBounds: function (bounds, zoom, projection) {\n      if (\n        !bounds ||\n        !bounds.max ||\n        !bounds.min ||\n        (!zoom && zoom !== 0) ||\n        !Number.isFinite(+zoom) ||\n        !projection\n      )\n        return undefined;\n      projection = typeof projection === 'string' ? M[projection] : projection;\n      return L.bounds(\n        M.pixelToPCRSPoint(bounds.min, zoom, projection),\n        M.pixelToPCRSPoint(bounds.max, zoom, projection)\n      );\n    },\n\n    //meta content is the content attribute of meta\n    // input \"max=5,min=4\" => [[max,5][min,5]]\n    _metaContentToObject: function (input) {\n      if (!input || input instanceof Object) return {};\n      let content = input.split(/\\s+/).join('');\n      let contentArray = {};\n      let stringSplit = content.split(',');\n\n      for (let i = 0; i < stringSplit.length; i++) {\n        let prop = stringSplit[i].split('=');\n        if (prop.length === 2) contentArray[prop[0]] = prop[1];\n      }\n      if (contentArray !== '' && stringSplit[0].split('=').length === 1)\n        contentArray.content = stringSplit[0];\n      return contentArray;\n    },\n\n    // _coordsToArray returns an array of arrays of coordinate pairs\n    // _coordsToArray: (\"1,2,3,4\") -> [[1,2],[3,4]]\n    _coordsToArray: function (containerPoints) {\n      for (\n        var i = 1, pairs = [], coords = containerPoints.split(',');\n        i < coords.length;\n        i += 2\n      ) {\n        pairs.push([parseInt(coords[i - 1]), parseInt(coords[i])]);\n      }\n      return pairs;\n    },\n\n    // _splitCoordinate splits string coordinates to an array as floating point numbers\n    _splitCoordinate: function (element, index, array) {\n      var a = [];\n      element.split(/\\s+/gim).forEach(M._parseNumber, a);\n      this.push(a);\n    },\n\n    // _parseNumber parses a string as a floating point number, helper function for _splitCoordinate\n    _parseNumber: function (element, index, array) {\n      this.push(parseFloat(element));\n    },\n\n    // _handleLink handles map-a links, when clicked on a map-a link\n    _handleLink: function (link, leafletLayer) {\n      let zoomTo,\n        justPan = false,\n        layer,\n        map = leafletLayer._map,\n        opacity;\n      if (link.type === 'text/html' && link.target !== '_blank') {\n        // all other target values other than blank behave as _top\n        link.target = '_top';\n      } else if (link.type !== 'text/html' && link.url.includes('#')) {\n        let hash = link.url.split('#'),\n          loc = hash[1].split(',');\n        zoomTo = { z: loc[0] || 0, lng: loc[1] || 0, lat: loc[2] || 0 };\n        justPan = !hash[0]; // if the first half of the array is an empty string then the link is just for panning\n        if (['/', '.', '#'].includes(link.url[0])) link.target = '_self';\n      }\n      if (!justPan) {\n        layer = document.createElement('layer-');\n        layer.setAttribute('src', link.url);\n        layer.setAttribute('checked', '');\n        switch (link.target) {\n          case '_blank':\n            if (link.type === 'text/html') {\n              window.open(link.url);\n            } else {\n              postTraversalSetup();\n              map.options.mapEl.appendChild(layer);\n            }\n            break;\n          case '_parent':\n            postTraversalSetup();\n            for (let l of map.options.mapEl.querySelectorAll('layer-'))\n              if (l._layer !== leafletLayer) map.options.mapEl.removeChild(l);\n            map.options.mapEl.appendChild(layer);\n            map.options.mapEl.removeChild(leafletLayer._layerEl);\n            break;\n          case '_top':\n            window.location.href = link.url;\n            break;\n          default:\n            postTraversalSetup();\n            opacity = leafletLayer._layerEl.opacity;\n            leafletLayer._layerEl.insertAdjacentElement('beforebegin', layer);\n            map.options.mapEl.removeChild(leafletLayer._layerEl);\n        }\n      } else if (zoomTo && !link.inPlace && justPan) {\n        leafletLayer._map.options.mapEl.zoomTo(\n          +zoomTo.lat,\n          +zoomTo.lng,\n          +zoomTo.z\n        );\n        if (opacity) layer.opacity = opacity;\n        map.getContainer().focus();\n      }\n\n      function postTraversalSetup() {\n        // when the projection is changed as part of the link traversal process,\n        // it's necessary to set the map viewer's lat, lon and zoom NOW, so that\n        // the promises that are created when the viewer's projection is changed\n        // can use the viewer's lat, lon and zoom properties that were in effect\n        // before the projection change i.e. in the closure for that code\n        // see mapml-viewer / map is=web-map projection attributeChangedCallback\n        // specifically required for use cases like changing projection after\n        // link traversal, e.g. BC link here https://maps4html.org/experiments/linking/features/\n        if (!link.inPlace && zoomTo) updateMapZoomTo(zoomTo);\n        // the layer is newly created, so have to wait until it's fully init'd\n        // before setting properties.\n        layer.whenReady().then(() => {\n          // if the map projection isnt' changed by link traversal, it's necessary\n          // to perform pan/zoom operations after the layer is ready\n          if (!link.inPlace && zoomTo)\n            layer.parentElement.zoomTo(+zoomTo.lat, +zoomTo.lng, +zoomTo.z);\n          else if (!link.inPlace) layer.zoomTo();\n          // not sure if this is necessary\n          if (opacity) layer.opacity = opacity;\n          // this is necessary to display the FeatureIndexOverlay, I believe\n          map.getContainer().focus();\n        });\n      }\n\n      function updateMapZoomTo(zoomTo) {\n        // can't use mapEl.zoomTo(...) here, it's too slow!\n        map.options.mapEl.lat = +zoomTo.lat;\n        map.options.mapEl.lon = +zoomTo.lng;\n        map.options.mapEl.zoom = +zoomTo.z;\n      }\n    },\n    getBoundsFromMeta: function (mapml) {\n      if (!mapml) return null;\n      let cs,\n        pseudo = mapml instanceof ShadowRoot ? ':host' : ':scope',\n        projection =\n          (mapml.querySelector(pseudo + ' > map-meta[name=projection]') &&\n            M._metaContentToObject(\n              mapml\n                .querySelector(pseudo + ' > map-meta[name=projection]')\n                .getAttribute('content')\n            ).content.toUpperCase()) ||\n          M.FALLBACK_PROJECTION;\n      try {\n        let meta =\n          mapml.querySelector(pseudo + ' > map-meta[name=extent]') &&\n          M._metaContentToObject(\n            mapml\n              .querySelector(pseudo + ' > map-meta[name=extent]')\n              .getAttribute('content')\n          );\n\n        let zoom = meta.zoom;\n\n        let metaKeys = Object.keys(meta);\n        for (let i = 0; i < metaKeys.length; i++) {\n          if (!metaKeys[i].includes('zoom')) {\n            cs = M.axisToCS(metaKeys[i].split('-')[2]);\n            break;\n          }\n        }\n        // this could happen if the content didn't match the grammar for map-meta[name=extent]\n        if (cs === undefined) throw new Error('cs undefined when getting bounds');\n\n        // when cs is tilematrix, tcrs or tile, zoom is required.\n        // should throw / return null instead of trying to construct a bounds\n\n        if (\n          zoom === undefined &&\n          (cs === 'TILEMATRIX' || cs === 'TCRS' || cs === 'TILE')\n        )\n          throw new Error(\n            'map-meta[name=extent] zoom= parameter not provided for tcrs,tile or tilematrix bounds'\n          );\n        let axes = M.csToAxes(cs);\n        return M.boundsToPCRSBounds(\n          L.bounds(\n            L.point(+meta[`top-left-${axes[0]}`], +meta[`top-left-${axes[1]}`]),\n            L.point(\n              +meta[`bottom-right-${axes[0]}`],\n              +meta[`bottom-right-${axes[1]}`]\n            )\n          ),\n          zoom,\n          projection,\n          cs\n        );\n      } catch (error) {\n        //if error then by default set the layer to osm and bounds to the entire map view\n        return M.boundsToPCRSBounds(\n          M[projection].options.crs.tilematrix.bounds(0),\n          0,\n          projection,\n          cs\n        );\n      }\n    },\n    /**\n     * TODO Review and improve design logic with Aliyan\n     *\n     * Parses object from <map-meta name=\"zoom\" content=\"...\">\n     * @param {type} mapml\n     * @returns {minZoom, maxZoom, minNativeZoom, maxNativeZoom}\n     */\n    getZoomBoundsFromMeta: function (mapml) {\n      if (!mapml) return null;\n      let pseudo = mapml instanceof ShadowRoot ? ':host' : ':scope';\n\n      let meta = M._metaContentToObject(\n        mapml\n          .querySelector(pseudo + '> map-meta[name=zoom]')\n          .getAttribute('content')\n      );\n      if (meta.min && meta.max && meta.value)\n        return {\n          minZoom: +meta.min,\n          maxZoom: +meta.max,\n          minNativeZoom: +meta.value,\n          maxNativeZoom: +meta.value\n        };\n      else if (meta.min && meta.max)\n        return {\n          minZoom: +meta.min,\n          maxZoom: +meta.max\n        };\n      else if (meta.min)\n        return {\n          minZoom: +meta.min\n        };\n      else if (meta.max)\n        return {\n          maxZoom: +meta.max\n        };\n    },\n    getZoomBounds: function (mapml, nativeZoom) {\n      if (!mapml) return null;\n      let nMin = 100,\n        nMax = 0,\n        features = mapml.querySelectorAll('map-feature'),\n        meta,\n        projection;\n      for (let i = 0; i < features.length; i++) {\n        let lZoom = +features[i].getAttribute('zoom');\n        if (!features[i].getAttribute('zoom')) lZoom = nativeZoom;\n        nMax = Math.max(nMax, lZoom);\n        nMin = Math.min(nMin, lZoom);\n      }\n      try {\n        projection = M._metaContentToObject(\n          mapml.querySelector('map-meta[name=projection]').getAttribute('content')\n        ).content;\n        meta = M._metaContentToObject(\n          mapml.querySelector('map-meta[name=zoom]').getAttribute('content')\n        );\n      } catch (error) {\n        return {\n          minZoom: 0,\n          maxZoom:\n            M[projection || M.FALLBACK_PROJECTION].options.resolutions.length - 1,\n          minNativeZoom: nMin,\n          maxNativeZoom: nMax\n        };\n      }\n      return {\n        minZoom: +meta.min,\n        maxZoom: +meta.max,\n        minNativeZoom: nMin,\n        maxNativeZoom: nMax\n      };\n    },\n    // getNativeVariables: returns an object with the native zoom and CS,\n    //                     based on the map-metas that are available within\n    //                     the layer or the fallback default values.\n    // getNativeVariables: mapml-||layer-||null||[map-feature,...] -> {zoom: _, val: _}\n    // mapml can be a mapml- element, layer- element, null, or an array of map-features\n    getNativeVariables: function (mapml) {\n      let nativeZoom, nativeCS;\n      // when mapml is an array of features provided by the query\n      if (\n        mapml.length &&\n        mapml[0].parentElement.parentElement &&\n        mapml[0].parentElement.parentElement.tagName === 'mapml-'\n      ) {\n        let mapmlEl = mapml[0].parentElement.parentElement;\n        nativeZoom =\n          (mapmlEl.querySelector &&\n            mapmlEl.querySelector('map-meta[name=zoom]') &&\n            +M._metaContentToObject(\n              mapmlEl.querySelector('map-meta[name=zoom]').getAttribute('content')\n            ).value) ||\n          0;\n        nativeCS =\n          (mapmlEl.querySelector &&\n            mapmlEl.querySelector('map-meta[name=cs]') &&\n            M._metaContentToObject(\n              mapmlEl.querySelector('map-meta[name=cs]').getAttribute('content')\n            ).content) ||\n          'GCRS';\n      } else {\n        // when mapml is null or a layer-/mapml- element\n        nativeZoom =\n          (mapml.querySelector &&\n            mapml.querySelector('map-meta[name=zoom]') &&\n            +M._metaContentToObject(\n              mapml.querySelector('map-meta[name=zoom]').getAttribute('content')\n            ).value) ||\n          0;\n        nativeCS =\n          (mapml.querySelector &&\n            mapml.querySelector('map-meta[name=cs]') &&\n            M._metaContentToObject(\n              mapml.querySelector('map-meta[name=cs]').getAttribute('content')\n            ).content) ||\n          'GCRS';\n      }\n      return { zoom: nativeZoom, cs: nativeCS };\n    },\n\n    // _gcrsToTileMatrix returns the [column, row] of the tiles at map center. Used for Announce movement for screen readers\n    // _gcrsToTileMatrix: map/mapml-viewer -> [column, row]\n    _gcrsToTileMatrix: function (mapEl) {\n      let point = mapEl._map.project(mapEl._map.getCenter());\n      let tileSize = mapEl._map.options.crs.options.crs.tile.bounds.max.y;\n      let column = Math.trunc(point.x / tileSize);\n      let row = Math.trunc(point.y / tileSize);\n      return [column, row];\n    },\n\n    // Pastes text to a mapml-viewer/map element(mapEl), text can be a mapml link, geojson, or a layer-\n    //    used for pasting layers through ctrl+v, drag/drop, and pasting through the contextmenu\n    // _pasteLayer: HTMLElement Str -> None\n    // Effects: append a layer- element to mapEl, if it is valid\n    _pasteLayer: function (mapEl, text) {\n      try {\n        new URL(text);\n        // create a new <layer-> child of the <mapml-viewer> element\n        let l =\n          '<layer- src=\"' +\n          text +\n          '\" label=\"' +\n          M.options.locale.dfLayer +\n          '\" checked=\"\"></layer->';\n        mapEl.insertAdjacentHTML('beforeend', l);\n        mapEl.lastElementChild.whenReady().catch(() => {\n          if (mapEl) {\n            // should invoke lifecyle callbacks automatically by removing it from DOM\n            mapEl.removeChild(mapEl.lastChild);\n          }\n          // garbage collect it\n          l = null;\n        });\n      } catch (err) {\n        text = text\n          .replace(/(<!--.*?-->)|(<!--[\\S\\s]+?-->)|(<!--[\\S\\s]*?$)/g, '')\n          .trim();\n        if (text.slice(0, 7) === '<layer-' && text.slice(-9) === '</layer->') {\n          mapEl.insertAdjacentHTML('beforeend', text);\n        } else if (\n          text.slice(0, 12) === '<map-feature' &&\n          text.slice(-14) === '</map-feature>'\n        ) {\n          let layer =\n            `<layer- label=\"${M.options.locale.dfPastedLayer}\" checked>\n                       <map-meta name='projection' content='${mapEl.projection}'></map-meta>` +\n            text +\n            '</layer->';\n          mapEl.insertAdjacentHTML('beforeend', layer);\n        } else {\n          try {\n            mapEl.geojson2mapml(JSON.parse(text));\n          } catch {\n            console.log('Invalid Input!');\n          }\n        }\n      }\n    },\n\n    // Takes GeoJSON Properties to return an HTML table, helper function\n    //    for geojson2mapml\n    // _properties2Table: geojsonPropertiesOBJ -> HTML Table\n    _properties2Table: function (json) {\n      let table = document.createElement('table');\n\n      // Creating a Table Header\n      let thead = table.createTHead();\n      let row = thead.insertRow();\n      let th1 = document.createElement('th');\n      let th2 = document.createElement('th');\n      th1.appendChild(document.createTextNode('Property name'));\n      th2.appendChild(document.createTextNode('Property value'));\n      th1.setAttribute('role', 'columnheader');\n      th2.setAttribute('role', 'columnheader');\n      th1.setAttribute('scope', 'col');\n      th2.setAttribute('scope', 'col');\n      row.appendChild(th1);\n      row.appendChild(th2);\n\n      // Creating table body and populating it from the JSON\n      let tbody = table.createTBody();\n      for (let key in json) {\n        if (json.hasOwnProperty(key)) {\n          let row = tbody.insertRow();\n          let th = document.createElement('th');\n          let td = document.createElement('td');\n          th.appendChild(document.createTextNode(key));\n          td.appendChild(document.createTextNode(json[key]));\n          th.setAttribute('scope', 'row');\n          td.setAttribute('itemprop', key);\n          row.appendChild(th);\n          row.appendChild(td);\n        }\n      }\n      return table;\n    },\n\n    // Takes bbox array and a x,y coordinate to possibly update the extent, returns extent\n    //    for geojson2mapml\n    // _updateExtent: [min x, min y, max x, max y], x, y -> [min x, min y, max x, max y]\n    _updateExtent: function (bboxExtent, x, y) {\n      if (bboxExtent === {}) {\n        return bboxExtent;\n      }\n      bboxExtent[0] = Math.min(x, bboxExtent[0]);\n      bboxExtent[1] = Math.min(y, bboxExtent[1]);\n      bboxExtent[2] = Math.max(x, bboxExtent[2]);\n      bboxExtent[3] = Math.max(y, bboxExtent[3]);\n      return bboxExtent;\n    },\n\n    // Takes a GeoJSON geojson and an options Object which returns a <layer-> Element\n    // The options object can contain the following:\n    //      label            - String, contains the layer name, if included overrides the default label mapping\n    //      projection       - String, contains the projection of the layer (OSMTILE, WGS84, CBMTILE, APSTILE), defaults to   OSMTILE\n    //      caption          - Function | String, function accepts one argument being the feature object which produces the   featurecaption string OR a string that is the name of the property that will be mapped to featurecaption\n    //      properties       - Function | String | HTMLElement, a function which maps the geojson feature to an HTMLElement   or a string that will be parsed as an HTMLElement or an HTMLElement\n    //      geometryFunction - Function, A function you supply that can add classes, hyperlinks and spans to the created  <map-geometry> element, default would be the plain map-geometry element\n    // geojson2mapml: geojson Object <layer-> [min x, min y, max x, max y] -> <layer->\n    geojson2mapml: function (json, options = {}, layer = null, bboxExtent = {}) {\n      let defaults = {\n        label: null,\n        projection: 'OSMTILE',\n        caption: null,\n        properties: null,\n        geometryFunction: null\n      };\n      // assign default values for undefined options\n      options = Object.assign({}, defaults, options);\n\n      // If string json is received\n      if (typeof json === 'string') {\n        json = JSON.parse(json);\n      }\n      let geometryType = [\n        'POINT',\n        'LINESTRING',\n        'POLYGON',\n        'MULTIPOINT',\n        'MULTILINESTRING',\n        'MULTIPOLYGON',\n        'GEOMETRYCOLLECTION'\n      ];\n      let jsonType = json.type.toUpperCase();\n      let out = '';\n      let setExtent = false;\n\n      // HTML parser\n      let parser = new DOMParser();\n\n      // initializing layer\n      if (layer === null) {\n        if (!json.bbox) {\n          setExtent = true;\n        }\n        // creating an empty mapml layer\n        let xmlStringLayer =\n          \"<layer- label='' checked><map-meta name='projection' content='\" +\n          options.projection +\n          \"'></map-meta><map-meta name='cs' content='gcrs'></map-meta></layer->\";\n        layer = parser.parseFromString(xmlStringLayer, 'text/html');\n        //console.log(layer)\n        if (options.label !== null) {\n          layer.querySelector('layer-').setAttribute('label', options.label);\n        } else if (json.name) {\n          layer.querySelector('layer-').setAttribute('label', json.name);\n        } else if (json.title) {\n          layer.querySelector('layer-').setAttribute('label', json.title);\n        } else {\n          layer\n            .querySelector('layer-')\n            .setAttribute('label', M.options.locale.dfLayer);\n        }\n      }\n      let point = '<map-point></map-point>';\n      point = parser.parseFromString(point, 'text/html');\n\n      let multiPoint =\n        '<map-multipoint><map-coordinates></map-coordinates></map-multipoint>';\n      multiPoint = parser.parseFromString(multiPoint, 'text/html');\n\n      let linestring =\n        '<map-linestring><map-coordinates></map-coordinates></map-linestring>';\n      linestring = parser.parseFromString(linestring, 'text/html');\n\n      let multilinestring = '<map-multilinestring></map-multilinestring>';\n      multilinestring = parser.parseFromString(multilinestring, 'text/html');\n\n      let polygon = '<map-polygon></map-polygon>';\n      polygon = parser.parseFromString(polygon, 'text/html');\n\n      let multiPolygon = '<map-multipolygon></map-multipolygon>';\n      multiPolygon = parser.parseFromString(multiPolygon, 'text/html');\n\n      let geometrycollection =\n        '<map-geometrycollection></map-geometrycollection>';\n      geometrycollection = parser.parseFromString(\n        geometrycollection,\n        'text/html'\n      );\n\n      let feature =\n        '<map-feature><map-featurecaption></map-featurecaption><map-geometry></map-geometry><map-properties></map-properties></map-feature>';\n      feature = parser.parseFromString(feature, 'text/html');\n\n      // Template to add coordinates to Geometries\n      let coords = '<map-coordinates></map-coordinates>';\n      coords = parser.parseFromString(coords, 'text/html');\n\n      //console.log(layer);\n      if (jsonType === 'FEATURECOLLECTION') {\n        // Setting bbox if it exists\n        if (json.bbox) {\n          layer\n            .querySelector('layer-')\n            .insertAdjacentHTML(\n              'afterbegin',\n              \"<map-meta name='extent' content='top-left-longitude=\" +\n                json.bbox[0] +\n                ', top-left-latitude=' +\n                json.bbox[1] +\n                ', bottom-right-longitude=' +\n                json.bbox[2] +\n                ',bottom-right-latitude=' +\n                json.bbox[3] +\n                \"'></map-meta>\"\n            );\n        } else {\n          bboxExtent = [\n            Infinity,\n            Infinity,\n            Number.NEGATIVE_INFINITY,\n            Number.NEGATIVE_INFINITY\n          ];\n        }\n\n        let features = json.features;\n        //console.log(\"Features length - \" + features.length);\n        for (let l = 0; l < features.length; l++) {\n          M.geojson2mapml(features[l], options, layer, bboxExtent);\n        }\n      } else if (jsonType === 'FEATURE') {\n        let clone_feature = feature.cloneNode(true);\n        let curr_feature = clone_feature.querySelector('map-feature');\n\n        // Setting bbox if it exists\n        if (json.bbox) {\n          layer\n            .querySelector('layer-')\n            .insertAdjacentHTML(\n              'afterbegin',\n              \"<map-meta name='extent' content='top-left-longitude=\" +\n                json.bbox[0] +\n                ', top-left-latitude=' +\n                json.bbox[1] +\n                ', bottom-right-longitude=' +\n                json.bbox[2] +\n                ',bottom-right-latitude=' +\n                json.bbox[3] +\n                \"'></map-meta>\"\n            );\n        } else if (\n          typeof bboxExtent === 'object' &&\n          bboxExtent.length === undefined\n        ) {\n          bboxExtent = [\n            Infinity,\n            Infinity,\n            Number.NEGATIVE_INFINITY,\n            Number.NEGATIVE_INFINITY\n          ];\n        }\n\n        // Setting featurecaption\n        let featureCaption = layer.querySelector('layer-').getAttribute('label');\n        if (typeof options.caption === 'function') {\n          featureCaption = options.caption(json);\n        } else if (typeof options.caption === 'string') {\n          featureCaption = json.properties[options.caption];\n          // if property does not exist\n          if (featureCaption === undefined) {\n            featureCaption = options.caption;\n          }\n        } else if (json.id) {\n          // when no caption option available try setting id as featurecaption\n          featureCaption = json.id;\n        }\n        curr_feature.querySelector('map-featurecaption').innerHTML =\n          featureCaption;\n\n        // Setting Properties\n        let p;\n        // if properties function is passed\n        if (typeof options.properties === 'function') {\n          p = options.properties(json);\n          // if function output is not an element, ignore the properties.\n          if (!(p instanceof Element)) {\n            p = false;\n            console.error(\n              'options.properties function returns a string instead of an HTMLElement.'\n            );\n          }\n        } else if (typeof options.properties === 'string') {\n          // if properties string is passed\n          curr_feature\n            .querySelector('map-properties')\n            .insertAdjacentHTML('beforeend', options.properties);\n          p = false;\n        } else if (options.properties instanceof HTMLElement) {\n          // if an HTMLElement is passed - NOT TESTED\n          p = options.properties;\n        } else {\n          // If no properties function, string or HTMLElement is passed\n          p = M._properties2Table(json.properties);\n        }\n\n        if (p) {\n          curr_feature.querySelector('map-properties').appendChild(p);\n        }\n\n        // Setting map-geometry\n        let g = M.geojson2mapml(json.geometry, options, layer, bboxExtent);\n        if (typeof options.geometryFunction === 'function') {\n          curr_feature\n            .querySelector('map-geometry')\n            .appendChild(options.geometryFunction(g, json));\n        } else {\n          curr_feature.querySelector('map-geometry').appendChild(g);\n        }\n\n        // Appending feature to layer\n        layer.querySelector('layer-').appendChild(curr_feature);\n      } else if (geometryType.includes(jsonType)) {\n        //console.log(\"Geometry Type - \" + jsonType);\n        switch (jsonType) {\n          case 'POINT':\n            bboxExtent = M._updateExtent(\n              bboxExtent,\n              json.coordinates[0],\n              json.coordinates[1]\n            );\n            out = json.coordinates[0] + ' ' + json.coordinates[1];\n\n            // Create Point element\n            let clone_point = point.cloneNode(true);\n            clone_point = clone_point.querySelector('map-point');\n\n            // Create map-coords to add to the polygon\n            let clone_coords = coords.cloneNode(true);\n            clone_coords = clone_coords.querySelector('map-coordinates');\n\n            clone_coords.innerHTML = out;\n\n            clone_point.appendChild(clone_coords);\n            //console.log(clone_point);\n            return clone_point;\n\n          case 'LINESTRING':\n            let clone_linestring = linestring.cloneNode(true);\n            let linestring_coordindates =\n              clone_linestring.querySelector('map-coordinates');\n\n            out = '';\n\n            for (let x = 0; x < json.coordinates.length; x++) {\n              bboxExtent = M._updateExtent(\n                bboxExtent,\n                json.coordinates[x][0],\n                json.coordinates[x][1]\n              );\n              out =\n                out + json.coordinates[x][0] + ' ' + json.coordinates[x][1] + ' ';\n            }\n\n            linestring_coordindates.innerHTML = out;\n            //console.log(clone_linestring.querySelector('map-linestring'));\n            return clone_linestring.querySelector('map-linestring');\n\n          case 'POLYGON':\n            let clone_polygon = polygon.cloneNode(true);\n            clone_polygon = clone_polygon.querySelector('map-polygon');\n\n            // Going over each coordinates\n            for (let y = 0; y < json.coordinates.length; y++) {\n              let out = '';\n              let clone_coords = coords.cloneNode(true);\n              clone_coords = clone_coords.querySelector('map-coordinates');\n\n              // Going over coordinates for the polygon\n              for (let x = 0; x < json.coordinates[y].length; x++) {\n                bboxExtent = M._updateExtent(\n                  bboxExtent,\n                  json.coordinates[y][x][0],\n                  json.coordinates[y][x][1]\n                );\n                out =\n                  out +\n                  json.coordinates[y][x][0] +\n                  ' ' +\n                  json.coordinates[y][x][1] +\n                  ' ';\n              }\n\n              // Create map-coordinates element and append it to clone_polygon\n              clone_coords.innerHTML = out;\n\n              clone_polygon.appendChild(clone_coords);\n            }\n            //console.log(clone_polygon);\n            return clone_polygon;\n\n          case 'MULTIPOINT':\n            out = '';\n            // Create multipoint element\n            let clone_multipoint = multiPoint.cloneNode(true);\n            clone_multipoint = clone_multipoint.querySelector('map-multipoint');\n\n            for (let i = 0; i < json.coordinates.length; i++) {\n              bboxExtent = M._updateExtent(\n                bboxExtent,\n                json.coordinates[i][0],\n                json.coordinates[i][1]\n              );\n              out =\n                out + json.coordinates[i][0] + ' ' + json.coordinates[i][1] + ' ';\n            }\n            clone_multipoint.querySelector('map-coordinates').innerHTML = out;\n            return clone_multipoint;\n\n          case 'MULTILINESTRING':\n            let clone_multilinestring = multilinestring.cloneNode(true);\n            clone_multilinestring = clone_multilinestring.querySelector(\n              'map-multilinestring'\n            );\n\n            for (let i = 0; i < json.coordinates.length; i++) {\n              let out = '';\n              let clone_coords = coords.cloneNode(true);\n              clone_coords = clone_coords.querySelector('map-coordinates');\n              for (let y = 0; y < json.coordinates[i].length; y++) {\n                bboxExtent = M._updateExtent(\n                  bboxExtent,\n                  json.coordinates[i][y][0],\n                  json.coordinates[i][y][1]\n                );\n                out =\n                  out +\n                  json.coordinates[i][y][0] +\n                  ' ' +\n                  json.coordinates[i][y][1] +\n                  ' ';\n              }\n              clone_coords.innerHTML = out;\n              clone_multilinestring.appendChild(clone_coords);\n            }\n            return clone_multilinestring;\n\n          case 'MULTIPOLYGON':\n            let m = multiPolygon.cloneNode(true);\n            m = m.querySelector('map-multiPolygon');\n\n            // Going over each Polygon\n            for (let i = 0; i < json.coordinates.length; i++) {\n              let clone_polygon = polygon.cloneNode(true);\n              clone_polygon = clone_polygon.querySelector('map-polygon');\n\n              // Going over each coordinates\n              for (let y = 0; y < json.coordinates[i].length; y++) {\n                let out = '';\n                let clone_coords = coords.cloneNode(true);\n                clone_coords = clone_coords.querySelector('map-coordinates');\n\n                // Going over coordinates for the polygon\n                for (let x = 0; x < json.coordinates[i][y].length; x++) {\n                  bboxExtent = M._updateExtent(\n                    bboxExtent,\n                    json.coordinates[i][y][x][0],\n                    json.coordinates[i][y][x][1]\n                  );\n                  out =\n                    out +\n                    json.coordinates[i][y][x][0] +\n                    ' ' +\n                    json.coordinates[i][y][x][1] +\n                    ' ';\n                }\n\n                // Create map-coordinates element and append it to clone_polygon\n                clone_coords.innerHTML = out;\n\n                clone_polygon.appendChild(clone_coords);\n              }\n              m.appendChild(clone_polygon);\n            }\n            return m;\n          case 'GEOMETRYCOLLECTION': // ---------------------------------------------------------------------------\n            let g = geometrycollection.cloneNode(true);\n            g = g.querySelector('map-geometrycollection');\n            //console.log(json.geometries);\n            for (let i = 0; i < json.geometries.length; i++) {\n              let fg = M.geojson2mapml(\n                json.geometries[i],\n                options,\n                layer,\n                bboxExtent\n              );\n              g.appendChild(fg);\n            }\n            return g;\n        }\n      }\n      //Add default bbox\n      if (setExtent) {\n        layer\n          .querySelector('layer-')\n          .insertAdjacentHTML(\n            'afterbegin',\n            \"<map-meta name='extent' content='top-left-longitude=\" +\n              bboxExtent[0] +\n              ', top-left-latitude=' +\n              bboxExtent[1] +\n              ', bottom-right-longitude=' +\n              bboxExtent[2] +\n              ',bottom-right-latitude=' +\n              bboxExtent[3] +\n              \"'></map-meta>\"\n          );\n      }\n      return layer.querySelector('layer-');\n    },\n\n    // Takes an array of length n to return an array of arrays with length 2, helper function\n    //    for mapml2geojson\n    // _breakArray: arr(float) -> arr(arr(float, float))\n    _breakArray: function (arr) {\n      let size = 2;\n      let arrayOfArrays = [];\n      // removing anything other than numbers, ., - (used to remove <map-span> tags)\n      arr = arr.filter((x) => !/[^\\d.-]/g.test(x)).filter((x) => x);\n      for (let i = 0; i < arr.length; i += size) {\n        arrayOfArrays.push(arr.slice(i, i + size).map(Number));\n      }\n      return arrayOfArrays;\n    },\n\n    // Takes an HTML Table to return geojson properties, helper function\n    //    for mapml2geojson\n    // _table2properties: HTML Table -> geojson\n    _table2properties: function (table) {\n      // removing thead, if it exists\n      let head = table.querySelector('thead');\n      if (head !== null) {\n        table.querySelector('thead').remove();\n      }\n      let json = {};\n      table.querySelectorAll('tr').forEach((tr) => {\n        let tableData = tr.querySelectorAll('th, td');\n        json[tableData[0].innerHTML] = tableData[1].innerHTML;\n      });\n      return json;\n    },\n\n    // Converts a geometry element (el) to geojson, helper function\n    //    for mapml2geojson, NOTE - el can not be a map-geometrycollection\n    // _geometry2geojson: (child of <map-geometry>), Proj4, Proj4, Bool -> geojson\n    _geometry2geojson: function (el, source, dest, transform) {\n      // remove map-a, map-span elements if the geometry is wrapped in them\n      while (\n        el.nodeName.toUpperCase() === 'MAP-SPAN' ||\n        el.nodeName.toUpperCase() === 'MAP-A'\n      ) {\n        el = el.firstElementChild;\n      }\n      let elem = el.nodeName;\n      let j = {};\n      let coord;\n\n      switch (elem.toUpperCase()) {\n        case 'MAP-POINT':\n          j.type = 'Point';\n          if (transform) {\n            let pointConv = proj4.transform(\n              source,\n              dest,\n              el\n                .querySelector('map-coordinates')\n                .innerHTML.split(/[<>\\ ]/g)\n                .map(Number)\n            );\n            j.coordinates = [pointConv.x, pointConv.y];\n          } else {\n            j.coordinates = el\n              .querySelector('map-coordinates')\n              .innerHTML.split(/[<>\\ ]/g)\n              .map(Number);\n          }\n          break;\n        case 'MAP-LINESTRING':\n          j.type = 'LineString';\n          coord = el.querySelector('map-coordinates').innerHTML.split(/[<>\\ ]/g);\n          coord = M._breakArray(coord);\n          if (transform) {\n            coord = M._pcrsToGcrs(coord, source, dest);\n          }\n          j.coordinates = coord;\n          break;\n        case 'MAP-POLYGON':\n          j.type = 'Polygon';\n          j.coordinates = [];\n          let x = 0;\n          el.querySelectorAll('map-coordinates').forEach((coord) => {\n            coord = coord.innerHTML.split(/[<>\\ ]/g);\n            coord = M._breakArray(coord);\n            if (transform) {\n              coord = M._pcrsToGcrs(coord, source, dest);\n            }\n            j.coordinates[x] = coord;\n            x++;\n          });\n          break;\n        case 'MAP-MULTIPOINT':\n          j.type = 'MultiPoint';\n          coord = M._breakArray(\n            el.querySelector('map-coordinates').innerHTML.split(/[<>\\ ]/g)\n          );\n          if (transform) {\n            coord = M._pcrsToGcrs(coord, source, dest);\n          }\n          j.coordinates = coord;\n          break;\n        case 'MAP-MULTILINESTRING':\n          j.type = 'MultiLineString';\n          j.coordinates = [];\n          let i = 0;\n          el.querySelectorAll('map-coordinates').forEach((coord) => {\n            coord = coord.innerHTML.split(/[<>\\ ]/g);\n            coord = M._breakArray(coord);\n            if (transform) {\n              coord = M._pcrsToGcrs(coord, source, dest);\n            }\n            j.coordinates[i] = coord;\n            i++;\n          });\n          break;\n        case 'MAP-MULTIPOLYGON':\n          j.type = 'MultiPolygon';\n          j.coordinates = [];\n          let p = 0;\n          el.querySelectorAll('map-polygon').forEach((poly) => {\n            let y = 0;\n            j.coordinates.push([]);\n            poly.querySelectorAll('map-coordinates').forEach((coord) => {\n              coord = coord.innerHTML.split(/[<>\\ ]/g);\n              coord = M._breakArray(coord);\n              if (transform) {\n                coord = M._pcrsToGcrs(coord, source, dest);\n              }\n              j.coordinates[p].push([]);\n              j.coordinates[p][y] = coord;\n              y++;\n            });\n            p++;\n          });\n          break;\n      }\n      return j;\n    },\n\n    // _pcrsToGcrs: arrof([x,y]) Proj4, Proj4 -> arrof[x,y]\n    _pcrsToGcrs: function (arr, source, dest) {\n      let newArr = [];\n      for (let i = 0; i < arr.length; i++) {\n        let conv = proj4.transform(source, dest, arr[i]);\n        conv = [conv.x, conv.y];\n        newArr.push(conv);\n      }\n      return newArr;\n    },\n\n    // Takes an <layer-> element and returns a geojson feature collection object\n    // The options object can contain the following:\n    //      propertyFunction   - function(<map-properties>), A function that maps the features' <map-properties> element to   a GeoJSON \"properties\" member.\n    //      transform          - Bool, Transform coordinates to gcrs values, defaults to True\n    // mapml2geojson: <layer-> Object -> GeoJSON\n    mapml2geojson: function (element, options = {}) {\n      let defaults = {\n        propertyFunction: null,\n        transform: true\n      };\n      // assign default values for undefined options\n      options = Object.assign({}, defaults, options);\n\n      let json = {};\n      json.type = 'FeatureCollection';\n      json.title = element.getAttribute('label');\n      json.features = [];\n\n      // Transforming Coordinates to gcrs if transformation = true and coordinate is not (EPSG:3857 or EPSG:4326)\n      let source = null;\n      let dest = null;\n      if (options.transform) {\n        source = new proj4.Proj(element.parentElement._map.options.crs.code);\n        dest = new proj4.Proj('EPSG:4326');\n        if (\n          element.parentElement._map.options.crs.code === 'EPSG:3857' ||\n          element.parentElement._map.options.crs.code === 'EPSG:4326'\n        ) {\n          options.transform = false;\n        }\n      }\n\n      // Setting all meta settings, if any\n      let metas = element.querySelectorAll('map-meta');\n      metas.forEach((meta) => {\n        let name = meta.getAttribute('name');\n        if (name === 'extent') {\n          let content = meta.getAttribute('content');\n          let arr = content.split(',');\n          let ex = {};\n          for (let i = 0; i < arr.length; i++) {\n            let s = arr[i].split('=');\n            s[0] = s[0].trim(); // removing whitespace\n            s[1] = parseFloat(s[1]);\n            ex[s[0]] = s[1];\n          }\n          json.bbox = [\n            ex['top-left-longitude'],\n            ex['top-left-latitude'],\n            ex['bottom-right-longitude'],\n            ex['bottom-right-latitude']\n          ];\n        }\n      });\n\n      // Iterating over each feature\n      let features = element.querySelectorAll('map-feature');\n      let num = 0;\n\n      // Going over each feature in the layer\n      features.forEach((feature) => {\n        //console.log(feature);\n\n        json.features[num] = { type: 'Feature' };\n        json.features[num].geometry = {};\n        json.features[num].properties = {};\n\n        // setting properties when function presented\n        if (!feature.querySelector('map-properties')) {\n          json.features[num].properties = null;\n        } else if (typeof options.propertyFunction === 'function') {\n          let properties = options.propertyFunction(\n            feature.querySelector('map-properties')\n          );\n          json.features[num].properties = properties;\n        } else if (\n          feature.querySelector('map-properties').querySelector('table') !== null\n        ) {\n          // setting properties when table presented\n          let table = feature\n              .querySelector('map-properties')\n              .querySelector('table')\n              .cloneNode(true),\n            properties = M._table2properties(table);\n          json.features[num].properties = properties;\n        } else {\n          // when no table present, strip any possible html tags to only get text\n          json.features[num].properties = {\n            prop0: feature\n              .querySelector('map-properties')\n              .innerHTML.replace(/(<([^>]+)>)/gi, '')\n          };\n        }\n\n        let geom = feature.querySelector('map-geometry').firstElementChild;\n\n        // remove map-a, map-span elements if the geometry is wrapped in them\n        while (\n          geom.nodeName.toUpperCase() === 'MAP-SPAN' ||\n          geom.nodeName.toUpperCase() === 'MAP-A'\n        ) {\n          geom = geom.firstElementChild;\n        }\n\n        // Adding Geometry\n        if (geom.nodeName.toUpperCase() !== 'MAP-GEOMETRYCOLLECTION') {\n          json.features[num].geometry = M._geometry2geojson(\n            geom,\n            source,\n            dest,\n            options.transform\n          );\n        } else {\n          json.features[num].geometry.type = 'GeometryCollection';\n          json.features[num].geometry.geometries = [];\n\n          let geoms = geom.children;\n          Array.from(geoms).forEach((g) => {\n            // omit all map-span, map-a that may be present in geometry-collection\n            let n = g.nodeName.toUpperCase();\n            if (n === 'MAP-SPAN' || n === 'MAP-A') {\n              g = g.cloneNode(true);\n              [...g.querySelectorAll('map-a, map-span')].forEach((e) =>\n                e.replaceWith(...e.children)\n              );\n              Array.from(g.children).forEach((i) => {\n                i = M._geometry2geojson(i, source, dest, options.transform);\n                json.features[num].geometry.geometries.push(i);\n              });\n            } else {\n              g = M._geometry2geojson(g, source, dest, options.transform);\n              json.features[num].geometry.geometries.push(g);\n            }\n          });\n        }\n        //going to next feature\n        num++;\n      });\n\n      return json;\n    },\n\n    // Takes leaflet bound, leaflet map and min and max zoom limit,\n    // return the maximum zoom level that can show the bound completely\n    // getMaxZoom: L.Bound, L.Map, Number, Number -> Number\n    getMaxZoom: function (bound, map, minZoom, maxZoom) {\n      if (!bound) return;\n\n      let newZoom = map.getZoom(),\n        scale = map.options.crs.scale(newZoom),\n        mapCenterTCRS = map.options.crs.transformation.transform(\n          bound.getCenter(true),\n          scale\n        );\n\n      let mapHalf = map.getSize().divideBy(2),\n        mapTlNew = mapCenterTCRS.subtract(mapHalf).round(),\n        mapBrNew = mapCenterTCRS.add(mapHalf).round();\n\n      let mapTlPCRSNew = M.pixelToPCRSPoint(\n          mapTlNew,\n          newZoom,\n          map.options.projection\n        ),\n        mapBrPCRSNew = M.pixelToPCRSPoint(\n          mapBrNew,\n          newZoom,\n          map.options.projection\n        );\n\n      let mapPCRS = L.bounds(mapTlPCRSNew, mapBrPCRSNew),\n        zOffset = mapPCRS.contains(bound) ? 1 : -1;\n\n      while (\n        (zOffset === -1 && !mapPCRS.contains(bound) && newZoom - 1 >= minZoom) ||\n        (zOffset === 1 && mapPCRS.contains(bound) && newZoom + 1 <= maxZoom)\n      ) {\n        newZoom += zOffset;\n        scale = map.options.crs.scale(newZoom);\n        mapCenterTCRS = map.options.crs.transformation.transform(\n          bound.getCenter(true),\n          scale\n        );\n\n        mapTlNew = mapCenterTCRS.subtract(mapHalf).round();\n        mapBrNew = mapCenterTCRS.add(mapHalf).round();\n        mapTlPCRSNew = M.pixelToPCRSPoint(\n          mapTlNew,\n          newZoom,\n          map.options.projection\n        );\n        mapBrPCRSNew = M.pixelToPCRSPoint(\n          mapBrNew,\n          newZoom,\n          map.options.projection\n        );\n\n        mapPCRS = L.bounds(mapTlPCRSNew, mapBrPCRSNew);\n      }\n\n      if (\n        zOffset === 1 &&\n        newZoom - 1 >= 0 &&\n        !(newZoom === maxZoom && mapPCRS.contains(bound))\n      )\n        newZoom--;\n      return newZoom;\n    },\n    getClosest(node, selector) {\n      if (!node) {\n        return null;\n      }\n      if (node instanceof ShadowRoot) {\n        return M.getClosest(node.host, selector);\n      }\n\n      if (node instanceof HTMLElement) {\n        if (node.matches(selector)) {\n          return node;\n        } else {\n          return M.getClosest(node.parentNode, selector);\n        }\n      }\n\n      return M.getClosest(node.parentNode, selector);\n    }\n  };\n\n  var AttributionButton = L.Control.Attribution.extend({\n    options: {\n      prefix:\n        '<img src=\"https://www.w3.org/community/src/templates/wordpress/StoryTeller/favicon.ico\" style=\"position: relative; top: 5px\" alt=\"W3C Community and Business Groups logo\"> <a href=\"https://www.w3.org/community/maps4html/\">Maps for HTML Community Group</a> | <img src=\"data:image/svg+xml;base64,PHN2ZyBhcmlhLWhpZGRlbj0idHJ1ZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTIiIGhlaWdodD0iOCI+PHBhdGggZmlsbD0iIzRDN0JFMSIgZD0iTTAgMGgxMnY0SDB6Ii8+PHBhdGggZmlsbD0iI0ZGRDUwMCIgZD0iTTAgNGgxMnYzSDB6Ii8+PHBhdGggZmlsbD0iI0UwQkMwMCIgZD0iTTAgN2gxMnYxSDB6Ii8+PC9zdmc+\" style=\"padding-right: 0.3em;\" alt=\"Slava Ukraini\"> <a href=\"https://leafletjs.com\" title=\"A JS library for interactive maps\">Leaflet</a> '\n    },\n\n    onAdd: function (map) {\n      map.attributionControl = this;\n      this._container = L.DomUtil.create(\n        'details',\n        'leaflet-control-attribution'\n      );\n      L.DomEvent.disableClickPropagation(this._container);\n\n      for (var i in map._layers) {\n        if (map._layers[i].getAttribution) {\n          this.addAttribution(map._layers[i].getAttribution());\n        }\n      }\n\n      this._update();\n\n      map.on('layeradd', this._addAttribution, this);\n\n      let dialog = document.createElement('dialog');\n      dialog.setAttribute('class', 'shortcuts-dialog');\n      dialog.setAttribute('autofocus', '');\n      dialog.onclick = function (e) {\n        e.stopPropagation();\n      };\n      dialog.innerHTML =\n        `<b>${M.options.locale.kbdShortcuts} </b><button aria-label=\"Close\" onclick='this.parentElement.close()'>X</button>` +\n        `<ul><b>${M.options.locale.kbdMovement}</b><li><kbd>&#8593</kbd> ${M.options.locale.kbdPanUp}</li><li><kbd>&#8595</kbd> ${M.options.locale.kbdPanDown}</li><li><kbd>&#8592</kbd> ${M.options.locale.kbdPanLeft}</li><li><kbd>&#8594</kbd> ${M.options.locale.kbdPanRight}</li><li><kbd>+</kbd> ${M.options.locale.btnZoomIn}</li><li><kbd>-</kbd> ${M.options.locale.btnZoomOut}</li><li><kbd>shift</kbd> + <kbd>&#8592/&#8593/&#8594/&#8595</kbd> 3x ${M.options.locale.kbdPanIncrement}</li><li><kbd>ctrl</kbd> + <kbd>&#8592/&#8593/&#8594/&#8595</kbd> 0.2x ${M.options.locale.kbdPanIncrement}</li><li><kbd>shift</kbd> + <kbd>+/-</kbd> ${M.options.locale.kbdZoom}</li></ul>` +\n        `<ul><b>${M.options.locale.kbdFeature}</b><li><kbd>&#8592/&#8593</kbd> ${M.options.locale.kbdPrevFeature}</li><li><kbd>&#8594/&#8595</kbd> ${M.options.locale.kbdNextFeature}</li></ul>`;\n      map._container.appendChild(dialog);\n\n      return this._container;\n    },\n\n    _update: function () {\n      if (!this._map) {\n        return;\n      }\n\n      var attribs = [];\n\n      for (var i in this._attributions) {\n        if (this._attributions[i]) {\n          attribs.push(i);\n        }\n      }\n\n      var prefixAndAttribs = [];\n\n      if (this.options.prefix) {\n        prefixAndAttribs.push(this.options.prefix);\n      }\n      if (attribs.length) {\n        prefixAndAttribs.push(attribs.join(', '));\n      }\n      this._container.innerHTML =\n        `<summary><svg aria-hidden=\"true\" xmlns=\"http://www.w3.org/2000/svg\" height=\"30px\" viewBox=\"0 0 24 24\" width=\"30px\" fill=\"currentColor\"><path d=\"M0 0h24v24H0V0z\" fill=\"none\"></path><path d=\"M11 7h2v2h-2zm0 4h2v6h-2zm1-9C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z\"></path></svg></summary>` +\n        '<div class=\"mapml-attribution-container\">' +\n        `<button onclick=\"this.closest(\\'.leaflet-container\\').querySelector(\\'.shortcuts-dialog\\').showModal()\" class=\"shortcuts-button mapml-button\">${M.options.locale.kbdShortcuts}</button> | ` +\n        prefixAndAttribs.join(' <span aria-hidden=\"true\">|</span> ') +\n        '</div>';\n      this._container.setAttribute('role', 'group');\n      this._container.setAttribute(\n        'aria-label',\n        `${M.options.locale.btnAttribution}`\n      );\n    }\n  });\n\n  L.Map.mergeOptions({\n    attributionControl: false,\n    toggleableAttributionControl: true\n  });\n\n  L.Map.addInitHook(function () {\n    if (this.options.toggleableAttributionControl) {\n      new AttributionButton().addTo(this);\n    }\n  });\n\n  var attributionButton = function (options) {\n    return new AttributionButton(options);\n  };\n\n  var ReloadButton = L.Control.extend({\n    options: {\n      position: 'topleft'\n    },\n\n    onAdd: function (map) {\n      let container = L.DomUtil.create('div', 'mapml-reload-button leaflet-bar');\n\n      let link = L.DomUtil.create('button', 'mapml-reload-button', container);\n      link.innerHTML = \"<span aria-hidden='true'>&#x021BA</span>\";\n      link.title = M.options.locale.cmReload;\n      link.setAttribute('type', 'button');\n      link.classList.add('mapml-button');\n      link.setAttribute('aria-label', 'Reload');\n\n      L.DomEvent.disableClickPropagation(link);\n      L.DomEvent.on(link, 'click', L.DomEvent.stop);\n      L.DomEvent.on(link, 'click', this._goReload, this);\n\n      this._reloadButton = link;\n\n      this._updateDisabled();\n      map.on('moveend', this._updateDisabled, this);\n\n      return container;\n    },\n\n    onRemove: function (map) {\n      map.off('moveend', this._updateDisabled, this);\n    },\n\n    disable: function () {\n      this._disabled = true;\n      this._updateDisabled();\n      return this;\n    },\n\n    enable: function () {\n      this._disabled = false;\n      this._updateDisabled();\n      return this;\n    },\n\n    _goReload: function (e) {\n      if (!this._disabled && this._map.options.mapEl._history.length > 1) {\n        this._map.options.mapEl.reload();\n      }\n    },\n\n    _updateDisabled: function () {\n      setTimeout(() => {\n        L.DomUtil.removeClass(this._reloadButton, 'leaflet-disabled');\n        this._reloadButton.setAttribute('aria-disabled', 'false');\n\n        if (\n          this._map &&\n          (this._disabled || this._map.options.mapEl._history.length <= 1)\n        ) {\n          L.DomUtil.addClass(this._reloadButton, 'leaflet-disabled');\n          this._reloadButton.setAttribute('aria-disabled', 'true');\n        }\n      }, 0);\n    }\n  });\n\n  var reloadButton = function (options) {\n    return new ReloadButton(options);\n  };\n\n  var ScaleBar = L.Control.Scale.extend({\n    options: {\n      maxWidth: 100,\n      updateWhenIdle: true,\n      position: 'bottomleft'\n    },\n\n    onAdd: function (map) {\n      // create output tag for screenreader to read from\n      let outputScale =\n        \"<output role='status' aria-live='polite' aria-atomic='true' class='mapml-screen-reader-output-scale'></output>\";\n      map._container.insertAdjacentHTML('beforeend', outputScale);\n\n      // initialize _container\n      this._container = L.DomUtil.create('div', 'mapml-control-scale');\n      let scaleControl = L.Control.Scale.prototype.onAdd.call(this, map);\n      this._container.appendChild(scaleControl);\n      this._container.setAttribute('tabindex', 0);\n      this._scaleControl = this;\n\n      // run on load\n      setTimeout(() => {\n        this._updateOutput();\n        this._focusOutput();\n      }, 0);\n\n      // update whenever map is zoomed or dragged\n      map.on('zoomend moveend', this._updateOutput, this);\n\n      // have screenreader read out everytime the map is focused\n      this._map._container.addEventListener('focus', () => this._focusOutput());\n\n      return this._container;\n    },\n\n    onRemove: function (map) {\n      map.off('zoomend moveend', this._updateOutput, this);\n    },\n\n    getContainer: function () {\n      return this._container;\n    },\n\n    _pixelsToDistance: function (px, units) {\n      let dpi = window.devicePixelRatio * 96; // default dpi\n      if (units === 'metric') {\n        return (px / dpi) * 2.54; // inches to cm\n      }\n      return px / dpi;\n    },\n\n    _scaleLength: function (scale) {\n      let scaleLength = scale.getAttribute('style');\n      let finalLength = parseInt(scaleLength.match(/width:\\s*(\\d+)px/)[1]);\n\n      return finalLength;\n    },\n\n    _focusOutput: function () {\n      setTimeout(() => {\n        let outputFocus = this._map._container.querySelector(\n          '.mapml-screen-reader-output-scale'\n        );\n        outputFocus.textContent = '';\n        setTimeout(() => {\n          outputFocus.textContent = this._container.getAttribute('aria-label');\n        }, 100);\n      }, 0);\n    },\n\n    _updateOutput: function () {\n      let output = '';\n      let scaleLine = this._scaleControl\n        .getContainer()\n        .getElementsByClassName('leaflet-control-scale-line')[0];\n\n      if (this.options.metric) {\n        let distance = parseFloat(\n          this._pixelsToDistance(this._scaleLength(scaleLine), 'metric').toFixed(\n            1\n          )\n        );\n        output = `${distance} centimeters to ${scaleLine.textContent.trim()}`;\n        output = output.replace(/(\\d+)\\s*m\\b/g, '$1 meters');\n        output = output.replace(/ km/g, ' kilometers');\n      } else {\n        let distance = parseFloat(\n          this._pixelsToDistance(\n            this._scaleLength(scaleLine),\n            'imperial'\n          ).toFixed(1)\n        );\n        output = `${distance} inches to ${scaleLine.textContent.trim()}`;\n        output = output.replace(/ft/g, 'feet');\n        output = output.replace(/mi/g, 'miles');\n      }\n\n      this._container.setAttribute('aria-label', output);\n      this._map._container.querySelector(\n        '.mapml-screen-reader-output-scale'\n      ).textContent = output;\n    }\n  });\n  var scaleBar = function (options) {\n    return new ScaleBar(options);\n  };\n\n  var FullscreenButton = L.Control.extend({\n    options: {\n      position: 'topleft',\n      title: {\n        false: 'View Fullscreen',\n        true: 'Exit Fullscreen'\n      }\n    },\n\n    onAdd: function (map) {\n      var container = L.DomUtil.create(\n        'div',\n        'leaflet-control-fullscreen leaflet-bar leaflet-control'\n      );\n\n      this.link = L.DomUtil.create(\n        'a',\n        'leaflet-control-fullscreen-button leaflet-bar-part',\n        container\n      );\n      this.link.href = '#';\n      this.link.setAttribute('role', 'button');\n\n      this._map = map;\n      this._map.on('fullscreenchange', this._toggleTitle, this);\n      this._toggleTitle();\n\n      L.DomEvent.on(this.link, 'click', this._click, this);\n\n      return container;\n    },\n\n    onRemove: function (map) {\n      map.off('fullscreenchange', this._toggleTitle, this);\n    },\n\n    _click: function (e) {\n      L.DomEvent.stopPropagation(e);\n      L.DomEvent.preventDefault(e);\n      this._map.toggleFullscreen(this.options);\n    },\n\n    _toggleTitle: function () {\n      this.link.title = this.options.title[this._map.isFullscreen()];\n    }\n  });\n\n  L.Map.include({\n    isFullscreen: function () {\n      return this._isFullscreen || false;\n    },\n\n    toggleFullscreen: function (options) {\n      // the <map> element can't contain a shadow root, so we used a child <div>\n      // <mapml-viewer> can contain a shadow root, so return it directly\n      var mapEl = M.getClosest(this.getContainer(), 'mapml-viewer,[is=web-map]');\n      if (this.isFullscreen()) {\n        if (options && options.pseudoFullscreen) {\n          this._disablePseudoFullscreen(mapEl);\n        } else if (document.exitFullscreen) {\n          document.exitFullscreen();\n        } else if (document.mozCancelFullScreen) {\n          document.mozCancelFullScreen();\n        } else if (document.webkitCancelFullScreen) {\n          document.webkitCancelFullScreen();\n        } else if (document.msExitFullscreen) {\n          document.msExitFullscreen();\n        } else {\n          this._disablePseudoFullscreen(mapEl);\n        }\n      } else {\n        if (options && options.pseudoFullscreen) {\n          this._enablePseudoFullscreen(mapEl);\n        } else if (mapEl.requestFullscreen) {\n          mapEl.requestFullscreen();\n        } else if (mapEl.mozRequestFullScreen) {\n          mapEl.mozRequestFullScreen();\n        } else if (mapEl.webkitRequestFullscreen) {\n          mapEl.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT);\n        } else if (mapEl.msRequestFullscreen) {\n          mapEl.msRequestFullscreen();\n        } else {\n          this._enablePseudoFullscreen(mapEl);\n        }\n      }\n      this.getContainer().focus();\n    },\n\n    _enablePseudoFullscreen: function (container) {\n      L.DomUtil.addClass(container, 'leaflet-pseudo-fullscreen');\n      this._setFullscreen(true);\n      this.fire('fullscreenchange');\n    },\n\n    _disablePseudoFullscreen: function (container) {\n      L.DomUtil.removeClass(container, 'leaflet-pseudo-fullscreen');\n      this._setFullscreen(false);\n      this.fire('fullscreenchange');\n    },\n\n    _setFullscreen: function (fullscreen) {\n      this._isFullscreen = fullscreen;\n      var container = M.getClosest(\n        this.getContainer(),\n        'mapml-viewer,[is=web-map]'\n      );\n      if (fullscreen) {\n        L.DomUtil.addClass(container, 'mapml-fullscreen-on');\n      } else {\n        L.DomUtil.removeClass(container, 'mapml-fullscreen-on');\n      }\n      this.invalidateSize();\n    },\n\n    _onFullscreenChange: function (e) {\n      var fullscreenElement = M.getClosest(this.getContainer(), ':fullscreen'),\n        mapEl = M.getClosest(this.getContainer(), 'mapml-viewer,[is=web-map]');\n      if (fullscreenElement === mapEl && !this._isFullscreen) {\n        this._setFullscreen(true);\n        this.fire('fullscreenchange');\n      } else if (fullscreenElement !== mapEl && this._isFullscreen) {\n        this._setFullscreen(false);\n        this.fire('fullscreenchange');\n      }\n    }\n  });\n\n  L.Map.mergeOptions({\n    fullscreenControl: false\n  });\n\n  L.Map.addInitHook(function () {\n    if (this.options.fullscreenControl) {\n      this.fullscreenControl = new FullscreenButton(\n        this.options.fullscreenControl\n      );\n      this.addControl(this.fullscreenControl);\n    }\n\n    var fullscreenchange;\n\n    if ('onfullscreenchange' in document) {\n      fullscreenchange = 'fullscreenchange';\n    } else if ('onmozfullscreenchange' in document) {\n      fullscreenchange = 'mozfullscreenchange';\n    } else if ('onwebkitfullscreenchange' in document) {\n      fullscreenchange = 'webkitfullscreenchange';\n    } else if ('onmsfullscreenchange' in document) {\n      fullscreenchange = 'MSFullscreenChange';\n    }\n\n    if (fullscreenchange) {\n      var onFullscreenChange = L.bind(this._onFullscreenChange, this);\n\n      this.whenReady(function () {\n        L.DomEvent.on(document, fullscreenchange, onFullscreenChange);\n      });\n\n      this.on('unload', function () {\n        L.DomEvent.off(document, fullscreenchange, onFullscreenChange);\n      });\n    }\n  });\n\n  var fullscreenButton = function (options) {\n    return new FullscreenButton(options);\n  };\n\n  var GeolocationButton = L.Control.extend({\n    options: {\n      position: 'bottomright'\n    },\n\n    onAdd: function (map) {\n      // customize locate control to focus map after start/stop, so that\n      // featureIndexOverlay is correctly displayed\n      L.Control.CustomLocate = L.Control.Locate.extend({\n        start: function () {\n          L.Control.Locate.prototype.start.call(this);\n          map.getContainer().focus();\n        },\n        stop: function () {\n          L.Control.Locate.prototype.stop.call(this);\n          map.getContainer().focus();\n        }\n      });\n      this.locateControl = new L.Control.CustomLocate({\n        showPopup: false,\n        strings: {\n          title: M.options.locale.btnLocTrackOff\n        },\n        position: this.options.position,\n        locateOptions: {\n          maxZoom: 16\n        }\n      }).addTo(map);\n\n      var container = this.locateControl._container;\n      var button = this.locateControl;\n      var observer = new MutationObserver(function (mutations) {\n        if (\n          container.classList.contains('active') &&\n          container.classList.contains('following')\n        ) {\n          container.firstChild.title = M.options.locale.btnLocTrackOn;\n          button._marker.bindTooltip(M.options.locale.btnMyLocTrackOn, {\n            permanent: true\n          });\n        } else if (container.classList.contains('active')) {\n          container.firstChild.title = M.options.locale.btnLocTrackLastKnown;\n          button._marker.bindTooltip(M.options.locale.btnMyLastKnownLocTrackOn);\n        } else {\n          container.firstChild.title = M.options.locale.btnLocTrackOff;\n        }\n      });\n      var observerConfig = { attributes: true, attributeFilter: ['class'] };\n      observer.observe(container, observerConfig);\n\n      return container;\n    },\n\n    stop: function () {\n      return this.locateControl.stop();\n    }\n  });\n\n  var geolocationButton = function (options) {\n    return new GeolocationButton(options);\n  };\n\n  var Crosshair = L.Layer.extend({\n    onAdd: function (map) {\n      // SVG crosshair design from https://github.com/xguaita/Leaflet.MapCenterCoord/blob/master/src/icons/MapCenterCoordIcon1.svg?short_path=81a5c76\n      // Optimized with SVGOMG: https://jakearchibald.github.io/svgomg/\n      let svgInnerHTML = `<svg xmlns=\"http://www.w3.org/2000/svg\" xml:space=\"preserve\" viewBox=\"0 0 100 100\"><g stroke=\"#fff\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><circle cx=\"50.028\" cy=\"50.219\" r=\"3.923\" stroke-width=\"2\" color=\"currentColor\" overflow=\"visible\"/><path stroke-width=\"3\" d=\"M4.973 54.424h31.768a4.204 4.204 0 1 0 0-8.409H4.973A4.203 4.203 0 0 0 .77 50.22a4.203 4.203 0 0 0 4.204 4.205z\" color=\"currentColor\" overflow=\"visible\"/><path stroke-width=\"3\" d=\"M54.232 5.165a4.204 4.204 0 1 0-8.408 0v31.767a4.204 4.204 0 1 0 8.408 0V5.165z\"/><path stroke-width=\"3\" d=\"M99.288 50.22a4.204 4.204 0 0 0-4.204-4.205H63.317a4.204 4.204 0 1 0 0 8.409h31.767a4.205 4.205 0 0 0 4.204-4.205zM45.823 95.274a4.204 4.204 0 1 0 8.409 0V63.506a4.204 4.204 0 1 0-8.409 0v31.768z\" color=\"currentColor\" overflow=\"visible\"/></g></svg>`;\n\n      this._container = L.DomUtil.create(\n        'div',\n        'mapml-crosshair',\n        map._container\n      );\n      this._container.innerHTML = svgInnerHTML;\n      map.isFocused = false;\n      this._isQueryable = false;\n\n      map.on(\n        'layerchange layeradd layerremove overlayremove',\n        this._toggleEvents,\n        this\n      );\n      map.on('popupopen', this._isMapFocused, this);\n      L.DomEvent.on(\n        map._container,\n        'keydown keyup mousedown',\n        this._isMapFocused,\n        this\n      );\n\n      this._addOrRemoveCrosshair();\n    },\n\n    onRemove: function (map) {\n      map.off(\n        'layerchange layeradd layerremove overlayremove',\n        this._toggleEvents\n      );\n      map.off('popupopen', this._isMapFocused);\n      L.DomEvent.off(\n        map._container,\n        'keydown keyup mousedown',\n        this._isMapFocused\n      );\n    },\n\n    _toggleEvents: function () {\n      if (this._hasQueryableLayer()) {\n        this._map.on('viewreset move moveend', this._addOrRemoveCrosshair, this);\n      } else {\n        this._map.off('viewreset move moveend', this._addOrRemoveCrosshair, this);\n      }\n      this._addOrRemoveCrosshair();\n    },\n\n    _addOrRemoveCrosshair: function (e) {\n      if (this._hasQueryableLayer()) {\n        this._container.removeAttribute('hidden');\n      } else {\n        this._container.setAttribute('hidden', '');\n      }\n    },\n\n    _addOrRemoveMapOutline: function (e) {\n      let mapContainer = this._map._container;\n      if (this._map.isFocused && !this._outline) {\n        this._outline = L.DomUtil.create('div', 'mapml-outline', mapContainer);\n      } else if (!this._map.isFocused && this._outline) {\n        L.DomUtil.remove(this._outline);\n        delete this._outline;\n      }\n    },\n\n    _hasQueryableLayer: function () {\n      let layers = this._map.options.mapEl.layers;\n      if (this._map.isFocused) {\n        for (let layer of layers) {\n          if (layer.queryable()) {\n            return true;\n          }\n        }\n      }\n      return false;\n    },\n\n    // TODO: should be merged with the 'mapfocused' event emitted by mapml-viewer and map, not trivial\n    _isMapFocused: function (e) {\n      //set this._map.isFocused = true if arrow buttons are used\n      if (!this._map._container.parentNode.activeElement) {\n        this._map.isFocused = false;\n        return;\n      }\n      let isLeafletContainer =\n        this._map._container.parentNode.activeElement.classList.contains(\n          'leaflet-container'\n        );\n      if (\n        isLeafletContainer &&\n        ['keydown'].includes(e.type) &&\n        e.shiftKey &&\n        e.keyCode === 9\n      ) {\n        this._map.isFocused = false;\n      } else\n        this._map.isFocused =\n          isLeafletContainer && ['keyup', 'keydown'].includes(e.type);\n\n      if (this._map.isFocused) this._map.fire('mapkeyboardfocused');\n      this._addOrRemoveMapOutline();\n      this._addOrRemoveCrosshair();\n    }\n  });\n\n  var crosshair = function (options) {\n    return new Crosshair(options);\n  };\n\n  /**\n   * M.Path is a extension of L.Path that understands mapml feature markup\n   * It converts the markup to the following structure (abstract enough to encompass all feature types) for example:\n   *  this._outlinePath = HTMLElement;\n   *  this._parts = [\n   *    {\n   *      path: HTMLElement,\n   *      rings:[\n   *        {points:[{x:1,y:1}, ...]},\n   *        ...\n   *      ],\n   *      subrings:[\n   *        {points:[{x:2, y:2}, ...], cls:\"Span Class Name\", path: HTMLElement,},\n   *        ...\n   *      ],\n   *      cls:\"className\",\n   *    },\n   *    ...\n   *  ];\n   */\n  var Path = L.Path.extend({\n    /**\n     * Initializes the M.Path\n     * @param {HTMLElement} markup - The markup representation of the feature\n     * @param {Object} options - The options of the feature\n     */\n    initialize: function (markup, options) {\n      this.type = markup.tagName.toUpperCase();\n\n      if (this.type === 'MAP-POINT' || this.type === 'MAP-MULTIPOINT')\n        options.fillOpacity = 1;\n\n      if (options.wrappers.length > 0)\n        options = Object.assign(this._convertWrappers(options.wrappers), options);\n      L.setOptions(this, options);\n\n      this.group = this.options.group;\n      this.options.interactive =\n        this.options.link ||\n        (this.options.properties && this.options.onEachFeature);\n\n      this._parts = [];\n      this._markup = markup;\n      this.options.zoom = markup.zoom ?? this.options.nativeZoom;\n\n      this._convertMarkup();\n\n      if (markup.querySelector('map-span') || markup.querySelector('map-a')) {\n        this._generateOutlinePoints();\n      }\n\n      this.isClosed = this._isClosed();\n    },\n\n    /**\n     * Attaches link handler to the sub parts' paths\n     * @param {SVGElement} elem - The element to add listeners to, either path or g elements\n     * @param {Object} link - The link object that contains the url, type and target data\n     * @param leafletLayer\n     */\n    attachLinkHandler: function (elem, link, leafletLayer) {\n      let dragStart,\n        container = document.createElement('div'),\n        p = document.createElement('p'),\n        hovered = false;\n      container.classList.add('mapml-link-preview');\n      container.appendChild(p);\n      elem.classList.add('map-a');\n      if (link.visited) elem.classList.add('map-a-visited');\n      elem.mousedown = (e) => (dragStart = { x: e.clientX, y: e.clientY });\n      L.DomEvent.on(elem, 'mousedown', elem.mousedown, this);\n      elem.mouseup = (e) => {\n        if (e.button !== 0) return; // don't trigger when button isn't left click\n        let onTop = true,\n          nextLayer = this.options._leafletLayer._layerEl.nextElementSibling;\n        while (nextLayer && onTop) {\n          if (nextLayer.tagName && nextLayer.tagName.toUpperCase() === 'LAYER-')\n            onTop = !nextLayer.queryable();\n          nextLayer = nextLayer.nextElementSibling;\n        }\n        if (onTop && dragStart) {\n          //M._handleLink gets called twice, once in the target phase on the path\n          //element, then in the bubble phase on the g element\n          //Using stopPropagation leaves the mouse in the mousedown state\n          if (e.eventPhase === Event.BUBBLING_PHASE) return;\n          let dist = Math.sqrt(\n            Math.pow(dragStart.x - e.clientX, 2) +\n              Math.pow(dragStart.y - e.clientY, 2)\n          );\n          if (dist <= 5) {\n            link.visited = true;\n            elem.setAttribute('stroke', '#6c00a2');\n            elem.classList.add('map-a-visited');\n            M._handleLink(link, leafletLayer);\n          }\n        }\n      };\n      L.DomEvent.on(elem, 'mouseup', elem.mouseup, this);\n      L.DomEvent.on(\n        elem,\n        'keypress',\n        (e) => {\n          L.DomEvent.stop(e);\n          if (e.keyCode === 13 || e.keyCode === 32) {\n            link.visited = true;\n            elem.setAttribute('stroke', '#6c00a2');\n            elem.classList.add('map-a-visited');\n            M._handleLink(link, leafletLayer);\n          }\n        },\n        this\n      );\n      L.DomEvent.on(\n        elem,\n        'mouseenter keyup',\n        (e) => {\n          if (e.target !== e.currentTarget) return;\n          hovered = true;\n          let resolver = document.createElement('a'),\n            mapWidth = this._map.getContainer().clientWidth;\n          resolver.href = link.url;\n          p.innerHTML = resolver.href;\n\n          this._map.getContainer().appendChild(container);\n\n          while (p.clientWidth > mapWidth / 2) {\n            p.innerHTML =\n              p.innerHTML.substring(0, p.innerHTML.length - 5) + '...';\n          }\n          setTimeout(() => {\n            if (hovered) p.innerHTML = resolver.href;\n          }, 1000);\n        },\n        this\n      );\n      L.DomEvent.on(\n        elem,\n        'mouseout keydown mousedown',\n        (e) => {\n          if (e.target !== e.currentTarget || !container.parentElement) return;\n          hovered = false;\n          this._map.getContainer().removeChild(container);\n        },\n        this\n      );\n      leafletLayer.on('add', addMouseHandler, leafletLayer);\n      function handleMouse(e) {\n        //adds a lot of event handlers\n        if (!container.parentElement) return;\n        hovered = false;\n        this._map.getContainer().removeChild(container);\n      }\n      function addMouseHandler() {\n        L.DomEvent.on(\n          this._map.getContainer(),\n          'mouseout mouseenter click',\n          handleMouse,\n          this\n        );\n      }\n      leafletLayer.on('remove', removeMouseHandler, leafletLayer);\n      function removeMouseHandler() {\n        L.DomEvent.off(this._map.getContainer(), {\n          mouseout: handleMouse,\n          mouseenter: handleMouse,\n          click: handleMouse\n        });\n      }\n    },\n\n    /**\n     * Updates internal structure of the feature to the new map state, the structure can be found in this._parts\n     * @param {L.Map} addedMap - The map that the feature is part of, can be left blank in the case of static features\n     * @param {L.Point} tileOrigin - The tile origin for the feature, if blank then it takes the maps pixel origin in the function\n     * @param {int} zoomingTo - The zoom the map is animating to, if left blank then it takes the map zoom, its provided because in templated tiles zoom is delayed\n     * @private\n     */\n    _project: function (addedMap, tileOrigin = undefined, zoomingTo = undefined) {\n      let map = addedMap || this._map,\n        origin = tileOrigin || map.getPixelOrigin(),\n        zoom = zoomingTo === undefined ? map.getZoom() : zoomingTo;\n      for (let p of this._parts) {\n        p.pixelRings = this._convertRing(p.rings, map, origin, zoom);\n        for (let subP of p.subrings) {\n          subP.pixelSubrings = this._convertRing([subP], map, origin, zoom);\n        }\n      }\n      if (!this._outline) return;\n      this.pixelOutline = [];\n      for (let o of this._outline) {\n        this.pixelOutline = this.pixelOutline.concat(\n          this._convertRing(o, map, origin, zoom)\n        );\n      }\n    },\n\n    /**\n     * Converts the PCRS points to pixel points that can be used to create the SVG\n     * @param {L.Point[][]} r - Is the rings of a feature, either the mainParts, subParts or outline\n     * @param {L.Map} map - The map that the feature is part of\n     * @param {L.Point} origin - The origin used to calculate the pixel points\n     * @param {int} zoom - The current zoom level of the map\n     * @returns {L.Point[][]}\n     * @private\n     */\n    _convertRing: function (r, map, origin, zoom) {\n      // TODO: Implement Ramer-Douglas-Peucer Algo for simplifying points\n      let scale = map.options.crs.scale(zoom),\n        parts = [];\n      for (let sub of r) {\n        let interm = [];\n        for (let p of sub.points) {\n          let conv = map.options.crs.transformation.transform(p, scale);\n          interm.push(L.point(conv.x, conv.y)._subtract(origin).round());\n        }\n        parts.push(interm);\n      }\n      return parts;\n    },\n\n    /**\n     * Updates the features\n     * @private\n     */\n    _update: function () {\n      if (!this._map) return;\n      this._renderer._updateFeature(this);\n    },\n\n    /**\n     * Converts the map-spans, a and divs around a geometry subtype into options for the feature\n     * @param {HTMLElement[]} elems - The current zoom level of the map\n     * @private\n     */\n    _convertWrappers: function (elems) {\n      if (!elems || elems.length === 0) return;\n      let classList = '',\n        output = {};\n      for (let elem of elems) {\n        if (elem.tagName.toUpperCase() !== 'MAP-A' && elem.className) {\n          classList += `${elem.className} `;\n        } else if (!output.link && elem.getAttribute('href')) {\n          let link = {};\n          link.url = elem.getAttribute('href');\n          if (elem.hasAttribute('target'))\n            link.target = elem.getAttribute('target');\n          if (elem.hasAttribute('type')) link.type = elem.getAttribute('type');\n          if (elem.hasAttribute('inplace')) link.inPlace = true;\n          output.link = link;\n        }\n      }\n      output.className = `${classList} ${this.options.className}`.trim();\n      return output;\n    },\n\n    /**\n     * Converts this._markup to the internal structure of features\n     * @private\n     */\n    _convertMarkup: function () {\n      if (!this._markup) return;\n\n      let attr = this._markup.attributes;\n      this.featureAttributes = {};\n      if (\n        this.options.link &&\n        this._markup.parentElement.tagName.toUpperCase() === 'MAP-A' &&\n        this._markup.parentElement.parentElement.tagName.toUpperCase() !==\n          'MAP-GEOMETRY'\n      )\n        this.featureAttributes.tabindex = '0';\n      for (let i = 0; i < attr.length; i++) {\n        this.featureAttributes[attr[i].name] = attr[i].value;\n      }\n\n      let first = true;\n      for (let c of this._markup.querySelectorAll('map-coordinates')) {\n        //loops through the coordinates of the child\n        let ring = [],\n          subRings = [];\n        this._coordinateToArrays(c, ring, subRings, this.options.className); //creates an array of pcrs points for the main ring and the subparts\n        if (!first && this.type === 'MAP-POLYGON') {\n          this._parts[0].rings.push(ring[0]);\n          if (subRings.length > 0)\n            this._parts[0].subrings = this._parts[0].subrings.concat(subRings);\n        } else if (this.type === 'MAP-MULTIPOINT') {\n          for (let point of ring[0].points.concat(subRings)) {\n            this._parts.push({\n              rings: [{ points: [point] }],\n              subrings: [],\n              cls: `${point.cls || ''} ${this.options.className || ''}`.trim()\n            });\n          }\n        } else {\n          this._parts.push({\n            rings: ring,\n            subrings: subRings,\n            cls: `${this.featureAttributes.class || ''} ${\n            this.options.className || ''\n          }`.trim()\n          });\n        }\n        first = false;\n      }\n    },\n\n    /**\n     * Generates the feature outline, subtracting the map-spans to generate those separately\n     * @private\n     */\n    _generateOutlinePoints: function () {\n      if (\n        this.type === 'MAP-MULTIPOINT' ||\n        this.type === 'MAP-POINT' ||\n        this.type === 'MAP-LINESTRING' ||\n        this.type === 'MAP-MULTILINESTRING'\n      )\n        return;\n\n      this._outline = [];\n      for (let coords of this._markup.querySelectorAll('map-coordinates')) {\n        let nodes = coords.childNodes,\n          cur = 0,\n          tempDiv = document.createElement('div'),\n          nodeLength = nodes.length;\n        for (let i = 0; i < nodes.length; i++) {\n          if (nodes[i].textContent.trim().length === 0) {\n            nodes[i].remove();\n          }\n        }\n        for (let n of nodes) {\n          let line = [];\n          if (!n.tagName) {\n            //no tagName means it's text content\n            let c = '',\n              ind = (((cur - 1) % nodes.length) + nodes.length) % nodes.length; // this equation turns Javascript's % to how it behaves in C for example\n            if (nodes[ind].tagName) {\n              let prev = nodes[ind].textContent.trim().split(/\\s+/);\n              c += `${prev[prev.length - 2]} ${prev[prev.length - 1]} `;\n            }\n            c += n.textContent;\n            ind = (((cur + 1) % nodes.length) + nodes.length) % nodes.length; // this is equivalent to C/C++'s (cur + 1) % nodes.length\n            if (nodes[ind].tagName) {\n              let next = nodes[ind].textContent.trim().split(/\\s+/);\n              c += ` ${next[0]} ${next[1]} `;\n            }\n            tempDiv.innerHTML = c;\n            this._coordinateToArrays(\n              tempDiv,\n              line,\n              [],\n              true,\n              this.featureAttributes.class || this.options.className\n            );\n            this._outline.push(line);\n          }\n          cur++;\n        }\n      }\n    },\n\n    /**\n     * Converts map-coordinates element to an object representing the parts and subParts\n     * @param {HTMLElement} coords - A single map-coordinates element\n     * @param {Object[]} main - An empty array representing the main parts\n     * @param {Object[]} subParts - An empty array representing the sub parts\n     * @param {boolean} isFirst - A true | false representing if the current HTML element is the parent map-coordinates element or not\n     * @param {string} cls - The class of the coordinate/span\n     * @param parents\n     * @private\n     */\n    _coordinateToArrays: function (\n      coords,\n      main,\n      subParts,\n      isFirst = true,\n      cls = undefined,\n      parents = []\n    ) {\n      for (let span of coords.children) {\n        this._coordinateToArrays(\n          span,\n          main,\n          subParts,\n          false,\n          span.getAttribute('class'),\n          parents.concat([span])\n        );\n      }\n      let noSpan = coords.textContent.replace(/(<([^>]+)>)/gi, ''),\n        pairs = noSpan.trim().match(/(\\S+\\s+\\S+)/gim),\n        local = [],\n        bounds;\n      for (let p of pairs) {\n        let numPair = [];\n        p.split(/\\s+/gim).forEach(M._parseNumber, numPair);\n        let point = M.pointToPCRSPoint(\n          L.point(numPair),\n          this.options.zoom,\n          this.options.projection,\n          this.options.nativeCS\n        );\n        local.push(point);\n        bounds = bounds ? bounds.extend(point) : L.bounds(point, point);\n      }\n      if (this._bounds) {\n        this._bounds.extend(bounds.min);\n        this._bounds.extend(bounds.max);\n      } else {\n        this._bounds = bounds;\n      }\n      if (isFirst) {\n        main.push({ points: local });\n      } else {\n        let attrMap = {},\n          attr = coords.attributes,\n          wrapperAttr = this._convertWrappers(parents);\n        if (wrapperAttr.link) attrMap.tabindex = '0';\n        for (let i = 0; i < attr.length; i++) {\n          if (attr[i].name === 'class') continue;\n          attrMap[attr[i].name] = attr[i].value;\n        }\n        subParts.unshift({\n          points: local,\n          center: bounds.getCenter(),\n          cls: `${cls || ''} ${wrapperAttr.className || ''}`.trim(),\n          attr: attrMap,\n          link: wrapperAttr.link,\n          linkTarget: wrapperAttr.linkTarget,\n          linkType: wrapperAttr.linkType\n        });\n      }\n    },\n\n    /**\n     * Returns if the feature is closed or open, useful when styling\n     * @returns {boolean}\n     * @private\n     */\n    _isClosed: function () {\n      switch (this.type) {\n        case 'MAP-POLYGON':\n        case 'MAP-MULTIPOLYGON':\n        case 'MAP-POINT':\n        case 'MAP-MULTIPOINT':\n          return true;\n        case 'MAP-LINESTRING':\n        case 'MAP-MULTILINESTRING':\n          return false;\n        default:\n          return false;\n      }\n    },\n\n    /**\n     * Returns the center of the entire feature\n     * @returns {L.Point}\n     */\n    getCenter: function () {\n      if (!this._bounds) return null;\n      return this._map.options.crs.unproject(this._bounds.getCenter());\n    },\n\n    getPCRSCenter: function () {\n      return this._bounds.getCenter();\n    }\n  });\n\n  /**\n   *\n   * @param {HTMLElement} markup - The markup of the feature\n   * @param {Object} options - Options of the feature\n   * @returns {M.Path}\n   */\n  var path = function (markup, options) {\n    return new Path(markup, options);\n  };\n\n  /**\n   * Returns a new Feature Renderer\n   * @param {Object} options - Options for the renderer\n   * @returns {*}\n   */\n  var FeatureRenderer = L.SVG.extend({\n    /**\n     * Override method of same name from L.SVG, use the this._container property\n     * to set up the role=\"none presentation\" on featureGroupu container,\n     * per this recommendation:\n     * https://github.com/Maps4HTML/Web-Map-Custom-Element/pull/471#issuecomment-845192246\n     * @private overrides ancestor method so that we have a _container to work with\n     */\n    _initContainer: function () {\n      // call the method we're overriding, per https://leafletjs.com/examples/extending/extending-1-classes.html#methods-of-the-parent-class\n      // note you have to pass 'this' as the first arg\n      L.SVG.prototype._initContainer.call(this);\n      // knowing that the previous method call creates the this._container, we\n      // access it and set the role=\"none presetation\" which suppresses the\n      // announcement of \"Graphic\" on each feature focus.\n      this._container.setAttribute('role', 'none presentation');\n    },\n\n    /**\n     * Creates all the appropriate path elements for a M.Path\n     * @param {M.Path} layer - The M.Path that needs paths generated\n     * @param {boolean} stampLayer - Whether or not a layer should be stamped and stored in the renderer layers\n     * @private\n     */\n    _initPath: function (layer, stampLayer = true) {\n      if (layer._outline) {\n        let outlinePath = L.SVG.create('path');\n        if (layer.options.className)\n          L.DomUtil.addClass(\n            outlinePath,\n            layer.featureAttributes.class || layer.options.className\n          );\n        L.DomUtil.addClass(outlinePath, 'mapml-feature-outline');\n        outlinePath.style.fill = 'none';\n        layer.outlinePath = outlinePath;\n      }\n\n      //creates the main parts and sub parts paths\n      for (let p of layer._parts) {\n        if (p.rings) {\n          this._createPath(\n            p,\n            layer.options.className,\n            layer.featureAttributes['aria-label'],\n            layer.options.interactive,\n            layer.featureAttributes\n          );\n          if (layer.outlinePath) p.path.style.stroke = 'none';\n        }\n        if (p.subrings) {\n          for (let r of p.subrings) {\n            this._createPath(\n              r,\n              layer.options.className,\n              r.attr['aria-label'],\n              r.link !== undefined,\n              r.attr\n            );\n          }\n        }\n        this._updateStyle(layer);\n      }\n      if (stampLayer) {\n        let stamp = L.stamp(layer);\n        this._layers[stamp] = layer;\n      }\n    },\n\n    /**\n     * Creates paths for either mainParts, subParts or outline of a feature\n     * @param {Object} ring - The ring the current path is being generated for\n     * @param {string} title - The accessible aria-label of a path\n     * @param {string} cls - The class of the path\n     * @param {boolean} interactive - The boolean representing whether a feature is interactive or not\n     * @param {Object} attr - Attributes map\n     * @private\n     */\n    _createPath: function (\n      ring,\n      cls,\n      title,\n      interactive = false,\n      attr = undefined\n    ) {\n      let p = L.SVG.create('path');\n      ring.path = p;\n      if (!attr) {\n        if (title) p.setAttribute('aria-label', title);\n      } else {\n        for (let [name, value] of Object.entries(attr)) {\n          if (name === 'id' || name === 'tabindex') continue;\n          p.setAttribute(name, value);\n        }\n      }\n      if (ring.cls || cls) {\n        L.DomUtil.addClass(p, ring.cls || cls);\n      }\n      if (interactive) {\n        L.DomUtil.addClass(p, 'leaflet-interactive');\n      }\n    },\n\n    /**\n     * Adds all the paths needed for a feature\n     * @param {M.Path} layer - The feature that needs it's paths added\n     * @param {HTMLElement} container - The location the paths need to be added to\n     * @param {boolean} interactive - Whether a feature is interactive or not\n     * @private\n     */\n    _addPath: function (layer, container = undefined, interactive = true) {\n      if (!this._rootGroup && !container) {\n        this._initContainer();\n      }\n      let c = container || this._rootGroup,\n        outlineAdded = false;\n      if (interactive) {\n        layer.addInteractiveTarget(layer.group);\n      }\n      for (let p of layer._parts) {\n        if (p.path) layer.group.appendChild(p.path);\n        if (interactive) {\n          if (layer.options.link)\n            layer.attachLinkHandler(\n              p.path,\n              layer.options.link,\n              layer.options._leafletLayer\n            );\n          layer.addInteractiveTarget(p.path);\n        }\n\n        if (!outlineAdded && layer.pixelOutline) {\n          layer.group.appendChild(layer.outlinePath);\n          outlineAdded = true;\n        }\n\n        for (let subP of p.subrings) {\n          if (subP.path) {\n            if (subP.link) {\n              layer.attachLinkHandler(\n                subP.path,\n                subP.link,\n                layer.options._leafletLayer\n              );\n              layer.addInteractiveTarget(subP.path);\n            }\n            layer.group.appendChild(subP.path);\n          }\n        }\n      }\n      c.appendChild(layer.group);\n    },\n\n    /**\n     * Removes all the paths related to a feature\n     * @param {M.Path} layer - The feature who's paths need to be removed\n     * @private\n     */\n    _removePath: function (layer) {\n      for (let p of layer._parts) {\n        if (p.path) {\n          layer.removeInteractiveTarget(p.path);\n          L.DomUtil.remove(p.path);\n        }\n        for (let subP of p.subrings) {\n          if (subP.path) L.DomUtil.remove(subP.path);\n        }\n      }\n      if (layer.outlinePath) L.DomUtil.remove(layer.outlinePath);\n      layer.removeInteractiveTarget(layer.group);\n      L.DomUtil.remove(layer.group);\n      delete this._layers[L.stamp(layer)];\n    },\n\n    /**\n     * Updates the d attribute of all paths of a feature\n     * @param {M.Path} layer - The Feature that needs updating\n     * @private\n     */\n    _updateFeature: function (layer) {\n      if (layer.pixelOutline)\n        this._setPath(\n          layer.outlinePath,\n          this.geometryToPath(layer.pixelOutline, false)\n        );\n      for (let p of layer._parts) {\n        this._setPath(p.path, this.geometryToPath(p.pixelRings, layer.isClosed));\n        for (let subP of p.subrings) {\n          this._setPath(\n            subP.path,\n            this.geometryToPath(subP.pixelSubrings, false)\n          );\n        }\n      }\n    },\n\n    /**\n     * Generates the marker d attribute for a given point\n     * @param {L.Point} p - The point of the marker\n     * @returns {string}\n     * @private\n     */\n    _pointToMarker: function (p) {\n      return `M${p.x} ${p.y} L${p.x - 12.5} ${p.y - 30} C${p.x - 12.5} ${\n      p.y - 50\n    }, ${p.x + 12.5} ${p.y - 50}, ${p.x + 12.5} ${p.y - 30} L${p.x} ${p.y}z`;\n    },\n\n    /**\n     * Updates the styles of all paths of a feature\n     * @param {M.Path} layer - The feature that needs styles updated\n     * @private\n     */\n    _updateStyle: function (layer) {\n      this._updatePathStyle(layer.outlinePath, layer, false, true);\n      for (let p of layer._parts) {\n        if (p.path) {\n          this._updatePathStyle(p.path, layer, true);\n        }\n        for (let subP of p.subrings) {\n          if (subP.path) this._updatePathStyle(subP.path, layer);\n        }\n      }\n    },\n\n    /**\n     * Updates the style of a single path\n     * @param {HTMLElement} path - The path that needs updating\n     * @param {M.Path} layer - The feature layer\n     * @param {boolean} isMain - Whether it's the main parts or not\n     * @param {boolean} isOutline - Whether a path is an outline or not\n     * @private\n     */\n    _updatePathStyle: function (path, layer, isMain = false, isOutline = false) {\n      if (!path || !layer) {\n        return;\n      }\n      let options = layer.options,\n        isClosed = layer.isClosed;\n      if (\n        (options.stroke && (!isClosed || isOutline)) ||\n        (isMain && !layer.outlinePath)\n      ) {\n        path.setAttribute('stroke', options.color);\n        path.setAttribute('stroke-opacity', options.opacity);\n        path.setAttribute('stroke-width', options.weight);\n        path.setAttribute('stroke-linecap', options.lineCap);\n        path.setAttribute('stroke-linejoin', options.lineJoin);\n\n        if (options.dashArray) {\n          path.setAttribute('stroke-dasharray', options.dashArray);\n        } else {\n          path.removeAttribute('stroke-dasharray');\n        }\n\n        if (options.dashOffset) {\n          path.setAttribute('stroke-dashoffset', options.dashOffset);\n        } else {\n          path.removeAttribute('stroke-dashoffset');\n        }\n\n        if (options.link) {\n          path.setAttribute(\n            'stroke',\n            options.link.visited ? '#6c00a2' : '#0000EE'\n          );\n          path.setAttribute('stroke-opacity', '1');\n          path.setAttribute('stroke-width', '1px');\n          path.setAttribute('stroke-dasharray', 'none');\n        }\n      } else {\n        path.setAttribute('stroke', 'none');\n      }\n\n      if (isClosed && !isOutline) {\n        if (!options.fill) {\n          path.setAttribute('fill', options.fillColor || options.color);\n          path.setAttribute('fill-opacity', options.fillOpacity);\n          path.setAttribute('fill-rule', options.fillRule || 'evenodd');\n        } else {\n          path.setAttribute('fill', options.color);\n        }\n      } else {\n        path.setAttribute('fill', 'none');\n      }\n    },\n\n    /**\n     * Sets the d attribute of a path\n     * @param {HTMLElement} path - The path that is being updated\n     * @param {string} def - The new d attribute of the path\n     * @private\n     */\n    _setPath: function (path, def) {\n      path.setAttribute('d', def);\n    },\n\n    /**\n     * Generates the d string of a feature part\n     * @param {L.Point[]} rings - The points making up a given part of a feature\n     * @param {boolean} closed - Whether a feature is closed or not\n     * @returns {string}\n     */\n    geometryToPath: function (rings, closed) {\n      let str = '',\n        i,\n        j,\n        len,\n        len2,\n        points,\n        p;\n\n      for (i = 0, len = rings.length; i < len; i++) {\n        points = rings[i];\n        if (points.length === 1) {\n          return this._pointToMarker(points[0]);\n        }\n        for (j = 0, len2 = points.length; j < len2; j++) {\n          p = points[j];\n          str += (j ? 'L' : 'M') + p.x + ' ' + p.y;\n        }\n        str += closed ? 'z' : '';\n      }\n      return str || 'M0 0';\n    }\n  });\n\n  /**\n   * Returns new M.FeatureRenderer\n   * @param {Object} options - Options for the renderer\n   * @returns {M.FeatureRenderer}\n   */\n  var featureRenderer = function (options) {\n    return new FeatureRenderer(options);\n  };\n\n  var Geometry = L.FeatureGroup.extend({\n    /**\n     * Initialize the feature group\n     * @param {M.Path[]} layers\n     * @param {Object} options\n     */\n    initialize: function (layers, options) {\n      if (options.wrappers && options.wrappers.length > 0)\n        options = Object.assign(\n          M.Path.prototype._convertWrappers(options.wrappers),\n          options\n        );\n\n      L.LayerGroup.prototype.initialize.call(this, layers, options);\n      this._featureEl = this.options.mapmlFeature;\n\n      this.layerBounds = options.layerBounds;\n      this.zoomBounds = options.zoomBounds;\n\n      let firstLayer = layers[Object.keys(layers)[0]];\n      if (layers.length === 1 && firstLayer.options.link)\n        this.options.link = firstLayer.options.link;\n      if (\n        (this.options.onEachFeature && this.options.properties) ||\n        this.options.link\n      ) {\n        L.DomUtil.addClass(this.options.group, 'leaflet-interactive');\n        if (this.options.link) {\n          M.Path.prototype.attachLinkHandler.call(\n            this,\n            this.options.group,\n            this.options.link,\n            this.options._leafletLayer\n          );\n          this.options.group.setAttribute('role', 'link');\n        } else {\n          this.options.group.setAttribute('aria-expanded', 'false');\n          this.options.group.setAttribute('role', 'button');\n          this.options.onEachFeature(this.options.properties, this);\n          this.off('click', this._openPopup);\n        }\n      }\n\n      L.DomEvent.on(this.options.group, 'keyup keydown', this._handleFocus, this);\n      this.options.group.setAttribute('aria-label', this.options.accessibleTitle);\n      if (this.options.featureID)\n        this.options.group.setAttribute('data-fid', this.options.featureID);\n      for (let feature of layers) {\n        feature._groupLayer = this;\n      }\n    },\n\n    onAdd: function (map) {\n      L.LayerGroup.prototype.onAdd.call(this, map);\n      this.updateInteraction();\n    },\n\n    updateInteraction: function () {\n      let map = this._map || this.options._leafletLayer._map;\n      if (this.options.onEachFeature || this.options.link)\n        map.featureIndex.addToIndex(\n          this,\n          this.getPCRSCenter(),\n          this.options.group\n        );\n\n      for (let layerID in this._layers) {\n        let layer = this._layers[layerID];\n        for (let part of layer._parts) {\n          if (layer.featureAttributes && layer.featureAttributes.tabindex)\n            map.featureIndex.addToIndex(layer, layer.getPCRSCenter(), part.path);\n          for (let subPart of part.subrings) {\n            if (subPart.attr && subPart.attr.tabindex)\n              map.featureIndex.addToIndex(layer, subPart.center, subPart.path);\n          }\n        }\n      }\n    },\n\n    /**\n     * Check whether the feature group should be rendered at current map zoom level\n     * @param {Number} zoom - current map zoom\n     * @param {Object} vectorMinZoom - the minimum zoom bound of vector layer\n     * @param {Object} vectorMaxZoom - the maximum zoom bound of vector layer\n     * @returns {Boolean}\n     * @private\n     */\n    _checkRender: function (zoom, vectorMinZoom, vectorMaxZoom) {\n      let minZoom = this._featureEl.min,\n        maxZoom = this._featureEl.max;\n      // if the current map zoom falls below/above the zoom bounds of the vector layer\n      if (zoom > vectorMaxZoom || zoom < vectorMinZoom) return false;\n      // if the current map zoom falls below/above the [min, max] range\n      if (\n        (minZoom !== null && zoom < +minZoom) ||\n        (maxZoom !== null && zoom > +maxZoom)\n      ) {\n        return false;\n      }\n      return true;\n    },\n\n    /**\n     * Handler for focus events\n     * @param {L.DOMEvent} e - Event that occurred\n     * @private\n     */\n    _handleFocus: function (e) {\n      // tab, shift, cr, esc, up, left, down, right,\n      if (\n        [9, 16, 27, 37, 38, 39, 40].includes(e.keyCode) &&\n        e.type === 'keydown'\n      ) {\n        let index = this._map.featureIndex.currentIndex;\n        // Down/right arrow keys replicate tabbing through the feature index\n        // Up/left arrow keys replicate shift-tabbing through the feature index\n        if (e.keyCode === 37 || e.keyCode === 38) {\n          L.DomEvent.stop(e);\n          this._map.featureIndex.inBoundFeatures[index].path.setAttribute(\n            'tabindex',\n            -1\n          );\n          if (index === 0) {\n            this._map.featureIndex.inBoundFeatures[\n              this._map.featureIndex.inBoundFeatures.length - 1\n            ].path.focus();\n            this._map.featureIndex.currentIndex =\n              this._map.featureIndex.inBoundFeatures.length - 1;\n          } else {\n            this._map.featureIndex.inBoundFeatures[index - 1].path.focus();\n            this._map.featureIndex.currentIndex--;\n          }\n        } else if (e.keyCode === 39 || e.keyCode === 40) {\n          L.DomEvent.stop(e);\n          this._map.featureIndex.inBoundFeatures[index].path.setAttribute(\n            'tabindex',\n            -1\n          );\n          if (index === this._map.featureIndex.inBoundFeatures.length - 1) {\n            this._map.featureIndex.inBoundFeatures[0].path.focus();\n            this._map.featureIndex.currentIndex = 0;\n          } else {\n            this._map.featureIndex.inBoundFeatures[index + 1].path.focus();\n            this._map.featureIndex.currentIndex++;\n          }\n        } else if (e.keyCode === 27) {\n          let shadowRoot = this._map.options.mapEl.shadowRoot\n            ? this._map.options.mapEl.shadowRoot\n            : this._map.options.mapEl.querySelector('.mapml-web-map').shadowRoot;\n          if (shadowRoot.activeElement.nodeName !== 'g') return;\n          this._map._container.focus();\n        } else if (e.keyCode === 9) {\n          let obj = this;\n          setTimeout(function () {\n            obj._map.featureIndex.inBoundFeatures[0].path.setAttribute(\n              'tabindex',\n              0\n            );\n          }, 0);\n        }\n        // tab, shift, cr, esc, right, left, up, down,\n        // 1, 2, 3, 4, 5, 6, 7 (featureIndexOverlay available index items\n        // [8, 9] being allocated to next, previous menu items).\n      } else if (\n        ![9, 16, 13, 27, 37, 38, 39, 40, 49, 50, 51, 52, 53, 54, 55].includes(\n          e.keyCode\n        )\n      ) {\n        this._map.featureIndex.currentIndex = 0;\n        this._map.featureIndex.inBoundFeatures[0].path.focus();\n      }\n\n      // 27 added so that the tooltip opens when dismissing popup with 'esc' key\n      if (e.target.tagName.toUpperCase() !== 'G') return;\n      if (\n        [9, 13, 16, 37, 38, 39, 40, 49, 50, 51, 52, 53, 54, 55, 27].includes(\n          e.keyCode\n        ) &&\n        e.type === 'keyup'\n      ) {\n        this.openTooltip();\n      } else if (e.keyCode === 13 || e.keyCode === 32) {\n        this.closeTooltip();\n        if (!this.options.link && this.options.onEachFeature) {\n          L.DomEvent.stop(e);\n          this.openPopup();\n        }\n      } else {\n        this.closeTooltip();\n      }\n    },\n\n    /**\n     * Add a M.Path to the M.Geometry\n     * @param layer\n     */\n    addLayer: function (layer) {\n      if (!layer.options.link && layer.options.interactive) {\n        this.options.onEachFeature(this.options.properties, layer);\n      }\n      L.FeatureGroup.prototype.addLayer.call(this, layer);\n    },\n\n    /**\n     * Focuses the previous function in the sequence on previous button press\n     * @param e\n     * @private\n     */\n    _previousFeature: function (e) {\n      L.DomEvent.stop(e);\n      this._map.featureIndex.currentIndex = Math.max(\n        this._map.featureIndex.currentIndex - 1,\n        0\n      );\n      let prevFocus =\n        this._map.featureIndex.inBoundFeatures[\n          this._map.featureIndex.currentIndex\n        ];\n      prevFocus.path.focus();\n      this._map.closePopup();\n    },\n\n    /**\n     * Focuses next feature in sequence\n     * @param e\n     * @private\n     */\n    _nextFeature: function (e) {\n      L.DomEvent.stop(e);\n      this._map.featureIndex.currentIndex = Math.min(\n        this._map.featureIndex.currentIndex + 1,\n        this._map.featureIndex.inBoundFeatures.length - 1\n      );\n      let nextFocus =\n        this._map.featureIndex.inBoundFeatures[\n          this._map.featureIndex.currentIndex\n        ];\n      nextFocus.path.focus();\n      this._map.closePopup();\n    },\n\n    getPCRSCenter: function () {\n      let bounds;\n      for (let l in this._layers) {\n        let layer = this._layers[l];\n        if (!bounds) {\n          bounds = L.bounds(layer.getPCRSCenter(), layer.getPCRSCenter());\n        } else {\n          bounds.extend(layer.getPCRSCenter());\n        }\n      }\n      return bounds.getCenter();\n    }\n  });\n\n  /**\n   * Returns new M.Geometry\n   * @param {M.Path[]} layers - Layers belonging to feature group\n   * @param {Object} options - Options for the feature group\n   * @returns {M.Geometry}\n   */\n  var geometry = function (layers, options) {\n    return new Geometry(layers, options);\n  };\n\n  var AnnounceMovement = L.Handler.extend({\n    addHooks: function () {\n      this._map.on({\n        layeradd: this.totalBounds,\n        layerremove: this.totalBounds\n      });\n\n      this._map.options.mapEl.addEventListener(\n        'map-moveend',\n        this.announceBounds\n      );\n      this._map.dragging._draggable.addEventListener('dragstart', this.dragged);\n      this._map.options.mapEl.addEventListener(\n        'mapfocused',\n        this.focusAnnouncement\n      );\n    },\n    removeHooks: function () {\n      this._map.off({\n        layeradd: this.totalBounds,\n        layerremove: this.totalBounds\n      });\n\n      this._map.options.mapEl.removeEventListener(\n        'map-moveend',\n        this.announceBounds\n      );\n      this._map.dragging._draggable.removeEventListener(\n        'dragstart',\n        this.dragged\n      );\n      this._map.options.mapEl.removeEventListener(\n        'mapfocused',\n        this.focusAnnouncement\n      );\n    },\n\n    focusAnnouncement: function () {\n      let mapEl = this;\n      setTimeout(function () {\n        let el = mapEl.querySelector('.mapml-web-map')\n          ? mapEl\n              .querySelector('.mapml-web-map')\n              .shadowRoot.querySelector('.leaflet-container')\n          : mapEl.shadowRoot.querySelector('.leaflet-container');\n\n        let mapZoom = mapEl._map.getZoom();\n        let standard = M.options.locale.amZoom + ' ' + mapZoom;\n\n        if (mapZoom === mapEl._map.getMaxZoom()) {\n          standard = M.options.locale.amMaxZoom + ' ' + standard;\n        } else if (mapZoom === mapEl._map._layersMinZoom) {\n          standard = M.options.locale.amMinZoom + ' ' + standard;\n        }\n\n        el.setAttribute('aria-roledescription', 'region ' + standard);\n        setTimeout(function () {\n          el.removeAttribute('aria-roledescription');\n        }, 2000);\n      }, 0);\n    },\n\n    announceBounds: function () {\n      if (this._traversalCall > 0) {\n        return;\n      }\n      let mapZoom = this._map.getZoom();\n      let mapBounds = M.pixelToPCRSBounds(\n        this._map.getPixelBounds(),\n        mapZoom,\n        this._map.options.projection\n      );\n\n      let visible = true;\n      if (this._map.totalLayerBounds) {\n        visible =\n          mapZoom <= this._map.getMaxZoom() &&\n          mapZoom >= this._map.getMinZoom() &&\n          this._map.totalLayerBounds.overlaps(mapBounds);\n      }\n\n      let output = this.querySelector('.mapml-web-map')\n        ? this.querySelector('.mapml-web-map').shadowRoot.querySelector(\n            '.mapml-screen-reader-output'\n          )\n        : this.shadowRoot.querySelector('.mapml-screen-reader-output');\n\n      let standard = M.options.locale.amZoom + ' ' + mapZoom;\n\n      if (!visible) {\n        let outOfBoundsPos = this._history[this._historyIndex];\n        let inBoundsPos = this._history[this._historyIndex - 1];\n        this.back();\n        this._history.pop();\n\n        if (outOfBoundsPos.zoom !== inBoundsPos.zoom) {\n          output.innerText = M.options.locale.amZoomedOut;\n        } else if (this._map.dragging._draggable.wasDragged) {\n          output.innerText = M.options.locale.amDraggedOut;\n        } else if (outOfBoundsPos.x > inBoundsPos.x) {\n          output.innerText = M.options.locale.amEastBound;\n        } else if (outOfBoundsPos.x < inBoundsPos.x) {\n          output.innerText = M.options.locale.amWestBound;\n        } else if (outOfBoundsPos.y < inBoundsPos.y) {\n          output.innerText = M.options.locale.amNorthBound;\n        } else if (outOfBoundsPos.y > inBoundsPos.y) {\n          output.innerText = M.options.locale.amSouthBound;\n        }\n      } else {\n        let prevZoom = this._history[this._historyIndex - 1]\n          ? this._history[this._historyIndex - 1].zoom\n          : this._history[this._historyIndex].zoom;\n        if (mapZoom === this._map.getMaxZoom() && mapZoom !== prevZoom) {\n          output.innerText = M.options.locale.amMaxZoom + ' ' + standard;\n        } else if (mapZoom === this._map._layersMinZoom && mapZoom !== prevZoom) {\n          output.innerText = M.options.locale.amMinZoom + ' ' + standard;\n        } else {\n          output.innerText = standard;\n        }\n      }\n      this._map.dragging._draggable.wasDragged = false;\n    },\n\n    totalBounds: function (e) {\n      // don't bother with non-MapMLLayer layers...\n      if (!e.layer._layerEl) return;\n      let map = this.options.mapEl;\n      map.whenLayersReady().then(() => {\n        let layers = map.querySelectorAll('layer-');\n        let bounds;\n        for (let i = 0; i < layers.length; i++) {\n          // the _layer may no longer exist if this is invoked by layerremove\n          if (layers[i]._layer) {\n            let extent = layers[i].extent;\n            if (bounds && extent) {\n              bounds.extend(M.extentToBounds(extent, 'pcrs'));\n            } else if (extent) {\n              bounds = M.extentToBounds(extent, 'pcrs');\n            }\n          }\n        }\n\n        this.totalLayerBounds = bounds;\n      });\n    },\n\n    dragged: function () {\n      this.wasDragged = true;\n    }\n  });\n\n  var FeatureIndex = L.Handler.extend({\n    initialize: function (map) {\n      L.Handler.prototype.initialize.call(this, map);\n      this.inBoundFeatures = [];\n      this.outBoundFeatures = [];\n      this.currentIndex = 0;\n      this._mapPCRSBounds = M.pixelToPCRSBounds(\n        map.getPixelBounds(),\n        map.getZoom(),\n        map.options.projection\n      );\n    },\n\n    addHooks: function () {\n      this._map.on('mapkeyboardfocused', this._updateMapBounds, this);\n      this._map.on('mapkeyboardfocused', this._sortIndex, this);\n    },\n\n    removeHooks: function () {\n      this._map.off('mapkeyboardfocused', this._updateMapBounds);\n      this._map.off('mapkeyboardfocused', this._sortIndex);\n    },\n\n    /**\n     * Adds a svg element to the index of tabbable features, it also keeps track of the layer it's associated + center\n     * @param layer - the layer object the feature is associated with\n     * @param lc - the layer center\n     * @param path - the svg element that needs to be focused, can be a path or g\n     */\n    addToIndex: function (layer, lc, path) {\n      let mc = this._mapPCRSBounds.getCenter();\n      let dist = Math.sqrt(Math.pow(lc.x - mc.x, 2) + Math.pow(lc.y - mc.y, 2));\n      let index = this._mapPCRSBounds.contains(lc)\n        ? this.inBoundFeatures\n        : this.outBoundFeatures;\n\n      let elem = { path: path, layer: layer, center: lc, dist: dist };\n      path.setAttribute('tabindex', -1);\n\n      index.push(elem);\n\n      // TODO: this insertion loop has potential to be improved slightly\n      for (\n        let i = index.length - 1;\n        i > 0 && index[i].dist < index[i - 1].dist;\n        i--\n      ) {\n        let tmp = index[i];\n        index[i] = index[i - 1];\n        index[i - 1] = tmp;\n      }\n\n      if (this._mapPCRSBounds.contains(lc)) this.inBoundFeatures = index;\n      else this.outBoundFeatures = index;\n    },\n\n    /**\n     * Removes features that are no longer on the map, also moves features to the respective array depending\n     * on whether the feature is in the maps viewport or not\n     */\n    cleanIndex: function () {\n      this.currentIndex = 0;\n      this.inBoundFeatures = this.inBoundFeatures.filter((elem) => {\n        let inbound = this._mapPCRSBounds.contains(elem.center);\n        elem.path.setAttribute('tabindex', -1);\n        if (elem.layer._map && !inbound) {\n          this.outBoundFeatures.push(elem);\n        }\n        return elem.layer._map && inbound;\n      });\n      this.outBoundFeatures = this.outBoundFeatures.filter((elem) => {\n        let inbound = this._mapPCRSBounds.contains(elem.center);\n        elem.path.setAttribute('tabindex', -1);\n        if (elem.layer._map && inbound) {\n          this.inBoundFeatures.push(elem);\n        }\n        return elem.layer._map && !inbound;\n      });\n    },\n\n    /**\n     * Sorts the index of features in the map's viewport based on distance from center\n     * @private\n     */\n    _sortIndex: function () {\n      this.cleanIndex();\n      if (this.inBoundFeatures.length === 0) return;\n\n      let mc = this._mapPCRSBounds.getCenter();\n\n      this.inBoundFeatures.sort(function (a, b) {\n        let ac = a.center;\n        let bc = b.center;\n        a.dist = Math.sqrt(Math.pow(ac.x - mc.x, 2) + Math.pow(ac.y - mc.y, 2));\n        b.dist = Math.sqrt(Math.pow(bc.x - mc.x, 2) + Math.pow(bc.y - mc.y, 2));\n        return a.dist - b.dist;\n      });\n      this.inBoundFeatures[0].path.setAttribute('tabindex', 0);\n    },\n\n    /**\n     * Event handler for 'mapfocused' event to update the map's bounds in terms of PCRS\n     * @param e - the event object\n     * @private\n     */\n    _updateMapBounds: function (e) {\n      // TODO: map's PCRS bounds is used in other parts of the viewer, can be moved out to the map object directly\n      this._mapPCRSBounds = M.pixelToPCRSBounds(\n        this._map.getPixelBounds(),\n        this._map.getZoom(),\n        this._map.options.projection\n      );\n    }\n  });\n\n  var Options = {\n    featureIndexOverlayOption: false,\n    announceMovement: false,\n    announceScale: { metric: true, imperial: false },\n    defaultExtCoor: 'pcrs',\n    defaultLocCoor: 'gcrs',\n    locale: {\n      cmBack: 'Back',\n      cmForward: 'Forward',\n      cmReload: 'Reload',\n      cmToggleControls: 'Toggle Controls',\n      cmCopyCoords: 'Copy',\n      cmCopyMapML: 'Map',\n      cmCopyExtent: 'Extent',\n      cmCopyLocation: 'Location',\n      cmToggleDebug: 'Toggle Debug Mode',\n      cmPasteLayer: 'Paste',\n      cmViewSource: 'View Map Source',\n      lmZoomToLayer: 'Zoom To Layer',\n      lmCopyLayer: 'Copy Layer',\n      lmZoomToExtent: 'Zoom To Sub-layer',\n      lmCopyExtent: 'Copy Sub-layer',\n      lcOpacity: 'Opacity',\n      btnAttribution: 'Map data attribution',\n      btnZoomIn: 'Zoom in',\n      btnZoomOut: 'Zoom out',\n      btnFullScreen: 'View Fullscreen',\n      btnExitFullScreen: 'Exit Fullscreen',\n      btnLocTrackOn: 'Show my location - location tracking on',\n      btnMyLocTrackOn: 'My current location, shown on map',\n      btnLocTrackOff: 'Show my location - location tracking off',\n      btnLocTrackLastKnown: 'Show my location - last known location shown',\n      btnMyLastKnownLocTrackOn: 'My last known location, shown on map',\n      amZoom: 'zoom level',\n      amColumn: 'column',\n      amRow: 'row',\n      amMaxZoom: 'At maximum zoom level, zoom in disabled',\n      amMinZoom: 'At minimum zoom level, zoom out disabled',\n      amZoomedOut: 'Zoomed out of bounds, returning to',\n      amDraggedOut: 'Dragged out of bounds, returning to',\n      amEastBound: 'Reached east bound, panning east disabled',\n      amWestBound: 'Reached west bound, panning west disabled',\n      amNorthBound: 'Reached north bound, panning north disabled',\n      amSouthBound: 'Reached south bound, panning south disabled',\n      kbdShortcuts: 'Keyboard shortcuts',\n      kbdMovement: 'Movement keys',\n      kbdFeature: 'Feature navigation keys',\n      kbdPanUp: 'Pan up',\n      kbdPanDown: 'Pan down',\n      kbdPanLeft: 'Pan left',\n      kbdPanRight: 'Pan right',\n      kbdPanIncrement: 'pan increment',\n      kbdZoom: 'Zoom in/out 3 levels',\n      kbdPrevFeature: 'Previous feature',\n      kbdNextFeature: 'Next feature',\n      dfLayer: 'Layer',\n      dfExtent: 'Sub-layer',\n      popupZoom: 'Zoom to here',\n      dfPastedLayer: 'Pasted layer',\n      fIndexNoFeatures: 'No features found'\n    }\n  };\n\n  L.Map.Keyboard.include({\n    _onKeyDown: function (e) {\n      if (e.altKey || e.metaKey) {\n        return;\n      }\n\n      let zoomIn = {\n        187: 187,\n        107: 107,\n        61: 61,\n        171: 171\n      };\n\n      let zoomOut = {\n        189: 189,\n        109: 109,\n        54: 54,\n        173: 173\n      };\n\n      var key = e.keyCode,\n        map = this._map,\n        offset;\n\n      if (key in this._panKeys) {\n        if (!map._panAnim || !map._panAnim._inProgress) {\n          offset = this._panKeys[key];\n          if (e.shiftKey) {\n            offset = L.point(offset).multiplyBy(3);\n          }\n          if (e.ctrlKey) {\n            offset = L.point(offset).divideBy(5);\n          }\n\n          map.panBy(offset);\n\n          if (map.options.maxBounds) {\n            map.panInsideBounds(map.options.maxBounds);\n          }\n        }\n      } else if (key in this._zoomKeys) {\n        if (\n          (key in zoomIn && map.getMaxZoom() !== map.getZoom()) ||\n          (key in zoomOut && map._layersMinZoom !== map.getZoom())\n        )\n          map.setZoom(map.getZoom() + (e.shiftKey ? 3 : 1) * this._zoomKeys[key]);\n      } else if (\n        key === 27 &&\n        map._popup &&\n        map._popup.options.closeOnEscapeKey\n      ) {\n        map.closePopup();\n      } else {\n        return;\n      }\n\n      L.DomEvent.stop(e);\n    }\n  });\n\n  var FeatureIndexOverlay = L.Layer.extend({\n    onAdd: function (map) {\n      let svgInnerHTML = `<svg xmlns=\"http://www.w3.org/2000/svg\" xml:space=\"preserve\" viewBox=\"0 0 100 100\"><path fill=\"none\" stroke=\"#000\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"3\" d=\"M0 0h100v100H0z\" color=\"#000\" overflow=\"visible\"/></svg>`;\n\n      this._container = L.DomUtil.create(\n        'div',\n        'mapml-feature-index-box',\n        map._container\n      );\n      this._container.innerHTML = svgInnerHTML;\n\n      this._output = L.DomUtil.create(\n        'output',\n        'mapml-feature-index',\n        map._container\n      );\n      this._output.setAttribute('role', 'status');\n      this._output.setAttribute('aria-live', 'polite');\n      this._output.setAttribute('aria-atomic', 'true');\n      this._body = L.DomUtil.create(\n        'span',\n        'mapml-feature-index-content',\n        this._output\n      );\n      this._body.index = 0;\n      this._output.initialFocus = false;\n      map.on('focus blur popupclose', this._addOrRemoveFeatureIndex, this);\n      map.on('moveend focus templatedfeatureslayeradd', this._checkOverlap, this);\n      map.on('keydown', this._onKeyDown, this);\n      this._addOrRemoveFeatureIndex();\n    },\n\n    _calculateReticleBounds: function () {\n      let bounds = this._map.getPixelBounds();\n      let center = bounds.getCenter();\n      let wRatio =\n        Math.abs(bounds.min.x - bounds.max.x) / this._map.options.mapEl.width;\n      let hRatio =\n        Math.abs(bounds.min.y - bounds.max.y) / this._map.options.mapEl.height;\n\n      let reticleDimension = getComputedStyle(this._container).width.replace(\n        /[^\\d.]/g,\n        ''\n      );\n      if (getComputedStyle(this._container).width.slice(-1) === '%') {\n        reticleDimension =\n          (reticleDimension * this._map.options.mapEl.width) / 100;\n      }\n      let w = (wRatio * reticleDimension) / 2;\n      let h = (hRatio * reticleDimension) / 2;\n      let minPoint = L.point(center.x - w, center.y + h);\n      let maxPoint = L.point(center.x + w, center.y - h);\n      let b = L.bounds(minPoint, maxPoint);\n      return M.pixelToPCRSBounds(\n        b,\n        this._map.getZoom(),\n        this._map.options.projection\n      );\n    },\n\n    _checkOverlap: function (e) {\n      if (e.type === 'focus') this._output.initialFocus = true;\n      if (!this._output.initialFocus) return;\n      if (this._output.popupClosed) {\n        this._output.popupClosed = false;\n        return;\n      }\n\n      this._map.fire('mapkeyboardfocused');\n\n      let featureIndexBounds = this._calculateReticleBounds();\n      let features = this._map.featureIndex.inBoundFeatures;\n      let index = 1;\n      let keys = Object.keys(features);\n      let body = this._body;\n      let noFeaturesMessage = document.createElement('span');\n      noFeaturesMessage.innerHTML = M.options.locale.fIndexNoFeatures;\n\n      body.innerHTML = '';\n      body.index = 0;\n\n      body.allFeatures = [];\n      keys.forEach((i) => {\n        let layer = features[i].layer;\n        let layers = features[i].layer._layers;\n        let bounds = L.bounds();\n\n        if (layers) {\n          let keys = Object.keys(layers);\n          keys.forEach((j) => {\n            if (!bounds)\n              bounds = L.bounds(\n                layer._layers[j]._bounds.min,\n                layer._layers[j]._bounds.max\n              );\n            bounds.extend(layer._layers[j]._bounds.min);\n            bounds.extend(layer._layers[j]._bounds.max);\n          });\n        } else if (layer._bounds) {\n          bounds = L.bounds(layer._bounds.min, layer._bounds.max);\n        }\n\n        if (featureIndexBounds.overlaps(bounds)) {\n          let label = features[i].path.getAttribute('aria-label');\n\n          if (index < 8) {\n            body.appendChild(this._updateOutput(label, index, index));\n          }\n          if (index % 7 === 0 || index === 1) {\n            body.allFeatures.push([]);\n          }\n          body.allFeatures[Math.floor((index - 1) / 7)].push({\n            label,\n            index,\n            layer\n          });\n          if (body.allFeatures[1] && body.allFeatures[1].length === 1) {\n            body.appendChild(this._updateOutput('More results', 0, 9));\n          }\n          index += 1;\n        }\n      });\n      this._addToggleKeys();\n      if (index === 1) {\n        body.appendChild(noFeaturesMessage);\n      }\n    },\n\n    _updateOutput: function (label, index, key) {\n      let span = document.createElement('span');\n      span.setAttribute('data-index', index);\n      //\", \" adds a brief auditory pause when a screen reader is reading through the feature index\n      //also prevents names with numbers + key from being combined when read\n      span.innerHTML = `<kbd>${key}</kbd>` + ' ' + label + '<span>, </span>';\n      return span;\n    },\n\n    _addToggleKeys: function () {\n      let allFeatures = this._body.allFeatures;\n      for (let i = 0; i < allFeatures.length; i++) {\n        if (allFeatures[i].length === 0) return;\n        if (allFeatures[i - 1]) {\n          let label = 'Previous results';\n          allFeatures[i].push({ label });\n        }\n\n        if (allFeatures[i + 1] && allFeatures[i + 1].length > 0) {\n          let label = 'More results';\n          allFeatures[i].push({ label });\n        }\n      }\n    },\n\n    _onKeyDown: function (e) {\n      let body = this._body;\n      let key = e.originalEvent.keyCode;\n      if (key >= 49 && key <= 55) {\n        if (!body.allFeatures[body.index]) return;\n        let feature = body.allFeatures[body.index][key - 49];\n        if (!feature) return;\n        let layer = feature.layer;\n        if (layer) {\n          this._map.featureIndex.currentIndex = feature.index - 1;\n          if (layer._popup) {\n            this._map.closePopup();\n            layer.openPopup();\n          } else layer.options.group.focus();\n        }\n      } else if (key === 56) {\n        this._newContent(body, -1);\n      } else if (key === 57) {\n        this._newContent(body, 1);\n      }\n    },\n\n    _newContent: function (body, direction) {\n      let index = body.firstChild.getAttribute('data-index');\n      let newContent = body.allFeatures[Math.floor((index - 1) / 7 + direction)];\n      if (newContent && newContent.length > 0) {\n        body.innerHTML = '';\n        body.index += direction;\n        for (let i = 0; i < newContent.length; i++) {\n          let feature = newContent[i];\n          let index = feature.index ? feature.index : 0;\n          let key = i + 1;\n          if (feature.label === 'More results') key = 9;\n          if (feature.label === 'Previous results') key = 8;\n          body.appendChild(this._updateOutput(feature.label, index, key));\n        }\n      }\n    },\n\n    _addOrRemoveFeatureIndex: function (e) {\n      //Toggle aria-hidden attribute so screen reader rereads the feature index on focus\n      if (!this._output.initialFocus) {\n        this._output.setAttribute('aria-hidden', 'true');\n      } else if (this._output.hasAttribute('aria-hidden')) {\n        let obj = this;\n        setTimeout(function () {\n          obj._output.removeAttribute('aria-hidden');\n        }, 100);\n      }\n\n      if (e && e.type === 'popupclose') {\n        this._output.setAttribute('aria-hidden', 'true');\n        this._output.popupClosed = true;\n      } else if (e && e.type === 'focus') {\n        this._container.removeAttribute('hidden');\n        this._output.classList.remove('mapml-screen-reader-output');\n        // this is a very subtle branch.  The event that gets handled below is a blur\n        // event, which happens to have the e.target._popup property\n        // when there will be a popup.  Because blur gets handled here, it doesn't\n        // get handled in the next else if block, which would hide both the reticle\n        // and the index menu, and then recursively call this method with no event\n        // argument, which manipulates the aria-hidden attribute on the output\n        // in order to have the screenreader read its contents when the focus returns\n        // to (what exactly???).\n      } else if (e && e.target._popup) {\n        this._container.setAttribute('hidden', '');\n      } else if (e && e.type === 'blur') {\n        this._container.setAttribute('hidden', '');\n        this._output.classList.add('mapml-screen-reader-output');\n        this._output.initialFocus = false;\n        this._addOrRemoveFeatureIndex();\n      } else {\n        // this is the default block, called when no event is passed (recursive call)\n        this._container.setAttribute('hidden', '');\n        this._output.classList.add('mapml-screen-reader-output');\n      }\n    }\n  });\n\n  var featureIndexOverlay = function (options) {\n    return new FeatureIndexOverlay(options);\n  };\n\n  var createLayerControlExtentHTML = function () {\n    var extent = L.DomUtil.create('fieldset', 'mapml-layer-extent'),\n      extentProperties = L.DomUtil.create(\n        'div',\n        'mapml-layer-item-properties',\n        extent\n      ),\n      extentSettings = L.DomUtil.create(\n        'div',\n        'mapml-layer-item-settings',\n        extent\n      ),\n      extentLabel = L.DomUtil.create(\n        'label',\n        'mapml-layer-item-toggle',\n        extentProperties\n      ),\n      input = L.DomUtil.create('input'),\n      svgExtentControlIcon = L.SVG.create('svg'),\n      extentControlPath1 = L.SVG.create('path'),\n      extentControlPath2 = L.SVG.create('path'),\n      extentNameIcon = L.DomUtil.create('span'),\n      extentItemControls = L.DomUtil.create(\n        'div',\n        'mapml-layer-item-controls',\n        extentProperties\n      ),\n      opacityControl = L.DomUtil.create(\n        'details',\n        'mapml-layer-item-details mapml-control-layers',\n        extentSettings\n      ),\n      extentOpacitySummary = L.DomUtil.create('summary', '', opacityControl),\n      mapEl = this.getMapEl(),\n      layerEl = this.getLayerEl(),\n      opacity = L.DomUtil.create('input', '', opacityControl);\n    extentSettings.hidden = true;\n    extent.setAttribute('aria-grabbed', 'false');\n\n    // append the svg paths\n    svgExtentControlIcon.setAttribute('viewBox', '0 0 24 24');\n    svgExtentControlIcon.setAttribute('height', '22');\n    svgExtentControlIcon.setAttribute('width', '22');\n    extentControlPath1.setAttribute('d', 'M0 0h24v24H0z');\n    extentControlPath1.setAttribute('fill', 'none');\n    extentControlPath2.setAttribute(\n      'd',\n      'M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z'\n    );\n    svgExtentControlIcon.appendChild(extentControlPath1);\n    svgExtentControlIcon.appendChild(extentControlPath2);\n\n    let mapSelects = this.querySelectorAll('map-select');\n    if (mapSelects.length) {\n      var frag = document.createDocumentFragment();\n      for (var i = 0; i < mapSelects.length; i++) {\n        frag.appendChild(mapSelects[i].selectdetails);\n      }\n      extentSettings.appendChild(frag);\n    }\n\n    let removeExtentButton = L.DomUtil.create(\n      'button',\n      'mapml-layer-item-remove-control',\n      extentItemControls\n    );\n    removeExtentButton.type = 'button';\n    removeExtentButton.title = 'Remove Sub Layer';\n    removeExtentButton.innerHTML = \"<span aria-hidden='true'>&#10005;</span>\";\n    removeExtentButton.classList.add('mapml-button');\n    removeExtentButton.addEventListener('click', (e) => {\n      e.preventDefault();\n      e.stopPropagation();\n      this.remove();\n    });\n\n    let extentsettingsButton = L.DomUtil.create(\n      'button',\n      'mapml-layer-item-settings-control',\n      extentItemControls\n    );\n    extentsettingsButton.type = 'button';\n    extentsettingsButton.title = 'Extent Settings';\n    extentsettingsButton.setAttribute('aria-expanded', false);\n    extentsettingsButton.classList.add('mapml-button');\n    L.DomEvent.on(\n      extentsettingsButton,\n      'click',\n      (e) => {\n        if (extentSettings.hidden === true) {\n          extentsettingsButton.setAttribute('aria-expanded', true);\n          extentSettings.hidden = false;\n        } else {\n          extentsettingsButton.setAttribute('aria-expanded', false);\n          extentSettings.hidden = true;\n        }\n      },\n      this\n    );\n\n    extentNameIcon.setAttribute('aria-hidden', true);\n    extentLabel.appendChild(input);\n    extentsettingsButton.appendChild(extentNameIcon);\n    extentNameIcon.appendChild(svgExtentControlIcon);\n    extentOpacitySummary.innerText = 'Opacity';\n    extentOpacitySummary.id =\n      'mapml-extent-item-opacity-' + L.stamp(extentOpacitySummary);\n    opacity.setAttribute('type', 'range');\n    opacity.setAttribute('min', '0');\n    opacity.setAttribute('max', '1.0');\n    opacity.setAttribute('step', '0.1');\n    opacity.setAttribute(\n      'aria-labelledby',\n      'mapml-extent-item-opacity-' + L.stamp(extentOpacitySummary)\n    );\n    const changeOpacity = function (e) {\n      if (e && e.target && e.target.value >= 0 && e.target.value <= 1.0) {\n        this._extentLayer.changeOpacity(e.target.value);\n      }\n    };\n    opacity.setAttribute('value', this.opacity);\n    opacity.value = this._extentLayer._container.style.opacity || '1.0';\n    opacity.addEventListener('change', changeOpacity.bind(this));\n\n    var extentItemNameSpan = L.DomUtil.create(\n      'span',\n      'mapml-extent-item-name',\n      extentLabel\n    );\n    input.type = 'checkbox';\n    input.defaultChecked = this.checked;\n    extentItemNameSpan.innerHTML = this.label;\n    const changeCheck = function () {\n      this.checked = !this.checked;\n    };\n    // save for later access by API\n    this._layerControlCheckbox = input;\n    input.addEventListener('change', changeCheck.bind(this));\n    extentItemNameSpan.id =\n      'mapml-extent-item-name-{' + L.stamp(extentItemNameSpan) + '}';\n    extent.setAttribute('aria-labelledby', extentItemNameSpan.id);\n    extentItemNameSpan.extent = this;\n\n    extent.ontouchstart = extent.onmousedown = (downEvent) => {\n      if (\n        (downEvent.target.parentElement.tagName.toLowerCase() === 'label' &&\n          downEvent.target.tagName.toLowerCase() !== 'input') ||\n        downEvent.target.tagName.toLowerCase() === 'label'\n      ) {\n        downEvent.stopPropagation();\n        downEvent =\n          downEvent instanceof TouchEvent ? downEvent.touches[0] : downEvent;\n\n        let control = extent,\n          controls = extent.parentNode,\n          moving = false,\n          yPos = downEvent.clientY,\n          originalPosition = Array.from(\n            extent.parentElement.querySelectorAll('fieldset')\n          ).indexOf(extent);\n\n        document.body.ontouchmove = document.body.onmousemove = (moveEvent) => {\n          moveEvent.preventDefault();\n          moveEvent =\n            moveEvent instanceof TouchEvent ? moveEvent.touches[0] : moveEvent;\n\n          // Fixes flickering by only moving element when there is enough space\n          let offset = moveEvent.clientY - yPos;\n          moving = Math.abs(offset) > 15 || moving;\n          if (\n            (controls && !moving) ||\n            (controls && controls.childElementCount <= 1) ||\n            controls.getBoundingClientRect().top >\n              control.getBoundingClientRect().bottom ||\n            controls.getBoundingClientRect().bottom <\n              control.getBoundingClientRect().top\n          ) {\n            return;\n          }\n\n          controls.classList.add('mapml-draggable');\n          control.style.transform = 'translateY(' + offset + 'px)';\n          control.style.pointerEvents = 'none';\n\n          let x = moveEvent.clientX,\n            y = moveEvent.clientY,\n            root =\n              mapEl.tagName === 'MAPML-VIEWER'\n                ? mapEl.shadowRoot\n                : mapEl.querySelector('.mapml-web-map').shadowRoot,\n            elementAt = root.elementFromPoint(x, y),\n            swapControl =\n              !elementAt || !elementAt.closest('fieldset')\n                ? control\n                : elementAt.closest('fieldset');\n\n          swapControl =\n            Math.abs(offset) <= swapControl.offsetHeight ? control : swapControl;\n\n          control.setAttribute('aria-grabbed', 'true');\n          control.setAttribute('aria-dropeffect', 'move');\n          if (swapControl && controls === swapControl.parentNode) {\n            swapControl =\n              swapControl !== control.nextSibling\n                ? swapControl\n                : swapControl.nextSibling;\n            if (control !== swapControl) {\n              yPos = moveEvent.clientY;\n              control.style.transform = null;\n            }\n            controls.insertBefore(control, swapControl);\n          }\n        };\n\n        document.body.ontouchend = document.body.onmouseup = () => {\n          let newPosition = Array.from(\n            extent.parentElement.querySelectorAll('fieldset')\n          ).indexOf(extent);\n          control.setAttribute('aria-grabbed', 'false');\n          control.removeAttribute('aria-dropeffect');\n          control.style.pointerEvents = null;\n          control.style.transform = null;\n          if (originalPosition !== newPosition) {\n            let controlsElems = controls.children,\n              zIndex = 0;\n            for (let c of controlsElems) {\n              let extentEl = c.querySelector('span').extent;\n\n              extentEl.setAttribute('data-moving', '');\n              const node = layerEl.src ? layerEl.shadowRoot : layerEl;\n              node.append(extentEl);\n              extentEl.removeAttribute('data-moving');\n\n              extentEl.extentZIndex = zIndex;\n              extentEl._extentLayer.setZIndex(zIndex);\n              zIndex++;\n            }\n          }\n          controls.classList.remove('mapml-draggable');\n          document.body.ontouchmove =\n            document.body.onmousemove =\n            document.body.ontouchend =\n            document.body.onmouseup =\n              null;\n        };\n      }\n    };\n    this._extentRootFieldset = extent;\n    this._opacitySlider = opacity;\n    this._opacityControl = opacityControl;\n    this._layerControlLabel = extentLabel;\n    return extent;\n  };\n\n  var createLayerControlHTML = async function () {\n    var fieldset = L.DomUtil.create('fieldset', 'mapml-layer-item'),\n      input = L.DomUtil.create('input'),\n      layerItemName = L.DomUtil.create('span', 'mapml-layer-item-name'),\n      settingsButtonNameIcon = L.DomUtil.create('span'),\n      layerItemProperty = L.DomUtil.create(\n        'div',\n        'mapml-layer-item-properties',\n        fieldset\n      ),\n      layerItemSettings = L.DomUtil.create(\n        'div',\n        'mapml-layer-item-settings',\n        fieldset\n      ),\n      itemToggleLabel = L.DomUtil.create(\n        'label',\n        'mapml-layer-item-toggle',\n        layerItemProperty\n      ),\n      layerItemControls = L.DomUtil.create(\n        'div',\n        'mapml-layer-item-controls',\n        layerItemProperty\n      ),\n      opacityControl = L.DomUtil.create(\n        'details',\n        'mapml-layer-item-opacity mapml-control-layers',\n        layerItemSettings\n      ),\n      opacity = L.DomUtil.create('input'),\n      opacityControlSummary = L.DomUtil.create('summary'),\n      svgSettingsControlIcon = L.SVG.create('svg'),\n      settingsControlPath1 = L.SVG.create('path'),\n      settingsControlPath2 = L.SVG.create('path'),\n      extentsFieldset = L.DomUtil.create(\n        'fieldset',\n        'mapml-layer-grouped-extents'\n      ),\n      mapEl = this.parentNode;\n\n    // append the paths in svg for the remove layer and toggle icons\n    svgSettingsControlIcon.setAttribute('viewBox', '0 0 24 24');\n    svgSettingsControlIcon.setAttribute('height', '22');\n    svgSettingsControlIcon.setAttribute('width', '22');\n    svgSettingsControlIcon.setAttribute('fill', 'currentColor');\n    settingsControlPath1.setAttribute('d', 'M0 0h24v24H0z');\n    settingsControlPath1.setAttribute('fill', 'none');\n    settingsControlPath2.setAttribute(\n      'd',\n      'M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z'\n    );\n    svgSettingsControlIcon.appendChild(settingsControlPath1);\n    svgSettingsControlIcon.appendChild(settingsControlPath2);\n\n    layerItemSettings.hidden = true;\n    settingsButtonNameIcon.setAttribute('aria-hidden', true);\n\n    let removeControlButton = L.DomUtil.create(\n      'button',\n      'mapml-layer-item-remove-control',\n      layerItemControls\n    );\n    removeControlButton.type = 'button';\n    removeControlButton.title = 'Remove Layer';\n    removeControlButton.innerHTML = \"<span aria-hidden='true'>&#10005;</span>\";\n    removeControlButton.classList.add('mapml-button');\n    L.DomEvent.on(removeControlButton, 'click', L.DomEvent.stop);\n    L.DomEvent.on(\n      removeControlButton,\n      'click',\n      (e) => {\n        let fieldset = 0,\n          elem,\n          root;\n        root =\n          mapEl.tagName === 'MAPML-VIEWER'\n            ? mapEl.shadowRoot\n            : mapEl.querySelector('.mapml-web-map').shadowRoot;\n        if (\n          e.target.closest('fieldset').nextElementSibling &&\n          !e.target.closest('fieldset').nextElementSibling.disbaled\n        ) {\n          elem = e.target.closest('fieldset').previousElementSibling;\n          while (elem) {\n            fieldset += 2; // find the next layer menu item\n            elem = elem.previousElementSibling;\n          }\n        } else {\n          // focus on the link\n          elem = 'link';\n        }\n        mapEl.removeChild(\n          e.target.closest('fieldset').querySelector('span').layer._layerEl\n        );\n        elem = elem\n          ? root.querySelector('.leaflet-control-attribution').firstElementChild\n          : (elem = root.querySelectorAll('input')[fieldset]);\n        elem.focus();\n      },\n      this._layer\n    );\n\n    let itemSettingControlButton = L.DomUtil.create(\n      'button',\n      'mapml-layer-item-settings-control',\n      layerItemControls\n    );\n    itemSettingControlButton.type = 'button';\n    itemSettingControlButton.title = 'Layer Settings';\n    itemSettingControlButton.setAttribute('aria-expanded', false);\n    itemSettingControlButton.classList.add('mapml-button');\n    L.DomEvent.on(\n      itemSettingControlButton,\n      'click',\n      (e) => {\n        let layerControl = this._layer._layerEl._layerControl._container;\n        if (!layerControl._isExpanded && e.pointerType === 'touch') {\n          layerControl._isExpanded = true;\n          return;\n        }\n        if (layerItemSettings.hidden === true) {\n          itemSettingControlButton.setAttribute('aria-expanded', true);\n          layerItemSettings.hidden = false;\n        } else {\n          itemSettingControlButton.setAttribute('aria-expanded', false);\n          layerItemSettings.hidden = true;\n        }\n      },\n      this._layer\n    );\n\n    input.defaultChecked = this.checked;\n    input.type = 'checkbox';\n    input.setAttribute('class', 'leaflet-control-layers-selector');\n    layerItemName.layer = this._layer;\n    const changeCheck = function () {\n      this.checked = !this.checked;\n    };\n    input.addEventListener('change', changeCheck.bind(this));\n    if (this._layer._legendUrl) {\n      var legendLink = document.createElement('a');\n      legendLink.text = ' ' + this._layer._title;\n      legendLink.href = this._layer._legendUrl;\n      legendLink.target = '_blank';\n      legendLink.draggable = false;\n      layerItemName.appendChild(legendLink);\n    } else {\n      layerItemName.innerHTML = this._layer._title;\n    }\n    layerItemName.id = 'mapml-layer-item-name-{' + L.stamp(layerItemName) + '}';\n    opacityControlSummary.innerText = 'Opacity';\n    opacityControlSummary.id =\n      'mapml-layer-item-opacity-' + L.stamp(opacityControlSummary);\n    opacityControl.appendChild(opacityControlSummary);\n    opacityControl.appendChild(opacity);\n    opacity.setAttribute('type', 'range');\n    opacity.setAttribute('min', '0');\n    opacity.setAttribute('max', '1.0');\n    opacity.setAttribute('value', this._layer._container.style.opacity || '1.0');\n    opacity.setAttribute('step', '0.1');\n    opacity.setAttribute(\n      'aria-labelledby',\n      'mapml-layer-item-opacity-' + L.stamp(opacityControlSummary)\n    );\n\n    const changeOpacity = function (e) {\n      if (e && e.target && e.target.value >= 0 && e.target.value <= 1.0) {\n        this._layer.changeOpacity(e.target.value);\n      }\n    };\n    opacity.value = this._layer._container.style.opacity || '1.0';\n    opacity.addEventListener('change', changeOpacity.bind(this));\n\n    fieldset.setAttribute('aria-grabbed', 'false');\n    fieldset.setAttribute('aria-labelledby', layerItemName.id);\n\n    fieldset.ontouchstart = fieldset.onmousedown = (downEvent) => {\n      if (\n        (downEvent.target.parentElement.tagName.toLowerCase() === 'label' &&\n          downEvent.target.tagName.toLowerCase() !== 'input') ||\n        downEvent.target.tagName.toLowerCase() === 'label'\n      ) {\n        downEvent =\n          downEvent instanceof TouchEvent ? downEvent.touches[0] : downEvent;\n        let control = fieldset,\n          controls = fieldset.parentNode,\n          moving = false,\n          yPos = downEvent.clientY,\n          originalPosition = Array.from(\n            controls.querySelectorAll('fieldset')\n          ).indexOf(fieldset);\n\n        document.body.ontouchmove = document.body.onmousemove = (moveEvent) => {\n          moveEvent.preventDefault();\n          moveEvent =\n            moveEvent instanceof TouchEvent ? moveEvent.touches[0] : moveEvent;\n\n          // Fixes flickering by only moving element when there is enough space\n          let offset = moveEvent.clientY - yPos;\n          moving = Math.abs(offset) > 15 || moving;\n          if (\n            (controls && !moving) ||\n            (controls && controls.childElementCount <= 1) ||\n            controls.getBoundingClientRect().top >\n              control.getBoundingClientRect().bottom ||\n            controls.getBoundingClientRect().bottom <\n              control.getBoundingClientRect().top\n          ) {\n            return;\n          }\n\n          controls.classList.add('mapml-draggable');\n          control.style.transform = 'translateY(' + offset + 'px)';\n          control.style.pointerEvents = 'none';\n\n          let x = moveEvent.clientX,\n            y = moveEvent.clientY,\n            root =\n              mapEl.tagName === 'MAPML-VIEWER'\n                ? mapEl.shadowRoot\n                : mapEl.querySelector('.mapml-web-map').shadowRoot,\n            elementAt = root.elementFromPoint(x, y),\n            swapControl =\n              !elementAt || !elementAt.closest('fieldset')\n                ? control\n                : elementAt.closest('fieldset');\n\n          swapControl =\n            Math.abs(offset) <= swapControl.offsetHeight ? control : swapControl;\n\n          control.setAttribute('aria-grabbed', 'true');\n          control.setAttribute('aria-dropeffect', 'move');\n          if (swapControl && controls === swapControl.parentNode) {\n            swapControl =\n              swapControl !== control.nextSibling\n                ? swapControl\n                : swapControl.nextSibling;\n            if (control !== swapControl) {\n              yPos = moveEvent.clientY;\n              control.style.transform = null;\n            }\n            controls.insertBefore(control, swapControl);\n          }\n        };\n\n        document.body.ontouchend = document.body.onmouseup = () => {\n          let newPosition = Array.from(\n            controls.querySelectorAll('fieldset')\n          ).indexOf(fieldset);\n          control.setAttribute('aria-grabbed', 'false');\n          control.removeAttribute('aria-dropeffect');\n          control.style.pointerEvents = null;\n          control.style.transform = null;\n          if (originalPosition !== newPosition) {\n            let controlsElems = controls.children,\n              zIndex = 1;\n            // re-order layer elements DOM order\n            for (let c of controlsElems) {\n              let layerEl = c.querySelector('span').layer._layerEl;\n              layerEl.setAttribute('data-moving', '');\n              mapEl.insertAdjacentElement('beforeend', layerEl);\n              layerEl.removeAttribute('data-moving');\n            }\n            // update zIndex of all layer- elements\n            let layers = mapEl.querySelectorAll('layer-');\n            for (let i = 0; i < layers.length; i++) {\n              let layer = layers[i]._layer;\n              if (layer.options.zIndex !== zIndex) {\n                layer.setZIndex(zIndex);\n              }\n              zIndex++;\n            }\n          }\n          controls.classList.remove('mapml-draggable');\n          document.body.ontouchmove =\n            document.body.onmousemove =\n            document.body.onmouseup =\n              null;\n        };\n      }\n    };\n\n    itemToggleLabel.appendChild(input);\n    itemToggleLabel.appendChild(layerItemName);\n    itemSettingControlButton.appendChild(settingsButtonNameIcon);\n    settingsButtonNameIcon.appendChild(svgSettingsControlIcon);\n\n    let mapml = this.src ? this.shadowRoot : this;\n    var styleLinks = mapml.querySelectorAll(\n      'map-link[rel=style],map-link[rel=\"self style\"],map-link[rel=\"style self\"]'\n    );\n    let styles;\n    if (styleLinks) {\n      styles = this.getAlternateStyles(styleLinks);\n      if (styles) {\n        layerItemSettings.appendChild(styles);\n      }\n    }\n\n    this._layerControlCheckbox = input;\n    this._layerControlLabel = itemToggleLabel;\n    this._opacityControl = opacityControl;\n    this._opacitySlider = opacity;\n    this._layerControlHTML = fieldset;\n    this._layerItemSettingsHTML = layerItemSettings;\n    this._propertiesGroupAnatomy = extentsFieldset;\n    this._styles = styles;\n    extentsFieldset.setAttribute('aria-label', 'Sublayers');\n    extentsFieldset.setAttribute('hidden', '');\n    let mapExtents = mapml.querySelectorAll('map-extent:not([hidden])');\n    let mapExtentLayerControls = [];\n    for (let i = 0; i < mapExtents.length; i++) {\n      mapExtentLayerControls.push(mapExtents[i].whenReady());\n      // if any map-extent is not hidden, the parent fieldset should not be hidden\n      extentsFieldset.removeAttribute('hidden');\n    }\n    await Promise.all(mapExtentLayerControls);\n    for (let i = 0; i < mapExtents.length; i++) {\n      extentsFieldset.appendChild(mapExtents[i].getLayerControlHTML());\n    }\n    layerItemSettings.appendChild(extentsFieldset);\n    return this._layerControlHTML;\n  };\n\n  class ZoomInput {\n    constructor(name, min, max, value, step, layer) {\n      this.name = name;\n      this.min = min;\n      this.max = max;\n      this.value = value;\n      this.step = step;\n      this.layer = layer;\n    }\n\n    validateInput() {\n      // name is required\n      if (!this.name) {\n        return false;\n      }\n      // min and max can not be present\n      // fallback would be layer's meta, -> projection min, max\n      // don't need value, map-meta max value, -> fallback is max zoom of projection\n      // don't need step, defaults to 1\n      return true;\n    }\n\n    getValue() {\n      return this.layer._map.options.mapEl.zoom;\n    }\n  }\n\n  class HiddenInput {\n    constructor(name, value) {\n      this.name = name;\n      this.value = value;\n    }\n\n    validateInput() {\n      // name is required\n      // value is required\n      if (!this.name || !this.value) {\n        return false;\n      }\n      return true;\n    }\n\n    getValue() {\n      return this.value;\n    }\n  }\n\n  class WidthInput {\n    constructor(name, layer) {\n      this.name = name;\n      this.layer = layer;\n    }\n\n    validateInput() {\n      // name is required\n      if (!this.name) {\n        return false;\n      }\n      return true;\n    }\n\n    getValue() {\n      return this.layer._map.getSize().x;\n    }\n  }\n\n  class HeightInput {\n    constructor(name, layer) {\n      this.name = name;\n      this.layer = layer;\n    }\n\n    validateInput() {\n      // name is required\n      if (!this.name) {\n        return false;\n      }\n      return true;\n    }\n\n    getValue() {\n      return this.layer._map.getSize().y;\n    }\n  }\n\n  class LocationInput {\n    constructor(name, position, axis, units, min, max, rel, layer) {\n      this.name = name;\n      this.position = position;\n      this.axis = axis;\n      // if unit/cs not present, find it\n      if (!units && axis && !['i', 'j'].includes(axis)) {\n        this.units = M.axisToCS(axis).toLowerCase();\n      } else {\n        this.units = units; // cs\n      }\n      this.min = min;\n      this.max = max;\n      this.rel = rel;\n      this.layer = layer;\n    }\n\n    validateInput() {\n      // name is required\n      // axis is required\n      if (!this.name || !this.axis) {\n        return false;\n      }\n      // cs/units is only required when the axis is i/j. To differentiate between the units/cs\n      if (\n        (this.axis === 'i' || this.axis === 'j') &&\n        !['map', 'tile'].includes(this.units)\n      ) {\n        return false;\n      }\n      // check if axis match the units/cs\n      if (this.units) {\n        let axisCS = M.axisToCS(this.axis);\n        if (\n          typeof axisCS === 'string' &&\n          axisCS.toUpperCase() !== this.units.toUpperCase()\n        ) {\n          return false;\n        }\n      }\n      // position is not required, will default to top-left\n      // min max fallbacks, map-meta -> projection\n      // rel not required, default is image/extent\n      return true;\n    }\n\n    _TCRSToPCRS(coords, zoom) {\n      // TCRS pixel point to Projected CRS point (in meters, presumably)\n      var map = this.layer._map,\n        crs = map.options.crs,\n        loc = crs.transformation.untransform(coords, crs.scale(zoom));\n      return loc;\n    }\n\n    getValue(zoom = undefined, bounds = undefined) {\n      // units = cs\n      //<input name=\"...\" units=\"pcrs\" type=\"location\" position=\"top|bottom-left|right\" axis=\"northing|easting|latitude|longitude\">\n      if (zoom === undefined) zoom = this.layer._map.getZoom();\n      if (bounds === undefined) bounds = this.layer._map.getPixelBounds();\n\n      if (this.units === 'pcrs' || this.units === 'gcrs') {\n        switch (this.axis) {\n          case 'longitude':\n          case 'easting':\n            if (this.position) {\n              if (this.position.match(/.*?-left/i)) {\n                return this._TCRSToPCRS(bounds.min, zoom).x;\n              } else if (this.position.match(/.*?-right/i)) {\n                return this._TCRSToPCRS(bounds.max, zoom).x;\n              }\n            } else {\n              // position is not required, will default to top-left\n              return this._TCRSToPCRS(bounds.min, zoom).x;\n            }\n            break;\n          case 'latitude':\n          case 'northing':\n            if (this.position) {\n              if (this.position.match(/top-.*?/i)) {\n                return this._TCRSToPCRS(bounds.min, zoom).y;\n              } else if (this.position.match(/bottom-.*?/i)) {\n                return this._TCRSToPCRS(bounds.max, zoom).y;\n              }\n            } else {\n              // position is not required, will default to top-left\n              return this._TCRSToPCRS(bounds.min, zoom).y;\n            }\n            break;\n        }\n      } else if (this.units === 'tilematrix') {\n        // Value is retrieved from the createTile method of TemplatedTileLayer, on move end.\n        // Different values for each tile when filling in the map tiles on the map.\n        // Currently storing all x,y,z within one object,\n        // TODO: change return value as needed based on usage by map-input\n        // https://github.com/Leaflet/Leaflet/blob/6994baf25f267db1c8b720c28a61e0700d0aa0e8/src/layer/tile/GridLayer.js#L652\n        const center = this.layer._map.getCenter();\n        const templatedTileLayer = this.layer._extentLayer._templates[0].layer;\n        const pixelBounds = templatedTileLayer._getTiledPixelBounds(center);\n        const tileRange = templatedTileLayer._pxBoundsToTileRange(pixelBounds);\n        let obj = [];\n        for (let j = tileRange.min.y; j <= tileRange.max.y; j++) {\n          for (let i = tileRange.min.x; i <= tileRange.max.x; i++) {\n            const coords = new L.Point(i, j);\n            coords.z = templatedTileLayer._tileZoom;\n            obj.push(coords);\n          }\n        }\n        return obj;\n      } else if (this.units === 'tile' || this.units === 'map') ;\n      return;\n    }\n  }\n\n  class DOMTokenList {\n    /* jshint ignore:start */\n    #element; // create element as a private property\n    #valueSet; // needed to prevent infinite recursive calls to CE setAttribute\n    #attribute; // the name of the attribute that will be a DOMTokenList\n    #domain; // the domain of token values supported by this attribute\n    /* jshint ignore:end */\n    constructor(initialValue, element, attribute, domain) {\n      // create donor/host div to extract DomTokenList from\n      const hostingElement = document.createElement('div');\n      this.domtokenlist = hostingElement.classList;\n\n      // to check if value is being set, protects from infinite recursion\n      // from attributeChangedCallback of mapml-viewer and web-map\n      this.#valueSet = false; // jshint ignore:line\n      this.domtokenlist.value = initialValue ?? '';\n      this.#element = element; // jshint ignore:line\n      this.#attribute = attribute; // jshint ignore:line\n      this.#domain = domain; // jshint ignore:line\n    }\n\n    get valueSet() {\n      return this.#valueSet; // jshint ignore:line\n    }\n\n    get length() {\n      return this.domtokenlist.length;\n    }\n\n    get value() {\n      return this.domtokenlist.value;\n    }\n    set value(val) {\n      if (val === null) {\n        // when attribute is being removed\n        this.domtokenlist.value = '';\n      } else {\n        this.domtokenlist.value = val.toLowerCase();\n        /* jshint ignore:start */\n        this.#valueSet = true;\n        this.#element.setAttribute(this.#attribute, this.domtokenlist.value);\n        this.#valueSet = false;\n        /* jshint ignore:end */\n      }\n    }\n\n    item(index) {\n      return this.domtokenlist.item(index);\n    }\n\n    contains(token) {\n      return this.domtokenlist.contains(token);\n    }\n\n    // Modified default behavior\n    add(token) {\n      this.domtokenlist.add(token);\n      this.#element.setAttribute(this.#attribute, this.domtokenlist.value); // jshint ignore:line\n    }\n\n    // Modified default behavior\n    remove(token) {\n      this.domtokenlist.remove(token);\n      this.#element.setAttribute(this.#attribute, this.domtokenlist.value); // jshint ignore:line\n    }\n\n    // Modified default behavior\n    replace(oldToken, newToken) {\n      this.domtokenlist.replace(oldToken, newToken);\n      this.#element.setAttribute(this.#attribute, this.domtokenlist.value); // jshint ignore:line\n    }\n\n    // Modified default behavior\n    supports(token) {\n      /* jshint ignore:start */\n      if (this.#domain.includes(token)) {\n        return true;\n      } else {\n        return false;\n      }\n      /* jshint ignore:end */\n    }\n\n    // Modified default behavior\n    //https://developer.mozilla.org/en-US/docs/Web/API/DOMTokenList/toggle\n    toggle(token, force) {\n      this.domtokenlist.toggle(token, force);\n      this.#element.setAttribute(this.#attribute, this.domtokenlist.value); // jshint ignore:line\n    }\n\n    entries() {\n      return this.domtokenlist.entries();\n    }\n\n    //https://developer.mozilla.org/en-US/docs/Web/API/DOMTokenList/forEach\n    forEach(callback, thisArg) {\n      this.domtokenlist.forEach(callback, thisArg);\n    }\n\n    //https://developer.mozilla.org/en-US/docs/Web/API/DOMTokenList/keys\n    keys() {\n      return this.domtokenlist.keys();\n    }\n\n    //https://developer.mozilla.org/en-US/docs/Web/API/DOMTokenList/values\n    values() {\n      return this.domtokenlist.values();\n    }\n  }\n\n  /*\n   * Copyright 2015-2016 Canada Centre for Mapping and Earth Observation,\n   * Earth Sciences Sector, Natural Resources Canada.\n   *\n   * License\n   *\n   * By obtaining and/or copying this work, you (the licensee) agree that you have\n   * read, understood, and will comply with the following terms and conditions.\n   *\n   * Permission to copy, modify, and distribute this work, with or without\n   * modification, for any purpose and without fee or royalty is hereby granted,\n   * provided that you include the following on ALL copies of the work or portions\n   * thereof, including modifications:\n   *\n   * The full text of this NOTICE in a location viewable to users of the\n   * redistributed or derivative work.\n   *\n   * Any pre-existing intellectual property disclaimers, notices, or terms and\n   * conditions. If none exist, the W3C Software and Document Short Notice should\n   * be included.\n   *\n   * Notice of any changes or modifications, through a copyright statement on the\n   * new code or document such as \"This software or document includes material\n   * copied from or derived from [title and URI of the W3C document].\n   * Copyright  [YEAR] W3C (MIT, ERCIM, Keio, Beihang).\"\n   *\n   * Disclaimers\n   *\n   * THIS WORK IS PROVIDED \"AS IS,\" AND COPYRIGHT HOLDERS MAKE NO REPRESENTATIONS\n   * OR WARRANTIES, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO, WARRANTIES OF\n   * MERCHANTABILITY OR FITNESS FOR ANY PARTICULAR PURPOSE OR THAT THE USE OF THE\n   * SOFTWARE OR DOCUMENT WILL NOT INFRINGE ANY THIRD PARTY PATENTS, COPYRIGHTS,\n   * TRADEMARKS OR OTHER RIGHTS.\n   * COPYRIGHT HOLDERS WILL NOT BE LIABLE FOR ANY DIRECT, INDIRECT, SPECIAL OR\n   * CONSEQUENTIAL DAMAGES ARISING OUT OF ANY USE OF THE SOFTWARE OR DOCUMENT.\n   *\n   * The name and trademarks of copyright holders may NOT be used in advertising or\n   * publicity pertaining to the work without specific, written prior permission.\n   * Title to copyright in this work will at all times remain with copyright holders.\n   */\n\n  /* global L, Node */\n  (function (window, document, undefined$1) {\n    var M = {};\n    window.M = M;\n\n    (function () {\n      M.detectImagePath = function (container) {\n        // this relies on the CSS style leaflet-default-icon-path containing a\n        // relative url() that leads to a valid icon file.  Since that depends on\n        // how all of this stuff is deployed (i.e. custom element or as leaflet-plugin)\n        // also, because we're using 'shady DOM' api, the container must be\n        // a shady dom container, because the custom element tags it with added\n        // style-scope ... and related classes.\n        var el = L.DomUtil.create('div', 'leaflet-default-icon-path', container);\n        var path =\n          L.DomUtil.getStyle(el, 'background-image') ||\n          L.DomUtil.getStyle(el, 'backgroundImage'); // IE8\n\n        container.removeChild(el);\n\n        if (path === null || path.indexOf('url') !== 0) {\n          path = '';\n        } else {\n          path = path\n            .replace(/^url\\([\"']?/, '')\n            .replace(/marker-icon\\.png[\"']?\\)$/, '');\n        }\n\n        return path;\n      };\n      M.mime = 'text/mapml';\n\n      let mapOptions = window.document.head.querySelector('map-options');\n      M.options = Options;\n      if (mapOptions)\n        M.options = Object.assign(M.options, JSON.parse(mapOptions.innerHTML));\n\n      // see https://leafletjs.com/reference-1.5.0.html#crs-l-crs-base\n      // \"new classes can't inherit from (L.CRS), and methods can't be added\n      // to (L.CRS.anything) with the include function\n      // so we'll use the options property as a way to integrate needed\n      // properties and methods...\n      M.WGS84 = new L.Proj.CRS(\n        'EPSG:4326',\n        '+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs ',\n        {\n          origin: [-180, +90],\n          bounds: L.bounds([\n            [-180, -90],\n            [180, 90]\n          ]),\n          resolutions: [\n            0.703125, 0.3515625, 0.17578125, 0.087890625, 0.0439453125,\n            0.02197265625, 0.010986328125, 0.0054931640625, 0.00274658203125,\n            0.001373291015625, 0.0006866455078125, 0.0003433227539062,\n            0.0001716613769531, 0.0000858306884766, 0.0000429153442383,\n            0.0000214576721191, 0.0000107288360596, 0.0000053644180298,\n            0.0000026822090149, 0.0000013411045074, 0.0000006705522537,\n            0.0000003352761269\n          ],\n          crs: {\n            tcrs: {\n              horizontal: {\n                name: 'x',\n                min: 0,\n                max: (zoom) =>\n                  Math.round(\n                    M.WGS84.options.bounds.getSize().x /\n                      M.WGS84.options.resolutions[zoom]\n                  )\n              },\n              vertical: {\n                name: 'y',\n                min: 0,\n                max: (zoom) =>\n                  Math.round(\n                    M.WGS84.options.bounds.getSize().y /\n                      M.WGS84.options.resolutions[zoom]\n                  )\n              },\n              bounds: (zoom) =>\n                L.bounds(\n                  [\n                    M.WGS84.options.crs.tcrs.horizontal.min,\n                    M.WGS84.options.crs.tcrs.vertical.min\n                  ],\n                  [\n                    M.WGS84.options.crs.tcrs.horizontal.max(zoom),\n                    M.WGS84.options.crs.tcrs.vertical.max(zoom)\n                  ]\n                )\n            },\n            pcrs: {\n              horizontal: {\n                name: 'longitude',\n                get min() {\n                  return M.WGS84.options.crs.gcrs.horizontal.min;\n                },\n                get max() {\n                  return M.WGS84.options.crs.gcrs.horizontal.max;\n                }\n              },\n              vertical: {\n                name: 'latitude',\n                get min() {\n                  return M.WGS84.options.crs.gcrs.vertical.min;\n                },\n                get max() {\n                  return M.WGS84.options.crs.gcrs.vertical.max;\n                }\n              },\n              get bounds() {\n                return M.WGS84.options.bounds;\n              }\n            },\n            gcrs: {\n              horizontal: {\n                name: 'longitude',\n                // set min/max axis values from EPSG registry area of use, retrieved 2019-07-25\n                min: -180.0,\n                max: 180.0\n              },\n              vertical: {\n                name: 'latitude',\n                // set min/max axis values from EPSG registry area of use, retrieved 2019-07-25\n                min: -90.0,\n                max: 90.0\n              },\n              get bounds() {\n                return L.latLngBounds(\n                  [\n                    M.WGS84.options.crs.gcrs.vertical.min,\n                    M.WGS84.options.crs.gcrs.horizontal.min\n                  ],\n                  [\n                    M.WGS84.options.crs.gcrs.vertical.max,\n                    M.WGS84.options.crs.gcrs.horizontal.max\n                  ]\n                );\n              }\n            },\n            map: {\n              horizontal: {\n                name: 'i',\n                min: 0,\n                max: (map) => map.getSize().x\n              },\n              vertical: {\n                name: 'j',\n                min: 0,\n                max: (map) => map.getSize().y\n              },\n              bounds: (map) => L.bounds(L.point([0, 0]), map.getSize())\n            },\n            tile: {\n              horizontal: {\n                name: 'i',\n                min: 0,\n                max: 256\n              },\n              vertical: {\n                name: 'j',\n                min: 0,\n                max: 256\n              },\n              get bounds() {\n                return L.bounds(\n                  [\n                    M.WGS84.options.crs.tile.horizontal.min,\n                    M.WGS84.options.crs.tile.vertical.min\n                  ],\n                  [\n                    M.WGS84.options.crs.tile.horizontal.max,\n                    M.WGS84.options.crs.tile.vertical.max\n                  ]\n                );\n              }\n            },\n            tilematrix: {\n              horizontal: {\n                name: 'column',\n                min: 0,\n                max: (zoom) =>\n                  Math.round(\n                    M.WGS84.options.crs.tcrs.horizontal.max(zoom) /\n                      M.WGS84.options.crs.tile.bounds.getSize().x\n                  )\n              },\n              vertical: {\n                name: 'row',\n                min: 0,\n                max: (zoom) =>\n                  Math.round(\n                    M.WGS84.options.crs.tcrs.vertical.max(zoom) /\n                      M.WGS84.options.crs.tile.bounds.getSize().y\n                  )\n              },\n              bounds: (zoom) =>\n                L.bounds(\n                  [\n                    M.WGS84.options.crs.tilematrix.horizontal.min,\n                    M.WGS84.options.crs.tilematrix.vertical.min\n                  ],\n                  [\n                    M.WGS84.options.crs.tilematrix.horizontal.max(zoom),\n                    M.WGS84.options.crs.tilematrix.vertical.max(zoom)\n                  ]\n                )\n            }\n          }\n        }\n      );\n      M.CBMTILE = new L.Proj.CRS(\n        'EPSG:3978',\n        '+proj=lcc +lat_1=49 +lat_2=77 +lat_0=49 +lon_0=-95 +x_0=0 +y_0=0 +ellps=GRS80 +datum=NAD83 +units=m +no_defs',\n        {\n          origin: [-34655800, 39310000],\n          bounds: L.bounds([\n            [-34655800, -39000000],\n            [10000000, 39310000]\n          ]),\n          resolutions: [\n            38364.660062653464, 22489.62831258996, 13229.193125052918,\n            7937.5158750317505, 4630.2175937685215, 2645.8386250105837,\n            1587.5031750063501, 926.0435187537042, 529.1677250021168,\n            317.50063500127004, 185.20870375074085, 111.12522225044451,\n            66.1459656252646, 38.36466006265346, 22.48962831258996,\n            13.229193125052918, 7.9375158750317505, 4.6302175937685215,\n            2.6458386250105836, 1.5875031750063502, 0.92604351875370428,\n            0.52916772500211673, 0.31750063500127002, 0.18520870375074083,\n            0.11112522225044451, 0.066145965625264591\n          ],\n          crs: {\n            tcrs: {\n              horizontal: {\n                name: 'x',\n                min: 0,\n                max: (zoom) =>\n                  Math.round(\n                    M.CBMTILE.options.bounds.getSize().x /\n                      M.CBMTILE.options.resolutions[zoom]\n                  )\n              },\n              vertical: {\n                name: 'y',\n                min: 0,\n                max: (zoom) =>\n                  Math.round(\n                    M.CBMTILE.options.bounds.getSize().y /\n                      M.CBMTILE.options.resolutions[zoom]\n                  )\n              },\n              bounds: (zoom) =>\n                L.bounds(\n                  [\n                    M.CBMTILE.options.crs.tcrs.horizontal.min,\n                    M.CBMTILE.options.crs.tcrs.vertical.min\n                  ],\n                  [\n                    M.CBMTILE.options.crs.tcrs.horizontal.max(zoom),\n                    M.CBMTILE.options.crs.tcrs.vertical.max(zoom)\n                  ]\n                )\n            },\n            pcrs: {\n              horizontal: {\n                name: 'easting',\n                get min() {\n                  return M.CBMTILE.options.bounds.min.x;\n                },\n                get max() {\n                  return M.CBMTILE.options.bounds.max.x;\n                }\n              },\n              vertical: {\n                name: 'northing',\n                get min() {\n                  return M.CBMTILE.options.bounds.min.y;\n                },\n                get max() {\n                  return M.CBMTILE.options.bounds.max.y;\n                }\n              },\n              get bounds() {\n                return M.CBMTILE.options.bounds;\n              }\n            },\n            gcrs: {\n              horizontal: {\n                name: 'longitude',\n                // set min/max axis values from EPSG registry area of use, retrieved 2019-07-25\n                min: -141.01,\n                max: -47.74\n              },\n              vertical: {\n                name: 'latitude',\n                // set min/max axis values from EPSG registry area of use, retrieved 2019-07-25\n                min: 40.04,\n                max: 86.46\n              },\n              get bounds() {\n                return L.latLngBounds(\n                  [\n                    M.CBMTILE.options.crs.gcrs.vertical.min,\n                    M.CBMTILE.options.crs.gcrs.horizontal.min\n                  ],\n                  [\n                    M.CBMTILE.options.crs.gcrs.vertical.max,\n                    M.CBMTILE.options.crs.gcrs.horizontal.max\n                  ]\n                );\n              }\n            },\n            map: {\n              horizontal: {\n                name: 'i',\n                min: 0,\n                max: (map) => map.getSize().x\n              },\n              vertical: {\n                name: 'j',\n                min: 0,\n                max: (map) => map.getSize().y\n              },\n              bounds: (map) => L.bounds(L.point([0, 0]), map.getSize())\n            },\n            tile: {\n              horizontal: {\n                name: 'i',\n                min: 0,\n                max: 256\n              },\n              vertical: {\n                name: 'j',\n                min: 0,\n                max: 256\n              },\n              get bounds() {\n                return L.bounds(\n                  [\n                    M.CBMTILE.options.crs.tile.horizontal.min,\n                    M.CBMTILE.options.crs.tile.vertical.min\n                  ],\n                  [\n                    M.CBMTILE.options.crs.tile.horizontal.max,\n                    M.CBMTILE.options.crs.tile.vertical.max\n                  ]\n                );\n              }\n            },\n            tilematrix: {\n              horizontal: {\n                name: 'column',\n                min: 0,\n                max: (zoom) =>\n                  Math.round(\n                    M.CBMTILE.options.crs.tcrs.horizontal.max(zoom) /\n                      M.CBMTILE.options.crs.tile.bounds.getSize().x\n                  )\n              },\n              vertical: {\n                name: 'row',\n                min: 0,\n                max: (zoom) =>\n                  Math.round(\n                    M.CBMTILE.options.crs.tcrs.vertical.max(zoom) /\n                      M.CBMTILE.options.crs.tile.bounds.getSize().y\n                  )\n              },\n              bounds: (zoom) =>\n                L.bounds(\n                  [0, 0],\n                  [\n                    M.CBMTILE.options.crs.tilematrix.horizontal.max(zoom),\n                    M.CBMTILE.options.crs.tilematrix.vertical.max(zoom)\n                  ]\n                )\n            }\n          }\n        }\n      );\n      M.APSTILE = new L.Proj.CRS(\n        'EPSG:5936',\n        '+proj=stere +lat_0=90 +lat_ts=50 +lon_0=-150 +k=0.994 +x_0=2000000 +y_0=2000000 +datum=WGS84 +units=m +no_defs',\n        {\n          origin: [-2.8567784109255e7, 3.2567784109255e7],\n          bounds: L.bounds([\n            [-28567784.109254867, -28567784.109254755],\n            [32567784.109255023, 32567784.10925506]\n          ]),\n          resolutions: [\n            238810.813354, 119405.406677, 59702.7033384999, 29851.3516692501,\n            14925.675834625, 7462.83791731252, 3731.41895865639, 1865.70947932806,\n            932.854739664032, 466.427369832148, 233.213684916074,\n            116.606842458037, 58.3034212288862, 29.1517106145754,\n            14.5758553072877, 7.28792765351156, 3.64396382688807,\n            1.82198191331174, 0.910990956788164, 0.45549547826179\n          ],\n          crs: {\n            tcrs: {\n              horizontal: {\n                name: 'x',\n                min: 0,\n                max: (zoom) =>\n                  Math.round(\n                    M.APSTILE.options.bounds.getSize().x /\n                      M.APSTILE.options.resolutions[zoom]\n                  )\n              },\n              vertical: {\n                name: 'y',\n                min: 0,\n                max: (zoom) =>\n                  Math.round(\n                    M.APSTILE.options.bounds.getSize().y /\n                      M.APSTILE.options.resolutions[zoom]\n                  )\n              },\n              bounds: (zoom) =>\n                L.bounds(\n                  [\n                    M.APSTILE.options.crs.tcrs.horizontal.min,\n                    M.APSTILE.options.crs.tcrs.vertical.min\n                  ],\n                  [\n                    M.APSTILE.options.crs.tcrs.horizontal.max(zoom),\n                    M.APSTILE.options.crs.tcrs.vertical.max(zoom)\n                  ]\n                )\n            },\n            pcrs: {\n              horizontal: {\n                name: 'easting',\n                get min() {\n                  return M.APSTILE.options.bounds.min.x;\n                },\n                get max() {\n                  return M.APSTILE.options.bounds.max.x;\n                }\n              },\n              vertical: {\n                name: 'northing',\n                get min() {\n                  return M.APSTILE.options.bounds.min.y;\n                },\n                get max() {\n                  return M.APSTILE.options.bounds.max.y;\n                }\n              },\n              get bounds() {\n                return M.APSTILE.options.bounds;\n              }\n            },\n            gcrs: {\n              horizontal: {\n                name: 'longitude',\n                // set min/max axis values from EPSG registry area of use, retrieved 2019-07-25\n                min: -180.0,\n                max: 180.0\n              },\n              vertical: {\n                name: 'latitude',\n                // set min/max axis values from EPSG registry area of use, retrieved 2019-07-25\n                min: 60.0,\n                max: 90.0\n              },\n              get bounds() {\n                return L.latLngBounds(\n                  [\n                    M.APSTILE.options.crs.gcrs.vertical.min,\n                    M.APSTILE.options.crs.gcrs.horizontal.min\n                  ],\n                  [\n                    M.APSTILE.options.crs.gcrs.vertical.max,\n                    M.APSTILE.options.crs.gcrs.horizontal.max\n                  ]\n                );\n              }\n            },\n            map: {\n              horizontal: {\n                name: 'i',\n                min: 0,\n                max: (map) => map.getSize().x\n              },\n              vertical: {\n                name: 'j',\n                min: 0,\n                max: (map) => map.getSize().y\n              },\n              bounds: (map) => L.bounds(L.point([0, 0]), map.getSize())\n            },\n            tile: {\n              horizontal: {\n                name: 'i',\n                min: 0,\n                max: 256\n              },\n              vertical: {\n                name: 'j',\n                min: 0,\n                max: 256\n              },\n              get bounds() {\n                return L.bounds(\n                  [\n                    M.APSTILE.options.crs.tile.horizontal.min,\n                    M.APSTILE.options.crs.tile.vertical.min\n                  ],\n                  [\n                    M.APSTILE.options.crs.tile.horizontal.max,\n                    M.APSTILE.options.crs.tile.vertical.max\n                  ]\n                );\n              }\n            },\n            tilematrix: {\n              horizontal: {\n                name: 'column',\n                min: 0,\n                max: (zoom) =>\n                  Math.round(\n                    M.APSTILE.options.crs.tcrs.horizontal.max(zoom) /\n                      M.APSTILE.options.crs.tile.bounds.getSize().x\n                  )\n              },\n              vertical: {\n                name: 'row',\n                min: 0,\n                max: (zoom) =>\n                  Math.round(\n                    M.APSTILE.options.crs.tcrs.vertical.max(zoom) /\n                      M.APSTILE.options.crs.tile.bounds.getSize().y\n                  )\n              },\n              bounds: (zoom) =>\n                L.bounds(\n                  [0, 0],\n                  [\n                    M.APSTILE.options.crs.tilematrix.horizontal.max(zoom),\n                    M.APSTILE.options.crs.tilematrix.vertical.max(zoom)\n                  ]\n                )\n            }\n          }\n        }\n      );\n      M.OSMTILE = L.CRS.EPSG3857;\n      L.setOptions(M.OSMTILE, {\n        origin: [-20037508.342787, 20037508.342787],\n        bounds: L.bounds([\n          [-20037508.342787, -20037508.342787],\n          [20037508.342787, 20037508.342787]\n        ]),\n        resolutions: [\n          156543.0339, 78271.51695, 39135.758475, 19567.8792375, 9783.93961875,\n          4891.969809375, 2445.9849046875, 1222.9924523438, 611.49622617188,\n          305.74811308594, 152.87405654297, 76.437028271484, 38.218514135742,\n          19.109257067871, 9.5546285339355, 4.7773142669678, 2.3886571334839,\n          1.1943285667419, 0.59716428337097, 0.29858214168549, 0.14929107084274,\n          0.074645535421371, 0.03732276771068573, 0.018661383855342865,\n          0.009330691927671432495\n        ],\n        crs: {\n          tcrs: {\n            horizontal: {\n              name: 'x',\n              min: 0,\n              max: (zoom) =>\n                Math.round(\n                  M.OSMTILE.options.bounds.getSize().x /\n                    M.OSMTILE.options.resolutions[zoom]\n                )\n            },\n            vertical: {\n              name: 'y',\n              min: 0,\n              max: (zoom) =>\n                Math.round(\n                  M.OSMTILE.options.bounds.getSize().y /\n                    M.OSMTILE.options.resolutions[zoom]\n                )\n            },\n            bounds: (zoom) =>\n              L.bounds(\n                [\n                  M.OSMTILE.options.crs.tcrs.horizontal.min,\n                  M.OSMTILE.options.crs.tcrs.vertical.min\n                ],\n                [\n                  M.OSMTILE.options.crs.tcrs.horizontal.max(zoom),\n                  M.OSMTILE.options.crs.tcrs.vertical.max(zoom)\n                ]\n              )\n          },\n          pcrs: {\n            horizontal: {\n              name: 'easting',\n              get min() {\n                return M.OSMTILE.options.bounds.min.x;\n              },\n              get max() {\n                return M.OSMTILE.options.bounds.max.x;\n              }\n            },\n            vertical: {\n              name: 'northing',\n              get min() {\n                return M.OSMTILE.options.bounds.min.y;\n              },\n              get max() {\n                return M.OSMTILE.options.bounds.max.y;\n              }\n            },\n            get bounds() {\n              return M.OSMTILE.options.bounds;\n            }\n          },\n          gcrs: {\n            horizontal: {\n              name: 'longitude',\n              get min() {\n                return M.OSMTILE.unproject(M.OSMTILE.options.bounds.min).lng;\n              },\n              get max() {\n                return M.OSMTILE.unproject(M.OSMTILE.options.bounds.max).lng;\n              }\n            },\n            vertical: {\n              name: 'latitude',\n              get min() {\n                return M.OSMTILE.unproject(M.OSMTILE.options.bounds.min).lat;\n              },\n              get max() {\n                return M.OSMTILE.unproject(M.OSMTILE.options.bounds.max).lat;\n              }\n            },\n            get bounds() {\n              return L.latLngBounds(\n                [\n                  M.OSMTILE.options.crs.gcrs.vertical.min,\n                  M.OSMTILE.options.crs.gcrs.horizontal.min\n                ],\n                [\n                  M.OSMTILE.options.crs.gcrs.vertical.max,\n                  M.OSMTILE.options.crs.gcrs.horizontal.max\n                ]\n              );\n            }\n          },\n          map: {\n            horizontal: {\n              name: 'i',\n              min: 0,\n              max: (map) => map.getSize().x\n            },\n            vertical: {\n              name: 'j',\n              min: 0,\n              max: (map) => map.getSize().y\n            },\n            bounds: (map) => L.bounds(L.point([0, 0]), map.getSize())\n          },\n          tile: {\n            horizontal: {\n              name: 'i',\n              min: 0,\n              max: 256\n            },\n            vertical: {\n              name: 'j',\n              min: 0,\n              max: 256\n            },\n            get bounds() {\n              return L.bounds(\n                [\n                  M.OSMTILE.options.crs.tile.horizontal.min,\n                  M.OSMTILE.options.crs.tile.vertical.min\n                ],\n                [\n                  M.OSMTILE.options.crs.tile.horizontal.max,\n                  M.OSMTILE.options.crs.tile.vertical.max\n                ]\n              );\n            }\n          },\n          tilematrix: {\n            horizontal: {\n              name: 'column',\n              min: 0,\n              max: (zoom) =>\n                Math.round(\n                  M.OSMTILE.options.crs.tcrs.horizontal.max(zoom) /\n                    M.OSMTILE.options.crs.tile.bounds.getSize().x\n                )\n            },\n            vertical: {\n              name: 'row',\n              min: 0,\n              max: (zoom) =>\n                Math.round(\n                  M.OSMTILE.options.crs.tcrs.vertical.max(zoom) /\n                    M.OSMTILE.options.crs.tile.bounds.getSize().y\n                )\n            },\n            bounds: (zoom) =>\n              L.bounds(\n                [0, 0],\n                [\n                  M.OSMTILE.options.crs.tilematrix.horizontal.max(zoom),\n                  M.OSMTILE.options.crs.tilematrix.vertical.max(zoom)\n                ]\n              )\n          }\n        }\n      });\n    })();\n\n    M._handleLink = Util._handleLink;\n    M.convertPCRSBounds = Util.convertPCRSBounds;\n    M.axisToXY = Util.axisToXY;\n    M.csToAxes = Util.csToAxes;\n    M._convertAndFormatPCRS = Util._convertAndFormatPCRS;\n    M.extentToBounds = Util.extentToBounds;\n    M.axisToCS = Util.axisToCS;\n    M._parseNumber = Util._parseNumber;\n    M._splitCoordinate = Util._splitCoordinate;\n    M.boundsToPCRSBounds = Util.boundsToPCRSBounds;\n    M.pixelToPCRSBounds = Util.pixelToPCRSBounds;\n    M._metaContentToObject = Util._metaContentToObject;\n    M._coordsToArray = Util._coordsToArray;\n    M.pointToPCRSPoint = Util.pointToPCRSPoint;\n    M.pixelToPCRSPoint = Util.pixelToPCRSPoint;\n    M._gcrsToTileMatrix = Util._gcrsToTileMatrix;\n    M._pasteLayer = Util._pasteLayer;\n    M._properties2Table = Util._properties2Table;\n    M._updateExtent = Util._updateExtent;\n    M.geojson2mapml = Util.geojson2mapml;\n    M._breakArray = Util._breakArray;\n    M._table2properties = Util._table2properties;\n    M._geometry2geojson = Util._geometry2geojson;\n    M._pcrsToGcrs = Util._pcrsToGcrs;\n    M.mapml2geojson = Util.mapml2geojson;\n    M.getMaxZoom = Util.getMaxZoom;\n    M.getBoundsFromMeta = Util.getBoundsFromMeta;\n    M.getZoomBoundsFromMeta = Util.getZoomBoundsFromMeta;\n    M.getZoomBounds = Util.getZoomBounds;\n    M.getNativeVariables = Util.getNativeVariables;\n    M.getClosest = Util.getClosest;\n\n    M.QueryHandler = QueryHandler;\n    M.ContextMenu = ContextMenu;\n    M.AnnounceMovement = AnnounceMovement;\n    M.FeatureIndex = FeatureIndex;\n\n    // see https://leafletjs.com/examples/extending/extending-3-controls.html#handlers\n    L.Map.addInitHook('addHandler', 'query', M.QueryHandler);\n    L.Map.addInitHook('addHandler', 'contextMenu', M.ContextMenu);\n    L.Map.addInitHook('addHandler', 'announceMovement', M.AnnounceMovement);\n    L.Map.addInitHook('addHandler', 'featureIndex', M.FeatureIndex);\n\n    M.MapMLLayer = MapMLLayer;\n    M.mapMLLayer = mapMLLayer;\n\n    M.ImageLayer = ImageLayer;\n    M.imageLayer = imageLayer;\n\n    M.TemplatedImageLayer = TemplatedImageLayer;\n    M.templatedImageLayer = templatedImageLayer;\n\n    M.TemplatedFeaturesLayer = TemplatedFeaturesLayer;\n    M.templatedFeaturesLayer = templatedFeaturesLayer;\n\n    M.ExtentLayer = ExtentLayer;\n    M.extentLayer = extentLayer;\n\n    M.TemplatedTileLayer = TemplatedTileLayer;\n    M.templatedTileLayer = templatedTileLayer;\n\n    M.FeatureLayer = FeatureLayer;\n    M.featureLayer = featureLayer;\n\n    M.LayerControl = LayerControl;\n    M.layerControl = layerControl;\n\n    M.AttributionButton = AttributionButton;\n    M.attributionButton = attributionButton;\n\n    M.ReloadButton = ReloadButton;\n    M.reloadButton = reloadButton;\n\n    M.ScaleBar = ScaleBar;\n    M.scaleBar = scaleBar;\n\n    M.FullscreenButton = FullscreenButton;\n    M.fullscreenButton = fullscreenButton;\n\n    M.geolocationButton = geolocationButton;\n\n    M.StaticTileLayer = StaticTileLayer;\n    M.staticTileLayer = staticTileLayer;\n\n    M.DebugOverlay = DebugOverlay;\n    M.debugOverlay = debugOverlay;\n\n    M.Crosshair = Crosshair;\n    M.crosshair = crosshair;\n\n    M.FeatureIndexOverlay = FeatureIndexOverlay;\n    M.featureIndexOverlay = featureIndexOverlay;\n\n    M.Path = Path;\n    M.path = path;\n\n    M.FeatureRenderer = FeatureRenderer;\n    M.featureRenderer = featureRenderer;\n\n    M.Geometry = Geometry;\n    M.geometry = geometry;\n\n    // element support\n    M._createLayerControlExtentHTML = createLayerControlExtentHTML;\n    M._createLayerControlHTML = createLayerControlHTML;\n    M.ZoomInput = ZoomInput;\n    M.HiddenInput = HiddenInput;\n    M.WidthInput = WidthInput;\n    M.HeightInput = HeightInput;\n    M.LocationInput = LocationInput;\n\n    // constants\n    M.TILE_SIZE = 256;\n    M.FALLBACK_PROJECTION = 'OSMTILE';\n    M.FALLBACK_CS = 'TILEMATRIX';\n    M.BLANK_TT_TREF = 'mapmltemplatedtileplaceholder';\n\n    M.DOMTokenList = DOMTokenList;\n  })(window);\n\n}());\n"],"names":["staticTileLayer","options","StaticTileLayer","layerControl","layers","LayerControl","featureLayer","mapml","FeatureLayer","templatedTileLayer","template","TemplatedTileLayer","extentLayer","ExtentLayer","templatedFeaturesLayer","TemplatedFeaturesLayer","templatedImageLayer","TemplatedImageLayer","imageLayer","url","location","size","angle","container","ImageLayer","mapMLLayer","node","MapMLLayer","debugOverlay","DebugOverlay","L","GridLayer","extend","initialize","setOptions","this","zoomBounds","_getZoomBounds","tileContainer","maxZoomBound","_groups","_groupTiles","getElementsByTagName","_bounds","_getLayerBounds","projection","layerBounds","Object","keys","let","key","min","max","onAdd","map","_map","prototype","call","_handleMoveEnd","getEvents","events","_parentOnMoveEnd","moveend","move","isVisible","mapZoom","getZoom","zoomLevel","maxNativeZoom","minNativeZoom","maxZoom","minZoom","overlaps","M","pixelToPCRSBounds","getPixelBounds","e","_isValidTile","coords","_tileCoordsToKey","createTile","tileGroup","tileElem","document","createElement","tileSize","getTileSize","setAttribute","x","y","z","i","length","tile","width","height","alt","src","appendChild","tileGroups","crs","bounds","sCoords","split","pixelCoords","point","pixelBounds","zoom","meta","_metaContentToObject","_leafletLayer","_layerEl","querySelector","getAttribute","tiles","nativeZoom","value","lZoom","Math","tileMap","row","col","tileCode","push","Control","Layers","autoZIndex","sortLayers","sortFunction","layerA","layerB","zIndex","overlays","_layerControlInputs","_layers","_lastZIndex","_handlingClick","_addLayer","_initLayout","DomEvent","on","_container","_focusFirstLayer","_preventDefaultContextMenu","_update","_showControls","onRemove","off","addOrUpdateOverlay","layer","name","alreadyThere","addOverlay","removeAttribute","removeLayer","_checkDisabledLayers","elem","className","children","setTimeout","focus","DomUtil","empty","_baseLayersList","_overlaysList","baseLayersPresent","overlaysPresent","obj","baseLayersCount","sort","a","b","_addItem","overlay","hideSingleBase","style","display","_separator","layercontrols","_layerControlHTML","input","layerId","stamp","collapse","includes","contextMenu","_extentLayerMenu","hidden","_layerMenu","target","tagName","relatedTarget","parentElement","removeClass","originalEvent","pointerType","_isExpanded","latlng","mouseEventToLatLng","containerPoint","mouseEventToContainerPoint","preventDefault","fire","FeatureGroup","query","create","pane","addClass","renderer","_queryFeatures","features","_features","_staticFeature","mapEl","withinZoom","_validateRendering","showPaginationFeature","addLayer","layerToAdd","featureZoom","mapmlFeature","addRendering","featureToAdd","remove","featureIndex","cleanIndex","featureToRemove","_leaflet_id","_removeFromFeaturesList","id","removeRendering","feature","splice","zoomend","_handleZoomEnd","type","_linkEl","shadowRoot","replaceChildren","clearLayers","addFeature","popup","_navigationBar","innerText","_totalFeatureCount","_content","srcdoc","innerHTML","currFeature","once","_removeCSS","hasLayer","k","geometry","renderable","_checkRender","placeholder","defaultOptions","group","parentNode","replaceWith","insertAdjacentElement","_setZoomTransform","center","clampZoom","scale","getZoomScale","translate","multiplyBy","subtract","_getNewPixelOrigin","round","any3d","setTransform","setPosition","createGeometry","fallbackCS","tileZoom","assign","filter","classList","title","properties","add","insertAdjacentHTML","cs","extentToBounds","extent","_geometryToLayer","color","hasAttribute","resetStyle","onEachFeature","bindTooltip","interactive","sticky","toUpperCase","_groupEl","Util","_setLayerStyle","setStyle","eachLayer","toDelete","querySelectorAll","removeChild","vectorOptions","svgGroup","SVG","copyOptions","_featureEl","geo","path","nativeCS","featureID","wrappers","_getGeometryParents","groupOptions","accessibleTitle","collections","subType","elems","concat","TileLayer","tms","_setUpTileTemplateVars","linkEl","extentBounds","_template","_initContainer","child","getMapEl","mapBounds","_updateZIndex","dispatchEvent","CustomEvent","detail","appendTile","startsWith","_url","BLANK_TT_TREF","_fetchTile","_mapmlTileReady","getPane","getTileUrl","fetch","redirect","then","response","status","Promise","resolve","console","log","reject","text","DOMParser","parseFromString","_createFeatures","catch","_parseStylesheetAsHTML","base","Element","URL","href","styleElm","ss","stylesheets","nodeName","linkElm","copyAttributes","textContent","s","source","Array","from","attributes","forEach","attribute","nodeValue","markup","svg","g","xOffset","yOffset","tileFeatures","fallback","getNativeVariables","FeatureRenderer","_initPath","_project","_addPath","_updateFeature","toString","tilematrix","contains","v","zoomInput","_getZoomForUrl","pcrs","easting","left","_tileMatrixToPCRSPosition","right","northing","top","bottom","indexOf","infinite","invertedY","_globalTileRange","r","detectRetina","Browser","retina","pos","nwPoint","scaleBy","sePoint","centrePoint","floor","nw","transformation","untransform","se","cen","result","Point","east","north","inputs","values","units","axis","position","select","toLowerCase","horizontal","resolutions","isNaN","Number","parseFloat","vertical","match","parsedselect","htmlselect","pcrs2tilematrix","c","transform","divideBy","bind","initialValue","boundsToPCRSBounds","axisToCS","pcrsBounds","zmin","zmax","_clampZoom","clamp","step","LayerGroup","_extentEl","extentEl","changeOpacity","opacity","zoomstart","_onZoomStart","closePopup","getContainer","parentLayer","_layer","redraw","setZIndex","undefined","_previousFeature","_count","_nextFeature","_source","_opacity","_opacitySlider","appendStyleLink","mapLink","link","positionAndNode","_getStylePositionAndNode","lastChild","appendStyleElement","mapStyle","styleElement","Layer","_setUpFeaturesTemplateVars","_onMoveEnd","addTo","featureRenderer","bindPopup","autoClose","minWidth","parent","history","_history","current","previous","steppedZoom","headers","parser","context","_pullFeatureFeed","scaleBounds","getCenter","_getfeaturesUrl","Headers","Accept","limit","frag","createDocumentFragment","elements","featuresReady","whenReady","allSettled","_updateTabIndex","error","layerNum","_path","childElementCount","getSize","_TCRSToPCRS","featuresVarNames","_setUpExtentTemplateVars","_clearLayer","_onAdd","containerImages","_addImage","loc","overlayToRemove","_imageOverlay","getImageUrl","_step","_overlayToRemove","_scaleImage","_image","_pixelOrigins","getPixelOrigin","pixelOrigin","extentVarNames","ImageOverlay","_location","_size","_angle","viewreset","_reset","_zoomAnimated","zoomanim","_animateZoom","load","_onImageLoad","_initImage","addInteractiveTarget","removeInteractiveTarget","loaded","Date","_updateOpacity","image","nextFrame","fade","now","setOpacity","cancelAnimFrame","_fadeFrame","requestAnimFrame","layerEl","_href","_mapmlTileContainer","_initialize","getHref","titleIsReadOnly","_titleIsReadOnly","setName","newName","_title","getName","_staticTileLayer","_attachSkipButtons","_calculateBounds","projectionBounds","getBoundsFromMeta","getZoomBoundsFromMeta","mapExtents","zoomMax","zoomMin","Infinity","mapExtentLayer","_extentLayer","getAttribution","attribution","getBase","baseURI","native","licenseLink","licenseTitle","licenseUrl","attText","legendLink","_legendUrl","attributionControl","addAttribution","parseLicenseAndLegend","trim","newTiles","nt","importNode","processTiles","_mapmlvectors","_toggleControls","getQueryTemplates","queryLinks","templates","getBounds","_templateVars","content","getElementsByClassName","_eventParents","attachZoomLink","mapExtent","div","mapFocusButton","stop","_sortIndex","previousButton","featureCount","totalFeatures","nextButton","controlFocusButton","currentIndex","inBoundFeatures","_controlContainer","divider","focusFeature","focusEvent","composedPath","isTab","keyCode","shiftPressed","shiftKey","focusMap","stopPropagation","_popupClosed","featureEl","_groupLayer","tL","topLeft","gcrs","bR","bottomRight","latLngBounds","latLng","zoomLink","getZoomToZoom","lng","lat","locale","popupZoom","onclick","onkeydown","MouseEvent","zoomTo","insertBefore","featureIndexOverlayOption","removeHandlers","removeEvent","mapSize","_panel","debugPanel","_grid","debugGrid","_panes","mapPane","_vectors","debugVectors","toolPane","DebugPanel","debug","_infoContainer","_debugContainer","infoContainer","_tileCoord","_tileMatrixCoord","_mapCoord","_tcrsCoord","_pcrsCoord","_gcrsCoord","_updateCoords","_visible","project","pointI","pointJ","trunc","toFixed","DebugGrid","join","outline","DebugVectors","_mapLayerUpdate","_centerVector","circle","pointToLatLng","radius","_addBounds","colors","j","boundsArray","boundsTestTag","getLayerEl","boundsRect","projectedExtent","weight","fillOpacity","fill","totalBounds","totalLayerBounds","totalBoundsArray","ProjectedExtent","Path","unproject","_locations","locations","_rings","_subtract","_parts","_renderer","_updatePoly","QueryHandler","Handler","addHooks","_queryTopLayer","_queryTopLayerAtMapCenter","removeHooks","_getTopQueryableLayer","l","queryable","event","isFocused","layerPoint","latLngToLayerPoint","latLngToContainerPoint","_mapmlFeatures","_query","tcrs2pcrs","tcrs2gcrs","popupOptions","autoPan","maxHeight","tcrsClickLoc","latLngToPoint","tileMatrixClickLoc","tileBounds","Bounds","ceil","pcrsClick","fetches","tilei","tilej","mapi","mapj","pixelleft","pixeltop","pixelright","pixelbottom","column","longitude","latitude","mapbottom","mapleft","maptop","mapright","tilebottom","tileleft","tiletop","tileright","contenttype","get","Error","geom","mapmldoc","geometrylessFeatures","f","firstElementChild","cloneNode","slice","queryMetas","featureDocument","featureCollection","err","html","featureDoc","body","append","message","fetchFeatures","results","openPopup","_popup","displayFeaturesPopup","ContextMenu","_touchstart","msPointer","pointer","activeIndex","excludedIndices","isRunned","_menuItems","CTXBACK","CTXFWD","CTXRELOAD","CTXFULLSCR","CTXSPACER1","CTXCOPY","CTXPASTE","CTXSPACER2","CTXCNTRLS","CTXDEBUG","CTXVWSRC","_items","cmBack","callback","_goBack","cmForward","_goForward","cmReload","_reload","btnFullScreen","_toggleFullScreen","spacer","cmCopyCoords","_copyCoords","hideOnSelect","submenu","cmCopyMapML","_copyMapML","cmCopyExtent","_copyExtent","cmCopyLocation","_copyLocation","cmPasteLayer","_paste","cmToggleControls","cmToggleDebug","_toggleDebug","cmViewSource","_viewSource","defExtCS","defaultExtCoor","defLocCS","defaultLocCoor","LYRZOOMTO","LYRCOPY","_layerItems","lmZoomToLayer","_zoomToLayer","lmCopyLayer","_copyLayer","_extentLayerItems","lmZoomToExtent","_zoomToMapExtent","lmCopyExtent","_copyMapExtent","_mapMenuVisible","_keyboardEvent","el","_createItem","_copySubMenu","_clickEvent","CPYMENUMAP","CPYMENUEXTENT","CPYMENULOC","t","_hide","_onKeyDown","touch","contextmenu","_show","mousedown","_updateCS","KeyboardEvent","coord","data","_copyData","_layerClicked","layerElem","getOuterHTML","extentElem","forward","back","reload","controls","outerHTML","replace","navigator","clipboard","readText","_pasteLayer","viewSource","toggleDebug","directory","_showCopySubMenu","execCommand","menu","_copyTile","_copyTileMatrix","_copyMap","_copyTCRS","_copyPCRS","_copyGCRS","click","caption","h2","pt","pointX","pointY","mapPt","_copyAllCoords","allData","index","_createSeparator","_insertElementAt","_createEventHandler","_onItemMouseOver","_onItemMouseOut","func","_showLocation","containerPointToLayerPoint","layerPointToLatLng","refEl","closest","_showAtPoint","layerList","find","checked","gecko","w","getBoundingClientRect","h","parseInt","activeEl","button","activeElement","_elementInFocus","_layerMenuTabs","firstChild","_extentLayerMenuTabs","_setPosition","anchor","containerSize","_getElementSize","contextmenuAnchor","_leaflet_pos","_sizeChanged","offsetWidth","offsetHeight","_focusOnLayerControl","_setActiveItem","noActiveEl","next","disabled","nextIndex","prevIndex","code","copyEl","menuWidth","submenuWidth","_hideCopySubMenu","srcElement","toggleContextMenuItem","state","setViewFullScreenInnerHTML","btnExitFullScreen","tcrsTopLeft","tcrsBottomRight","tileMatrixTopLeft","tileMatrixBottomRight","minConverted","maxConverted","unprojectedMin","unprojectedMax","tcrs","FALLBACK_CS","isFinite","minPixel","maxPixel","minGCRS","maxGCRS","pixelToPCRSPoint","pointToPCRSPoint","contentArray","stringSplit","prop","containerPoints","pairs","element","array","_parseNumber","leafletLayer","justPan","hash","inPlace","window","open","postTraversalSetup","lon","pseudo","ShadowRoot","FALLBACK_PROJECTION","metaKeys","axes","csToAxes","nMin","nMax","mapmlEl","dfLayer","lastElementChild","dfPastedLayer","geojson2mapml","JSON","parse","json","table","thead","createTHead","insertRow","th1","th2","createTextNode","tbody","createTBody","hasOwnProperty","th","td","bboxExtent","label","geometryFunction","jsonType","out","setExtent","bbox","xmlStringLayer","multiPoint","linestring","multilinestring","polygon","multiPolygon","geometrycollection","NEGATIVE_INFINITY","clone_feature","curr_feature","featureCaption","p","HTMLElement","_properties2Table","_updateExtent","coordinates","clone_point","clone_coords","clone_linestring","linestring_coordindates","clone_polygon","clone_multipoint","clone_multilinestring","m","geometries","fg","arr","arrayOfArrays","test","tableData","tr","dest","pointConv","proj4","_breakArray","_pcrsToGcrs","poly","newArr","conv","propertyFunction","Proj","metas","ex","num","_table2properties","prop0","_geometry2geojson","geoms","n","bound","newZoom","mapCenterTCRS","mapHalf","mapTlNew","mapBrNew","mapTlPCRSNew","mapBrPCRSNew","mapPCRS","zOffset","selector","getClosest","host","matches","AttributionButton","Attribution","prefix","disableClickPropagation","_addAttribution","dialog","kbdShortcuts","kbdMovement","kbdPanUp","kbdPanDown","kbdPanLeft","kbdPanRight","btnZoomIn","btnZoomOut","kbdPanIncrement","kbdZoom","kbdFeature","kbdPrevFeature","kbdNextFeature","attribs","_attributions","prefixAndAttribs","btnAttribution","Map","mergeOptions","toggleableAttributionControl","addInitHook","attributionButton","reloadButton","ReloadButton","scaleBar","ScaleBar","_goReload","_reloadButton","_updateDisabled","disable","_disabled","enable","Scale","maxWidth","updateWhenIdle","scaleControl","_scaleControl","_updateOutput","_focusOutput","addEventListener","_pixelsToDistance","px","dpi","devicePixelRatio","_scaleLength","scaleLength","outputFocus","output","scaleLine","distance","metric","FullscreenButton","false","true","_toggleTitle","_click","toggleFullscreen","isFullscreen","include","_isFullscreen","pseudoFullscreen","_disablePseudoFullscreen","exitFullscreen","mozCancelFullScreen","webkitCancelFullScreen","msExitFullscreen","_enablePseudoFullscreen","requestFullscreen","mozRequestFullScreen","webkitRequestFullscreen","ALLOW_KEYBOARD_INPUT","msRequestFullscreen","_setFullscreen","fullscreen","invalidateSize","_onFullscreenChange","fullscreenElement","fullscreenControl","fullscreenchange","onFullscreenChange","addControl","fullscreenButton","geolocationButton","GeolocationButton","crosshair","Crosshair","Geometry","CustomLocate","Locate","start","locateControl","showPopup","strings","btnLocTrackOff","locateOptions","MutationObserver","mutations","btnLocTrackOn","_marker","btnMyLocTrackOn","permanent","btnLocTrackLastKnown","btnMyLastKnownLocTrackOn","observe","attributeFilter","_isQueryable","_toggleEvents","_isMapFocused","_addOrRemoveCrosshair","_hasQueryableLayer","_addOrRemoveMapOutline","mapContainer","_outline","isLeafletContainer","_convertWrappers","_markup","_convertMarkup","_generateOutlinePoints","isClosed","_isClosed","attachLinkHandler","dragStart","hovered","handleMouse","visited","clientX","clientY","mouseup","onTop","nextLayer","nextElementSibling","eventPhase","Event","BUBBLING_PHASE","sqrt","pow","_handleLink","currentTarget","resolver","mapWidth","clientWidth","substring","mouseout","mouseenter","addedMap","tileOrigin","zoomingTo","origin","pixelRings","_convertRing","rings","subP","subrings","pixelSubrings","pixelOutline","o","parts","sub","interm","points","attr","featureAttributes","tabindex","first","ring","subRings","_coordinateToArrays","cls","class","nodes","childNodes","cur","tempDiv","prev","line","ind","main","subParts","isFirst","parents","span","noSpan","local","numPair","attrMap","wrapperAttr","unshift","linkTarget","linkType","getPCRSCenter","stampLayer","outlinePath","_createPath","stroke","_updateStyle","entries","_rootGroup","outlineAdded","_removePath","_setPath","geometryToPath","_pointToMarker","_updatePathStyle","isMain","isOutline","lineCap","lineJoin","dashArray","dashOffset","fillColor","fillRule","def","closed","str","len","len2","firstLayer","_openPopup","_handleFocus","updateInteraction","layerID","addToIndex","part","subPart","vectorMinZoom","vectorMaxZoom","openTooltip","closeTooltip","prevFocus","nextFocus","AnnounceMovement","layeradd","layerremove","announceBounds","dragging","_draggable","dragged","focusAnnouncement","removeEventListener","standard","amZoom","getMaxZoom","amMaxZoom","_layersMinZoom","amMinZoom","_traversalCall","visible","getMinZoom","outOfBoundsPos","prevZoom","_historyIndex","inBoundsPos","pop","amZoomedOut","wasDragged","amDraggedOut","amEastBound","amWestBound","amNorthBound","amSouthBound","whenLayersReady","FeatureIndex","outBoundFeatures","_mapPCRSBounds","_updateMapBounds","lc","mc","dist","tmp","inbound","ac","bc","Options","announceMovement","announceScale","imperial","lcOpacity","amColumn","amRow","dfExtent","fIndexNoFeatures","Keyboard","altKey","metaKey","offset","_panKeys","_panAnim","_inProgress","ctrlKey","panBy","maxBounds","panInsideBounds","_zoomKeys","187","107","61","171","189","109","54","173","setZoom","closeOnEscapeKey","featureIndexOverlay","FeatureIndexOverlay","createLayerControlExtentHTML","extentProperties","extentSettings","extentLabel","svgExtentControlIcon","extentControlPath1","extentControlPath2","extentNameIcon","extentItemControls","opacityControl","extentOpacitySummary","mapSelects","selectdetails","removeExtentButton","extentsettingsButton","extentItemNameSpan","defaultChecked","_layerControlCheckbox","ontouchstart","onmousedown","downEvent","TouchEvent","touches","control","moving","yPos","originalPosition","ontouchmove","onmousemove","moveEvent","abs","pointerEvents","root","elementAt","elementFromPoint","swapControl","nextSibling","ontouchend","onmouseup","newPosition","controlsElems","extentZIndex","_extentRootFieldset","_opacityControl","_layerControlLabel","async","createLayerControlHTML","fieldset","layerItemName","settingsButtonNameIcon","layerItemProperty","layerItemSettings","itemToggleLabel","layerItemControls","opacityControlSummary","svgSettingsControlIcon","settingsControlPath1","settingsControlPath2","extentsFieldset","removeControlButton","disbaled","previousElementSibling","itemSettingControlButton","_layerControl","draggable","styleLinks","styles","getAlternateStyles","_layerItemSettingsHTML","_propertiesGroupAnatomy","_styles","mapExtentLayerControls","all","getLayerControlHTML","_output","_body","initialFocus","_addOrRemoveFeatureIndex","_checkOverlap","_calculateReticleBounds","wRatio","hRatio","reticleDimension","getComputedStyle","minPoint","maxPoint","popupClosed","featureIndexBounds","noFeaturesMessage","allFeatures","_addToggleKeys","_newContent","direction","newContent","ZoomInput","constructor","validateInput","getValue","HiddenInput","WidthInput","HeightInput","LocationInput","rel","axisCS","_templates","_getTiledPixelBounds","tileRange","_pxBoundsToTileRange","_tileZoom","DOMTokenList","#element","#valueSet","#attribute","#domain","domain","hostingElement","domtokenlist","valueSet","val","item","token","oldToken","newToken","supports","toggle","force","thisArg","detectImagePath","getStyle","mime","mapOptions","head","WGS84","CRS","CBMTILE","APSTILE","OSMTILE","EPSG3857","convertPCRSBounds","axisToXY","_convertAndFormatPCRS","_splitCoordinate","_coordsToArray","_gcrsToTileMatrix","mapml2geojson","getZoomBounds","_createLayerControlExtentHTML","_createLayerControlHTML","TILE_SIZE"],"mappings":"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"}