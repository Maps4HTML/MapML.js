<!DOCTYPE html>
<html lang="en">
  <head>
    <title>domApi-HTMLLayerElement.html</title>
    <meta charset="UTF-8">
    <script type="module" src="mapml-viewer.js"></script>
  </head>
  <body>
    <template>
      <layer- id="remote-with-title" label="This should not appear in layer control" src="with-title.mapml" checked></layer->
      <layer- id="remote-no-title" label="Layer with name settable via HTMLLayerElement.label" src="no-title.mapml" checked></layer->
      <layer- id="local-no-title" label="Another Layer with name settable via HTMLLayerElement.label" checked>
        <map-meta name="projection" content="OSMTILE"></map-meta>
        <map-feature id="hg" zoom="3" min="0" max="22">
          <map-featurecaption>Statue of a guy with a hat</map-featurecaption>
            <map-geometry cs="gcrs">
              <map-point>
                <map-coordinates>-75.70628 45.39878</map-coordinates>
              </map-point>
            </map-geometry>
            <map-properties>
              <h1>A Man With Two Hats</h1>
            </map-properties>
        </map-feature>
      </layer->
      <layer- id="local-with-title" label="This should not appear in layer control" checked>
        <map-title>Layer name set via local map-title element - unsettable via HTMLLayerelement.label</map-title>
        <map-meta name="projection" content="OSMTILE"></map-meta>
        <map-feature id="hg" zoom="3" min="0" max="22">
          <map-featurecaption>Statue of a guy with a hat</map-featurecaption>
            <map-geometry cs="gcrs">
              <map-point>
                <map-coordinates>-75.70528 45.39778</map-coordinates>
              </map-point>
            </map-geometry>
            <map-properties>
              <h1>A Man With Two Hats</h1>
            </map-properties>
        </map-feature>
      </layer->
    </template>
  <mapml-viewer projection="OSMTILE" controls  zoom="15" lat="45.39778" lon="-75.70528" width="500" height="500">
  </mapml-viewer>
  </body>
  <script>
    
    let remoteWithTitle = document.querySelector('template').content.cloneNode(true).querySelector('#remote-with-title');
    remoteWithTitle = document.querySelector('mapml-viewer').appendChild(remoteWithTitle);
    let remoteNoTitle = document.querySelector('template').content.cloneNode(true).querySelector('#remote-no-title');
    remoteNoTitle  = document.querySelector('mapml-viewer').appendChild(remoteNoTitle);
    let localNoTitle = document.querySelector('template').content.cloneNode(true).querySelector('#local-no-title');
     localNoTitle = document.querySelector('mapml-viewer').appendChild(localNoTitle);
    let localWithTitle = document.querySelector('template').content.cloneNode(true).querySelector('#local-with-title');
     localWithTitle = document.querySelector('mapml-viewer').appendChild(localWithTitle);
     
   
    addEventListener("loadedmetadata", (e) => {
      if (e.target === remoteWithTitle) {
        // setting label should not change the layer name in layer control
        remoteWithTitle.label = "Unforsettable in every way"; 
      } else if (e.target === remoteNoTitle) {
        // setting label should set the layer name in layer control
        remoteNoTitle.label = "Bedtime For Bonzo";  
      } else if (e.target === localWithTitle) {
        // setting label should not set the layer name in layer control
        localWithTitle.label = "No dice, buddy!";
      } else if (e.target === localNoTitle) {
        // setting label should set the layer name in layer control
        // but because the layer is not fully initialized, need to wait unit
        // it triggers the createmap event, which eventually creates layer-._layer
        // but if we run this too early, before createmap, then the setter
        // for label does not have any (desired) side effects, namely running
        // layer-._layer.setName(labelValue). hence setTimeout.
        setTimeout(()=>{
          localNoTitle.label = "Go ahead, make my day!"; 
        }, 500);
      }
    }, {capture: true});
  
  </script>
</html>